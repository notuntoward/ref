{"path":"lit/lit_sources/Martin18germanMktLOB.pdf","text":"German Intraday Electricity Market Analysis and Modeling based on the Limit Order Book Henry Martin Institute of Cartography and Geoinformation ETH Zurich, Stefano-Franscini-Platz 5 8093 Zurich, Switzerland e-mail: martinhe@ethz.ch Scott Otterson Fraunhofer Institute for Energy Economics and Energy System Technology 34119 Kassel, Germany e-mail: scotto@sharpleaf.org Abstract—This paper presents a market model for the EPEX SPOT German continuous intraday market for electric power trading based on the limit order book (LOB). We use the EPEX SPOT M7 order book data, which contains all orders submitted to the German continuous intraday market, to simulate the historic course of the market. Thereby, we reconstruct the complete state of the LOB at every point in (trading) time. We validate our simulation by comparing the transactions that our simulation generated with the actual historical transactions available from a different data set. The LOB based market model can be used to include price volatility risk and illiquidity risk when simulating trading at the EPEX SPOT continuous intraday market. Furthermore, we present all preprocessing steps and decision rules necessary to correctly identify orders from the often ambiguous EPEX SPOT M7 order book data. I. INTRODUCTION A. The Importance of the German Continuous Intraday Market From 2010 to 2016, the power generation from intermittent renewable energy sources in Germany rose by about 100 % from 82 TWh to 161 TWh [BNetzA Bundesnetzagentur, 2017, p. 68]. In the same time, the volume traded at the German continuous intraday market rose by about 400 % from 10 TWh to 41 TWh [BNetzA Bundesnetzagentur, 2017, p. 189]. The German continuous intraday market is of great importance for the trading of renewable energy generation in Germany because it offers the possibility to trade power shortly before the start of power delivery. Market participants can take advantage of precise short-term forecasts to either trade with a lower risk of forecast errors or to correct trading errors made at an earlier point in time (e.g. at the day-ahead market). This allows to avoid the usage of expensive and security relevant balancing power. At the same time, the German continuous intraday market becomes interesting for ﬂexible energy applications like demand-side-management [Siano and Sarno, 2016], cogeneration [Mitra et al., 2013], or virtual power plants [Wille-Haussmann et al., 2010], that can generate proﬁt by providing their ﬂexibility at the market [Goutte and Vassilopoulos, 2017] [Resch et al., 2017]. B. The Importance of Market Models Before ﬂexible energy applications are used in practice, their proﬁtability is tested in simulations. Hereby a model Fig. 1: Comparison of German day-ahead, volume-weighted average intraday price, and minimum and maximum intraday prices. of the ﬂexible energy application interacts with a model of the intraday market. The reliability of the simulation result is then directly dependent of the quality of both models. In energy system research, the tested ﬂexible energy applications are often modeled highly detailed and in a very sophisticated way, while the used market model is often oversimpliﬁed and can thus be a bottleneck for the overall performance of the simulation. Power market models often assume that there is a single price for each power delivery time (the time when power delivery starts). This is a good ﬁt for the German day-ahead market, a uniform priced auction, where every (successful) market participant receives the same price. However, in the German continuous intraday market each delivery time generally has a large number of volatile prices, the result of a price building mechanism using a limit order book (LOB), and following the pay-as-bid principle Some intraday market models have assumed a single price, for example, the volume-weighted average price per delivery time, as it can be directly computed from historical data, a practical choice at the time because the data needed to know the LOB state was not available. Unfortunately, simulations based on a single price can lead to an underestimation of the true trading risk. This can be seen in Figure 1, where between hours 16 and 18, the volume-weighted978-1-5386-1488-4/18/$31.00 c⃝2018 IEEE average price of the intraday market corresponds closely to the day-ahead price but the minimum and maximum prices for these delivery times indicate a very volatile trading period. Apart from the trading risk, such a single price model does assume that the price is constant. In reality however, the German intraday market shows often signs of illiquidity [Hagemann and Weber, 2013] and prices can for example be strongly dependent on the trading-volume. C. Added Value of our Paper We use the EPEX SPOT M7 order book data, a new data set that contains all orders submitted to the intraday market, to simulate the LOB from the moment the intraday market opens until market close. This simulation has two great beneﬁts, ﬁrst of all it gives access to the complete market state (bid-ask- spread, LOB-depth, etc.) [Gould et al., 2013] [Neuhoff et al., 2016] at any point in time, data that can be used to analyze how trading behavior depends on the current market situation [?]. Secondly, the simulation can be used as a market model which allows a more correct simulation of trading risk and illiquidity. To enable others to reproduce this approach we describe all preprocessing steps necessary to correctly interpret the M7 EPEX SPOT order book data set. We start in Section II with a review of the price building mechanism of the EPEX SPOT continuous intraday market, in Section III we describe the EPEX SPOT M7 order book data. Section IV covers the necessary preprocessing steps, the simulation and the validation of the market simulation framework. Finally, in Section V, we discuss the results and potential applications. II. CONTINUOUS GERMAN INTRADAY MARKET A. Power Trading in Germany On the German market wholesale level, utilities can trade power in several ways. They can trade directly with each other (over the counter trading) or they can trade at one of the two power exchanges: the European Energy Exchange (EEX), which organizes the derivatives market, where power can be traded up to six years in advance until several days before delivery, or the European Power Exchange (EPEX SPOT), which organizes the spot market. Power can be traded on the spot market in several ways. On the day before delivery, power can be traded at the day-ahead auction and the intraday auction. After these auctions, the continuous intraday market starts for all delivery times of the next day at 3pm for 1-hour contracts; at 3:30pm for 30-minute products; and at 4pm for 15-minute products. In Germany, power at the EPEX SPOT continuous intraday market can be traded until 30-minutes before start of delivery, and since June 2017, up to 5-minutes before the start of delivery for trades within the same control zone. B. Price Building at the Continuous Intraday Market Prices in the continuous intraday market are found using a set of LOBs (one for each delivery time). This is a widespread mechanism for price formation in continuous markets [Gould et al., 2013] [Ros¸u, 2009]. An order can be deﬁned as a commitment to buy or sell a ﬁxed quantity of the traded good for a deﬁned price or ”better” (lower for buy, higher for sell). Once an order for a delivery time is submitted, it enters the delivery time’s LOB and is checked for opposing orders that fulﬁll its price restrictions. Otherwise, the order is called a limit order, and stays active in the LOB until it is fully matched by one or more opposing orders entering the LOB; until it is canceled by the owner; or until the market closes. If an order that enters the LOB is at least partially matched with an existing opposite order, it is called a market order. In this case, the order gets ”matched” with the best opposite order (highest priced buy order, lowest priced sell order) that exists in the LOB and immediately generates a transaction. The price of the transaction is deﬁned by the price of the already existing limit order, the volume of the transaction corresponds to the minimal volume of both orders. After the transaction, the volumes of both orders are updated by subtracting the transaction volume. Now either the market order, the limit order or both orders are completely consumed. A consumed order is deleted from the LOB. If the limit order is not consumed, it stays with its remaining volume in the LOB, if the market order is not consumed, it continuous to match the next limit order with the next best price. If existing orders can no longer fulﬁll the price restriction of the incoming order, it stays with its remaining volume and its maximum price in the LOB like a limit order. For every transaction, the owner of a limit order gets the price she submitted. The example in Figure 2 illustrates the so-called pay-as-bid principle of a LOB market for one delivery time. We can observe three transactions with three different prices for the same delivery time, which where potentially traded at (almost) the same time. This is in a strong contrast to the uniform pricing rules of the day-ahead auction and can result in very volatile prices [Goutte and Vassilopoulos, 2017]. C. Price Dependence on Delivery and Trading Time The limit order book rules imply that for the German continuous intraday market, price is not only deﬁned by the delivery time but also by when the power is traded for a speciﬁc delivery time. For example on the EPEX SPOT continuous intraday market for 15-minute contracts, there are 96 independent LOBs open at the same time, one for every delivery period. The LOBs are closed sequentially 30 minutes before the delivery period. Depending on the delivery time, each LOB stays open for 7.5 hours to 31.5 hours. During this trading period, the price for the same delivery period can vary greatly. This is also illustrated in Figure 2, which could represent a sequence of offers for the same delivery time. D. Order Types, Order Restriction and Market Actions Market participants that want to trade power in the con- tinuous intraday market, can choose between different order types. Here is a list of order types that are available during the continuous intraday trading [EPEXSPOT, 2014] [EPEXSPOT, 2017] (a) Example of a 5 MWh market order to sell, that matches the best limit order to buy power at 30 EUR/MWh (red rectangle). The result is a transaction of 5MWh for 30 EUR/MWh. (b) The LOB after the transaction from 2a. The matched volume was deleted from the LOB. The remaining volume is still active. (c) Example of a 30 MWh mar- ket order to buy, that fully con- sumes the best opposite order at 42 EUR/MWh and then matches the next best opposite order at 48 EUR/MWh (red rectangles). The result is a transaction of 5 MWh for 42 EUR/MWh and a transaction for 25 MWh for 48 EUR/MWh. (d) The LOB after the transaction from 2c. The matched volume was deleted from the LOB. The partially consumed order is still active with the remaining vol- ume. Fig. 2: Example of orders submitted in an LOB market and their effect on the LOB. In this example, two orders were submitted after another and resulted in three transactions with three different prices (30, 42, 48 EUR/MWh) • A limit order is the offer to buy or sell a deﬁned power volume for a speciﬁc price or better, as discussed in Section II-B. • Iceberg orders are ”large volume orders[for the same delivery time], divided into several smaller orders which are entered in the order book sequentially” (EPEXSPOT, 2014). This allows market participants who need to trade large amounts to conceal their total trading volume and thus limit the market impact of their actions [Gould et al., 2013]. At the EPEX SPOT intraday market an iceberg order consists of several, equally sized limit orders, each with a minimal size of 25 MW. Additional to the different order types, market participants can restrict the execution of their orders. Here is a list of the possible restrictions, market participants can choose from: • Immediate-or-cancel: The order is either immediately executed or automatically canceled. • Fill-or-kill: The order is either immediately and entirely executed or canceled in its entirety. • All-or-none The order is executed completely or not at all. After an order is submitted, market participants have several actions available. • Activation/Deactivation: Market participants have the possibility to temporarily deactivate and later to reactivate their orders. • Modify: Price and volume of active orders can be adjusted. • Cancel: Market participants can cancel their active orders. III. EPEX SPOT LOB DATA A. Available datasets There are three data sets with different resolutions for the analysis of the EPEX SPOT intraday market: 1) Aggregated market data: Is freely available via the EPEX SPOT homepage1. This data set provides a single price for each delivery time, for example, the volume-weighted-average price. 2) Transaction data: Can be purchased from EPEX SPOT, describes the prices and times at which LOB orders were satisﬁed by a transaction but it does not describe when the orders entered the LOB or give information about orders that did not lead to transactions. 3) The M7 order book data: A dataset that contains all orders that have been submitted to the intraday market, including orders that never resulted in a transaction or orders that were canceled. This data theoretically allows the complete reconstruction of the LOB state at any time of the trading period. Table I shows the order information available in the EPEX SPOT order book data set. It is categorized by whether or not it is available at the moment of order submission (ex-ante) or after (ex-post). TABLE I: Order information available in the EPEX SPOT order book data separated in ex-ante and ex-post data. Ex-ante Ex-post Instrument type Is executed Delivery instrument End validity date Delivery date Canceling date Start validity date Execution price Status Executed volume Side Price Volume Initial ID Parent ID B. Difﬁculties with the EPEX SPOT LOB Data An LOB user must overcome various data problems. 1) Erroneous Order Information: The ﬁelds Execution Price and Execution Volume contain errors and cannot be used 2. 2) Overlapping Content: The M7 order book dataset is delivered by EPEX SPOT as one or more Excel spreadsheets per month. Adjacent months sometimes overlap for several days. This redundant information must be detected and be deleted. 1http://www.epexspot.com/en/market-data/intradaycontinuous/ 2This was communicated by EPEX SPOT prior to purchase. 3) Simulation of Austrian Orders: Germany and Austria are in the same market area but the EPEX SPOT LOB data includes only orders for power generated within, or to be delivered to, Germany. We attempt to complete the order ﬂow using EPEX SPOT intraday transaction data, which includes transactions delivered to or from Austria. If power was delivered to (respectively from) the Austrian delivery zone, a buy (respectively sell) order with the same volume, price and delivery time as the transaction is created. IV. SIMULATION OF THE CONTINUOUS GERMAN INTRADAY MARKET The sequence of simulated LOB states, along with the transaction volumes and pricing they emit, is generated by processing the EPEX SPOT order book data for one delivery time, order-by-order. Unfortunately, not every row in the EPEX SPOT order book data corresponds to an individual submitted order. A. Identify Orders in the EPEX SPOT LOB data Here, we describe how we extract the meaning of the EPEX SPOT data rows, and which LOB actions are taken in response to them. 1) Orders: Most of the rows in the EPEX SPOT data correspond to orders. Orders are identiﬁed by excluding all other cases: • Limit Orders and Market Orders: If a new order matches an opposing order, the order is identiﬁed as market order. If not, it is classiﬁed as a limit order (see Section II-B). • Iceberg Orders: In the moment of their submission, only the ﬁrst suborder of an iceberg order appears as a row in the EPEX SPOT data. Once the visible order is consumed, it is immediately followed by an order with the same ID and with volume zero, and this is followed by a new order with the same ID and the new volume. Since all suborders spawned by an iceberg order have the same ID, they cannot be distinguished from reborn orders (see IV-A2) which are ignored during the simulation. To be able to correctly identify all parts of an iceberg orders, we assign them with unique IDs in a preprocessing step. This is done by iterating the LOB data and whenever an order with volume zero appears, all following orders with the same ID are equipped with a new ID. • Restricted Orders: Unfortunately, it was not possible for us to identify the different restrictions given the limited information in the order ﬂow. 2) Rebirth of Partially Matched Orders: Limit orders are often only partially matched. In this case, the order reappears in the data as a new order with the same ID, price and with the residual volume. So that the number of submitted orders can be properly counted, the reborn order must be distinguished from original new orders. We do this by keeping track of active order IDs during the simulation. 3) Market Actions: Market actions (Section II-D) also appear as rows in the EPEX SPOT data. Here we describe how market actions are identiﬁed. • Order Modiﬁcations: Once an order is submitted, the owner may modify its price or volume. In the EPEX SPOT data, modiﬁcation actions have the same ID as an existing order and a non-empty Canceling time ﬁeld containing the modiﬁcation time stamp. It is followed by a new order with the same ID and a modiﬁed price or volume. So that the simulation can identify modiﬁcations, a modiﬁcation ﬂag is introduced in a preprocessing step. This is done by iterating the LOB data and whenever a row with an ID that already appeared has a nonempty ﬁeld Canceling time and is not the last row with this ID, this row is marked as a modiﬁcation. • Activation and Deactivation of Orders: Market par- ticipants may deactivate an order temporarily and later reactivate it. A deactivation appears in the order ﬂow as an item with the ID of an existing order and the ﬁeld Status set to N. The Canceling time ﬁeld is ﬁlled with the reactivation time of the order. • Cancellations: Market participants may cancel their active limit orders. A cancellation can be identiﬁed by the non- empty Canceling time after modiﬁcation and deactivation actions have already been excluded. B. Implementation and Simulation The Lob is simulated by processing the EPEX SPOT data row by row and consists of two tasks: The interpretation of the current row of the EPEX SPOT data and the reproduction of the market mechanisms. The order ﬂow is processed sequentially and only valid orders with respect to the special cases discussed in section IV-A, are presented to an order book object, which reproduces the LOB mechanism. The simulation process is shown in Figure 3. C. Validation The information provided in the EPEX SPOT order book data is not sufﬁciently detailed to identify all order types, market actions and order restrictions with certainty. This leads to an error in the reconstruction of the historic LOB state. This true LOB state is not observable, but we can compare the transactions the LOB simulation generates with the actual historical transactions (Section III-A2). The EPEX SPOT transaction data contains all individual intraday transactions with their volume and price information. We consider the trans- action data to be ground-truth information and the generated transactions should match them as closely as possible. The match is assessed over April 2015 to December 2016, using three derived transaction statistics: • Number of transactions • Volume weighted average price • Traded volume We calculate the three transaction statistics as totals for each delivery time and each day (e.g. the total traded volume on day 1 for delivery period 1) and then compare it to the ground truth. Fig. 3: Work ﬂow of the historic order ﬂow simulation. Figure 4 shows the results for all three transaction statistics. The comparisons of Figure 4 show that the simulation follows the true behavior very closely. The average price per delivery time is matched almost perfectly, the number of transactions is slightly overestimated and the traded volume is slightly underestimated at peak trading times. Table II shows the numerical results of the comparison. The average of the absolute errors of the total transactions volume per delivery time was 11.58 % and the average of the absolute errors of the total number of trades was 8.86 %. For all three error categories the median is much lower than the mean. This is evidence of few delivery times which have a large error while most of the delivery times have a small error. A possible source of error are order restrictions that could not be identiﬁed (Section IV-A1). An example of a restricted order is a ﬁll-or-kill order, which allows traders to test the market for hidden liquidity (iceberg-orders) [Cesari et al., 2012]. If TABLE II: Simulated transactions compared to the ofﬁcial transactions data set. Mean and median of the absolute errors calculated for every delivery time on every day from April 2015 to December 2016. Name of error Volume No. of trades Price Mean error in % 11.58 % 8.86 % 13.52 % Median error in % 6.6 % 6.17 % 1.38 % 0 10 20 30 40 50 60 70 80 90 100 Delivery time (as 15 minute increments) 2 3 4 5 6 7 8 9Number of trades 104 Number of transactions average per delivery time from Apr 15 to Dec 16 Intraday transaction data (baseline) Order book simulation (a) 0 10 20 30 40 50 60 70 80 90 100 Delivery time (as 15 minute increments) 15 20 25 30 35 40 45 50Price in EUR/MWh Volume weighted average transaction price average per delivery time from Apr 15 to Dec 16 Intraday transaction data (baseline) Order book simulation (b) 0 10 20 30 40 50 60 70 80 90 100 Delivery time (as 15 minute increments) 0 1 2 3 4 5 6 7Volume in MWh/quarter hour 105 Total transaction volume per delivery time from Apr 15 to Dec 16 Intraday transaction data (baseline) Order book simulation (c) Fig. 4: Comparison of the transactions generated by the simulation of the order ﬂow and the EPEX SPOT transaction data. a trader suspects the existence of so-called iceberg orders, he may repeatedly submit ﬁll-or-kill orders to ﬁnd them. Without correctly identifying the restriction, the order can match existing orders even if it is only ﬁlled partially. The missing restriction information could explain the overestimation of the number of trades. V. CONCLUSION In this work, we used the EPEX SPOT M7 order ﬂow data to simulate the limit order book of the continuous German intraday market. This representation gives access to the complete market state for every moment in trading time for every delivery time. We validated the simulation by comparing the resulting transactions of our simulation to the ofﬁcial EPEX SPOT transaction data set. Additionally, the simulation can be used as a market model by simply adding new orders to the list of the EPEX SPOT order book data. This market model allows to model trading risk and allows market participants to test weather they perform better or worse than the volume-weighted average price depending on their trading strategy. The model allows prices to be different for buy and sell actions and can also represent illiquidity by modeling the relation between price and volume (e.g. the price gets worse the more power you buy at the same time). The instructions for the simulation of the LOB, especially the interpretation of the EPEX SPOT order book data, are presented in detail to allow repetition of the process. In the future, the simulation of the order book could be used in two ways. At ﬁrst, to get all information available for traders at the moment of their order submission to simulate and analyze their trading behavior at the intraday market. And secondly, the LOB simulation can be used as a market model of the intraday market to simulate intraday trading or arbitrage of ﬂexible energy systems in a much more realistic setting than it is the case at the moment. REFERENCES [BNetzA Bundesnetzagentur, 2017] BNetzA Bundesnetzagentur, B. (2017). Monitoringbericht 2017. [Cesari et al., 2012] Cesari, R., Marzo, M., and Zagaglia, P. (2012). Effective trade execution. [EPEXSPOT, 2014] EPEXSPOT (2014). Epex spot trad- ing brochure 2014. Technical report, EPEX SPOT, https://www.epexspot.com/document/26145/EPEX [EPEXSPOT, 2017] EPEXSPOT (2017). Epex spot operational rules. EPEX SPOT. [Gould et al., 2013] Gould, M. D., Porter, M. A., Williams, S., McDonald, M., Fenn, D. J., and Howison, S. D. (2013). Limit order books. Quantitative Finance, 13(11):1709–1742. [Goutte and Vassilopoulos, 2017] Goutte, S. and Vassilopoulos, P. (2017). The value of ﬂexibility in power markets. Chaire European Electricity Markets, Fondation Paris-Daupine. [Hagemann and Weber, 2013] Hagemann, S. and Weber, C. (2013). An empirical analysis of liquidity and its determinants in the german intraday market for electricity. [Mitra et al., 2013] Mitra, S., Sun, L., and Grossmann, I. E. (2013). Optimal scheduling of industrial combined heat and power plants under time-sensitive electricity prices. Energy, 54:194–211. [Neuhoff et al., 2016] Neuhoff, K., Ritter, N., Salah-Abou-El-Enien, A., and Vassilopoulos, P. (2016). Intraday markets for power: Discretizing the continuous trading? DIW discussion Paper. [Resch et al., 2017] Resch, M., B¨uhler, J., Klausen, M., and Sumper, A. (2017). Impact of operation strategies of large scale battery systems on distribution grid planning in germany. Renewable and Sustainable Energy Reviews, 74:1042–1063. [Ros¸u, 2009] Ros¸u, I. (2009). A dynamic model of the limit order book. The Review of Financial Studies, 22(11):4601–4641. [Siano and Sarno, 2016] Siano, P. and Sarno, D. (2016). Assessing the beneﬁts of residential demand response in a real time distribution energy market. Applied Energy, 161:533–551. [Wille-Haussmann et al., 2010] Wille-Haussmann, B., Erge, T., and Wittwer, C. (2010). Decentralised optimisation of cogeneration in virtual power plants. Solar Energy, 84(4):604–611.","libVersion":"0.3.2","langs":""}