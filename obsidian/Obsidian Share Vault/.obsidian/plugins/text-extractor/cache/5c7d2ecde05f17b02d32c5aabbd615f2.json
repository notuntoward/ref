{"path":"lit/lit_notes_OLD_PARTIAL/Loesch22prosumFlexSpotBalMkt.pdf","text":"Utilization of Electric Prosumer Flexibility Incentivized by Spot and Balancing Markets Zur Erlangung des akademischen Grades eines Doktors der Ingenieurwissenschaften (Dr.-Ing.) von der KIT-Fakultät für Wirtschaftswissenschaften des Karlsruher Instituts für Technologie (KIT) genehmigte DISSERTATION von Manuel Lösch, M. Sc. Tag der mündlichen Prüfung: 28.10.2021 Referent: Prof. Dr. Hartmut Schmeck Korreferent: Prof. Dr. Wolf Fichtner This document is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License (CC BY-SA 4.0): https://creativecommons.org/licenses/by-sa/4.0/deed.en Abstract The use of energy flexibility to balance electricity demand and supply is becoming increasingly important due to the growing share of fluctuating energy sources. Electric flexibility regarding time or magnitude of consumption can be offered in the form of different products on electricity spot and balancing power markets. In the wake of the energy transition and because of new possibilities provided by digitalization, the decision intervals on these markets are becoming shorter and the controllability of electricity consumption and generation more small-scale. This evolution opens up new chances for formerly passive energy consumers. This thesis shows how electric flexibility can be monetized using the application example of commercial sites. These are often multimodal energy systems coupling electricity, heat, and gas, and thus deliver high flexibility potential. To leverage this potential, a comprehensive picture of demand-side flexibilization is provided and used to propose an energy management system and optimization for cost-optimized device schedules. The cost-optimization considers two simultaneous incentives: variable day- ahead spot market prices and revenues for offering possible schedule adjustments to the automatic Frequency Restoration Reserve (aFRR) balancing market. To solve the formulated optimization problem, a genetic algorithm is presented, tailored to the specific needs of consumers. In addition to addressing the trade-off between the two competing markets, the algorithm inherently considers the uncertain activation of aFRR bids and related catch-up effects. An analysis of the activation behavior of aFRR balancing market bids, based on a developed ex-post simulation, forms an important decision basis for the optimization. Finally, a simulation study concentrating on battery energy storage systems and combined heat and power plants on the consumer side enables the quantitative discussion of the optimization potential. The results show that consumers considering both markets simultaneously can achieve cost benefits that are up to multiples of those for pure day-ahead price optimization, despite the stochastic nature of aFRR balancing power activations. In conclusion, this thesis enables formerly passive electricity consumers to assume the role of alternative balancing service providers, hence contributing to the economic and reliable operation of power grids characterized by a high share of renewable energy sources. iii Acknowledgements I would like to express my gratitude to all those who have accompanied and supported me in preparing this work. First and foremost, I want to thank my thesis supervisor Professor Dr. Hartmut Schmeck for the opportunity to pursue my doctoral research at the Karlsruhe Institute of Technology (KIT) and the FZI Research Center for Information Technology. Your pioneering contributions to the digitalization and optimization of energy system operation, combined with your ability for focused remarks, allowed me to grow and gradually sharpen the understanding of my own academic work. Additionally, I want to thank Professor Dr. Wolf Fichtner, Professor Dr. Christof Weinhardt, and Professor Dr. Andreas Oberweis for their valuable advice and suggestions, and for their service on my thesis committee. For the large variety of research-related and unrelated discussions, inspiring inputs, motivation, and for many unforgettable moments, I would like to thank many colleagues from the energy informatics community and beyond. Special thanks go to my FZI colleagues with whom I could collaborate closely over the years: Ariane, Birger, David, Dominik, Fabian, Ingo, Julian, Kevin, Mischa, Sebastian (alphabetically almost last, but actually rather first!), and Tobias. You all contributed to this thesis in your very own way! Furthermore, I warmly thank my colleagues in the KIT research group Efficient Algorithms for our numerous enlightening discussions on optimizations. Our exchanges have always been a great enrichment! In addition to collaborating with colleagues from academia, the countless discussions with partners from the energy industry provided valuable input that steered my research in a direction of relevance. Therefore, I want to thank my business network: it was the insights into your very real challenges, your openness to discussions, and our shared vi- sions that motivated me. Particularly, I thank Dr. Christoph Schlenzig for his mentorship and for helping me pave the way to bring this research into practical application. Finally, yet importantly, I am most grateful for the continuous encouragement, endless support, love, and joyful moments provided by my family, my significant other Ivana, and my dear friends. You always reminded me of the beauty of life beyond research and gave this work (and the night and weekend shifts to which it sometimes led) a meaning! v Contents List of Tables xiii List of Figures xv List of Abbreviations xix List of Symbols xxiii 1 Introduction 1 1.1 Motivation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2 1.1.1 Balancing Demand and Supply in Electricity Grids . . . . . . . . 2 1.1.2 Energy System Transition & Impacts on Grid Operation . . . . . 5 1.1.3 Commercial Facilities as Active Grid Participants . . . . . . . . . 7 1.1.4 Value Stacking of Flexibility at Spot and Balancing Markets . . 8 1.2 Research Objective & Contributions . . . . . . . . . . . . . . . . . . . . 11 1.3 Thesis Structure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 2 Basic Theory of Smart Grid Operation and Optimization 15 2.1 Grid Architecture and Stability . . . . . . . . . . . . . . . . . . . . . . 15 2.1.1 Interconnection of Generators and Consumers . . . . . . . . . . 16 2.1.2 Global Grid Stability & Frequency Control . . . . . . . . . . . . 19 2.1.3 Local Grid Stability & Voltage Control . . . . . . . . . . . . . . 19 2.2 Electricity Markets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21 2.2.1 Balancing Groups . . . . . . . . . . . . . . . . . . . . . . . . . . 21 2.2.2 Long-term and Short-term Electricity Markets . . . . . . . . . . 22 2.2.3 Electricity Spot Markets . . . . . . . . . . . . . . . . . . . . . . 23 2.2.4 Composition of the Final Electricity Price . . . . . . . . . . . . . 31 2.2.5 Congestion Management and Redispatching . . . . . . . . . . . 33 2.3 Balancing Services & Balancing Markets . . . . . . . . . . . . . . . . . 34 2.3.1 Types of Balancing Services . . . . . . . . . . . . . . . . . . . . 35 2.3.2 Product Characteristics at Balancing Markets . . . . . . . . . . . 39 2.3.3 Settlement of Balancing Service Costs . . . . . . . . . . . . . . 41 vii Contents 2.3.4 Grid Control Cooperation . . . . . . . . . . . . . . . . . . . . . 42 2.3.5 Overall Balancing Service Provisioning Process . . . . . . . . . . 45 2.3.6 Backup Mechanisms . . . . . . . . . . . . . . . . . . . . . . . . 46 2.4 Implication of the Energy Transition . . . . . . . . . . . . . . . . . . . 46 2.4.1 Need for Demand Side Management . . . . . . . . . . . . . . . 47 2.4.2 Increasing Share of Prosumers in Distribution Grids . . . . . . . 48 2.4.3 Rollout of Smart Metering Infrastructures . . . . . . . . . . . . 48 2.4.4 Advancements of Electricity and Balancing Markets . . . . . . . 50 2.5 Mathematical Optimization . . . . . . . . . . . . . . . . . . . . . . . . 53 2.5.1 Classification of Optimization Problems . . . . . . . . . . . . . . 53 2.5.2 The Choice of an Appropriate Optimization Method . . . . . . . 56 3 Related Work on Prosumer Flexibilization 59 3.1 Value Creation Options for Flexible Prosumers . . . . . . . . . . . . . . 59 3.1.1 Locally Incentivized Flexibilization . . . . . . . . . . . . . . . . 60 3.1.2 Externally Incentivized Flexibilization . . . . . . . . . . . . . . 61 3.1.3 Value Creation in Potential Future Energy System Designs . . . 64 3.2 Modeling of Flexibility . . . . . . . . . . . . . . . . . . . . . . . . . . . 65 3.3 Optimizations for Utilization of Prosumer Flexibility . . . . . . . . . . . 67 3.3.1 Aggregation Levels for Prosumer Optimizations . . . . . . . . . 68 3.3.2 Multi-use of Flexibility . . . . . . . . . . . . . . . . . . . . . . . 70 3.3.3 aFRR Provisioning and Spot Market Scheduling . . . . . . . . . 71 3.4 Research Gap . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73 4 Modeling in the Context of a Grid-responsive Facility Energy Management System 75 4.1 System Environment and Information Flows . . . . . . . . . . . . . . . 75 4.1.1 Facility . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76 4.1.2 Facility Energy Management System . . . . . . . . . . . . . . . 77 4.1.3 Flexibility Markets . . . . . . . . . . . . . . . . . . . . . . . . . 80 4.2 Modeling of the Electricity Market . . . . . . . . . . . . . . . . . . . . 83 4.3 Modeling of the aFRR Balancing Market & aFRR Activations . . . . . . 85 4.3.1 Assumptions . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85 4.3.2 Ex-post Simulation of aFRR Activations & Data Processing . . . 88 4.4 Modeling of the Facility Side . . . . . . . . . . . . . . . . . . . . . . . . 91 4.4.1 Facility Demands . . . . . . . . . . . . . . . . . . . . . . . . . . 93 4.4.2 Battery Storage System . . . . . . . . . . . . . . . . . . . . . . 93 4.4.3 Thermal Energy Storage . . . . . . . . . . . . . . . . . . . . . . 97 viii Contents 4.4.4 Combined Heat and Power Plant . . . . . . . . . . . . . . . . . 101 4.4.5 Condensing Boiler . . . . . . . . . . . . . . . . . . . . . . . . . 106 4.4.6 Air Conditioning . . . . . . . . . . . . . . . . . . . . . . . . . . 107 5 Analysis of aFRR Activations 115 5.1 Uncertainties Resulting in the Need for Balancing Power . . . . . . . . 115 5.1.1 Technical Reasons . . . . . . . . . . . . . . . . . . . . . . . . . 116 5.1.2 Impact of Regulation . . . . . . . . . . . . . . . . . . . . . . . . 117 5.1.3 Outlook on Future Development . . . . . . . . . . . . . . . . . 118 5.2 Implications of aFRR Energy Prices Choices . . . . . . . . . . . . . . . . 119 5.2.1 aFRR Activations . . . . . . . . . . . . . . . . . . . . . . . . . . 121 5.2.2 aFRR Revenue Potential . . . . . . . . . . . . . . . . . . . . . . 122 5.2.3 Historical Development . . . . . . . . . . . . . . . . . . . . . . 123 5.3 Uncertainty of aFRR Activations . . . . . . . . . . . . . . . . . . . . . . 124 5.4 Provisioning of Balancing Services via the Demand Side . . . . . . . . . 127 5.4.1 Balancing Group Allocation . . . . . . . . . . . . . . . . . . . . 127 5.4.2 Catch-up Effects . . . . . . . . . . . . . . . . . . . . . . . . . . 128 5.5 Utilization of Insights for the Optimization of aFRR Bids . . . . . . . . 130 5.5.1 Consideration of aFRR Activation Costs . . . . . . . . . . . . . . 131 5.5.2 Consideration of Opportunity Costs . . . . . . . . . . . . . . . . 132 5.5.3 Consideration of Catch-up Effects . . . . . . . . . . . . . . . . . 134 6 Formalization of the Optimization Problem for Value Stacking of Flexibility at Day-ahead Spot and aFRR Balancing Markets 135 6.1 Problem Formulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . 136 6.1.1 Decision Variables . . . . . . . . . . . . . . . . . . . . . . . . . 136 6.1.2 Objective Function . . . . . . . . . . . . . . . . . . . . . . . . . 137 6.2 Constraints . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 141 6.2.1 Devices and Storages . . . . . . . . . . . . . . . . . . . . . . . . 141 6.2.2 aFRR Bids . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 143 6.2.3 aFRR Activation . . . . . . . . . . . . . . . . . . . . . . . . . . . 144 6.2.4 Demands . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 148 6.3 Discussion of Uncertainty . . . . . . . . . . . . . . . . . . . . . . . . . 149 6.4 Characterization of the Optimization Problem . . . . . . . . . . . . . . 150 6.4.1 Mathematical Properties . . . . . . . . . . . . . . . . . . . . . . 150 6.4.2 Non-functional Requirements . . . . . . . . . . . . . . . . . . . 153 6.5 Options for Solving Non-linear Optimization Problems . . . . . . . . . 154 6.5.1 Linearization and Application of Exact Solving Methods . . . . 154 ix Contents 6.5.2 Dynamic Programming . . . . . . . . . . . . . . . . . . . . . . . 155 6.5.3 Application of Metaheuristics . . . . . . . . . . . . . . . . . . . 156 7 Design and Implementation of a Genetic Algorithm 161 7.1 Methodology . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 161 7.2 Design Choices and Genetic Operators . . . . . . . . . . . . . . . . . . 162 7.2.1 Optimization Cycle and Encoding . . . . . . . . . . . . . . . . . 162 7.2.2 Initialization and Termination . . . . . . . . . . . . . . . . . . . 165 7.2.3 Selection, Crossover, and Mutation . . . . . . . . . . . . . . . . 166 7.2.4 Fitness Evaluation . . . . . . . . . . . . . . . . . . . . . . . . . 169 7.3 Genotype-Phenotype Transformation: Profile Generation . . . . . . . . 170 7.3.1 Handling of Devices and Storages . . . . . . . . . . . . . . . . . 172 7.3.2 P1: Mapping to Day-ahead Power Level Profiles . . . . . . . . . 172 7.3.3 P2: Mapping to aFRR Capacity Level Profiles . . . . . . . . . . . 173 7.3.4 P3: Mapping to aFRR Energy Price Profiles . . . . . . . . . . . . 174 7.4 Genotype-Phenotype Transformation: Constraint Handling . . . . . . . 176 7.4.1 Discussion of Approaches for Constraint Handling . . . . . . . . 176 7.4.2 C1: Genetic Profile Repair According to Power Restrictions . . . 178 7.4.3 C2: Legal Decoding Concerning aFRR Product Slot Duration . . 179 7.4.4 C3: Penalty Function for SOC Constraints . . . . . . . . . . . . 179 7.5 Genotype-Phenotype Transformation: Fitness Evaluation . . . . . . . . 182 7.5.1 F1: Calculation of Expected Energy Delta Profiles . . . . . . . . 182 7.5.2 F2: Fitness Function . . . . . . . . . . . . . . . . . . . . . . . . 184 7.5.3 Generation of DA Market and aFRR Market Bids . . . . . . . . . 186 7.6 Problem-specific Crossover Operator . . . . . . . . . . . . . . . . . . . 186 8 Evaluation and Assessment of the Optimization Potential 189 8.1 Simulation Flow . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 190 8.2 Parameter Definition & Data Sources . . . . . . . . . . . . . . . . . . . 191 8.2.1 Flexible Facility Devices . . . . . . . . . . . . . . . . . . . . . . 191 8.2.2 Facility Demands . . . . . . . . . . . . . . . . . . . . . . . . . . 194 8.2.3 Market and Grid-Side Characteristics . . . . . . . . . . . . . . . 194 8.2.4 Investigated Scenarios . . . . . . . . . . . . . . . . . . . . . . . 197 8.3 Parametrization of Genetic Operators . . . . . . . . . . . . . . . . . . . 199 8.3.1 Implementation Details . . . . . . . . . . . . . . . . . . . . . . 199 8.3.2 Crossover and Mutation Probabilities . . . . . . . . . . . . . . . 200 8.3.3 Convergence of the Optimization . . . . . . . . . . . . . . . . . 202 x Contents 8.4 Qualitative Discussion of Optimized Schedules & Identification of Patterns 203 8.4.1 Battery Storage System . . . . . . . . . . . . . . . . . . . . . . 203 8.4.2 CHP Plant . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 210 8.5 Quantitative Analysis of Realized Cost Savings . . . . . . . . . . . . . . 215 8.5.1 Battery Storage System . . . . . . . . . . . . . . . . . . . . . . 215 8.5.2 CHP Plant . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 219 8.6 Impact of Device Dimensioning . . . . . . . . . . . . . . . . . . . . . . 222 8.6.1 Battery Storage System . . . . . . . . . . . . . . . . . . . . . . 222 8.6.2 CHP Plant . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 223 8.6.3 Thermal Energy Storage . . . . . . . . . . . . . . . . . . . . . . 224 8.7 Impact of Market Development in Future Scenarios . . . . . . . . . . . 225 8.7.1 aFRR Capacity Price Levels . . . . . . . . . . . . . . . . . . . . 226 8.7.2 DA Spot Market Price Fluctuation . . . . . . . . . . . . . . . . . 228 8.8 Concluding Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . 230 9 Conclusion 231 9.1 Summary of Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . 231 9.2 Outlook and Further Research Directions . . . . . . . . . . . . . . . . . 235 A Appendix 239 A.1 Preliminary Work . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 239 A.2 Price Levels in Context of the CHP Plant Operation . . . . . . . . . . . 242 Bibliography 243 xi List of Tables 2.1 Dimensions of public transmission and distribution grids . . . . . . . . 18 2.2 Characteristics of balancing services and related balancing markets . . 40 2.3 Comparison of common classes of optimization problems . . . . . . . . 56 4.1 Demand and supply of flexible devices separated by energy forms . . . 78 4.2 Inputs and outputs of a FEMS and linked information sources and sinks 79 4.3 Spot and balancing market interfaces for flexibility aggregators . . . . 83 4.4 Load shifting potential of thermal generators and storages . . . . . . . 99 5.1 Influences on balancing power demand and supply . . . . . . . . . . . 119 7.1 Concept of the binary encoding of a phenotype . . . . . . . . . . . . . 164 7.2 Generation of day-ahead power level profiles . . . . . . . . . . . . . . . 172 7.3 Generation of aFRR capacity level profiles . . . . . . . . . . . . . . . . 174 7.4 Generation of aFRR energy price profiles . . . . . . . . . . . . . . . . . 175 7.5 Fitness function input and output . . . . . . . . . . . . . . . . . . . . . 185 8.1 Default configuration of the device models in the baseline scenario . . 192 8.2 Characteristics of the hourly energy demands used in the evaluation . . 195 8.3 Evaluation parameters for the DA spot and aFRR balancing markets . . 196 8.4 Implementation details of the genetic algorithm . . . . . . . . . . . . . 200 8.5 Parametrization of the bit string length for the considered devices . . . 201 A.1 Price levels in the context of the CHP plant optimization . . . . . . . . 242 xiii List of Figures 1.1 Balancing power handles power schedule deviations and fluctuations . 4 1.2 Concept of a FEMS monetizing electric flexibility . . . . . . . . . . . . 9 2.1 Structure of the public power with different voltage levels . . . . . . . 17 2.2 Trading times and product time slots at German spot and balancing markets 26 2.3 Price formation at the spot market day-ahead call auction . . . . . . . . 28 2.4 Distribution of market prices resulting from the EPEX day-ahead call auction . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 2.5 Day-ahead auction vs. intraday auction prices . . . . . . . . . . . . . . 30 2.6 Composition of final electricity prices paid by final consumers . . . . . 31 2.7 Balancing service activation scheme for FCR, aFRR, and mFRR . . . . . 37 2.8 Settlement of balancing service costs via grid users and BRPs . . . . . . 41 2.9 Optimization of aFRR activations in the Grid Control Cooperation . . . 44 2.10 Overall balancing service provisioning process . . . . . . . . . . . . . . 45 2.11 Recent changes at German spot and balancing markets . . . . . . . . . 52 2.12 Classification for the choice of an optimization method . . . . . . . . . 57 3.1 Different types of energetic flexibility . . . . . . . . . . . . . . . . . . . 66 3.2 Options for multi-use / value stacking of flexibility . . . . . . . . . . . . 71 4.1 Information flows in the context of a FEMS . . . . . . . . . . . . . . . . 76 4.2 Calculation of the minutely marginal aFRR energy price . . . . . . . . . 90 4.3 The control band of a device as defined by its discrete power levels . . 104 4.4 Components of a chiller-driven air conditioning system . . . . . . . . . 108 5.1 Activation of three exemplary aFRR bids with different aFRR energy prices 120 5.2 Impact of aFRR energy prices on aFRR bid activation and revenues . . 121 5.3 Distribution of historically experienced aFRR activation shares . . . . . 125 5.4 Balancing power provision via alternative BSPs resulting in catch-up effects 128 5.5 Annual activation-based profit for different aFRR energy prices after considering different activation costs . . . . . . . . . . . . . . . . 132 xv List of Figures 5.6 Consideration of opportunity costs and catch-up effects in the optimization of aFRR energy prices . . . . . . . . . . . . . . . . 133 6.1 Decision variables of the optimization problem . . . . . . . . . . . . . . 136 6.2 Expected aFRR activations and required SOC band guarantees . . . . . 147 6.3 Uncertainty at the time of the day-ahead optimization . . . . . . . . . 151 7.1 Evolutionary optimization cycle and mapping of different constraint handling approaches . . . . . . . . . . . . . . . . . . . . . . 163 7.2 Overview of the overall genotype-phenotype transformation . . . . . . 171 7.3 Problem-specific n-point crossover that maintains the interdependencies between related profiles . . . . . . . . . . . . . 188 8.1 Simulation flow and the integration of the optimization . . . . . . . . . 190 8.2 Uncontrollable electric and heat energy demands . . . . . . . . . . . . 194 8.3 Overview of the prices used in the evaluation . . . . . . . . . . . . . . 197 8.4 Parametrization of crossover and mutation probability . . . . . . . . . 201 8.5 Impact of the number of evaluations on the solution quality . . . . . . 202 8.6 EPEX-only optimized battery storage system: six exemplary days . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 204 8.7 Combined EPEX+aFRR optimized battery storage system: one exemplary day with neg. and pos. aFRR bids . . . . . . . . . . . . 206 8.8 Combined EPEX+aFRR optimized battery storage system: one exemplary day with only neg. aFRR bids . . . . . . . . . . . . . . . 207 8.9 EPEX-only optimized CHP plant schedules: four exemplary summer days . . . . . . . . . . . . . . . . . . . . . . . 211 8.10 Combined EPEX+aFRR optimized CHP plant: four exemplary summer days . . . . . . . . . . . . . . . . . . . . . . . 212 8.11 Seasonal behavior of the EPEX+aFRR optimized CHP plant schedules . 213 8.12 Composition of cost savings of the optimized battery storage system: EPEX-only optimization vs. baseline . . . . . . . . . . . . . . . . . . . . 216 8.13 Composition of cost savings of the optimized battery storage system (surcharges for neg. aFRR energy) . . . . . . . . . . . . . . . . . . . . 217 8.14 Composition of cost savings of the optimized battery storage system (no surcharges for neg. aFRR energy) . . . . . . . . . . . . . . . . . . . 218 8.15 Composition of the cost savings of the flexibilized CHP plant operation 220 8.16 Impact of battery storage system sizing on the cost savings. . . . . . . . 222 8.17 Impact of CHP plant sizing on the optimized cost savings . . . . . . . . 223 8.18 Impact of thermal energy storage sizing on the optimized cost savings . 225 xvi List of Figures 8.19 aFRR capacity price level scenarios . . . . . . . . . . . . . . . . . . . . 227 8.20 Impact of aFRR capacity price levels on the optimized cost savings . . . 227 8.21 DA spot market price fluctuation scenarios . . . . . . . . . . . . . . . . 229 8.22 Impact of DA spot market price fluctuation on the optimized cost savings 230 xvii List of Abbreviations AC Alternating current ACE Area control error aFRR Automatic frequency restoration reserve BEMS Building energy management system BES Battery energy storage BMS Battery management system BMWi Federal Ministry for Economic Affairs and Energy (German: “Bundesministerium für Wirtschaft und Energie”) BNetzA Federal Network Agency (German: “Bundesnetzagentur”) BRP Balance responsible party BSP Balancing service provider CCCV Constant current constant voltage CHP Combined heat and power CO2 Carbon dioxide COP Coefficient of performance DA Day-ahead DC Direct current DSM Demand side management DSO Distribution system operator EEG Renewable Energy Act (German: “Erneuerbare-Energien-Gesetz”) EEX European Energy Exchange EMS Energy management system ENTSO-E European Network of Transmission System Operators for Electricity EnWG Energy Industry Act (German: “Energiewirtschaftsgesetz”) EPEX European Power Exchange EU European Union EV Electric vehicle FCR Frequency containment reserve FEMS Facility energy management system FRP Flexibility requesting party GA Genetic algorithm xix List of Abbreviations GC Gate closure GCC Grid control cooperation GDEW Law on the Digitalization of the Energy Transition (German: “Gesetz zur Digitalisierung der Energiewende”) GHG Green house gas HEMS Home energy management system HT Peak tariff (German: “Haupttarif ”) HVAC Heating, ventilation, and air conditioning HVDC High-voltage direct current ID Intraday IGCC International grid control cooperation ILP Integer linear programming INLP Integer non-linear programming KWKG Combined Heat and Power Act (German: “Kraft-Wärme-Kopplungsgesetz”) LFC Load-frequency control LP Linear programming mFRR Manual frequency restoration reserve MILP Mixed integer linear programming MINLP Mixed integer non-linear programming MOL Merit order list MsbG Metering Point Operation Law (German: “Messstellenbetriebsgesetz”) NLP Non-linear programming NP Non-deterministic polynomial-time NT Off-peak tariff (German: “Nebentarif ”) OTC Over the counter PCR Primary control reserve (see also FCR) PI Proportional-integral PICASSO Platform for the International Coordination of Automated Frequency Restoration and Stable System Operation PTAS Polynomial-time approximation scheme PV Photovoltaic reBAP Imbalance energy price (German: “regelzonenübergreifender einheitlicher Bilanzausgleichsenergiepreis”) RQ Research question SCR Secondary control reserve (see also aFRR) SMGW Smart Meter Gateway xx SOC State of charge StromNZV Electricity Network Access Regulation (German: “Stromnetzzugangsverordnung”) TCR Tertiary control reserve (see also mFRR) TES Thermal energy storage TSO Transmission system operator xxi List of Symbols As the below listed symbols are used in different contexts, we use the index notation to describe them in more detail. We write indices referring to textual identifiers in non-italic and indices referring to variables in italic. Variables and Parameters 𝑏 Bit of the genotype 𝑐 Costs (context-dependent; cf. line below) EUR 𝑐 Specific heat capacity (context-dependent; cf. line above) J/(kgK) 𝐶 Capacity Wh 𝐶𝑂𝑃 Coefficient of performance 𝑑 Device Δ𝑒 Maximum energy delta in case of continuous aFRR upwards activation Wh Δ𝑒 Minimum energy delta in case of continuous aFRR downwards activation Wh Δ𝜆 Power level step delta between two power level steps 𝑒 Energy Wh 𝜂 Efficiency factor 𝐹 Fluctuation factor or stretch factor 𝜆 Power level step 𝜆 Maximum possible power level step 𝜆 Minimum possible power level step 𝑛 Number of possible power level steps 𝜔 Minimum runtime in number of time steps 𝑝 Power W 𝑝 Maximum possible power W 𝑝 Minimum possible power W 𝜋 Energy or capacity price EUR/Wh or EUR/W ̂𝜋 Marginal energy or capacity price EUR/Wh or EUR/W ̃𝜋 Resulting energy or capacity market price EUR/Wh or EUR/W 𝑟 Revenues EUR xxiii List of Symbols 𝜌 Density of a medium kg/m3 𝑆 Curve shift parameter 𝑠 State of a device (on or off) 𝑆𝑂𝐶 State of charge % 𝑆𝑂𝐶 Maximum accepted state of charge % 𝑆𝑂𝐶 Minimum accepted state of charge % 𝑇 Temperature K 𝑇 Maximum accepted temperature K 𝑇 Minimum accepted temperature K 𝑡 Time step within the optimization or simulation 𝜏 Reference temperature delta K 𝑉 Volume m3 𝑤 Weighting factor 𝜉 Energy form ∈ {el, heat, cold, gas} Functions 𝐶𝑂𝑃(𝜆, 𝜏) Coefficient of performance in dependence of power level step and reference temperature (ℕ × 𝕋 → [0, 1]) 𝜂(𝜆) Efficiency in dependence of power level step (ℕ → [0, 1]) 𝑓 aFRR +(𝜋) Expected temporal activation share for positive aFRR in dependence of aFRR+ energy price (ℝ → [0, 1]) 𝑓 aFRR −(𝜋) Expected temporal activation share for negative aFRR in dependence of aFRR− energy price (ℝ → [0, 1]) 𝑝(𝜆) Power in dependence of power level step (ℕ → ℝ) W Sets and Tuples 𝔻 Set of devices considered in the optimization ℿ Set of prices considered in the optimization 𝕋 Set of available reference temperature deltas ℬ Tuple with parameters representing a market bid 𝒟 Tuple with parameters representing a device Indices (sub- and superscript) act aFRR activation adjusted Adjusted according to specific scenario based on original value aFRR Automatic frequency restoration reserve aFRR + Positive automatic frequency restoration reserve xxiv List of Symbols aFRR − Negative automatic frequency restoration reserve aFRRdemand aFRR demand avg Average balance Balance battery Battery capacity aFRR capacity charge Charging chiller Chiller chp Combined heat and power plant cold Cold condBoiler Condensing boiler DA Day-ahead spot market demand Demand discharge Discharging el Electric end Last relevant time step energy aFRR energy excess Theoretical energy excess above 𝑆𝑂𝐶 exp Expected aFRR activation final Final state after modifying the system under consideration flexDown Downwards flexibility flexUp Upwards flexibility fuel Fuel gas Natural gas or biogas gridFees Grid fees and related surcharges heat Heat heatExchanger Heat exchanger heatPump Heat pump ID Intraday spot market in Added to the system under consideration interpol Interpolated maxDownAct Maximum downward activation maxUpAct Maximum upward activation out Removed from the system under consideration penalty Penalty of a solution candidate shortage Theoretical energy shortage below 𝑆𝑂𝐶 th Thermal thBuffer Thermal energy storage xxv List of Symbols tmp Temporarily used total Sum of all entities water Water wear Wear xxvi CHAPTER 1 Introduction In the twenty-first century, electricity is the foundation for a high standard of living throughout the world. We are used to benefit from electric energy independent of time by simply plugging electric devices into a power socket connected to the public grid. The complexity required to provide this freedom to individuals and businesses is well-hidden behind the power socket. Behind it lies a complex, increasingly digitalized, system with various entities and processes that are closely working together to provide the reliable delivery of electricity around the time. This complex techno-socio-economical system was initially built to cope with the challenges of the previous century. At that time, the primary challenge was the distribution of electricity from large, central electricity generators to distributed electricity consumers1. Nowadays, the general conditions are changing due to rising awareness of the implications of the chosen energy mix. As global warming shapes the earth in the long term, worldwide governmental goals aim at reducing greenhouse gas emissions. This results in historic changes to the energy landscape. Targeting lower greenhouse gas emissions, large fossil-fuel driven power plants are successively replaced by electric power generation based on decentrally available renewable energy sources such as photovoltaic and wind power. This disruptive development comes along with far-reaching challenges. One of them is the high dependence of renewable power generation on weather conditions, resulting in an intermittent and fluctuating power supply. Before the extensive rollout of renewable energy sources, large stochastic fluctuations could only be found in power demand, not in power supply. Consequently, in earlier power grids, the permanently required balance of power demand and supply could be implemented by controlling the supply of a comparatively small number of large power plants according to the actual demand. Information and communication technology bears great potential to efficiently handle the nowadays increasing share of intermittent and fluctuating power supply [Sia14]. 1In a closed system, electric energy is neither generated nor consumed, but instead converted from or to other energy forms such as thermal or kinetic energy. In this thesis, we use the established wording of generation and consumption of energy to refer to this process. 1 Chapter 1 Introduction The term Smart Grid summarizes digitalized power grids with intelligent coordination of generation and consumption [AM13; Far10]. Digitalization in this context is discussed on different system levels [Goe+14]. Examples range from single households with Building Energy Management Systems that are, e. g., shifting the runtime of heat pumps according to renewable generation, up to self-arranging energy communities whose participants coordinate the exchange of energy by means of decentralized control mechanisms. In this thesis, we focus on using flexibility regarding time and power of electric consumption in a grid-supportive and monetarily rewarding way. The scenario considered focuses on two aspects. Firstly, the German electricity and balancing power market environment, and secondly, commercial facilities in terms of office building complexes that bring together different forms of energy such as electricity, heat, cold, or gas. The rest of this chapter provides a more detailed view on the motivation for this thesis, contributions added to the current state of the art, the core research questions, and challenges tackled when answering them. Finally, the chapter ends with a roadmap through the thesis. 1.1 Motivation The introduction of fluctuating renewable energy sources puts the steady balance of electric power demand and supply at risk. In alternating current (AC) grids, a global indicator representing the demand-supply balance is the grid frequency. In the syn- chronized grid of Europe, the nominal frequency is defined to be 50 Hz. Apart from limitation through a certain speed of propagation, the grid frequency is independent of the geographic position within the grid. In the chapter on power system fundamentals, we explain why the frequency decreases below 50 Hz if the demand is higher than the supply, and increases above 50 Hz if the demand is lower than the supply. A primary goal in the operation of AC power grids is the steady balance of demand and supply, and hence keeping a stable grid frequency. As subsequently explained, electricity spot and balancing power markets provide economic stimuli for reaching this goal by utilizing the runtime flexibility of electricity generators and consumers. 1.1.1 Balancing Demand and Supply in Electricity Grids There are two fundamental mechanisms that allow balancing electricity generation and consumption to keep the grid frequency within a specific tolerance range. While the technical motivation is the same for all power grids, their implementation can vary 2 1.1 Motivation between grids. For instance, Germany belongs to the European synchronized grid with a nominal frequency of 50 Hz, while the synchronized grid in the United States of America is operated at a nominal frequency of 60 Hz. Furthermore, details regarding market designs, regulatory paradigms, or timing behaviors may vary between different grids. However, a common requirement for the stable operation of all AC grids are the subsequent two major mechanisms (M1 and M2): M1: Determining power schedules for demand and supply The first mechanism addresses the temporal planning of electricity generation (feed- in) and consumption (feed-out) and results in power schedules for generators and consumers. A power schedule represents energy supply or demand per time step. In public grids, this mechanism is, to a large degree, implemented by electricity spot markets where energy is traded in different time granularities (per hour, per quarter-hour) and with different lead times (days or even minutes ahead). → Realized through electricity spot markets. M2: Managing power schedule fluctuations and deviations The demand and supply schedules determined via Mechanism 1 are usually based on energy amounts per time intervals of 15 minutes. Due to planning uncertainties, deviations from the determined demand and supply schedules are inevitable, and power fluctuations within a 15-minute time interval are common. Respective deviations put the grid frequency and hence the physical grid stability at risk. In such cases, a mechanism is required to close the gap between demand and supply. In public grids, this is implemented by balancing (power) services and related balancing (power) markets. At balancing markets, balancing service providers (BSPs) offer to hold back the flexibility to adjust their consumption or generation within seconds to minutes upon short-term activation requests. Balancing power is also referred to as control reserve. → Realized through balancing power and balancing markets. Demand and supply curves resulting from the schedule generation are illustrated in Figure 1.1 whereby quarter-hour schedule intervals are common in most countries, including Germany. If the energy feed-in and feed-out is uniformly distributed within a 15-minute interval, the demand and supply curves overlap. If demand and supply diverge, it can be recognized that demand and/or supply have to be increased and/or decreased till the power gap is closed. This is realized by balancing power. In the example, the power gap is denoted as 𝑝1 and 𝑝2 respectively. It is visible that one can split balancing power measures into negative and positive balancing power. Negative balancing power is needed when the demand is lower than the supply (i. e., the frequency 3 Chapter 1 Introduction demand < supply t (quarter hours) Negative balancing power: ↓ Decrease supply, and/or ↑ Increase demand Positive balancing power: ↑ Increase supply, and/or ↓ Decrease demand demand > supply p2 Power perfect match 00:15 00:30 00:45 01:00 01:15 01:3000:00 demand supply p1 Figure 1.1: Balancing power handles power schedule deviations and fluctuations to guarantee a steady balance of demand and supply. is above the default), and positive balancing power is needed when the demand is higher than the supply (i. e., the frequency is below the default). In Germany, the schedule generation in Mechanism 1 is mainly based on trading at the European Power Exchange (EPEX), which is based in Paris, France. Large consumers and generators use this wholesale market to trade electric energy in the form of different products. These products mainly vary regarding their time interval length (representing the duration of the offered power provisioning) and their lead times (representing the minimum time between trade and delivery). However, due to the minimum required trading amounts and the overall process complexity, smaller consumers and producers, such as households or smaller commercial sites, do not directly participate in whole- sale electricity markets. Instead, power suppliers aggregate their demands and act at wholesale electricity markets in the form of large virtual consumers or producers. For Mechanism 2, different balancing power products are established depending on the speed of the reaction. For the willingness to adjust their schedules, BSPs usually receive a capacity price [EUR/kW]. The maximum allowed time between the activation request of a balancing power offer and the delivery of the power adjustment depends on the balancing power product. Depending on the product, BSPs earn an additional energy price for the energy delta they provide [EUR/kWh]. In the European grid, the 4 1.1 Motivation European Network of Transmission System Operators for Electricity (ENTSO-E) specifies a framework of boundaries within which participating countries can realize their own balancing power mechanisms [Eur17; Eur18b]. According to the ENTSO-E guidelines, Transmission System Operators (TSOs) are responsible for managing balancing power mechanisms. Three categories of balancing power products are established to guarantee schedule adjustments within seconds, minutes, or quarter hours. Traditionally, balancing power is provided by conventional power plants that intentionally only operate at partial load, e. g., only providing 90 percent of their maximum power output. Depending on frequency deviations, and hence demand and supply imbalances, BSPs must adjust their power schedules. The requirements for the schedule adjustments depend on the balancing power product offered by the BSP. In the end, the sum of BSP schedule adjustments minimizes the grid-wide gap between demand and supply. 1.1.2 Energy System Transition & Impacts on Grid Operation Scientists agree that greenhouse gases are responsible for global warming resulting in rising sea levels, regional changes in precipitation, and more frequent extreme weather events [Int14]. Developed countries are responsible for a large share of greenhouse gas (GHG) emissions. For this reason, 38 industrialized countries committed themselves to the Kyoto Protocol in 1997, which aims at reducing human-made greenhouse gas emissions [Uni98]. In the following years, more countries followed, and in 2020 the agreement was ratified by 191 countries [Uni20]. During the first commitment period (2008–2012), the participating countries agreed to reduce GHG emissions by at least an average of five percent against 1990 levels, and in the second commitment period (2013–2020), this target was increased to at least 18 percent [Uni17]. This was the start of a successive worldwide shift from mainly coal-fired power generation to a power system largely based on renewable and environment-friendly energy resources. In 2014 [Eur14a] and updated in 2018 [Eur18a], the European Union (EU) agreed on more specific energy targets that have to be met by 2030: 40 percent reduction of the EU greenhouse gas emission compared to 1990, a share of 32 percent of the EU’s final energy consumption from renewables, and 32.5 percent improvement in energy efficiency. In the Paris Agreement from 2016, 191 countries agreed on determining, planning, and regularly reporting their contributions to mitigate global warming [Uni16]. The agreement goes beyond previously set targets by pursuing the long-term goal of limiting the global average temperature increase to 1.5 °C compared to pre-industrial levels. Germany is often recognized as taking over a pioneering and leading role in transition- ing from a fossil-fuel based to a sustainable, renewable energy system [Hak+15; Wor20]. Already in 2010, Germany set ambitious targets regarding renewable generation in 5 Chapter 1 Introduction the electricity sector [Bun10]: 35 percent by 2020, 50 percent by 2030, 65 percent by 2040, and 80 percent by 2050 (as a share of the gross electricity consumption). In the electricity sector, the national goal for 2020 (35 percent) was met in 2018 with a share of 37.8 percent and in 2019 with a share of 42.1 percent [Bun20a]. Nuclear power plants do not emit greenhouse gases; however, they bear the risk of nuclear meltdowns and carry unsolved issues regarding the permanent disposal of nuclear waste. Therefore, in reaction to the Fukushima nuclear disaster in 2011, Germany decided to additionally shut down all nuclear power plants in Germany by 2022 [Bun11]. Furthermore, in 2020, Germany is discussing a draft law [Deu20i] for successively stopping coal-fired power generation latest by 2038. Discussing such heavyweight changes, it is worth noting that the electricity supply is a complex techno-socio-economical system. It consists of various operational mechanisms, a diverse landscape of actors and markets, and extensive regu- lation by laws and other instruments [Bun14; Bun15a] that have emerged as an answer to relatively consistent requirements during the previous century. Consequently, the historical transformation from a coal- and nuclear-driven power system to a sustainable, renewable one comes along with numerous challenges for the operation of electricity grids. The work presented in this thesis mainly contributes to three of these challenges: C1: The increased fluctuation and intermittency on the supply side increases the need for a flexible demand side: Due to the strong dependence on weather con- ditions, renewable energy sources are characterized by intermittency and power fluctuations. The balance of demand and supply is reflected by energy prices. As only limited flexibility is available on the demand side, the increased supply-side intermittency and fluctuation tend to increase price variances at electricity spot markets. [WGH16; Str08; SW14; Woo+11; Ket14] → Consequence: An increased potential for the economic exploitation of consump- tion and generation flexibility via electricity spot markets can be recognized. C2: The phase-out of conventional power plants decreases the available balancing capacity: Traditionally, balancing power is mainly provided by conventional power plants that are successively replaced by renewable energy sources. In addition, the loss of conventional BSPs is aggravated by stochastic renewable energy sources introducing new uncertainty. [Agr+14; ASH15] → Consequence: There is a need for alternative BSPs, which can be satisfied by flexible electricity consumers and generators located at demand side entities. 6 1.1 Motivation C3: The decentralization significantly increases the number of system entities potentially participating in the demand-supply matching: Renewable energy based on sun or wind is available spatially decentralized. It is not limited to rare environmental conditions (such as in the case of coal, where the efficient transport of resources is a major criterion for choosing the plant location). Due to limited economies of density, installing smaller units is already lucrative. This naturally increases the number of entities participating in the demand-supply matching process. [AM13; PD11] → Consequence: The increased overall coordination effort can be managed by a decentralized control realized by smaller sub-systems. 1.1.3 Commercial Facilities as Active Grid Participants In this thesis, we use the term commercial facility to refer to a building complex made up of office buildings with electricity, heating, and cooling demands. Commercial facilities are often characterized by local on-site generation, e. g., via photovoltaics or combined heat and power plants [Rie17]. Additionally, a solid trend towards on-site charging infrastructure for electric vehicles can be recognized. Traditionally, from the grid view- point, such commercial facilities take the role of pure energy consumers. However, the capability to adjust their electricity consumption and generation to some degree allows them to tackle the above-introduced challenges by utilizing electric flexibility incentivized by electricity and balancing power markets. Utilizing flexibility can result in decreased energy costs for the facility operator on the one hand, while the grid can benefit from additional grid-supporting services on the other hand. The combination of a traditional demand-side entity (consumer) with supply-side capabilities (producer) is also referred to via the portmanteau word prosumer. Prosumers can be seen as grid entities that can adjust demand and supply within certain boundaries according to local or grid-side incentives. A Facility Energy Management System (FEMS) enables the utilization of electric flexibility by processing information from entities representing the grid side to control energy consumers and generators located on-site. The above-elaborated consequences of the energy transition support the introduction of FEMSs as follows. Firstly, the increased price variance at electricity spot markets (→ challenge C1) allows facility operators to realize economic benefits via a FEMS that automatically uses electric flexibility regarding time and power for the optimized procurement of energy. In addition, the need for alternative BSPs (→ challenge C2) tends to lower barriers to access the balancing power market, hence opening it for facilities and resulting in an additional source of income for facility operators. Finally, as natural aggregation instances, FEMSs can be seen as 7 Chapter 1 Introduction power grid sub-systems that autonomously can couple and coordinate different energy forms based on local needs and external incentives. Consequently, by minimizing the communication overhead and conducting a local optimization, FEMSs can contribute to a simplification of the overall demand-supply matching process (→ challenge C3). Figure 1.2 visualizes the concept of a FEMS utilizing on-site flexibility in electric power consumption for acting at spot and balancing markets. It shows the facility as natural aggregation instance at which energy demand, supply, and buffers come together. Furthermore, this aggregation level brings together different forms of energy and unites electricity, heat, cold, and gas such that they can be optimized together. In particular, the coupling with existing buffering options allows devices to be operated flexibly regarding their runtime and power level. This flexibility can be used for buying or selling electric energy at the spot market while simultaneously providing balancing power via balancing power markets. The daily day-ahead optimization results are represented by the information flows marked with an 𝐴. This information flow includes device schedules, bids to the spot, and bids to the balancing power market (i. e., the offer of short-term schedule adjustments that can be activated within a lead time of seconds to minutes). If a balancing power bid is activated (→ information flow 𝐵1), the facility’s overall electricity demand has to be adjusted according to the bid. The FEMS realizes this by adjusting device schedules and communicating them to the respective devices (→ information flow 𝐵2). Depending on the activation of balancing power bids and in order to guarantee the satisfaction of on-site energy needs, device schedules may also be readjusted intraday via the intraday spot market (→ information flow 𝐵3). 1.1.4 Value Stacking of Flexibility at Spot and Balancing Markets In the course of this thesis, we focus on the EPEX day-ahead (DA) spot market and automatic Frequency Restoration Reserve (aFRR) provided via the aFRR market in Germany. As electric flexibility has a value in both markets, jointly considering them allows potentially increasing the monetary benefit for the facility operator. Therefore, the optimization provided by this thesis simultaneously considers both markets. This is also referred to as value stacking or multi-use of flexibility [Kla+18]. Traditionally, balancing services are provided by generators on the supply side. In contrast, consumers and generators that are directly located at demand side entities can be used to act as alternative BSPs. A significant challenge of demand-side BSPs is that they must satisfy local needs such as heating or cooling. Therefore, uncertain balancing power activations of flexible devices on the demand side can result in catch-up effects after a balancing power activation, i. e., the need for a later increase or decrease of the facility’s consump- tion to satisfy the local needs. Potential catch-up effects resulting from balancing power 8 1.1 Motivation Facility Energy Management System Power Grid and Markets Electricity Spot Market Balancing Power Market Market price (€/kWh) t Offer possible schedule deviations (kW per time slot) Lead time: minutes to day-ahead Lead time: seconds to minutes  On-site needs  Predictions  Interaction with third parties Device schedules Combined heat and power Cold storage Photo- voltaics Electric mobility Uncontroll- able load Air conditioning Facility schedule (kW) t buy buy Offer to adjust load in case of grid needs Heat storage Flexibility potential A A Activation of offer? A B2 Adjusted device schedules B3 Energy buffersElectric supply Electric demand Buy/sell day-ahead Buy/sell intraday Electric storage B1 Balancing power activation Optimization Figure 1.2: Concept of a FEMS monetizing electric flexibility via spot and balancing markets. 9 Chapter 1 Introduction activation impact the facility’s previously determined device schedules. Consequently, to minimize the imbalance of demand and supply (of a balancing responsible party, see Section 2.2.1), known catch-up effects have to be considered in the spot-market based schedule generation. In practice, catch-up effects through flexible demand-side BSPs are not yet of high relevance. Due to the relatively low share of BSPs on the demand side, the topic of balancing-power induced catch-up effects is not explicitly addressed by regulation [Deu16]. However, as the active integration of the flexible demand side into the electricity system is a declared goal of the government [Bun15a], the importance of adequately managing catch-up effects can be assumed to increase in the near future [Deu16]. We define that the whole electric energy demand of a facility, including the demand from the devices controlled by the balancing-power providing FEMS, belongs to one dedicated balancing group, which is kept balanced via the electricity spot market. The proposed optimization takes advantage of the knowledge that the activation of an aFRR bid (i. e., whether the bid is activated and, if yes, for how long) depends on the bid’s aFRR energy price. Following the aFRR merit order list, cheap bids are always activated prior to more expensive ones, and hence, they have a higher activation probability. This way, an optimization can roughly influence the activation characteristics of balancing power bids by adjusting their energy prices. In addition, information about expected aFRR activations allows for considering potential catch-up effects already in the day- ahead optimization. However, unforeseen schedule deviations through aFRR activations are always possible due to the stochastic nature of balancing power. Consequently, differences between planned and actual states of on-site devices and resulting catch-up effects are likely. For example, the temperature of a hot water storage can get lower than expected (if an activated balancing power bid turns off a combined heat and power plant longer than expected). Alternatively, the state of charge of an electric vehicle battery can get higher as expected (if an activated balancing power bid charges the battery longer than expected). Although information about expected balancing power activations can be used as input for the optimization of spot and balancing market bids, it is crucial to preserve the possibility of satisfying unexpected balancing power activations. For handling unforeseen balancing power activations, it is possible to intentionally provide only a share of the available flexibility as balancing power. For instance, if only a small range of a possible storage capacity is considered as degree of freedom in the day-ahead device scheduling (e. g., by only planning with a state of charge between 30 and 70 percent), an additional buffer is available for handling unforeseen balancing power activations. Aiming at maximum profit, the optimization proposed in this thesis dynamically weighs up the trade-off between possible aFRR revenues and decreased cost savings at the day-ahead spot market while guaranteeing unexpected aFRR activations. 10 1.2 Research Objective & Contributions Another option for handling unforeseen balancing power activations is the intraday schedule readjustment, e. g., via the intraday spot market. Here, we can distinguish two cases. In the first case, balancing power activations lead to more energy consumption than expected (e. g., if a battery’s state of charge gets too high). Then, surplus energy already procured day-ahead, which was not yet consumed, can be sold at the intraday spot market. In the second case, balancing power activations lead to less energy consumption than expected (e. g., if a battery’s state of charge gets too low). Then, missing energy can be bought at the intraday spot market. 1.2 Research Objective & Contributions Given the above motivation, this thesis provides a concept and optimization for a FEMS that utilizes a facility’s consumption and generation flexibility. The proposed optimization addresses two aspects. Firstly, it schedules devices according to prices at the day-ahead spot market. Secondly, it provides aFRR capacity by leveraging the facility’s ability to quickly increase or decrease the power demand upon stochastic grid needs within five minutes. Potential catch-up effects resulting from balancing power activations in the aftermath of an activation are already considered in the spot market procurement. If not explicitly stated differently, this thesis refers to the German power system. This particularly covers German electricity spot and German balancing power markets. Although commercial facilities set the motivational scenario in this thesis, the elaborated results have a broader validity and can be transferred to flexibility aggregators in other domains. To reach the overall goal, we define five research questions: RQ1: System environment and information processing What are information-processing system entities, communication links, character- istics of information flows, and uncertainties that have to be managed by a FEMS that utilizes electric flexibility in consumption and generation for participating in spot and balancing markets? (→ Chapter 2 + Chapter 4) RQ2: Modeling and simulation in the prosumer context How can grid and facility side system entities in the context of a spot- and balancing-market driven FEMS be modeled such that the flexibility potential can be assessed by simulation? (→ Chapter 4) RQ3: Analysis of aFRR balancing power activations How are aFRR activations characterized, and to what extent can these character- 11 Chapter 1 Introduction istics be used as input for an optimization that enables balancing power provision via alternative BSPs on the demand side? (→ Chapter 5) RQ4: Optimization for value stacking of flexibility and market bids How does an efficient algorithm have to look like that utilizes electric flexibility on the demand side by simultaneously considering both the day-ahead spot and the aFRR balancing market—and what are appropriate inputs? (→ Chapter 6 + Chapter 7) RQ5: Benefits of value stacking prosumer flexibilities What is the monetary effect for flexibility owners of utilizing electric flexibil- ity by value stacking the day-ahead spot and aFRR balancing market options? (→ Chapter 8) The thesis contributes to the research field of energy informatics, a research field in the computer science community that brings together methods of computer science, automation, economics, and electrical engineering to manage the increased complexity of electricity grids [Goe+14]. This thesis makes three significant contributions. The first is an efficient algorithm that utilizes electric flexibility by jointly considering the day-ahead spot and the aFRR balancing market, embedded into an optimization approach that can handle balancing power activation uncertainties. The design of the flexibilization algorithm is partly guided by algorithm engineering methods [San09]. The second is a simulation and analysis of the German aFRR market. This is based on an implemented ex- post simulation using historical market data. The third contribution builds upon the first two and is an assessment of the flexibilization potential from the facility operator’s view in current and future scenarios. This evaluation of the overall optimization approach is simulation-based. Different challenges must be addressed to answer the above presented research questions. The highly interdisciplinary thematic environment in particular requires a sound overall system competency: characteristics of energy consumers and generators, optimization methods, information and communication architectures, power system mechanisms, and different markets have to be understood in detail, and gaps between these areas have to be bridged with having the big picture in mind. Simulating the involved system entities and information flows requires finding adequate time granulari- ties, representations for the power system, and relevant device attributes. The design of an algorithm that allows for a joint spot market and balancing power market driven flexibilization has to handle various non-linear interdependencies and has to explore a big solution space. In particular, the value stacking through managing the trade-off 12 1.3 Thesis Structure between the two concurrently incentivizing markets, in combination with the handling of catch-up effects of demand-side BSPs, is not solved by prior work. The content presented in this thesis is partially based on peer-reviewed publications that have been previously published by this author as stated in Section A.1. 1.3 Thesis Structure This introductory chapter motivated the scenario of commercial facilities acting at the (day-ahead) spot and the (aFRR) balancing power market. The upcoming two chapters deal with the basics required for answering the introduced research questions: Ch. 2: Basic Theory of Smart Grid Operation and Optimization — presents funda- mentals for an in-depth understanding of electric power systems. This includes an explanation of operational mechanisms, different electricity and balancing markets, and regulations that are relevant for market participants. Furthermore, implications coming along with the energy transition are put into context. Ch. 3: Related Work — gives an overview of related work covering different types of flexibilities and provides a categorization and assessment of different flexibiliza- tion options found in literature and practice. After setting the foundations, Chapters 4–7 provide the required modeling, an analysis of the impacts of the choice of aFRR energy prices, and the optimization that jointly considers the day-ahead spot and aFRR balancing market: Ch. 4: Modeling in the Context of a Grid-responsive FEMS — presents the modeling and simulation of relevant system entities. Initially, information-processing entities are identified and information flows between relevant stakeholders are discussed. Based on this, selected grid and facility side entities are modeled and implemented for the simulative assessment of the flexibility potential presented later. On the grid side, focus is put on the German day-ahead spot market and the German aFRR balancing market with its activation mechanism. On the facility side, focus is put on typical consumers and generators. Ch. 5: Analysis of aFRR Activations — provides a quantitative analysis of balancing market characteristics based on the defined model for the German aFRR balanc- ing market and the related activation mechanism. This includes a discussion of drivers for demand and supply uncertainties. Particular focus is put on investigat- ing the impact of the choice of aFRR energy prices on the activation probability. 13 Chapter 1 Introduction The results of this quantitative analysis are used as input for the later proposed optimization. Ch. 6: Formulation of Optimization Problem for Flexibility Value Stacking at Day- ahead Spot and aFRR Balancing Markets — proposes the optimization for the flexibilization of demand-side consumers and generators and mathematically formulates the problem. The optimization outputs are device schedules and offers to the day-ahead spot and aFRR balancing market. This chapter covers the discussion of related uncertainties and different optimization methods regarding their suitability. Ch. 7: Design and Implementation of a Genetic Algorithm — puts the emphasis on the design of a genetic algorithm to solve the defined optimization problem. Besides the overall optimization scheme, the genotype-phenotype mapping and exemplary bit representations are presented for the prior modeled facility devices. Building upon the above contributions, Chapters 8 and 9 evaluate the proposed opti- mization, and conclude the thesis: Ch. 8: Evaluation and Assessment of the Optimization Potential — provides an assessment of the flexibility potential, evaluates the proposed optimization, and compares the results with the current state of the art. Based on the definition of a benchmark scenario, a sensitivity analysis is provided. It investigates the impact of various parameters, such as price level changes or the dimensioning of facility devices. Ch. 9: Conclusion — concludes the thesis with a summary, a critical discussion of the results, and an outlook on future research directions. 14 CHAPTER 2 Basic Theory of Smart Grid Operation and Optimization The presented work is interdisciplinary, covering aspects from power system operation, electricity and balancing markets, mathematical optimization, information and com- munication architectures, and the operational control of devices. This chapter presents the fundamentals required for this thesis and puts the work into the broader context. Therefore, the general architecture of power systems is explained. Special focus is put on the German power system, electricity and balancing markets, as well as underlying operational mechanisms. Further, this chapter discusses actors, regulation, and impli- cations of the energy transition in detail. This allows understanding newly emerging options for flexible demand-side entities with regards to grid stability, environmental, and monetary benefits. 2.1 Grid Architecture and Stability Provisioning of electricity via public power grids can be separated into four major tasks: generation, transmission, distribution, and retail. Generation describes the conversion of primary energy sources (such as coal, natural gas, solar, or wind energy) via power plants into electric energy (which after conversion from a primary energy source is also referred to as secondary energy). Transmission describes the transfer of generated electric energy over longer distances, and distribution describes the transfer to final consumers; both is done via power lines. Retail describes the selling of electric energy to final consumers. Traditionally, in the operation of power systems the four segments generation, trans- mission, distribution, and retail have been closely linked. Altogether they were provided by vertically integrated utilities that have been accepted as natural monopolies also in free market economies. However, over time the “essential facilities doctrine” gained 15 Chapter 2 Basic Theory of Smart Grid Operation and Optimization acceptance in the electricity sector [BK00]. It states that monopolists owning a facility essential to other competitors should provide reasonable access to that facility. In 1996, following the essential facilities doctrine, the liberalization of the electricity sector in Europe started with the European Union (EU) directive on the “internal market in electricity” [Eur96]. In 1998, Germany strictly separated the four segments generation, transmission, distribution, and retail. This unbundling was done based on the amended German Energy Industry Act1 (EnWG) which transposes the EU directive into national law. Since then, the services of the four segments have legally to be provided by sep- arated organizations. As a consequence, a competitive market environment can now be found within the segments generation and retail. As the operation of two parallel power grids is (in most cases) economically not reasonable, transmission and distribution remains a monopoly. To prevent potentially negative impacts of a lack of competition, government regulation is common for dealing with monopolies. In Germany, the German Federal Network Agency2 (BNetzA) is in charge of protecting grid user interests and setting rules for the discrimination-free usage of the infrastructure. 2.1.1 Interconnection of Generators and Consumers via Different Voltage Levels The vast majority of public power grids, including the synchronized European grid, transports electric energy using alternating current (AC)—current that periodically changes direction—rather than direct current (DC). For both AC and DC grids, the transmission of electric energy over power lines results in energy losses due to Joule’s first law (see [Jou41]). It states that electrical conductors generate heat due to their resistance, and that these losses quadratically decrease with an increase in voltage. Consequently, aiming at low transmission losses, a major advantage of AC grids in contrast to DC grids is the fact that voltage can be adjusted relatively easily. With transformers as passive components, the voltage can be increased for the transmission and later on decreased for usage in, e. g., households, hence decreasing transmission losses. Step-up transformers convert from grid segments that are operated at low voltage (with high current) to grid segments operated at high voltage (with low current), and step-down transformers vice versa. Figure 2.1 visualizes the structure of the German (AC) power grid. It shows the different voltage levels with transformers in-between, and maps typical generators and consumers. The following voltage levels are common: 1German: “Energiewirtschaftsgesetz” (EnWG) 2German: “Bundesnetzagentur” (BNetzA) 16 2.1 Grid Architecture and Stability Large power plants  nuclear, coal, gas  off-shore wind, hydro Medium power plants  coal, gas  solar, large wind parks, hydro Smaller power plants  gas  solar, wind parks, hydro, biomass Small power plants  solar, wind, hydro, biomass Large consumers  large industry  large cities Medium consumers  medium and small cities  industry and business  EV fast charging stations Small consumers  small business  households  EV charging stations Transmission & Distribution ConsumptionGeneration Extra-high voltage (220–380 kV) High voltage (60–110 kV) Medium voltage (6–30 kV) Low voltage (230/400 V) Figure 2.1: Structure of the public power grid that connects generators and consumers via different voltage levels. • Extra-high voltage grids are usually operated at 220 kV or 380 kV. They are used to connect the lower grid segments over longer distances. Larger coal, nuclear or hydro power plants feed into this grid segment. • High-voltage grids are operated between 60 kV and 110 kV, whereby in Germany 110 kV is most common. Small to medium power plants and large industrial consumers are connected to this grid segment. • Medium-voltage grids are operated between 6 kV and 50 kV. Urban power plants, large wind and photovoltaic power plants, and industrial as well as commercial consumers are connected to this grid segment. • Low-voltage grids are operated at 230 V (phase-to-neutral) or 400 V (phase- to-phase). This grid segment is intended for final consumers and particularly challenged by the energy transition. Originally, it was planned for the pure distribution of energy delivered via upstream grid segments. However, the share of (rooftop) PV panels feeding into this grid segment is increasing. This partially results in an inversion of the conventional top-down energy flow. Additionally, electric mobility results in high loads that are added to this grid segment. See Section 2.4.2 for a full discussion of related challenges. 17 Chapter 2 Basic Theory of Smart Grid Operation and Optimization Table 2.1: Dimensions of public transmission and distribution grids; data: [Bun20c]. TSO DSO Number of grid operators 4 883 Circuit length 36 800 km 1 814 200 km thereof extra-high voltage grid 36 400 km 300 km thereof high-voltage grid 400 km 94 200 km thereof medium-voltage grid 0 km 519 200 km thereof low-voltage grid 0 km 1 200 500 km Number of customers 487 51405860 thereof industry & commercial 487 3011337 thereof residential households 0 48394523 In context of the energy transition, high-voltage direct current (HVDC) lines are increasingly introduced to bridge between distant (AC) grid segments [Wan+13]. This is due to the fact that the transport of electric energy over longer distances in the range of hundreds of kilometers is cheaper via HVDC lines than via (high-voltage) AC lines. In particular for the transmission of wind power from large (offshore) wind parks in the north of Germany to consumption centers in the south of Germany, the German grid development plan aims at the construction of multiple HVDC links [Bun16]. In Germany, four Transmission System Operators (TSOs)3 and 883 Distribution System Operators (DSOs) are responsible for the operation of the above classified power grid segments [Bun20c]. TSOs particularly operate extra-high voltage grids and a small share of high-voltage grids, and DSOs particularly operate medium-voltage and low-voltage grids. Table 2.1 clarifies dimensions of the power lines in different voltage levels in Germany. It shows that the total length of extra-high voltage transmission lines is very small compared to low-voltage lines that are used for distribution to final consumers. Furthermore, the table confirms that the vast majority of consumers is connected to distribution grids. Only few industrial and commercial consumers with a very high energy demand are directly connected to transmission grids. Due to the high overall number of DSOs, their largest share (803 of 883 DSOs) has less than 100 000 customers [Bun20c]. 3Four TSOs have responsibility for a control area; when including three off-shore organizations without control area responsibility, the BNetzA counts seven TSOs [Bun20c]. 18 2.1 Grid Architecture and Stability 2.1.2 Global Grid Stability & Frequency Control Grid frequency is one of the two major electric power quality indicators. The second indicator is voltage as described in the next section. Worldwide, most of the public AC power grids have a nominal grid frequency of either 50 Hz or 60 Hz. In Europe, the nominal frequency defined by the European Network of Transmission System Operators for Electricity (ENTSO-E) is 50 Hz [ENT09], while, e. g., grids in the United Stated of America use a nominal frequency of 60 Hz. Electric consumers and generators are built to work with the nominal frequency. Depending on the device, deviations of the nominal frequency can be handled very generously or only in a very limited tolerance band. The frequency represents the grid-wide balance between demand (feed-out) and sup- ply (feed-in). It can be seen as a global indicator representing this balance independent of the position within a synchronous grid.4 If the grid-wide demand is higher than the grid-wide supply, the grid frequency decreases. If the grid-wide demand is smaller than the grid-wide supply, the grid frequency increases. The technical reason lies in traditional power plants (which still make up a large share of the power plants): they are converting kinetic into electric energy by means of turbines with rotating masses. If the electricity demand is too low, the surplus of energy in the system results in a faster rotation, i. e., in an increased frequency. If the electric demand is too high, the energy demand slows down the rotation, i. e., lowers the frequency. As already described in the motivational chapter, two major mechanisms are in place to reach a steady balance of feed-in and feed-out. Firstly, electricity (spot) markets are the basis for the creation of feed-in and feed-out schedules. Secondly, balancing services and related balancing markets are the basis for handling uncertainty and deviations from the planned schedules. The procurement and activation of balancing power lies in the responsibility of the TSOs. The next sections provide a detailed explanation of electricity markets (Section 2.2) and balancing services as well as related balancing markets (Section 2.3). 2.1.3 Local Grid Stability & Voltage Control Voltage is a local grid state which is largely affected by the physical grid structure and connected consumers and generators. The nominal voltage in European low-voltage grids, including Germany, is defined to be 230 V (phase-to-neutral) or 400 V (phase-to- phase). In Germany, voltage in the distribution grid is allowed to have a deviation of maximum ±10 % of the nominal value of 230 V [Deu12]. Figure 2.1 presents different voltage levels and parties involved. The output voltage of a transformer to the distribution grid was traditionally set close to the upper limit. This is due to the expected voltage 4The frequency’s propagation speed, however, is limited by the speed of light. 19 Chapter 2 Basic Theory of Smart Grid Operation and Optimization drop coming with each connected load. It can be clarified using the example of a linear power line fed by a transformer on one side. If multiple loads are connected to the power line at different positions (e. g., multiple buildings within a street), they result in a continuous voltage drop over the power line. In the initial grid planning, power lines have traditionally been planned such that all consumers, including, e. g., the last building in a street, receive a valid voltage. Traditionally, the load closest to the transformer was aligned close to the upper limit (i. e., 230 V + 10 %) and the load furthest away from the transformer was aligned close to the lower limit (i. e., 230 V − 10 %). However, as a result of the expansion of (rooftop) PV plants in low-voltage distribution grids, the voltage drop due to consumers is complemented by a voltage rise due to generators. This increases the uncertainty within distribution grids. As they originally have been built based on different assumptions, this makes voltage control a more dynamic and challenging task (see Section 2.4.2 for a full discussion). Besides considering voltage in the static grid planning on the long time scale, it can also be operationally adjusted on shorter time scales. DSOs operating low-voltage grids can adjust the voltage in particular via controllable transformers, via reactive power compensation, or via feed-in/feed-out management. Controllable transformers allow adjusting the output voltage level at the transformer. This adjusting allows to move from a potential critical voltage area to a non-critical one. Reactive power compensation allows modifying the voltage drop via power factor adjustments. Feed-in and feed-out management are the most relevant options with regard to prosumer flexibilization: Feed-in management allows to limit the feed-in of decentralized generators (nowadays mainly PV plants). Feed-out management, accordingly, allows to limit the feed-out of decentralized consumers (nowadays mainly heat pumps). So far, in Germany and many other countries, feed-in and feed-out management in distribution grids is usually realized via ripple control systems5 based on one-way Power Line Communication (PLC) [DBS11]. In PLC, a higher-frequency signal (usually between 150 Hz and 1 350 Hz) is superimposed onto the standard grid frequency of 50 Hz, which means that the power grid itself is used as a communication network. As of today, when a ripple control receiver receives such a signal from the DSO, it disconnects or throttles the related feed- in unit (e. g., PV plant), or the related feed-out unit (e. g., heat pumps) until another signal is received. The implementations of control mechanisms in distribution grids, and particularly details of ripple control, differ from distribution grid to distribution grid. In Germany, feed-in management in distribution grids is nowadays mainly realized via PV panels larger than 30 kWpeak. One prerequisite for receiving feed-in funding 5German: “Rundsteuertechnik” 20 2.2 Electricity Markets according to the German Renewable Energy Sources Act6 (EEG) is that DSOs have to receive control authority over PV plants7. Four steps are common: 100 % (default), and throttling to 60 %, 30 %, or 0 % of the maximum feed-in. By law, DSOs have to remunerate the throttled feed-in energy such that the operator has no financial disad- vantage. However, it is worth noting that renewables by law have a feed-in precedence (§ 11 EEG), and hence throttling of renewable energy sources should be the last option chosen by the DSO. Feed-out management in the distribution grid is nowadays mainly realized via heat pumps. This is incentivized by § 14a EnWG which guarantees reduced grid fees for final consumers that give control authority to the DSO. 2.2 Electricity Markets Electric energy can be traded at electricity markets. Electricity markets bring together representatives of power generation and consumption to buy or sell the obligation to feed-in or feed-out electricity in the future. On this basis, schedules for generators and consumers are created. Products at electricity markets differ in two major aspects: firstly, the duration of the delivery time slots and, secondly, the lead time between trading and the time of delivery. This section describes market segments and products in detail. Direct trading bypassing official electricity markets is also possible. This is called over-the-counter (OTC) trading. In this thesis, the focus in on the German market environment. 2.2.1 Balancing Groups At electricity markets, the smallest relevant entity that can exchange energy is a balancing group. A balancing group describes an account maintaining a virtual quantity of energy that is fed-in or fed-out per 15-minute time slot. Every grid user feeding in or feeding out energy has to administer a balancing group, or has to belong to someone else’s balancing group. Each balancing group has a balancing responsible party (BRP) that is responsible for keeping the balancing group’s feed-out and feed-in in line with the bought and sold energy.8 Therefore, each balancing group is composed of at least one feed-in and one feed-out point. On the basis of quarter hours, each balancing group has to guarantee the balance between energy flowing into the group and energy flowing out of the group: 6German: “Erneuerbare-Energien-Gesetz” (EEG) 7PV plants smaller than 30 kWpeak are alternatively allowed to limit the maximum feed-in power to 70 %. 8See § 4 of the German Electricity Network Access Regulation (German: “Stromnetzzugangsverordnung” (StromNZV)). 21 Chapter 2 Basic Theory of Smart Grid Operation and Optimization ∀𝑡 ∶ 𝑒feedIn 𝑡 + 𝑒import 𝑡 = 𝑒feedOut 𝑡 + 𝑒export 𝑡 (2.1) where 𝑒feedIn 𝑡 or 𝑒feedOut 𝑡 represent the energy fed in or out in the respective quarter hour 𝑡, and 𝑒import 𝑡 or 𝑒export 𝑡 represent the energy imported from or exported to other balancing groups in the respective quarter hour. For reaching this balance, the balancing group’s feed-in (𝑒feedIn 𝑡 ) or feed-out (𝑒feedOut 𝑡 ) can be adjusted, or energy can be imported (𝑒import 𝑡 ) from or exported (𝑒export 𝑡 ) to other balancing groups. Agreements for this balancing group adjustment can be reached on basis of electricity spot market trading or via bidirectional over-the-counter agreements. 2.2.2 Long-term and Short-term Electricity Markets From an economic viewpoint, electricity prices on the one hand influence the long-term investments into new power plants and also into energy-intensive consumption sites. On the other hand, they also control the short-term resource scheduling for both generators and consumers, i. e., the decision of when to feed-in or out energy. In order to meet these two different needs, different electricity market segments exist. The closer the delivery time, the better the market participants can estimate the real feed-in and feed-out, and the more fine-granular are the time slots of the traded products. While energy is traded in base load and peak load granularity years ahead, it is traded in 15-minute granularity on the day of delivery. At a high level of abstraction, we can separate between two kinds of wholesale markets: • Derivatives markets are used to agree on prices in the range of years to weeks before the delivery and payment [BP17]. They are in particular used to gain calculation certainty and to control investment decisions. This enables long-term planning for power plant operators and for energy-intensive consumers or utilities. Futures and forwards describe two derivative instruments. At standardized mar- kets, such long-term contracts are described by the term futures. When traded over the counter, i. e., on basis of bilateral agreements and without an interme- diary, the term forwards is used. In contrast to futures and forwards which are unconditional agreements, options are derivative instruments with conditional agreements: an option contract gives the buyer the right, but not the obligation, to buy or sell a product at a specific price (called strike price) prior to or on a specified date. Derivative instruments often define a financial and not physical settlement, i. e., the traded energy does not have to be backed by actual assets that are able to deliver or consume energy. As obligations to deliver or consume energy at a certain price can be sold or bought later (at different prices), derivative markets 22 2.2 Electricity Markets can be used for speculation. Futures and options for the German market area can be traded at the European Energy Exchange (EEX) which is based in Leipzig, Germany, whereby futures can be traded up to six years ahead. • Spot markets are used to trade energy short-term in the range of days to minutes before the delivery [BP17]. They are used to schedule generators and flexible consumers (mainly day-ahead) and to minimize balancing group deviations in case of changing generation or consumption forecast (mainly intraday). Energy traded at spot markets is physically settled, i. e., it must be backed by actual assets that are able to deliver or consume energy. The electricity spot market for the German market area is operated by the European Power Exchange (EPEX) which is based in Paris, France. Typical stakeholders participating at electricity wholesale markets are power suppliers, power plant operators, large industrial enterprises, or aggregators. Due to relatively large overheads (admission procedure, operational requirements, minimum trading capacities), a direct market participation is usually not worthwhile for final consumers [UR17]. Instead, they rely on intermediaries aggregating the demand of a large number of consumers. Power suppliers operate a balancing group, take over the procurement via electricity markets, and the responsibility for balancing group deviations. Therefore, they add a profit margin to the final electricity price. 2.2.3 Electricity Spot Markets Figure 2.2 shows the time sequence of the options that a flexibility owner (on the demand or supply side) has to monetize its flexibility. Different segments of the balancing market (upper half) and the electricity spot market (lower half) can be recognized. These markets are often also referred to as flexibility markets as they allow turning flexibility in consumption and/or generation into a monetary benefit [VBM18]. To begin with, we focus on electricity spot markets (which we also refer to as simply spot markets). Balancing markets are discussed separately in the upcoming Section 2.3. The Figure visualizes a time scale covering two days (shown on the x-axis): the day before the delivery of a respective product and the day of delivery. For each market segment (shown on the y-axis), trading times are marked in dark blue, and related product time slots are marked in light blue. The market characteristics summarized on the right side can be explained as follows: • Bid components describe the single components of a bid to the market. At electricity spot markets, bids typically consist of a power value (kW) representing 23 Chapter 2 Basic Theory of Smart Grid Operation and Optimization the power that has to be delivered over the duration of a product time slot and an energy price (EUR/kWh). In context of markets, a ‘bid’ price generally refers to the highest price a buyer is willing to buy and a ‘ask’ price refers to the lowest price a seller is willing to sell. • Market mechanism (call auction vs. continuous double auction) describes the process of matching bids. At electricity spot markets, we can separate between call auctions and continuous double auctions. In call auctions, buyers and sellers can submit bids to the order book during a bidding period. After a well-defined gate closure time, bids are matched by the central market operator. In continuous double auctions, both buyers and sellers can continuously submit bids to the order book, which are then directly matched as soon as possible. Call auctions tend to result in a high market liquidity by providing fixed points in time in which market participants are brought together. In contrast, continuous double auctions allow for a continuous matching of bids, and hence allow for more short-term decisions. At the EPEX electricity spot market, a day-ahead and intraday call auction as well as an intraday continuous double auction are offered. This is a pattern which is similarly also found at other stock markets (such as Xetra at the German Stock Exchange [Deu20a]): trading is often opened with a call auction, while a continuous market for trading operates the rest of the day. • Market pricing (pay as bid vs. pay as cleared) describes how the price is determined. In pay-as-bid pricing, the final price for a certain product (such as one specific hour or quarter hour) represents the price that was actually bid by the buyer and seller. In contrast, in pay-as-cleared pricing, the market clearing price is the one single price at which most of the buy and sell bids in the respective order book can be matched. In pay-as-cleared pricing, the price for both buyers and sellers can be better than their original bids: for buyers it is lower or equal to their bid, and for sellers it is higher or equal to their bid. The market clearing price is determined by the intersection of the supply curve (mapping the accumulated energy supply to the marginal energy prices), and the demand curve (mapping the accumulated energy demand to the marginal energy prices). At the EPEX electricity spot market, the day-ahead auction and the intraday auction follow the pay-as-cleared principle, and the intraday continuous double auction follows the pay-as-bid principle. • Bid requirements focus on minimum power capacities and possible power steps. At the EPEX electricity spot markets, trading is possible starting with a minimum 24 2.2 Electricity Markets power of 100 kW and in 100 kW steps. Consequently, one-hour products are traded in 100 kWh steps, and quarter-hour products are traded in 25 kWh steps. In the following, a more detailed overview of the different spot market segments is given. Section 2.2.4 describes further cost components that have to be paid by final consumers, Section 2.2.5 describes how grid constraints are taken into account, and Section 2.3 describes the balancing services and markets in more detail. 25 Chapter 2 Basic Theory of Smart Grid Operation and Optimization FCR 4-h neg.+pos. reserve products (6) aFRR 4-h pos. reserve products (6) aFRR 4-h neg. reserve products (6) mFRR 4-h neg. reserve products (6) mFRR 4-h pos. reserve products (6) 00:0000:00 00:00 GC 5 min. prior to delivery of the respective productElectricity MarketsAuction Day-ahead auction Intraday (opening) auction … … Day prior to provision/delivery Day of provision/delivery Summary of major market characteristics Day-ahead auction 1-h products (24) Intraday auction 15-min products (96) Intraday continuous 1-h products (24) Intraday continuous 15-min products (96) tBalancing Markets aFRR auction mFRR auction … … FCR auction Continuous min. 0.1 MW, in steps of 0.1 MW GC at 8:00 ● results at 8:30 GC at 9:00 ● results at 9:30 GC at 10:00 ● results at 10:30 GC at 12:00 ● results at 12:50 GC at 15:00 ● results at 15:10 GC 5 min. prior to delivery of the respective product … aFRR energy auction mFRR energy auction Acceptance by capacity price merit order; individual activation based on energy price merit order Acceptance by capacity price merit order; uniform activation based on frequency Individual activation based on combined energy price merit order (regular reserve auction + reserve energy auction) Regular auction Energy auction ✖ ✖ ✖ ✖ ✖ Bid components Pay as Power + capacity price Power + capacity price + energy price Power + energy price Power + energy price min. 1 MW, in steps of 1 MW Bid requirements Market mechanism Call auction Power + energy price Continuous double auction 15:00 16:00 bid cleared GC 1 hour prior to delivery of the respective product GC 1 hour prior to delivery of the respective product 09:30 10:30 Intraday continuous trading for 15-min products Intraday continuous trading for 1-h products Market opening times Related product timesLegend: GC = gate closureFigure2.2:TradingtimesandproducttimeslotsatGermanspotandbalancingmarketsclarifyoptionsforthemonetizationofconsumptionandgenerationflexibility. 26 2.2 Electricity Markets 2.2.3.1 Day-ahead Call Auction On the day before the physical delivery, demand and supply can be matched via trading at the EPEX day-ahead call auction. Germany and Luxembourg build a coupled market area in which electricity is traded without consideration of grid constraints (the ancillary service redispatch provides a mechanisms for the consideration of grid constraints after trading, see Section 2.2.5). The EPEX day-ahead auction allows to trade 24 one-hour products in daily auctions with the gate closing the day before the delivery at 12:00 h. Following the pay-as-cleared principle, the day-ahead auction results in a uniform hourly energy price per one-hour product. The 24 prices for each day are published as soon as possible after 12:50 h. The day-ahead call auction is also referred to as day-ahead auction or day-ahead market. Figure 2.3 visualizes the above explained principle of a call auction matching the interests of buyers and sellers. It is based on actual bids to the EPEX day-ahead auction for one single one-hour product of one exemplary day. The market clearance price is the price of the most expensive offer which is required for satisfying the requested demand. It is represented by the intersection of both curves. The market clearing price defines the market equilibrium where the highest possible quantity of buy and sell bids is matched. Furthermore, the figure visualizes two effects coming along with the energy transition. The arrow marked with A indicates the implication of renewable energy sources: an increased number of relatively cheap sell bids will result in a shift of the supply curve to the right. The two arrows marked with B indicate the implication of an increasing flexible demand: a higher price elasticity on the demand side will result in a tilt of the demand curve [Han+17]. The demand curve visualized in Figure 2.3 may be misleading regarding the price elasticity of the overall energy demand, i. e., the degree to which the energy requested depends on the price. The figure suggest a high price elasticity on the demand side, i. e., that the energy requested depends on the price to a high degree. However, the visualized day-ahead demand curve only represents the trading of positions by participants at this particular market segment. It does not represent the overall electricity demand [KP16] which is also satisfied via bilateral over-the-counter agreements and trading at earlier and later markets. While Figure 2.3 helps understanding the matching process via the day-ahead auction, Figure 2.4 shows a box plot diagram with the resulting 24 hourly prices for each day of the year 2019, categorized by the day of week. Looking at the interquartile range it can be seen that 50 % of the hourly prices of the whole year lie in a relatively small corridor following a recognizable pattern: from Monday to Friday prices tend to be lower during night hours (which are characterized by a relatively low demand) and around the early 27 Chapter 2 Basic Theory of Smart Grid Operation and Optimization-50005001,0001,5002,0002,5003,00014,00018,00022,00026,00030,00034,00038,000 Marginal electricity price (EUR/MWh)Accumulated energy (MWh)Supply: sell bids (ask)Demand: purchase bids (bid)❌BBA Figure 2.3: Price formation at the spot market day-ahead call auction: demand and supply are matched resulting in one market clearing price per one-hour product; exemplary market data: [EPE20a]. afternoon (which is characterized by a relatively high supply from photovoltaic plants). On Saturday and Sunday, an overall lower price level can be recognized which may be attributed to the overall lower energy demand on the weekend. 2.2.3.2 Intraday Call Auction The intraday call auction closes at 15:00 h (i. e., three hours after the day-ahead auction closes). The intraday call auction is also referred to as intraday auction. While the day-ahead auction allows trading one-hour products, the intraday auction allows trading of more fine-granular quarter-hour products. After the gate closure at 15:00 h, demand and supply are matched for each of the 96 quarter-hour products as already explained and visualized in context of the day-ahead auction. The intraday auction is a pay-as- cleared auction (as the day-ahead auction, too), and hence results in a uniform energy price per quarter-hour. The 96 prices for each day are published as soon as possible from 15:10 h. After the intraday auction, the continuous intraday trading starts. Therefore, the intraday auction is also referred to as intraday “opening” auction. Figure 2.5 opposes the prices of the day-ahead auction (1-h products) and the intraday auction (15-min products) for two exemplary days: one winter and one summer day. It can be seen that the prices resulting from the day-ahead auction (gate closure 12:00 h) differ from the prices resulting from the intraday auction (gate closure 15:00 h). The price 28 2.2 Electricity Markets Figure 2.4: Distribution of electricity prices resulting from the EPEX day-ahead auction: box plot based on all hourly prices from all days of the year 2019 (outliers are not visualized); market data: [EPE20a]. differences can be explained by new information (such as better forecasts) considered in the bidding at the intraday auction, or by limited liquidity at the intraday auction (not all generators can technically be operated in 15-minute intervals). The recognizable zigzag price pattern resulting from the intraday auction is the result of the quarter-hourly correction of prior hourly traded products [BB18; MFN18]. It can be explained well by means of the example of selling photovoltaic energy. Due to the high liquidity at the day-ahead auction, photovoltaic energy is initially sold as one-hour product. The depicted summer day shows that the prices of the day-ahead and intraday auction particularly differ in the morning hours before noon (rising sun) and in the afternoon hours (setting sun). If energy is sold at the day-ahead auction in form of a 1-h product, the rising sun results in the fact that the available power in the first quarter hour is lower than in the last quarter hour. Respectively, as balancing groups have to be balanced in 15-minute intervals, additional energy has to be bought (resulting in higher prices) or surplus energy has to be sold (resulting in lower prices) via the intraday auction. In the evening hours, the same pattern can be recognized vice versa, motivated by the setting sun. The resulting zigzag price pattern at the intraday auction can, to some degree, also be found in the night hours. Then, the pattern can be explained by intrahour changes of the required power on the demand side rather than the supply side. 29 Chapter 2 Basic Theory of Smart Grid Operation and Optimization 0 10 20 30 40 50 60 70 80 1 5 9 13172125 2933374145495357616569737781858993Electricity Price (EUR/MWh) Quarter hour of the respective day Day-ahead, 31 Jan. 2019 Day-ahead, 31 Aug. 2019 Intraday, 31 Jan. 2019 Intraday, 31 Aug. 2019 Figure 2.5: EPEX day-ahead auction prices (24 one-hour products per day) vs. EPEX intraday auction prices (96 quarter-hour products): comparison of a winter and summer day; market data: [EPE20a; EPE20b]. 2.2.3.3 Intraday Continuous Double Auction After the intraday auction is closed, the intraday continuous double auction opens. It allows trading energy with a shorter lead time of at least five minutes (within one of the four TSO control areas) or thirty minutes (between different TSO control areas) before the delivery. This market is also referred to as the continuous intraday market, and it allows trading of 1-h, 30-min and 15-min products. It is described as continuous double auction as ask and bid are continuously matched as soon as a matching is possible, and as both the demand and the supply side can put bids into the (central, open and anonymous) order book. At this market, a trade is directly executed if a buy bid is added to the order book with a price that is at least as high as a fitting sell bid, or if a sell is added to the order book with a price that is at least as low as a fitting buy bid. Consequently, the pricing principle is pay-as-bid. Besides the direct trade execution, the pricing principle is a major difference to the day-ahead and intraday auctions: while the continuous intraday market is operated with pay-as-bid pricing, the day-ahead and intraday auctions are operate with a pay-as-cleared pricing. An analysis of the development of the trading behavior at the continuous intraday market has already been published in [Rom+19]. Our analysis showed that, in recent years, the lead time between trading and delivery, as well as the average volume per trade decreased. Among others, we showed that prices and volumes are changing from transaction to transaction, and especially close to the delivery time an increase of liquidity in the market can be recognized. 30 2.2 Electricity Markets05101520253035Energyprocu-rement,sales,marginGridfeesMeter-ing pointoperat-ionCon-cessionlevyEEGreallo-cationchargeFurtherreallo-cationchargesElectri-city taxValueaddedtaxTotalIndustrial customers4.332.320.010.116.410.762.053.0419.03Commercial customers5.696.030.280.766.411.012.054.2226.45Private customers7.616.890.331.626.411.022.054.9330.85Cent/kWh Figure 2.6: Composition of final electricity prices paid by final consumers, separated by customer segments; data: [Bun20c]. By law, BRPs are obligated to keep their balancing groups balanced. If they are not able to do so via latest the continuous intraday market, the balancing services operated by the TSOs will minimize the resulting deviations (see Section 2.3). 2.2.4 Composition of the Final Electricity Price Electricity prices paid by final consumers are significantly higher than pure energy prices resulting from the trading at electricity markets (or over the counter). In addition to the pure energy price, final consumers have to pay for additional services required for the power supply. This includes costs for the grid infrastructure, costs for ancillary services required for a stable grid operation (such as redispatching and balancing power), and taxes. Figure 2.6 visualizes electricity price components paid by final consumers in Germany in 2019. It can be seen that the price components depend on the total electricity demand. The bars in the front show price components for household (2 500–5 000 kWh/a ∧ = ⌀ 0.29–0.57 kW), the bars in the middle show price components for commercial consumers (50 MWh/a ∧ = ⌀ 5.7 kW), and the bars in the back show price components for industrial consumers (24 GWh/a ∧ = ⌀ 2.7 MW). It can be seen that in all three consumer classes, the actual price for the procurement of energy makes up only a small share of the overall price that finally has to be paid for consuming electric energy via the public grid. The three largest price components of the electricity price paid by final consumers are the “EEG reallocation charge”, “grid fees”, and “energy procurement, sales and margin”. 31 Chapter 2 Basic Theory of Smart Grid Operation and Optimization The EEG reallocation charge is set by the government and used to finance the expansion of renewable energies. Large energy-intensive consumers above 1 GWh are (partly) exempt from paying EEG reallocation charges (see § 64 EEG). Grid fees are based on the individual power capacity provided at the grid connection; for large consumers they can be based on monthly or annual power peak measurements, depending on the utilization hours (defined as the annual energy demand in kWh divided by the maximum quarter-hourly power demand in kW). The energy procurement costs are based on the procurement strategy of the electricity supplier. Power suppliers usually buy a share of the energy via electricity derivatives markets (which allows hedging against price risks) and a share of the energy via electricity spot markets. Traditional electricity meters do not allow to map energy measurements to the time of use. As a consequence, costs for energy procurement are traditionally generalized by the electricity supplier such that the final consumer’s electricity costs are independent of the time of use. So far, final consumers did not experience electricity spot market based incentives for load shifting. However, on the one hand, the increasing share of renewable energy sources results in an increasing fluctuation of spot market prices and hence increasing incentives to utilize electric flexibility. On the other hand, electric flexibility is more and more needed for dealing with fluctuating and intermittent renewable energy sources (see Section 2.4.1). Motivated by this, smart metering infrastructures are widely rolled out as they allow linking energy consumption and the time of use (see Section 2.4.3). Discussing time-variable price signals requires having a detailed look on the above price composition: the monetary benefit of a pure spot market based flexibilization is relatively low if the remaining components remain static. If only spot market based prices are considered as load-shifting incentive, only a small share of the final electricity price will be subject to fluctuation. To foster the integration of renewable energy sources and the flexible demand side, current research and political discussions investigate adoptions of the overall tax and fee system behind electricity prices paid by final consumers. Among others, the way of splitting grid fees, e. g., to capacity-based and energy-based price components is discussed [CF18]. Furthermore, research suggests the flexibilization of further electricity price components [Fro16], such as grid fees [Con20] or the EEG reallocation charge [Ago19; HNV17]. Discussions about the flexibilization of grid fees particularly address the advancement of § 14a EnWG [Deu19a]: already today, this paragraph guarantees reduced grid fees in exchange for control authority over flexible consumers. Regulatory changes resulting in higher fluctuations of the final electricity price paid by final consumers will increase the interest in load shifting due to increased monetary benefits. 32 2.2 Electricity Markets 2.2.5 Congestion Management and Redispatching Electricity spot markets target the operational planning and scheduling of flexible generators and consumers. They result in balanced feed-in and feed-out schedules that match demand and supply. In the German system design, trading at these markets is based on the assumption of a large copper plate without any physical constraints with respect to the delivery of electricity. To consider grid constraints resulting from limited operating resources, different concepts have been proposed [PPK15]. Grid constraints originate from, e. g., power limits of transformers or transmission lines. The two most prominent concepts for considering grid constraints are zonal pricing (with redispatching) and nodal pricing. In the following, key concepts are summarized based on reference [MZH18]. The two concepts differ regarding the spatial resolution of prices determined by electricity markets. In the concept of zonal pricing, the same price applies to the entire market zone independent of the spatial location within the market zone. In most European countries, including Germany, zonal pricing is implemented. Market zones are often aligned along country borders. However, some countries are divided into more than one market zone, and some countries team up with further countries to form one common market zone. At the EPEX, Germany forms one market zone together with Austria and Luxembourg. Consequently, trading at electricity spot markets assumes that energy can freely flow between the feed-in and feed-out locations of sellers and buyers within this market zone as if it were a single copper plate. In the concept of nodal pricing, an individual price is determined for each entry or exit point, e. g., of the transmission grid. This way, grid constraints can be reflected in prices. In case of free transmission capacities, the price level of zonal and nodal pricing will equalize. Examples for countries implementing nodal pricing are Australia, Russia and parts of the United States of America. This way, in nodal pricing systems, grid constraints are already considered upfront in the schedule generation. However, it is worth mentioning that he constraints are only reflected in the prices and there is still no guarantee that physical constraints are respected. In zonal pricing systems, in contrast, grid constraints are considered after trading: this is done via the ancillary service redispatch which is operated by the TSOs. Redispatching results in grid constraint motivated adjustments of power plant schedules that are changing the spatial distribution of the feed-in. It can be separated into preemptive redispatch aiming at preventing the violation of grid constraints, and curative redispatch aiming at correcting grid constraint violations [BDE20b]. The overall redispatching process is as follows: Daily, schedules of larger power plants have to be reported to the TSOs (after the publication of the day-ahead auction results which 33 Chapter 2 Basic Theory of Smart Grid Operation and Optimization in Germany is at 12:50 h). After the daily deadline, the TSOs conduct power flow simulations based on grid models. These simulations may uncover the need for schedule adjustments due to grid constraints (preemptive redispatch). Alternatively, the need for schedule adjustments may be uncovered based on measurement within the grid (curative redispatch). As a grid-wide steady balance of demand and supply is required, power schedule adjustment should always be realized pairwise involving at least two parties: if one power plant (in front of a grid congestion) is shut down due to grid restrictions, another power plant (behind the grid congestion) is required to increase the output by the same power in order to keep the required balance. As the ancillary service redispatching is required for a stable grid operation, regulation defines that large power plants9 have to adjust their (active or reactive) power feed-in upon TSO requests. In Germany, power plant operators are compensated for redispatch-related costs, e. g., resulting from additional fuel consumption or balancing group deviations. However, as of today, redispatching is not a market-based approach: according to § 13a Abs. 2 EnWG, power plant operators should be “economically neither better nor worse off” due to redispatch measures. In Germany, costs for the ancillary service redispatching have increased significantly with the rollout of renewable energy sources during the last years [BDE20b]. This can be explained by wind power related electricity surplus in the north of Germany. As a consequence, the advancement to a new “Redispatch 2.0” is currently in progress [Hir+20; BDE20a]. It is based on an amendment of § 13a EnWG which was announced via the German Grid Expansion Acceleration Act10. According to this, from October 2021 onwards, redispatching should also include smaller generation units above 100 kW, rather than only the large ones above 10 MW. As smaller units are located in the distribution grids and not in the transmission grid, this results in the need for a closer cooperation between TSOs and DSOs. 2.3 Balancing Services & Balancing Markets In the section on balancing groups, it was shown that each balancing group is obligated to make the best possible decisions in order to realize the 15-minute based demand/sup- ply schedules. It was shown that the schedules usually result from trading at electricity markets or over the counter. If the planned schedules always matched the actual feed-in and feed-out, the permanently required demand-supply balance would be given. How- ever, deviations from agreed schedules are common due to prediction errors, noise, and 9in Germany above 10 MW; see § 13a EnWG 10German: “Gesetz zur Beschleunigung des Energieleitungsausbaus” 34 2.3 Balancing Services & Balancing Markets outages on both the supply and demand side. As already introduced in the motivational chapter, balancing power is in place to close the gap between the actual feed-in and feed-out (see Figure 1.1). Balancing power is also referred to as control reserve or reserve power. In the synchronized European power grid, the ENTSO-E defines the framework for balancing services via its Operation Handbook [ENT09]. Building upon this framework, the VDE Transmission Code 2007 provides concrete technical requirements for the im- plementation in Germany [Ver07]. According to this, the TSOs are responsible to handle unpredictable deviations from agreed schedules. In order to close demand and supply gaps, the TSOs procure and activate three types of balancing services using balancing markets. Balancing service providers bid to these markets and provide the capability to deviate from their reported schedule upwards and/or downwards upon short-term activation request. Depending on the type of balancing service, in Germany the required reaction speed is in the range of max. 30 seconds (Frequency Containment Reserve), max. 5 minutes (automatic Frequency Restoration Reserve), or max. 15 minutes (manual Frequency Restoration Reserve). Balancing services are provided by generators or con- sumers that are able and willing to adjust their schedules upwards and/or downwards upon such short-term requests. This way, balancing services continuously close potential demand and supply gaps, hence allowing for a steady grid frequency of (almost) 50 Hz even in case of deviations from the planned power schedules. Balancing services are crucial to the grid stability as frequency deviations greater than ±0.2 Hz may end up in blackouts [ENT17]. 2.3.1 Types of Balancing Services Balancing services can be classified by two major characteristics [Con14]. Firstly, we can distinguish the direction of balancing power, depending on whether feed-in is too low or too high. Secondly, we can distinguish different temporal qualities of balancing services, classified by the time till the provided balancing power is fully available after an activation. Depending on the direction of the imbalance, i. e., whether the feed-in is too low or too high, we can separate between negative and positive balancing power. The difference between the two balancing directions was already visualized and explained in Figure 1.1 in the motivational chapter. It can be recognized that negative balancing power (also referred to as negative reserve) is required if the feed-in is higher than the feed-out (frequency > 50 Hz). Positive balancing power (also referred to as positive reserve) is required if the feed-in is lower than the feed-out (frequency < 50 Hz). A potential gap between feed-in and feed-out can be closed by power adjustments on both the 35 Chapter 2 Basic Theory of Smart Grid Operation and Optimization demand and the supply side. Consequently, both balancing directions can be provided by generators and consumers. However, the traditional focus was on generators, based on the assumption that consumption cannot be controlled. Regarding the speed of power adjustments, different classes of power plants come along with different capabilities. For the synchronized European grid, the ENTSO- E specifies three types of balancing services regarding their temporal requirements [ENT09]: • Frequency Containment Reserve (FCR): fully available within 30 seconds, also referred to as Primary Control Reserve (PCR) • Automatic Frequency Restoration Reserve (aFRR): fully available within 5 minutes, also referred to as Secondary Control Reserve (SCR) • Manual Frequency Restoration Reserve (mFRR): fully available within 15 minutes, also referred to as Tertiary Control Reserve (TCR) In the European context, the terminology FCR, aFRR and mFRR gained acceptance in recent years. This thesis focuses on German balancing services and uses this inter- nationally established terminology which is also used by the ENTSO-E and in context of European regulation [Eur17]. It is worth noting that the same types of balancing services are also referred to as PCR, SCR and TCR. Activation of balancing services follows the activation scheme visualized in Figure 2.7. It can be seen that slower balancing services substitute faster balancing services. This way, faster balancing services can recover to be ready for quickly reacting to new imbalances. Subsequently, the three types of balancing services are described in more detail. According to the ENTSO-E, the grid area for which a TSO has to operate balancing services is defined as load-frequency control (LFC) area. In the following, we also refer to an LFC area simply as control area. Frequency Containment Reserve As already explained, the frequency measured within a synchronized grid is a global indicator representing the balance of the over- all feed-in and feed-out. In a fully balanced grid, the nominal grid frequency will be measured. Frequency deviations larger than 10 mHz (i. e., frequencies smaller than 50.01 Hz, or larger than 49.99 Hz) result in a direct activation of FCR [Deu19c; ENT09]. Therefore, all FCR-controlled generators and consumers measure the grid frequency locally. Based on these decentralized frequency measurements, FCR activation follows a frequency-based proportional-integral (PI) controller: the higher the frequency devia- tion, the higher the activated power [ENT09]. This way, provisioning of FCR is done 36 2.3 Balancing Services & Balancing Markets Replacement Replacement Maintains frequency in tolerance band Automatic activation Automatic activation Manual activation Manual Frequency Restoration Reserve Transmission System Operator Control area power balance Frequency Containment Reserve Grid frequency Deviation from nominal frequency Imbalance Automatic Frequency Restoration Reserve Minimizes imbalance Figure 2.7: Balancing service activation scheme: in case of ongoing imbalances, faster balancing services release slower balancing services to be able to quickly react to new imbalances (FCR is released by aFRR and aFRR is released by mFRR); inspired by [ENT09]. collectively by all ENTSO-E control areas where the activation of FCR does not need any explicit communication between the TSOs and the FCR providers as they are implicitly synchronized by the frequency signal. Control areas are operated by TSOs and often represent one country; sometimes countries are also split into multiple control areas such as Germany, which is split into four control areas of which each is operated by a dedicated TSO. The ENTSO-E specifies the required FCR power 𝑝FCR,total. Each control area of the European synchronized grid has to provide a share of the overall required FCR power. The FCR power 𝑝FCR,𝑖 which a certain control area 𝑖 has to provide is based on the share of the respective control area’s electricity production on the ENTSO-E-wide electricity production: 𝑝FCR,𝑖 = 𝑝FCR,total ⋅ 𝑝elGeneration,𝑖 𝑃elGeneration,total . Hence, the higher the electricity production in a control area, the higher the FCR power that has to be provided by the control area. Traditionally, FCR is mainly provided by steam or gas driven plants as changes of the steam or gas supply are reflected in the plant’s electric power output within seconds. According to the ENTSO-E, FCR providers must be able to continuously deliver their maximal FCR power for a maximum of a quarter hour. In recent years, FCR provisioning by battery storage systems gained popularity [Deu15a] as they are also 37 Chapter 2 Basic Theory of Smart Grid Operation and Optimization able to quickly change the power output within seconds. In Germany, the TSOs procure about 500 MW FCR (Q3/2020) [Deu20h]. Automatic Frequency Restoration Reserve aFRR provisioning has lower temporal requirements than FCR provisioning. aFRR has to be provided within five minutes upon explicit activation request by the TSO. The activation request is communicated via the Internet. aFRR allows the faster FCR resources to stay available for short-term adjustments. In contrast to FCR which is activated decentrally by BSPs continuously monitoring the frequency, aFRR is activated via a control area specific controller. Each control area is operated by the respective TSO. This controller calculates BSP-specific control signals in four-second granularity which are then send directly to the BSP. The central controller is implemented as PI controller with two inputs [ENT09]: the grid frequency, and the deviation from all measured control area coupling points. The latter considers the FCR power provided within the control area. Its output is the aFRR power which has to be activated. The PI controller acts proportional to the temporal integral of the deviation. Given a certain deviation, this means that the activated aFRR power increases continuously until the deviation disappears. The activation of single aFRR providers follows the aFRR energy price merit order list. Bids are activated till the required aFRR power demand is satisfied, starting with the cheapest bid. As the aFRR controller works in four-second granularity, the latest activated offer in the merit- order list can change every four seconds. However, aFRR providers are free to react within five minutes. Traditionally, aFRR is mainly provided by pumped storage hydro power plants and gas driven power plants. The power output of these power plants can be well-adjusted within five minutes without. In Germany, the TSOs procure about 1 900–2 000 MW negative aFRR and about 2 000–2 100 MW positive aFRR (Q3/2020) whereas the exact capacity depends on the time of day [Deu20h]. The amount of the procured balancing capacity is motivated by historical experiences and the requirement of the 𝑛 − 1 stability which states that the failure of any power plant has to compensated [ENT09]. In this context, it is worth mentioning that the increasing number of smaller generation units may result in simultaneous failures of multiple smaller rather than one large generation unit. Consequently, the increasing share of renewable energy sources may require adaptions of the way of how the required balancing capacity is determined. Manual Frequency Restoration Reserve mFRR provisioning has lower temporal requirements than aFRR provisioning. mFRR has to be provided within a quarter hour upon explicit activation request by the TSO. It is used to compensate larger imbalances such as outages of large generators. The activation request is communicated via the 38 2.3 Balancing Services & Balancing Markets Internet. mFRR allows the faster aFRR resources to stay available for more short-term adjustments. mFRR is activated based on centralized decisions by TSO which are based on the amount of aFRR activated [ENT09]. Activation is done in form of 15-minute power schedule adjustments sent from the TSO to the BSP, i. e., the provided power remains constant for a minimum of a quarter hour. In contrast to FCR and aFRR which are both activated (almost) continuously, mFRR is activated only very seldom and in single quarter hours. In particular, the trend of decreased lead times at intraday electricity markets [Rom+19] results in a lower overall mFRR demand as it allows BRPs to handle upcoming imbalances via trading at the continuous intraday market. In Germany, the TSOs procure about 600–700 MW negative mFRR and about 900–1 200 MW positive mFRR (Q3/2020) whereas the exact capacity depends on the time of day [Deu20h]. 2.3.2 Product Characteristics at Balancing Markets Characteristics of the three balancing service types and the associated balancing markets are summarized in Table 2.2. Besides differences in the above described activation mechanisms, the characteristics of the balancing service products can be recognized: in the meanwhile all three balancing service types are offered over four hours. As FCR is a symmetric product, there are six FCR products per day. In contrast, it can be seen that aFRR and mFRR are asymmetric products, i. e., negative and positive balancing power are offered separately. Therefore, there are twelve aFRR products, and twelve mFRR products per day (six time slots of which each is separated into negative and positive balancing power). Trading times, product time slots, major market characteristics, and the temporal interaction with spot markets are also visualized in Figure 2.2. It is worth noting that pooling of multiple balancing providing entities for reaching the minimum volume is allowed for all three types of balancing services [For09b], and that dedicated requirements for FCR provisioning via battery storage systems exist [Deu15a]. A dedicated prequalification is required for provisioning of balancing services and participation at balancing markets. Within the prequalification, BSPs have to prove to the TSOs that they are capable of reliably providing requested power adjustments considering the power gradient, the maximum speed of activation, and the IT-based connectivity of the respective balancing service [For09a]. Among others, the prequalification includes the activation of an exemplary power profile. 39 Chapter 2 Basic Theory of Smart Grid Operation and OptimizationTable2.2:CharacteristicsofbalancingservicesandrelatedbalancingmarketsinGermany:FCR,aFRR,andmFRR.FrequencyContainmentReserveAutomaticFrequencyRestorationReserveManualFrequencyRestorationReserveBidcomponentspower[MW],capacityprice[EUR/MW]power[MW],capacityprice[EUR/MW],energyprice[EUR/MWh]power[MW],capacityprice[EUR/MW],energyprice[EUR/MWh]Activationtimemax.30secondsmax.5minutesmax.15minutesBalancingdirectionsymmetric(i.e.,onebidprovidesbothnegativeandpositivepower)asymmetric(i.e.,onebidprovideseithernegativeorpositivepower)asymmetric(i.e.,onebidprovideseithernegativeorpositivepower)Producttimeslots6×4-hourblocks:0–4h,4–8h,…,20–24h6×4-hourblocks:0–4h,4–8h,…,20–24h6×4-hourblocks:0–4h,4–8h,…,20–24hBiddingvolumeatleast1MW,incrementsof1MWatleast1MW,incrementsof1MWatleast1MW,incrementsof1MWBidsubmissiondailytilllatest8:00fortheupcomingdaydailytilllatest9:00fortheupcomingdaydailytilllatest10:00fortheupcomingdayAcceptanceintopoolcheapestfirstaccordingtocapacitypriceMOLcheapestfirstaccordingtocapacitypriceMOLcheapestfirstaccordingtocapacitypriceMOLActivationorderequallyprovidedbyallBSPinthepoolcheapestfirstaccordingtoenergypriceMOLcheapestfirstaccordingtoenergypriceMOLActivationmechanismcontinuousactivationproportionaltofrequencydeviationbasedondecentralizedfrequencymeasurementbyBSPcentralizeddecisionbyTSObasedonmeasuredcontrolareapowerbalanceandfrequency,activationviafour-secondsetpointsentfromTSOtoBSPcentralizeddecisionbyTSObasedontheamountofaFRRactivated,activationviaquarter-hourlyschedulesentfromTSOtoBSPRemunerationpay-as-cleared(marginalcapacityprice)pay-as-bid(capacityprice+energypriceincaseofactivation)pay-as-bid(capacityprice+energypriceincaseofactivation) 40 2.3 Balancing Services & Balancing Markets 2.3.3 Settlement of Balancing Service Costs For offering balancing services, BSPs earn a capacity price (EUR/MWh) in the case of FCR, and both a capacity and an energy price (EUR/MWh) in the case of aFRR and mFRR. The capacity price is paid for the provisioning, and the energy price is paid for actual aFFR/mFRR activations depending on the actually provided energy. Figure 2.8 visualizes the settlement of balancing service costs. The capacity price based costs for holding back balancing power are socialized. They are fully allocated to the grid fees and are consequently collectively paid by all grid users. The energy price based costs have to be paid by the BRPs causing the imbalances that result in the aFRR/mFRR activations. This cost settlement design distributes the costs for holding back the technically required balancing services to all users of the grid, and also serves as incentive to balancing groups to avoid schedule deviations. Grid Users Balancing Responsible Parties Transmission System Operator Balancing Service Providers Frequency Containment Reserve Balancing capacity costs Accruing balancing capacity costs (EUR/MW) Accruing balancing energy costs (EUR/MWh) Grid fees Uniform imbalance energy price (reBAP) Automatic Frequency Restoration Reserve Balancing capacity costs Balancing energy costs Manual Frequency Restoration Reserve Balancing capacity costs Balancing energy costs Figure 2.8: Settlement of balancing service costs: costs for holding back capacity are collectively paid by grid users and costs for aFRR/mFRR activations are paid by the BRPs causing the imbalance. In case of FCR and aFRR, the costs for the actual activation of balancing power are allocated to the BRPs causing the imbalances. In this context, the below introduced Grid Control Cooperation resulted in the introduction of a uniform imbalance (energy) price11 (reBAP) for all four German control areas. The reBAP is based on the energy 11German: “regelzonenübergreifender einheitlicher Bilanzausgleichsenergiepreis” (reBAP) 41 Chapter 2 Basic Theory of Smart Grid Operation and Optimization costs resulting from all aFRR and mFRR activations in a certain quarter hour, i. e., the costs resulting from the energy prices that had to be paid due to the activated bids. The reBAP is a quarter hourly energy price (EUR/MWh) which can be positive or negative. It is calculated by the TSOs [Deu20b] and has to be paid by each BRP with imbalances in a certain quarter hour. As a result of the reBAP, all BRPs with balancing group deviations in one quarter hour are equally priced with the same price in all German control area. Consequently, the higher the deviations of a balancing group, the higher the reBAP imbalance costs the respective BRP potentially has to pay. BRPs can make use of the so called “day-after market” for minimizing their balancing group imbalances after they occurred, i. e., after the time of delivery and after balancing power was activated [BP17]. This is not a regulated market as the name may suggest. Instead, it refers to OTC agreements that can be made by BRPs to adjust their balancing group schedules after delivery. In Germany, ex-post balancing group adjustments can be made till 16:00 h after the day of delivery. BRPs can use this option to minimize their imbalances after the time of delivery: If one BRP had a higher supply in a dedicated quarter hour and another BRP had a lower supply in the same quarter hour (or vice versa) these two parties can agree to adjust their balancing groups in the aftermath such that their individual imbalance is minimized. 2.3.4 Grid Control Cooperation The grid control cooperation (GCC) is a control concept used by the four German TSOs in order to technically and economically optimize the procurement and activation of aFRR and mFRR. It is implemented by coupling the power-frequency controllers of multiple control areas (each control area is represented by one power-frequency controller). The functionality of the GCC is based on four modules. Each module aims at a specific economical optimization of the balancing service provisioning process [Deu20d]: • Module 1: Avoidance of opposed aFRR/mFRR activations (imbalance netting) It is possible that one control area has a lack of power (i. e., is underfed) while at the same time another control area has surplus power available (i. e., is overfed). Without the GCC such two control areas would activate balancing power into different directions: One would activate positive balancing power and the other would active negative balancing power. Module 1 aims at preventing such situations by balancing such control areas. The cost saving potential lies is the reduction of the opposed balancing power activations for aFRR and mFRR [Con+19]. • Module 2: Joint dimensioning of the aFRR/mFRR balancing capacity The dimensioning of the balancing capacity procured by the TSOs traditionally is 42 2.3 Balancing Services & Balancing Markets done for each control area. Module 2 of the GCC introduced a joint dimensioning of the balancing capacity procured by the TSOs: Considering multiple control areas as one virtual control area allows minimizing the overall required balancing capacity. The cost saving potential lies in the decreased balancing capacity that has to be reserved, and hence the decreased costs for the provisioning of aFRR and mFRR. • Module 3: Joint procurement of aFRR/mFRR balancing power Without the GCC, aFRR and mFRR were procured per control area, and BSPs could only provide balancing power for their dedicated control area. Module 3 of the GCC introduced that aFRR and mFRR providers of involved control areas can (to some degree) also provide balancing power for other control areas independent of the TSO they are connected to. The cost saving potential lies in the increased competition between the affected BSPs which results in decreased aFRR and mFRR costs. • Module 4: Cost-optimal aFRR/mFRR activation Traditionally, the activation of aFRR and mFRR is done by each TSO for its control area. Even after the joint procurement introduced in Module 3, the activation would still be done following the control area specific energy price merit-order list. As it may be cheaper to activate a BSP located in a neighboring control area, Module 4 introduced common aFRR and common mFRR merit-order lists. They cover all bids within the control areas participating in the GCC. The cost saving potential of jointly considering all available aFRR or mFRR bids when activating balancing power lies in reduced activation costs. The first module of the German GCC was introduced in 2008, since then in particular Module 1 was extended by adding further European TSOs that collectively form the International Grid Control Cooperation (IGCC) [Int16; Deu20c]. With the Platform for the International Coordination of Automated Frequency Restoration and Stable System Operation (PICASSO), the ENTSO-E works on continuing the cooperation between TSOs in form of an European aFRR platform that enables the exchange of balancing power between TSOs [Eur21b]. Figure 2.9 shows how Module 1 (imbalance netting) and Module 4 (cost-optimal aFRR activation) are technically implemented. It shows the proportional-integral controllers for three exemplary control areas. Each is operated by the responsible TSO. The inputs and outputs of each controller can be recognized. When neglecting the higher-level central aFRR optimization, each controller’s input is (besides the measured frequency) the respective control area’s measured power balance, also referred to as Area Control 43 Chapter 2 Basic Theory of Smart Grid Operation and Optimization Control area 1 Power balance aFRR controller BSP aFRR activation aFRR ACE aFRR demand correction Control area 2 aFRR controller Power balance BSP aFRR activation aFRR ACE correction Control area 3 Power balance aFRR controller BSP aFRR activation aFRR ACE correction aFRR demand correction Further control areas Control area n aFRR optimization aFRR demand aFRR demand Figure 2.9: Optimization of aFRR activations in the Grid Control Cooperation; based on [Int16]. Error (ACE) [ENT09]. It is measured at the control area’s coupling points to other control areas, at the so called tie lines. Each controller’s output are aFRR activation requests that are sent to the single aFRR providers. After the introduction of the GCC, the control area specific controllers stayed active. Instead of replacing the multiple controllers with a single central controller, the higher-level central optimization (shown in the middle) was introduced. Its input is the aFRR demand individually calculated by each connected control area. On this basis, the central controller continuously calculates a correction for the ACE of each connected control area in one-second resolution [Deu20d]. Based on this central optimization, the input values for the control area specific controllers are adjusted such that the single aFRR bids are activated in a way that avoids opposite aFRR activations (Module 1) or that minimizes the overall activation costs by using a common aFRR energy price merit-order list (Module 4). An example clarifies how the GCC works in context of Module 4: In the extreme case, the BSPs with the cheapest energy price bids could all be located in control area 1 which at a given point of time may have no aFRR demand. At the same time, there could be an aFRR demand in control area 2 and 3. Due to Module 4 of the GCC, the higher-level central aFRR optimization would then adjust the ACE of control area 1 such that the respective aFRR controller activates its connected BSPs. At the same time, the ACE of control area 2 and 3 would be adjusted such that no activation takes place in these 44 2.3 Balancing Services & Balancing Markets control areas. This decreases the overall activation costs while satisfying the overall balancing power demand. 2.3.5 Overall Balancing Service Provisioning Process Figure 2.10 graphically summarizes the balancing service provisioning process, which was introduced in detail above. It shows the interaction between the three main actors TSOs, BRPs, and BSPs, highlights their responsibilities, and shows the overall temporal sequence. For each task, the color of the line indicates when the task is executed relative to the actual delivery of balancing power (ex ante, in real time, or ex post). Day-after market Available balancing capacity (MW) Activated balancing energy (MWh) 1 Prequalification of BSP 2 Definition of the required balancing capacity 3 Tendering and determination of the balancing activation merit-order 6 Balancing power activation (aFRR, mFRR) 9 Payment of the capacity and energy price 10 Calculation of the reBAP imbalance price for the activated balancing energy Responsibilities of TSOs 4 Registration of demand and supply schedule 5 Causing balancing power demand 8 Reduction of balancing group imbalances 11 Paying of the reBAP imbalance price Responsibilities of BRP 7 Provisioning of balancing energy Responsibilities of BSP Ex ante Real time Ex post Balancing service provider (BSP) • Demand • Supply 5 7 2 6 11 12 48 1 3 3 Balancing responsible party (BRP) • Demand • Supply Transmission System Operators (TSOs) in the Grid Control Cooperation (GCC) TSO 1 TSO 2 ··· TSO n Figure 2.10: Summary of the overall balancing service provisioning process with actors and their interaction; based on [HZ13]. The TSOs as natural monopolies are responsible for the successful provisioning of balancing services. Therefore, the BNetzA takes care of the correct and fair execution of necessary tasks. This in particular includes the efficient, non-discriminatory design of balancing markets and regulation regarding fees. 45 Chapter 2 Basic Theory of Smart Grid Operation and Optimization 2.3.6 Backup Mechanisms For cases in which balancing services fail at bringing back the frequency to its nominal value, there are two major backup mechanisms: one for the case of undersupply (handled by positive balancing power), and one for the case of oversupply (handled by negative balancing power). The first backup mechanism focuses on load shedding as backup for positive balancing power, i. e., disconnecting loads if positive balancing power is not able to bring the frequency back to the nominal value of 50 Hz. Therefore, the ENTSO-E defines different load shedding steps that connected TSOs have to enforce on an obligatory basis [ENT17]: Below 49.8 Hz, storage pumps must be disconnected within 10 s, and below 49.2 Hz they must be disconnected immediately. Afterwards, between 49.0 Hz and 48.0 Hz, load is shed in minimum six different steps till a total of 45 % is shed at 48.0 Hz. If these measures are not sufficient to keep the demand at a healthy balance with the supply, generators are allowed to be disconnected below 47.5 Hz in order to avoid sustainable physical damage for them. Load shedding as back-up strategy fits well to the traditional control paradigm “supply follows demand”: if the supply cannot follow, the demand is shed. However, due to the high fluctuation of renewable energy sources, oversupply turned out to be a challenge as well (see Section 2.4.1 for a full discussion). For this reason, in Germany, an additional supply side backup mechanism for negative balancing power was introduced with the rise of rooftop PV plants: In 2005, the German Association of Grid Operators12 (VDN) defined that in cases where negative balancing power is not able to keep the frequency down at 50 Hz, PV plants above 10 kW must disconnect from the public grid at 50.2 Hz [Ver05]. However, once a certain share of PV power was reached, the abrupt disconnection of a high share of PV plants was identified as a serious problem with regards to potential frequency oscillation: disconnecting a high share of PV plants can decrease the frequency to below 50 Hz, as a consequence balancing services will increase the feed-in, PV plants may reconnect, and frequency will increase again. As a consequence, in 2012, the frequency limit for a hard disconnection was increased to 51.5 Hz [Bun12a]. Nowadays, between 50.2 Hz and 51.5 Hz, a stepwise throttling of the feed-in power is realized, hence minimizing the threat of potential frequency oscillations. 2.4 Implication of the Energy Transition In recent years, the increasing share of renewable energy sources on the overall energy mix resulted in manifold changes. These changes are very challenging for multiple 12German: “Verband der Netzbetreiber” (VDN) 46 2.4 Implication of the Energy Transition reasons. Firstly, they require trade-offs between economic efficiency, environmental sustainability, and the security of supply which is also referred to as the energy policy target triangle [Sch17]. Secondly, they come along with multifaceted arguments due to a high number of stakeholders with partly divergent interests [Rei+18]: interests of TSOs, DSOs, utilities, power plant operators, the conventional and renewable energy industry, aggregators, and final consumers have to be discussed and weighed up. Thirdly, the energy transition involves multiple sectors such as electricity, heat, gas, and mobility that should be considered in a holistic way [Bro+18]. Finally, the enhancement of the energy system design does not happen on a green field. Instead, it is complicated by well-established and organization-overlapping operational processes. The major implications of the energy transition with relevance for the flexibilization of prosumers are summarized in the following. 2.4.1 Need for Demand Side Management The predominant control paradigm in power grids with a high share of conventional generation by controllable power plants can be characterized as “supply follows demand”. This control paradigm assumes that a large share of the electricity consumption is assumed as inflexible. Given this assumption, the required demand-supply balance can be realized by flexibilization of the generation. This control paradigm fits to energy systems with a large share of conventional power plants that are well controllable. However, in contrast to conventional power generation, the intermittent and fluctuating generation of renewable energy sources (PV, wind or hydro power) is based on weather conditions. Given a high share of such renewable energy sources, it becomes more and more difficult to keep demand and supply balanced by solely adjusting the supply side: once a certain share of the power generation is replaced with renewables, the intermittent and fluctuating supply may not be able to (economically) satisfy the demand. As a consequence, the energy transition results in a control paradigm shift from mainly “supply follows demand” to additionally “demand follows supply”. Measures aiming at the adjustment of the electricity consumption based on the electricity generation are summarized under the term Demand Side Management (DSM) [PD11]. DSM may be incentivized by time-variable price signals or other economic stimuli. The reaction of the demand side is also referred to as Demand Response. It can result from manual human intervention or from energy management systems automatically responding to the DSM incentives by shifting device runtimes. Smart metering as described below is the major technology enabling DSM. 47 Chapter 2 Basic Theory of Smart Grid Operation and Optimization 2.4.2 Increasing Share of Prosumers in Distribution Grids It was already shown that electricity traditionally is fed into high-voltage grid segments and transported down via transformers to low-voltage grid segments where it finally is consumed (see Section 2.1.1). Hence, the traditional power flow direction can be described as top-down. However, in recent years, the share of small generation units installed in low-voltage grids increased. In Germany, the EEG incentivized the installation of decentralized (rooftop) PV plants, and the German Act on Combined Heat and Power Generation13 (KWKG) incentivized the installation of decentralized CHP plants. Both, PV and CHP plants are often located on-site at traditional consumer places that are directly connected to the low-voltage grid [GM17]. As a consequence, at times of high on-site generation and low on-site consumption, electric energy can also be fed back into the grid. If this happens to a large extent, energy will also flow bottom-up from low-voltage to high-voltage grids. This challenges the voltage stability in distribution grids. As they originally have been designed and dimensioned for coping with top-down energy flows, operational mechanisms are designed for handling challenges coming along with this assumption (see Section 2.1.3). In addition, the expansion of electric mobility increases the share of high loads in distribution grids. As a consequence of this development, DSOs are faced with two major challenges. Firstly, DSOs lack information about the (time-dependent) stability within their grids. Secondly, DSOs lack control options for efficiently managing the partially high power supply (provided by PV plants) and the partially high power demand (requested by electric mobility and increasingly by heatpumps which are replacing fuel-based heating devices in private homes). Smart metering infrastructures are a major building block for handling these two challenges. However, the coordination between grid-supportive and market-oriented DSM measures comes along with new challenges [BDE15]. 2.4.3 Rollout of Smart Metering Infrastructures Smart metering infrastructures can be seen as a major step in the evolution of power grid operation. They allow to link energy consumption and the time of use in the area of hours or even quarter hours, hence setting the technical foundation for DSM (see Section 2.4.1). In contrast, conventional electromechanical electricity meters are not able to do so.14 Given conventional electromechanical electricity meters, electricity suppliers have to generalize the electricity prices for final customers such that they are 13German: “Kraft-Wärme-Kopplungsgesetz” (KWKG) 14Traditionally, day and night time tariffs have been implemented by switching between two conventional meters, resulting in a very limited time granularity. 48 2.4 Implication of the Energy Transition independent of the time of use. Billing can then be done based on the yearly sum of the consumed energy. By linking energy consumption and the time of use, smart meters allow verifying the reaction (i. e., the adjusted consumption) to load-shifting incentives such as time-variable price signals or other economic stimuli. By allowing to verify the reaction of flexible loads to grid needs or market prices, smart meters facilitate the integration of renewable energy sources. To foster the expansion of renewable energy sources, smart metering systems are introduced in many countries worldwide. However, implementations differ largely between countries. Among others, implementations differ regarding functionality and interfaces, expected deployment strategies (partial rollout vs. full rollout), the market model (market-driven vs. regulated), the targeted diffusion rates, rollout time frames, or expected costs [Eur14b; Eur14c]. Subsequently, backgrounds and relevant aspects of the German approach are summarized based on the paper [För+19]. In the European Union, smart metering infrastructures have to be rolled out based on an EU directive from 2009 [Eur09]. Single member states can define own approaches satisfying their local needs based on individual cost-benefit analyses. Germany evaluated different rollout scenarios in 2010 [Ern13]. As a result, in 2016, the German Law on the Digitalization of the Energy Transition15 (GDEW) was passed, which among others introduced the German Metering Point Operation Law16 (MsbG). The German smart metering approach puts a high emphasis on standardization and se- curity [Bun13]. It is based on two major components: smart meters (German: “Moderne Messeinrichtungen”) and Smart Meter Gateways (SMGWs), where the combination of both is referred to as smart metering system (German: “Intelligentes Messsystem”). The smart meter itself is a digital power meter capable of providing temporally fine-grained power measurements. It has a display for visualizing energy values for different time frames. The SMGW is a communication device with two major functionalities. Firstly, it can automatically communicate measurements from connected smart meters to external parties17. Secondly, it allows external parties to send incentives or commands for load adjustments to local energy management systems. In Germany, according to the MsbG, smart meters (i. e., the digital power meters) are compulsory for new installations. The installation of SMGWs (i. e., the communication devices) follows a stepwise roll-out plan, ultimately making it compulsory for consumers above 6 000 kWh/a or for prosumers with renewable feed-in above 7 kWpeak. The compulsory rollout may result in new business models that facilitate the integration of renewable energy sources or high loads, 15German: “Gesetz zur Digitalisierung der Energiewende” (GDEW) 16German: “Messstellenbetriebsgesetz” (MsbG) 17In context of German smart metering systems, these external parties are called “external market participants” (German: “Externe Marktteilnehmer”). 49 Chapter 2 Basic Theory of Smart Grid Operation and Optimization e. g., through electric mobility. Consumers falling below the thresholds are free to install SMGWs whereby new business models may incentivize them to do so. 2.4.4 Advancements of Electricity and Balancing Markets In recent years electricity and balancing markets have been advanced into two directions: firstly, to better integrate the rising share of renewable energy sources and, secondly, to better integrate the rising share of potentially flexible consumers. In the following we have a closer look on concrete developments at the German markets. 2.4.4.1 Governmental Measures Regarding the Electricity System Design The energy policy target triangle describes that the energy system design requires trade-offs between affordability, the environmental sustainability and the security of supply [Sch17]. In 2014, in order to navigate through the options, the BMWi started a government-driven stakeholder consultation focusing the future electricity market design. Therefore, it published a discussion paper (Green Paper) on “An Electricity Market for Germany’s Energy Transition” [Bun14] in which fundamental future directions have been proposed. On this basis, the BMWi invited affected stakeholders to submit their opinions. In 2015, the outcome of the consultation on the Green Paper was published. This was done in form of a White Paper that unites the interest of the participating 212 organizations and 484 private persons [Bun15a; Deu15b]. In the White Paper, the BMWi proposed and justified concrete directions for the advancements of the electricity market design. Proposed measures with relevance for the flexibilization of prosumers are [Bun15a]: Measure 3: Strengthening obligations to uphold balancing group commitments Measure 4: Billing balancing groups for each quarter hour Measure 6: Opening up balancing markets for new providers Measure 8: Revising special grid charges to allow for greater demand side flexibility Measure 10: Clarifying rules for the aggregation of flexible electricity consumers Measure 13: Gradually introducing smart meters Measure 16: Integrating combined heat and power generation into the electricity market Measure 17: Creating more transparency concerning electricity market data In 2020, parts of the measure have already been implemented in form of market design changes (as presented below), regulatory adaptations (e. g., regarding smart meters), BNetzA resolutions (e. g., regarding the aggregation of flexible electricity consumers or 50 2.4 Implication of the Energy Transition the transparency of electricity market data), or they are subject to ongoing discussions (e. g., regarding reduced grid fees for grid-supporting consumers). 2.4.4.2 Recent Advancements of Electricity Spot Markets We start with the discussion of advancements of electricity spot markets as visualized in Figure 2.11a. The discussion of balancing market advancements follows in the next paragraph. As a steady balance of generation and consumption has to be guaranteed, the rising share of renewable energies in the energy mix (characterized by a higher fluctuation and uncertainty) makes balancing group management more difficult. Conse- quently, the introduction of shorter product time slots and the reduction of the lead time between trading and delivery allows for a more effective balancing group management [MFN18]. Additionally, the introduction of the optional EEG market premium model18 sets incentives for directly selling PV energy via spot markets, instead of only relying on the guaranteed feed-in tariffs by the grid operator. Consequently, the depicted changes facilitate the integration of stochastic renewable energy sources into electricity spot markets. At the same time, the shorter product time slots and the shorter trading lead times set the basis for a better market integration of flexible loads. A remaining challenge regarding the efficient integration of flexible loads is the composition of final electricity prices paid by final consumers: While pure energy prices are characterized by a relatively high fluctuation, the largest share of the final electricity price is made up of additional—static—price components (see Section 2.2.4). 2.4.4.3 Recent Advancements of Balancing Markets Recent balancing market changes with respect to DSM are visualized in Figure 2.11b. Major changes occurred within recent years and do not date back that long as in the case of electricity spot markets. In general, if all other conditions remain equal, the demand for balancing power increases with stochastic generation. Research indicates that each additional 1 GW of PV and wind power requires 30–70 MW of additional balancing capacity, i. e., 3–7 % of the additional PV and wind power [HZ13]. However, the balancing power demand results from various parameters (see Chapter 5). For instance, minimized lead times at spot markets may result in a shift to short-term intraday trading [KH19], improved renewable energy generation forecasts may lower the uncertainty [HZ13], or regulation may increase incentives to keep balancing groups balanced. 18German: “Marktprämienmodell” 51 Chapter 2 Basic Theory of Smart Grid Operation and Optimization Trend: Efficient spot market design for the integration of renewables and flexible consumers Launch of 15-minute contracts at the continuous intraday market Introduction of the optional EEG direct marketing premium model Launch of the intraday opening call auction Lead time reduction 45 to 30 minutes Introduction of 30-minute continuous trading Lead time reduction 30 to 5 minutes Introduction of quarter hour blocks 2015 20162012 2018 201920172011 2013 2014 (a) Major changes at spot markets Trend : Efficient balancing market design for the integration of alternative BSPsStart of mixed-price mechanism for aFRR Start of joint aFRR procurement by Germany and Austria TSO stakeholder consultation for balancing power market design Start of daily 4-h aFRR auctions Special regulation for FCR provisioning via batteries Start of daily 4-h FCR auctions Start of aFRR balancing energy market End of mixed-price mechanism for aFRR 2017 2018 202020192015 2016 (b) Major changes at balancing markets Figure 2.11: Recent changes at German spot and balancing markets set the basis for the integration of renewable energy sources and flexible prosumers. Traditionally, balancing power of all three types is mainly provided by large generators and partly by large consumers that directly participate at balancing markets [Deu19b]. In its White Paper, the BMWi states that all potential providers that are technically able to provide balancing power should be enabled to do so in the future [Bun15a]. Concrete changes have been proposed via Measure 6 “Opening up balancing markets for new providers” [Bun15a]. To a large degree, they have already been implemented within the last years. Figure 2.11b visualizes the most relevant changes that aim at an efficient market design also for alternative BSPs. It can be seen that, in 2016, the joint aFRR procurement of Germany and Austria started. In 2017, a broader stakeholder consultation by the four German TSOs addressed the German balancing market design. Among others, this was incentivized by European regulation [Eur17], and resulted in detailed discussions regarding details of balancing markets [Deu18b; Deu18c]. In 2015, a dedicated regulation was announced that simplifies FCR provisioning via battery storage systems [Deu15a]. In 2018, due to increasing aFRR energy prices, the BNetzA announced a mixed-price mechanism [Bun17d]. For acceptance into the aFRR pool, this mechanism considers the aFRR energy price in addition to aFRR capacity price. However, after a lawsuit by the German aggregator NEXT Kraftwerke GmbH, the newly introduced mixed-price mechanism was rolled back in the same year [Deu19d]. Furthermore, in 2018, daily aFFR and mFRR auctions [Bun17a; Bun17b] started, and in 2019 daily FCR auctions started. Prior to this, all auctions were conducted weekly. Additionally, aFFR and FCR product time slots were adjusted to four hours (i. e., six product slots per day). 52 2.5 Mathematical Optimization Prior to this, aFFR and FCR product time slots were defined by daily peak and off-peak tariff slots (i. e., two product slot changes per day). In November 2020, additional aFRR energy auctions were introduced [Bun17c]: they allows submitting aFRR offers within the day of provisioning. BSPs participating at this new market segments earn an energy price only, i. e., no capacity price, and the bids are added to the respective four-hour slot’s energy price merit-order list. This allows for more short-term aFRR offers, however, also increases competition. In the end, the introduction of shorter product time slots and shorter lead times makes it easier for alternative (demand-side) BSPs to participate at balancing markets. The resulting balancing markets characteristics have already been presented in Ta- ble 2.2 and the market timing was already visualized in Figure 2.2. Although the high-level structure of balancing service mechanisms and markets is set by the ENTSO-E, it is worth mentioning that national implementations still differ [Eur20b]. However, in recent years, strong efforts for a European harmonization of processes and rules in context of balancing services can be recognized [Eur17; Eur18c; Int16]. In context of aFRR provisioning, in particular the PICASSO project may result in a closer international TSO cooperation in the upcoming years [Eur21b]. 2.5 Mathematical Optimization This thesis proposes an optimization that utilizes flexibility for value stacking of flexibility options by simultaneously providing bids to the (day-ahead) spot and (aFRR) balancing market. In order to understand the options, this section gives an overview about different types of optimization problems and a provides a classification of optimization methods. 2.5.1 Classification of Optimization Problems Mathematical optimization is a wide field extensively addressed by different communities such as mathematics, computer science, or operations research. The single communities are partly following very different goals, hence also putting their focus onto different aspects and sub fields. In addition, optimization techniques are applied to problems from very different domains such as engineering or economics. Depending on the pursued goal, and as there are multiple links between single aspects and subfields, there exists a wide range of classification schemes for optimization problems and related optimization technologies. In general, a mathematical optimization problem is characterized by several potential solutions (described by one or more decision variables which can be allocated with 53 Chapter 2 Basic Theory of Smart Grid Operation and Optimization different values), some means of assessing the quality of these alternative solutions (via the objective function converting the allocation of values to the decision variables into a quality metric), and conditions that the solution must satisfy (described in form of constraints limiting the allocation of values to the decision variables). Common classes of optimization problems found in literature are listed below. They are not exclusive and do overlap: • None vs. one vs. many objectives: While many optimization problems have a single objective function (i. e., minimization or maximization of a value), there are also optimization problems having no objective function. These are called feasibility problems where the optimization goal is to find a feasible solution without any particular objective. On the other side, there are also optimization problems having more than one objective function. This results in multi-objective optimization problems where trade-offs between multiple objectives such as mini- mizing costs and minimizing CO2 emissions have to be met, resulting in a Pareto front with the optimum solutions for the respective objectives. Multi-objective optimization problems can be solved by explicitly searching for the Pareto front [Ehr05], or by reformulation as single objective problems by either forming a weighted combination of the different objectives (e. g., focusing on costs) or by replacing some of the objectives by constraints (e. g., defining the maximum CO2 emission). • Constrained vs. unconstrained optimization: A distinction can be made be- tween constrained and unconstrained optimization where no constraints apply. Depending on the problem structure and the optimization technique used, it may be beneficial to rephrase a constrained problem to an unconstrained problem in which the constraints are replaced with a penalty term in the objective function, hence allowing to solve the problem as an unconstrained problem. • Continuous optimization vs. discrete optimization: In continuous optimization all variables used in the objective function must be continuous variables, i. e., vari- ables that take an uncountable set of values (such as an variable over a non-empty set of real values). In contrast, in discrete optimization at least one variable used in the objective function is restricted to be a discrete variable, i. e., a variable that takes a discrete set of values (such as a integer or binary variable). Continuous optimization problems tend to be easier to solve than discrete optimization prob- lems as the continuity assumption allows the use of calculus techniques for solving the problem whereas discrete optimization leads to combinatorial explosion and NP-hard problems. 54 2.5 Mathematical Optimization • Linear optimization vs. non-linear optimization: In linear optimization, the objective function as well as constraints are linear. In non-linear optimization, in contrast, the objective function or some of the constraints are non-linear. Linear optimization gained a lot of recognition as many practical problems can be ex- pressed this way, and as methods such as the simplex method or the interior-point method allow efficiently solving linear problems. [LY+84] • Optimization under uncertainty: Deterministic optimization assumes that data for the allocation of variables of a given problem is known accurately. However, as data often is fraught with uncertainty (e. g., due to measurement errors, environ- mental influences, or as it is related to the future), exact data to be used as input to an optimization problem is often not known beforehand. Two paradigms that incorporate the uncertainty into the model are stochastic programming [KW94] and robust optimization [BEN09]. Therefore, they are also referred to as op- timization under uncertainty. In stochastic programming, two approaches can be separated [Mad60]: Firstly, the “here-and-now” approach. In this approach, each variable that is subject to uncertainty gets assigned its expected value based on the underlying random distribution. Then, the problem can be solved in a deterministic way. Secondly, the “wait-and-see” approach which is two-staged. This approach is based on the assumption that the decision maker can wait till the uncertainty is eliminated. In a first step, the optimum decision which is valid for all uncertainty scenarios is calculated and realized. In a second (or 𝑛-th) step, if new information is available, the overall optimization problem is solved by additionally considering the new information. In contrast to stochastic programming which assumes the probability distribution of uncertain data to be known or estimated, robust optimization does not make this assumption [GYd15]. It is worth noting that a formal optimization model may differ from the real-world problem. As a given optimization problem can be formulated in different ways, it may in particular be intentionally transformed to a problem that is easier to solve. For instance, a discrete optimization problem may be formulated as a continuous optimization problem (relaxation), or a non-linear optimization problem may be approximated reasonably well by a linear optimization problem. Table 2.3 presents a common classification of problem types often found in engineering and economics: constrained and deterministic optimization problems with one objective (such as cost minimization or throughput maximization). For such problems, the linear- ity/non-linearity of terms, and the continuity/discreteness of variables are crucial for the choice of an optimization method. Applied mathematical optimization is historically also described using the word “programming” [Dan02]: Linear Programming (LP), 55 Chapter 2 Basic Theory of Smart Grid Operation and Optimization Table 2.3: Comparison of common classes of optimization problems. Problem class Characteristics Terms Variablesonlylinear1+non-linearonlycontinuous1+discrete1+continuous LP × × ILP × × MILP × × × NLP × × INLP × × MINLP × × × Integer-Linear-Programming (ILP), Mixed-integer Non-linear Programming (MILP), Non-linear Programming (NLP), Integer Non-linear Programming (INLP), Mixed-integer Non-linear Programming (MINLP). Characteristics of each problem class are shown in the table. In general, a problem is non-linear if at least one term is non-linear, and a problem is discrete if at least one variable is discrete. In the next section, we discuss the choice of an optimization method based on the problem type. 2.5.2 The Choice of an Appropriate Optimization Method An optimization algorithm takes the description of a mathematical optimization problem (in form of objective function, constraints, and data) and calculates its solution(s). An optimization method or technique, more abstract, describes the idea behind an optimization algorithm. The choice of an optimization method for solving a given optimization problem is specific to the type of the optimization problem. In general, the modeling is a very important step in the optimization process. One way to classify optimization methods according to the problem class is presented in Figure 2.12. It shows that it is particularly important for the choice of an appropriate optimization method whether the optimization problem is continuous or discrete, and whether it is linear or non-linear. First we have a look at continuous optimization problems (left branch in Figure 2.12). Continuous linear optimization (left sub branch) problems can be solved by well-studied methods which are in particular the simplex method or the interior point method. Con- 56 2.5 Mathematical Optimization Optimization methods Continuous problems Discrete problems Linear problems Non-linear problems Approximate optimization Exact optimization Local optimization Global optimization Heuristic methods Branch and bound method Simplex method Gradient-based methods Cutting plane method Interior-point method Branch and cut method Linear problemsNon-linear problems (M)ILPNLP (M)INLPLP Figure 2.12: A classification for the choice of an optimization method based on the problem class. tinuous non-linear problems (right sub branch) can again be separated into local and global problems. While global optimization methods can find the global optimum, local optimization methods can only find the local optimum. Local optimization methods for continuous non-linear problems are gradient-based methods. Global optimization methods for continuous non-linear problems are mainly heuristics. Local optimization methods are of special interest for convex optimization problems which are a superset of continuous non-linear problems [Ste17a]. Convex optimization problems are charac- terized by a convex (if minimizing) or concave (if maximizing) objective function, and have only convex functions as constraints. Given a convex optimization problem, all local solutions are global solutions. Now we look at discrete optimization problems (right branch in Figure 2.12). Discrete linear problems (right sub branch) can be solved with exact optimization algorithms including the branch and bound method, variants of the branch and bound method such as the branch and cut method, or cutting plane methods. In alternative to exact optimization methods, approximate optimization (left sub branch) may be useful for both discrete linear and discrete non-linear optimization problems. Approximate optimization methods are heuristics that may be based on established metaheuristic techniques as, e. g., provided by evolutionary algorithms, or approximation algorithms. While heuristics allow finding approximate solutions without the possibility to quantify how close a found 57 Chapter 2 Basic Theory of Smart Grid Operation and Optimization solution is to the optimum solution, approximation algorithms like Polynomial-time approximation scheme (PTAS) provide guarantees on how far the found solution is to the optimum [WS11]. In general, the class of non-linear problems is considered “difficult” to solve [BBV04]. However, within the last two decades, there has been significant progress [Kro+19], in particular in solving convex problems (which are always continuous) [Ste17a]. While non-linear problems that are convex can be solved by local optimization methods [Ste17b], non-linear problems that are non-convex are usually solved by heuristics that are specific to the problem. Dedicated (commercial and open-source) solvers provide generically applicable op- timization algorithms for solving certain types of optimization problems in practice [AAK17]. As a given optimization problem can be modeled in different ways, the avail- ability of solvers for certain kinds of optimization problems may influence the modeler’s choice. Often recognized solvers for solving linear problems in form of LP, ILP and MILP are the commercial IBM ILOG CPLEX Optimization Studio (CPLEX), the commercial Gurobi Optimizer (Gurobi), or the open-source GNU Linear Programming Kit (GLPK). These solvers are based on implementations of variants of the branch-and-cut method. Furthermore, solvers for convex non-linear problems are available. However, they are usually not based on single generically applicable optimization methods. Instead, they combine several optimization methods and often heavily rely on sub-solvers from the MILP field [Kro+19]. Often, they are used to find approximate instead of optimum solutions. 58 CHAPTER 3 Related Work on Prosumer Flexibilization The broader related work necessary for understanding power system mechanisms and putting this thesis on prosumer flexibilization in proper perspective is presented in the previous Chapter 2. On this basis, this chapter gives an overview of related work on prosumer flexibilization and aFRR provisioning. Firstly, we categorize value creation options for prosumers wanting to monetize their power consumption or generation flexi- bility. Based on the literature, we discuss and categorize incentives that allow prosumers to benefit economically from their flexibility. We show that flexibility provisioning is motivated by local or external incentives. Secondly, we review the literature regarding flexibility modeling. After discussing definitions of flexibility, we discuss flexibility mod- els found in the literature. Thirdly, we have a closer look at optimizations targeting the utilization of prosumer flexibility. This includes a discussion of prosumer aggregation levels commonly found in the literature. In reviewing optimization approaches, we put a focus on the multi-use of flexibility by simultaneously addressing spot market and balancing market incentives. 3.1 Value Creation Options for Flexible Prosumers This section presents a categorization of related work on the flexibilization of prosumer loads regarding the underlying incentives. Incentives can be provided locally on the prosumer side, or they can be provided externally by flexibility markets or grid operation mechanisms. In addition to this categorization of related work, it is worth pointing to the in-depth explanation of flexibility markets and system services presented in detail in the previous Chapter 2. 59 Chapter 3 Related Work on Prosumer Flexibilization 3.1.1 Locally Incentivized Flexibilization In the following, we categorize and summarize related work on prosumer flexibilization motivated by local incentives on the prosumer side. Self-consumption Many publications address the potential of increasing self-con- sumption to lower overall energy costs. Self-consumption describes the match of local on-site generation and consumption. As a result, electricity consumption from the public grid is minimized. Luthander et al. [Lut+15] present a literature review of the self-consumption potential in the context of residential PV plants. The review quantifies the potential from the prosumer’s viewpoint. It shows that self-consumption can be significantly increased using a battery storage system (13–24 % points given a battery capacity of 0.5–1.0 kWh per installed kW PV power) or demand side management measures (2–15 % points depending on the scenario). Concrete potentials are specific to demand and supply profiles, plant sizing, and regulation regarding surcharges (such as the EEG reallocation charge in Germany). Consequently, related work addresses different scenarios that are characterized by different flexibility characteristics such as those found in the residential sector [FM20], the commercial sector [MM17], or the industrial sector [PHM21]. In this value creation option, the monetary benefit of flexibility provision corresponds to the electricity price for energy from the public grid minus the opportunity costs in the form of revenues that would have been generated by selling the energy, multiplied by the related electric energy. The monetary benefit accrues directly to the prosumer. Peak Shaving In Germany, the grid fee pricing scheme for commercial or industrial consumers depends on the annual utilization hours (defined as the annual energy demand in kWh divided by the maximum hourly power demand in kW). Below a certain threshold (in Germany, usually 2 500 h), a large share of the final grid fees is based on the consumed energy (EUR/kWh). Above this threshold, a large share of the final grid fees is based on the measured peak load (EUR/kW per peak time window; in Germany, usually per calendar month or year). Benetti et al. [Ben+16] provide a literature review of 200 scientific papers focusing on load-shifting control strategies for peak load reduction. The authors show that the peak load reduction investigated in most of the analyzed papers is based on thermal applications in buildings, followed by (plugin hybrid) electric vehicles and water heaters. In Rominger et al. [RLS19], the authors analyze the charging behavior at a commercial office site and present different options to use flexibility in the charging processes for reducing the peak load. We showed that the peak load can be reduced by 44 % without affecting the EV’s mobility and by 69 % 60 3.1 Value Creation Options for Flexible Prosumers percent if less than 20 % of the charging events are controlled. In this value creation option, the monetary benefit of flexibility provision corresponds to reduced grid fees. The savings are calculated as the reduced capacity multiplied by the grid fee’s capacity price (EUR/kW) charged by the DSO. The monetary benefit accrues directly to the prosumer. 3.1.2 Externally Incentivized Flexibilization In the following, we categorize and summarize related work on prosumer flexibilization that is motivated by externally provided incentives from flexibility markets or grid operation mechanisms. A detailed overview of spot and balancing markets was already presented in the previous Chapter 2 (see Figure 2.2 for a market overview and Table 2.2 for details of balancing services). Day-ahead and Intraday Auction Electricity prices at the day-ahead market are determined by an auction (see Section 2.2.3.1) and the intraday market opens with an auction, too (see Section 2.2.3.2). Lago et al. [Lag+20] and Weron et al. [Wer14] present a literature review and show that day-ahead electricity prices can be predicted well using machine learning or statistical methods. The difference in prices can be used to optimize the prosumer’s load to decrease its cost. A large number of publications investigate how to benefit from price fluctuation in these markets. For example, Cordinalesi et al. [Cor+20] present a rolling horizon approach for trading end-user flexibility at day- ahead and intraday spot markets. The results suggest that energy procurement costs can be decreased by 8 %, though at the same time, the energy consumption of the prosumer is increased by 3.21 % due to deviation from the energy-optimal device schedules. Iria et al. [ISM17] present a stochastic programming approach for managing uncertainty in the prosumer context when bidding to DA spot markets. In general, the monetary benefit of flexibility provision incentivized by spot auctions is the difference between the electricity procurement costs for the uncontrolled vs. the controlled load. The monetary benefit accrues to the BRP, which may be the prosumer directly, the traditional electricity supplier, or a flexibility aggregator. If the two latter act as an intermediary BRP, they can communicate predicted cost forward curves to the prosumer. Then the prosumer’s reaction is an important aspect of the BRP’s procurement strategy. Grimm et al. [Gri+21] discuss the interaction between a supplier’s tariff design and the prosumer’s decisions. In order to align the incentives of suppliers and prosumers in the context of time-variable electricity tariffs, they propose a bilevel optimization model. 61 Chapter 3 Related Work on Prosumer Flexibilization Continuous Intraday Trading By continuously optimizing prosumer schedules, the flexibility can generate multiple revenues if repeatedly reacting to price changes within the continuous intraday market trading period. With the rise of the trading volume at intraday spot markets within the last few years, an increased interest could also be observed in the literature. For example, Martin et al. [MO18] propose a model for simulating trading at the EPEX spot continuous intraday market. In Rominger et al. [Rom+19], the authors analyzed the potential of a 100 kWh battery storage that has to be charged from empty to full within a calendar day. The storage’s flexible consumption and generation capabilities were traded at the continuous intraday market based on a simulation with historic EPEX trades from 2015–2017. The results show that the proposed optimization generates revenues that equal 3.4 times the pure wholesale energy costs in the case of a unidirectional (charging) flexibility, and 12.4 times the pure wholesale energy costs in case of an (bidirectional) charging and discharging flexibility. In this option, the monetary benefit of flexibility provision corresponds to the trading profits achieved between two alternative but valid prosumer load schedules. Again, the monetary benefit accrues to the BRP, which may be either the prosumer itself, the traditional electricity supplier, or a flexibility aggregator. Balancing Group Management BRPs are charged for deviations from their reported schedules by the balancing group coordinator, who in Germany is represented by the TSOs. This is done in form of the imbalance energy price (“reBAP”, as presented in Section 2.3.3). Using a real-time forecast of the deviation of a BRP’s reported balancing group schedule from the actual feed-in and feed-out, flexibility can be used to reduce the BRP’s deviation in the current quarter-hour for which there is no longer a trading option. In this case, the flexibility provision’s monetary benefit corresponds to reduced imbalance energy costs (based on the reBAP) resulting from lower plan deviations of the BRP’s balancing group. The monetary benefit accrues to the BRP, which may be either the prosumer itself or the electricity supplier. In Germany, imbalance energy prices are only officially announced after delivery and are difficult to forecast as they are, by their definition, a result of uncertainty. Balancing group compliance is an essential duty of BRPs; however, utilizing prosumer flexibility potentially allows them to substitute alternative options that may be more expensive. In the context of flexible demands, Rayati et al. [Ray+20] investigate the potential of optimized balancing management via aggregators that establish a common balancing group and cooperate to minimize their imbalances. Haque et al. [HTN18] propose a dynamic clustering method to benefit from small-scale residential prosumers in order to minimize imbalance cost. Their results indicate significant potential for reducing imbalance costs. Burgio et al. [Bur+17] 62 3.1 Value Creation Options for Flexible Prosumers investigate the potential of using storages located on the prosumer side to reduce imbalance charges in the context of a BSP’s high uncertainty when bringing renewable energy sources to spot markets. Balancing Markets We present the characteristics of balancing power markets in detail in Section 2.3. There, we show that the suitability of these balancing services for prosumers highly depends on the possible speed of reaction and that the monetary benefit for flexibility provision at balancing markets is twofold: Firstly, it results from the capacity revenues (EUR/MW) for the capacity held in reserve during the agreed period, and secondly, from revenues for the energy supplied in case of activation (EUR/MWh, except for FCR). The monetary benefit accrues to the BSP, which may be the prosumer or an intermediary aggregator that may take a certain profit share for its services. In Section 3.3, we have a closer look at the literature regarding alternative aFRR provision- ing on the demand side. The literature regarding mFRR provision via prosumers is very rare, which may be explained by the, in tendency, decreasing mFRR demand coming along with shorter lead times and higher trading volumes at intraday spot markets. In Germany, the overall available mFRR costs defrayed by the TSOs have steadily declined in the years prior to 2019 [Bun20c], making mFRR provisioning less attractive for prosumers. In this context, a high impact of regulation on the overall mFRR capacity requested by the TSOs can be recognized [Bun21]. Distribution Grid Support Another practical option worth mentioning is reacting to DSO control signals to reduce power in the event of grid bottlenecks temporarily. As of today, the reaction to such DSO signals is monetarily incentivized by reduced grid fees. In Germany, § 14 a EnWG sets the basis for reduced grid fees in the low-voltage distribution grid when reacting to DSO control signals. In this case, the monetary benefit of the flexibility provision results from the difference between the energy prices of the regular and the reduced grid fees. The monetary benefit accrues directly to the final consumer. In Germany, as of today, this option is mainly used for electric heating systems such as heat pumps [Bun21]. Focusing on the German regulatory environment, Riedel et al. [Rie+21] present potential development paths for the utilization of prosumer flexibility incentivized by the situation in distribution grids. Among others, the authors show that smart metering systems set the basis for implementing time-variable grid fees or dynamic power limitation signals, which may provide additional load-shifting incentives for flexible prosumers in the future. The optimization problem presented in Chapter 7 uses flexibility in a prosumer’s load to generate optimized device schedules. It is incentivized by simultaneously considering 63 Chapter 3 Related Work on Prosumer Flexibilization the external value creation options (day-ahead) spot market and (aFRR) balancing market. 3.1.3 Value Creation in Potential Future Energy System Designs The above-presented categorization of related work on prosumer flexibilization is practi- cally motivated by prosumers who nowadays want to benefit from utilizing flexibility in their load. In today’s and the near-future regulatory scheme, the above-presented value creation options are essential. However, additional flexibilization incentives are discussed in the context of newly proposed market and energy system designs. In particular, the following development paths are worth mentioning as they may result in new options for prosumer flexibilization. Cellular Energy Systems In particular related work in the field of cellular energy systems is worth mentioning, as it has attracted a lot of interest in recent years. The concept of cellular energy systems addresses the challenge that current energy market and grid operation principles are, in the long run, perceived to likely not be adequate to deal with the envisioned share of renewable energies and new loads [Fla+21]. Flatter et al. [Fla+21] define an energy cell (EC) as “a spatially delimited, balanceable part of a multi-sector energy supply system. It consists of the relevant supply infrastructure of various energy sectors, in which the sensible balancing of generation and consumption is organized by an EC Management in coordination with neighbouring cells using all available forms of energy”. This requires fundamental regulatory changes. However, it will bring manifold opportunities for prosumers to offer their flexibility and take an essential role in the energy system. Šikšnys et al. [Šik+19] propose a system for flexibility modeling, management, and intra-cell trading in cellular energy systems. Based on large-scale simulations that replicate pilot sites, the authors show how the cellular system design allows for 100 % self-utilization of renewable energy sources and significant end-prosumer savings in all scenarios considered. Local Flexibility/Energy Markets Local flexibility or energy markets are another prominent concept aiming at the integration of the demand side into the grid operation. The concept of these markets is interlinked with the concept of cellular energy sys- tems, in which they may play a crucial role in coordinating flexibility within an energy cell. Goldkamp et al. [GS20] emphasize that local flexibility markets are characterized by a strong focus on the market-oriented, grid-supportive utilization of demand-side flexibility. Mengelkamp et al. [EW19] discuss the value proposition of local energy 64 3.2 Modeling of Flexibility markets identifying economic, social, technological, and environmental benefits. Jin et al. [JWJ20] review the recent literature on flexibility markets and provide a discussion of concepts and definitions. They find that participants in local flexibility markets may take overlapping positions, such as the market operator, which may be the DSO, or the aggregator, which may be the BRP. The authors emphasize the coordination between local flexibility markets and central markets as well as between different grid segments (TSO and DSO) as an important aspect. Based on their comprehensive review, the authors predict a significantly rising trend for procuring flexibility from local flexibility markets in the future. Consequently, potential adoptions of these concepts in practice will create new incentives for flexible prosumers. Ancillary Services New value creation options for flexible prosumers may also arise through ongoing changes in ancillary services such as redispatch for congestion man- agement in the public grid. In Germany, in 2021, redispatch was advanced to include generators in the 100 kW class. It is worth mentioning that, as of today, redispatching in Germany does not follow a market-based approach: according to § 13a EnWG, power plant operators should be economically neither better nor worse off due to redispatch measures (see Section 2.2.5). However, the ongoing developments to include smaller generation units may incentivize prosumers to participate in such ancillary services. For example, a mandatory redispatch order for an on-site generation plant could also be realized by alternative flexibilization of on-site demand-side units, which potentially is cheaper. Scientific literature discusses different advancements of redispatch processes in the context of newly emerging potentials through flexible prosumers. For example, Pantoš [Pan20] proposes a mechanism for market-based redispatch that aims at inte- grating small-scale residential, commercial, or industrial prosumers. In the future, these developments may result in new flexibilization incentives for prosumers. 3.2 Modeling of Flexibility This section presents literature on the definition and modeling of flexibility and puts it into the context of this work. Flexibility Definitions The literature presents different definitions for flexibility in energy consumption and generation. Mauser et al. [Mau+17] define (energetic) flexibil- ity as “the collection of valid combinations of system inputs and their state dependent outputs in terms of all energy carriers”. Further definitions put the focus on potential changes from a current or normal load patterns in response to certain signals [CEN13], 65 Chapter 3 Related Work on Prosumer Flexibilization t Energy e e (a) Buffer-constrained t Energy tend e e (b) Buffer-constrained and time-limited t Energy e e tend trun (c) Shiftable with fixed power profile Figure 3.1: Different types of energetic flexibility; based on [Pet+13a]. on the shifting of consumption or generation under given constraints [NKS15], or on the ability to deviate from planned consumption or generation [Pet+13a]. The CEN- CENELEC-ETSI Smart Grid Coordination Group [CEN13] classifies flexibility providers in terms of generators, storages, or demands as uncontrollable (non-curtailable), cur- tailable (non-shiftable), shiftable (non-buffered), buffered (controllable within bounds), or freely controllable. Flexibility Models Peterson et al. [Pet+13a] formalize three abstract flexibility types that are of high practical relevance as they can be applied to various devices in the context of prosumer flexibilization. They are visualized in Figure 3.1. These flexibility types can be mapped to the above presented classification of the CEN-CENELEC-ETSI Smart Grid Coordination Group as variants of buffered flexibility (Figures 3.1a and 3.1b) and shiftable flexibility (Figure 3.1c). We use this classification to put related work on flexibility modeling into context: • Buffer-constrained: Figure 3.1a visualizes a buffer constrained flexibility. It can be seen as an energy storage that is constrained by a minimum and maximum bufferable energy amount (𝑒 and 𝑒) in which different temporal courses are possible for the energy contained in the storage. The flexibility is defined by the minimum and maximum amount that can be buffered in the energy storage. Commonly found devices that can be assigned to this category are battery storage systems, heat pumps, or combined heat and power plants. The two latter are usually modeled as being associated with a thermal energy storage. Besides the energy limitation, parameters of heat pumps, as they are commonly modeled in the literature, are the coefficient of performance (COP), an energy loss over time, or minimum and maximum runtimes. For CHP plants, the power-to-heat ratio, part-load efficiencies, 66 3.3 Optimizations for Utilization of Prosumer Flexibility an energy loss over time, or minimum and maximum runtimes are commonly modeled parameters. Battery storage system models for prosumer flexibilization are often characterized by charging and discharging efficiencies, aging parameters based on the battery usage [Xu+18], an energy loss over time, or constant current constant voltage (CCCV) characteristics. It is worth noting that different subclasses of this abstract flexibility type can be recognized: e. g., in the case of a heat pump, discharging the buffer may not be a control decision but instead be given by an exogenous heat energy demand. • Buffer-constrained and time-limited: Figure 3.1b visualizes a subclass of the flexibility presented in Figure 3.1a. It is further restricted by a certain energy amount that must be reached at a deadline 𝑡end. Devices modeled in the literature that can be assigned to this class are mainly electric vehicles (EVs) or industrial applications characterized by certain throughput requirements. For example, in the case of EVs, commonly considered parameters for the refinement of this flexibility model are: the arrival and departure time which may be fraught with uncertainty [WJF20], the battery’s state of charge (SOC) at arrival and departure, or a certain emergency SOC which should be reached as soon as possible after arrival. • Shiftable with fixed power profile: Figure 3.1c visualizes flexibility in the form of a fixed load profile that can be started flexibly within a specific time frame and must be finished by a deadline 𝑡end. In the figure, the fixed load profile has a runtime of 𝑡run. Corresponding devices and applications found in the literature are, e. g., household appliances or industrial processes that, once started, will follow a fixed load profile. Appliances found in the literature are modeled using fixed power profiles in different temporal granularities or, in case of interruptible power profiles, by splitting up a fixed profile into multiple separable profile phases [Mau+14]. It can be seen that flexibility in energy consumption and generation comes in different forms. In the literature, the modeling of device characteristics and granularities is very scenario specific. The device models presented in the upcoming Chapter 4 can be assigned to the buffer-constrained flexibility type visualized in Figure 3.1a. 3.3 Optimizations for Utilization of Prosumer Flexibility Prosumers are commonly seen as end consumers attributed to the traditional demand side that take an active role in power generation, power grid operation, or energy market 67 Chapter 3 Related Work on Prosumer Flexibilization participation [Kot20]. Gough et al. [Gou+20] provide a state-of-the-art review with a detailed scientometric analysis of research on prosumer flexibility. The review shows that the number of scientific papers related to prosumer flexibility was relatively low until 2016. In 2016, the number of published papers on prosumer flexibility was higher than the cumulated number of all papers on this topic from 2008–2015. From 2016 ongoing, the number of related publications increased exponentially until it peaked in the last considered year 2020. Different manifestations of prosumers can be found in the literature. In the fol- lowing, we categorize related work by the considered prosumer aggregation level (in Section 3.3.1). Furthermore, due to this thesis’ focus, we have a closer look at the multi-use of flexibility in the prosumer context (in Section 3.3.2). Finally, we present an overview of related work focusing on aFRR provisioning and spot market based scheduling (in Section 3.3.3). 3.3.1 Aggregation Levels for Prosumer Optimizations Existing literature addresses prosumer optimizations utilizing energetic flexibility on different aggregation levels. In the following, we put related work into the context and give an overview of aggregation levels that are of interest for this thesis. Buildings Prosumer flexibilization on the aggregation level of either residential or commercial buildings is a topic extensively addressed in the literature. In this context the terms “building energy management system” (BEMS) [Mis+14] or “home energy management system” (HEMS) [Ozt+13] are commonly used. The devices considered depend on the type of building. Generally, a strong focus on heating, ventilation, and air conditioning (HVAC) applications can be recognized. Often, buildings equipped with local generation via photovoltaics or combined heat and power plants are considered. In the residential sector, we additionally can recognize the consideration of household appliances, such as washing machines or dishwashers. Microgrids and Commercial/Industrial Sites Microgrid is a term commonly used for referring to a geographically delimited consolidation of energy consumers and generators that are coordinated by an optimization [Par+15; HPG18]. Microgrids are studied in different contexts, often emphasizing electrotechnical characteristics such as voltage and frequency stability, or the option to operate the grid in islanded mode independent from the public grid [Shu+16]. Depending on the definition, microgrids can be seen as “private grids” in which energy consumers and generators are pooled for being connected 68 3.3 Optimizations for Utilization of Prosumer Flexibility to the public grid. In Germany, certain surcharges can be waived for on-site generated energy consumed within a private grid1. Consequently, regulation is strict regarding the operation of private grids. In the German market environment, the regulatory interpretation regarding private grids depends on various characteristics, including the geographic expansion, the (in)significance for competition, or the number of involved entities [HM18]. Prosumer optimizations on the aggregation level of commercial and industrial sites/facilities can be seen as a subclass of this category [CM16; HHL17]. In the literature, sites are often defined to be operated by one central operator that is responsible for all on-site energy consumers and generators. In these cases, central optimizations do not consider further sub-interests within a site. Energy Communities In contrast to microgrids, which have a longer history in the literature [JCR08], the term energy community has been increasingly used within recent years [SFV21; EPC18]. As in the case of microgrids, the term energy community also refers to a consolidation of energy consumers and generators with the goal of energy- related optimizations. The term can relate to a local aggregation of geographically neighboring entities. However, it is often also used for scenarios where geographic restrictions do not apply [SFV21]. Based on a literature review, Sao et al. [SFV21] identify 17 different types of energy communities, including communities in the form of building clusters, multi-modal energy systems, or peer-to-peer trading. On this basis, the authors define four categories of energy communities. They are distinguished by the geographic relation (place-based vs. non-place based energy communities) and the purpose of the energy community (single-purpose vs. multi-purpose communities that address further objectives in addition to energy objectives). In practice, the economic potential of flexibilizing consumption and generation within an energy community highly depends on the regulation. Furthermore, the term energy community is often used in the context of energy cooperatives acting as democratic mergers of entities that collectively invest in energy equipment and distribute profits and losses within the community in a democratic way [Eur21a]. Finally, it is worth mentioning that, in recent years, an increased usage of the term “energy community” can be recognized in the marketing of electricity suppliers. However, considering today’s regulatory framework, the economic value creation behind corresponding business models is mostly based on the traditional value creation options presented in Section 3.1. Newly emerging business models in this context [Loo20] are challenged by the established regulation [LP17]. Nevertheless, in the future, regulatory adaptions and new business models potentially 1German: “Kundenanlage” 69 Chapter 3 Related Work on Prosumer Flexibilization result in new aggregation levels in which flexible prosumers may unite to optimize their energy assets. 3.3.2 Multi-use of Flexibility In the literature, the multi-use of flexibility simultaneously incentivized by different value creation options is, so far, mainly investigated with a focus on battery energy storage systems. This focus seems reasonable as battery storage systems are gradually reaching the mass market [Fig+20]. Furthermore, they are characterized by high flexibility to adjust power demand and supply, consequently qualifying for a relatively large number of value creation options. Englberger et al. [Eng+19] discuss different options for the flexible operation of battery energy storage systems for different purposes, which the authors refer to as “applications”. This allows for multiple types of revenue streams. They separate between sequential, parallel, and dynamic multi-use as visualized in Figure 3.2: • Sequential multi-use (Figure 3.2a) describes considering different value creation options in sequence, one after the other (e. g., PV self-consumption around noon and in the evening, FCR provisioning otherwise). • Parallel multi-use (Figure 3.2b) describes that certain flexibility shares are re- served for different value creation options. For example, a certain SOC range of a battery storage system may be reserved for PV self-consumption and the remaining SOC range may be reserved for FCR provisioning. In sequential and parallel multi-use, the disposition of the flexibility can be made based on rather static decisions. • Dynamic multi-use (Figure 3.2c) describes dynamically deciding which flexibility share to use for which value creation option. In contrast to the two other options, dynamic multi-use requires a more comprehensive optimization. While Englberger et al. [Eng+19] use the wording multi-use of flexibility, Klaasen et al. [Kla+18] refer to the same concept using the wording value-stacking of flexibility options, and Braeuer et al. emphasize the aspect of parallel revenue streams [Bra+19]. Klaasen et al. [Kla+18] discuss processes, rules, and interactions to enable value-stacking for aggregators of flexible demand-side resources. They introduce the role of a “flexibility requesting party” (FRP). Taking the point of view of an aggregator, they distinguish three types of value stacking that are in line with the classification of Englberger et al. [Eng+19]: Firstly, value stacking by time describes serving different FRP; however, only 70 3.3 Optimizations for Utilization of Prosumer Flexibility t Value creation option (a) Sequential multi-use t Value creation option (b) Parallel multi-use t Value creation option (c) Dynamic multi-use Figure 3.2: Options for multi-use / value stacking of flexibility incentivized by different value creation options, based on [Eng+19]. one at a time. Secondly, value stacking in pools describes splitting up an aggregation pool and treating the sub-pools or assets differently. Thirdly, double serving multiple FRP at the same time. On the basis of stakeholder roles such as prosumers, aggregators, suppliers, BRPs, DSOs, or TSOs, the authors discuss the value-stacking options in detail. Early work focuses on sequential bidding to different flexibility markets. It is worth noting that a sequential optimization addressing different incentives one after the other can also result in a dynamic multi-use as visualized in Figure 3.2c. However, if the incentives from the different value creation options are not considered in a predictive way, it is possible that the resulting usage of the flexibility will be suboptimal with respect to the overall profit optimization potential. For example, Petersen et al. [Pet+13b] propose a three-stage market model including DA, ID, and balancing markets. The single optimization problems are solved one by one, each time using the latest available information. Based on abstract flexibility types and historical Danish market data, the authors show that profits increase with the number of considered markets; however, highly depending on the type of the considered flexibility. 3.3.3 aFRR Provisioning and Spot Market Scheduling In this thesis, we focus on aFRR provisioning as one option for monetizing prosumer flexibility. The choice of aFRR out of the three balancing services is motivated by the technical fit of aFRR activation patterns to the characteristics of flexible devices. In contrast to FCR provisioning, aFRR provisioning comes with temporal requirements that can technically be handled well by a large share of prosumer devices such as CHP plants or other HVAC-related devices. aFRR also seems more interesting than mFRR as the mFRR demand tendered by the TSOs has decreased in recent years [Bun20c]. This development may continue due to shorter lead times and higher trading volumes at intraday spot markets. In the literature review, it has to be considered that the balancing 71 Chapter 3 Related Work on Prosumer Flexibilization market conditions have changed significantly in recent years. Furthermore, national implementations still differ despite the ongoing European harmonization approaches, as discussed in Section 2.4.4. Olk et al. [OSM19] propose a bidding strategy for a battery energy storage system in the German aFRR balancing market. Their evaluation is based on quarter-hourly activation data. In the discussion of possible data sets for the aFRR activation simulation in Section 4.3.2, we decided not to use the quarter-hourly data set in order to achieve a better mirroring of the actual aFRR activation behavior. The author’s simulation results show that aFRR provisioning via battery storage systems is not economically beneficial for standalone batteries, given battery prices from 2019. The authors used the spot market for a recharge strategy that returns the SOC to a default state. The joint optimization of the aFRR and spot market bids is suggested as a further research direction. The identification of this research gap fits to the work presented in the thesis in which we not only combine both markets but also inherently consider unexpected catch-up effects and prosumer demands. Jargstorf et al. [JW13] investigate the case of aFRR provisioning via an aggregated pool of electric vehicles (EVs) in the German aFRR balancing market, given the regulatory market conditions from 2013. Based on the simulation results, the authors argue that aFRR provisioning is not economically interesting for EVs and that easier accessible markets should be considered instead. Strictly regulated availability levels and the need for high SOC levels have been identified as major challenges for aFRR provisioning. The authors use fixed aFRR activation prices and fixed activation times per year. This separates the publication from this work in which the aFRR energy price is a decision variable and in which the actual aFRR activation is simulated on a one-minute basis using historical data from the TSOs. Merten et al. [Mer+20] present a description of the German aFRR balancing market, including the changes in the last years. Their contribution is a prediction of the marginal aFRR mixed price (see also Section 2.4.4.3), the average energy price of aFRR bids, and the aFRR activation duration (in terms of the average aFRR activation duration for a block of bids in the aFRR energy price merit order). In particular, the work on predictions of aFRR activation can be seen as an extension of our work regarding the relation between aFRR energy prices and aFRR activations, as presented in [Lös+18]. Braeuer et al. [Bra+19] model the usage of a battery energy storage system operated at an industrial site. Focus is on peak shaving, FCR provision, and the DA and ID spot markets. In a linear optimization in 15-minute granularity, they decide per time interval for which market opportunity to use which share of the available capacity. The results show that none of the single revenue streams individually is economically attractive when considering the investment costs. However, a profitable operation could be achieved 72 3.4 Research Gap when value-stacking the single revenue streams. The largest share of the overall revenue was identified to come from peak shaving and FCR. Biegel et al. [Bie+14] discuss the integration of flexible consumers into balancing markets. They identify two main barriers: firstly, the long duration of balancing market products, and secondly, the necessity of accurate consumption baselines. As a conse- quence, they propose a new market model in which a flexibility aggregator can change the balancing market bid in case of changing consumer situations. Bessa et al. [BM14] propose a day-ahead optimization for day-ahead energy and aFRR balancing power bids of an EV aggregator. The balancing power bids are assumed to be possible in the granularity of sub-hourly time slots that are aligned to the needs of electric vehicles. Based on Iberian market data, the results indicate cost savings between 30 % and 35 %, compared to a strategy that only optimizes the energy bids. Furthermore, the authors show that forecast errors due to the stochastic nature of markets and EV states may result in a shortage of balancing power. Therefore, a market settlement scheme with a penalty term for balancing power shortage is proposed. In a recent publication, Nitsch et al. [Nit+21] provide an economic evaluation of battery energy storage systems bidding to DA spot and aFRR balancing markets. In contrast to this thesis, the results are not evaluated towards the actual aFRR activations, and the optimization of standalone battery energy storage systems is not subject to non-linear efficiency values. The presented results are in line with the results presented in this thesis; however, a detailed comparison is not possible due to divergent scenario assumptions. On a higher level of abstraction, the possibility for combined bidding to spot and balancing markets also raises questions regarding new market models. For example, Lie et al. [LT14] propose a demand response market model where prosumers can bid energy as a price-responsive shiftable demand in an energy market while bidding balancing power into the balancing market via a bid that is coupled with the energy bid. 3.4 Research Gap We showed that the broad topic of utilizing prosumer flexibility gained significant interest in the literature in recent years [Gou+20]. After studying the literature and discussing the multiple value creation options a prosumer is exposed to, we found the multi-use of flexibility incentivized by different value creation options as an exciting field with unanswered research questions. We showed that recent literature indicates higher benefits for prosumers simultaneously considering multiple value creation options for flexibilizing device schedules, compared to only reacting to one value creation option. 73 Chapter 3 Related Work on Prosumer Flexibilization Consequently, we argued our focus on the choice of the simultaneous consideration of the DA spot and aFRR balancing market. The presented literature that emerged during the course of this thesis confirms the high relevance of the addressed research questions. In summary, the research gap identified for this thesis is managing the trade-off between the DA spot and the aFRR balancing markets as two markets that simultaneously provide demand side management incentives to prosumers. In this context, this thesis contributes to the existing literature in multiple dimensions. Taking the viewpoint of a prosumer, we consider the trade-off between the two markets and provide a corresponding optimization. It inherently and realistically considers uncertain aFRR activations, catch-up effects that can be expected due to aFRR activations, device-specific flexibility limits, and on-site demands that have to be satisfied. 74 CHAPTER 4 Modeling in the Context of a Grid-responsive Facility Energy Management System This chapter models grid and facility side entities in the context of a grid-responsive Facility Energy Management System (FEMS). The goal is the operation of electric devices in a flexible way regarding runtime and power, such that the flexibility can be offered to the (day-ahead) electricity and (aFRR) balancing markets. This chapter discusses the system environment and analyzes the information flows, covering information-processing entities, communication links, related triggers, and granularities. Then, after the system is understood, mathematical models are defined. On the grid side, the focus is put on modeling the aFRR market, the activation mechanism for aFRR bids, and the DA and ID spot market. On the facility side, the focus is put on modeling flexible devices commonly found in commercial and industrial settings. The defined models lay the foundation for 1) the later proposed optimization that flexibilizes electricity consumption, and 2) the related simulation that quantifies the flexibility potential. This chapter also discusses traditional non-flexibilized operating strategies as they set the baseline for the later evaluation. 4.1 System Environment and Information Flows The FEMS aims at monetizing electric flexibility via an optimization that jointly considers the DA and aFRR market. Figure 4.1 gives an overview of the system environment and categorizes it into four columns. The left column (facility) shows the facility side with flexible devices. The two rightmost columns show the grid side: one shows the electricity and balancing markets (flexibility markets), and the other shows the balancing activation mechanism, which is based on the grid state (grid). The second column (Facility EMS) 75 Chapter 4 Modeling in the Context of a Grid-responsive FEMS TSO Input daily optimization GridFlexibility Markets Flexible devices Cold storage Predictions (demand) Chiller Condens- ing boiler CHP plant Battery storage Facility Market prices day-ahead spot Expected aFRR activation shares Predictions (market & grid) Intraday continuous Day-ahead auction Calculation of aFRR demand Uncontrollable demands Cold demand Heat demand Facility EMS Electricity Cold Heat Physical connection Output daily optimization Prosumer optimization Electricity demand Input intraday Output intraday Spot market Balancing market Heat storage aFRR auction aFRR acti- vation signal Figure 4.1: Information flows in the context of a FEMS utilizing electric flexibility via spot and balancing markets. in-between these two sides shows the FEMS handling the interaction between the facility and the grid/market. Its optimization exploits local on-site flexibilities (on the left side) according to grid-side incentives (on the right side). Based on Figure 4.1, the detailed system environment and related information flows are explained in the following. 4.1.1 Facility Information processing entities on the facility side are presented in the first column of Figure 4.1 (facility). A facility can be seen as a prosumer with the potential to locally coordinate the consumption and generation of electricity, heat, cold, and gas to provide flexibility in the facility’s electric load. Demands As depicted on the left side of the first column (demands), a facility is characterized by an electricity, cold, and heat demand that must be satisfied. We assume that a share of these final energy demands is uncontrollable and exogenously given. Gas and on-site generators can be used to contribute to the satisfaction of these demands. The presence of thermal buffer storages and a share of on-site electricity generators and 76 4.1 System Environment and Information Flows consumers that can be operated in a flexible way regarding runtime and power, allow adjusting/shifting the facility’s overall external electric load. Usually, a facility’s electric demand is higher than its local on-site generation capacities, such that missing energy is delivered via the public power grid. In this thesis’ scenario, the electric demand that cannot be covered by on-site generation is procured via the DA spot market. Flexible Devices Regarding the flexible devices, we focus on the four depicted devices on the right side of the first column (flexible devices). That is a combined heat and power (CHP) plant, a condensing boiler, an air condition (AC) system with a chiller, and a battery energy storage (BES) system. These devices are chosen as the largest share of the final energy consumption in the commercial and industrial sector is used for heating and cooling [Arb20]. For the exemplary chosen facility setup, the physical connection between the facility devices, related thermal and electric energy storages, and the resulting final facility demands is shown in Figure 4.1. A reason for choosing the given set of devices is that they cover a broad set of energy forms, as depicted in Table 4.1. The table summarizes the energy forms each device deals with. Using the example of the CHP plant, it can be recognized that it converts gas (demand) to electricity and heat (supply). The table also shows the related storages that provide the flexibility regarding runtime and power. It can be seen that in the case of the CHP plant, the flexibility originates from a thermal heat energy storage that allows buffering heat. In this case, flexibility limits are set by a minimum and maximum amount of bufferable thermal energy (kWh), resulting in a minimum and a maximum temperature of the storage’s medium (°C). In the case of the battery storage system, the flexibility limits are set by the maximum bufferable amount of the battery (kWh). Mathematical models of the devices and related storages are presented in Section 4.4. In the evaluation, we quantify the optimization potentials of the BES system and the CHP plant. The closer focus on these two devices is motivated by the increased commercial availability of BES system in different dimensions in recent years [VMd17; KJF16] (in particular in Germany, where the continuous decrease of the EEG feed-in premium increases the monetary benefit of self-consumption) and the fact that CHP plants serve as good examples for the coupling of multiple energy forms (electricity, heat, gas). Furthermore, a BES system is a good-to-investigate flexibility that simplifies the demonstration of the introduced concepts and the analysis of flexibility aspects. 4.1.2 Facility Energy Management System The FEMS turns a facility that traditionally acts as a passive electricity consumer into an active prosumer capable of locally coordinating on-site energy demand and supply. By 77 Chapter 4 Modeling in the Context of a Grid-responsive FEMS Table 4.1: Demand and supply of flexible devices separated by energy forms. Device Related flexibility Energy form Electricity Heat Cold Gas Battery storage system electric storage demand+supply - - - CHP plant thermal heat storage supply supply - demand Condensing boiler thermal heat storage - supply - demand Air conditioning thermal cold storage demand - supply - Uncontrollable demand - demand demand demand - utilizing on-site flexibility and responding to DSM incentives provided by electricity and balancing markets, the FEMS can contribute to the overall demand-supply matching process in a decentralized way. On the one hand, this can contributes to grid stability, and on the other hand, it allows realizing monetary benefits for the facility operator. Flexibilization Incentives Different options to turn electric flexibility into monetary value are discussed in Section 3.1. It was shown that a pure local optimization without any communication with external (grid-side) parties is possible, e. g., in the case of self-consumption. In contrast, the optimization presented in this thesis acts as an intermediary between the on-site devices on the one side and external DSM incentives on the other side. As dynamically stacking different options for the exploitation of flexibility may result in a higher monetary benefit (as presented in Section 3.3.2), we decided to focus on utilizing prosumer flexibility by simultaneously considering options at the DA spot and aFRR balancing markets. Based on the flexibilization incentives provided by these two markets, the FEMS optimizes runtimes and power levels of flexible on-site consumers and generators such that electric flexibility is turned into a monetary benefit for the facility operator. FEMS Inputs & Outputs A FEMS optimization can turns inputs as presented in Table 4.2a into outputs as presented in Table 4.2b. The following sections present details regarding the assumed market interfaces and timing. An optimization that results in bids to the DA spot and the aFRR balancing market must submit the bids before the respective market’s gate closures. Bids to the aFRR market have to be submitted by 9:00 h and bids to the DA market by 12:00 h on the day before delivery (see Figure 2.2). This means a joint optimization can be conducted before the first gate closure. In Chapter 5 we show how an optimization can consider information about expected aFRR activations (i. e., activation probabilities given an aFRR energy price) for dynamically 78 4.1 System Environment and Information Flows Table 4.2: Inputs and outputs of a FEMS and linked information sources and sinks. (a) Information consumed by the FEMS Information source → Input to FEMS PurposeFacility Each device Device model Initial setup Static parameters according to device model Initial setup State of charge (%) according to device model Day-ahead bid generation Potential intraday schedule adjustmentPredictionsDemand predictions for electricity, heat, and cold Hourly energy demand for each hour of the next optimization, period (i. e., the upcoming day) Day-ahead bid generationFlexibilitymarketsaFRR controller (TSO) Activation of a submitted aFRR bid Adjustment of device schedule according to activation of submitted aFRR bidPredictionsDA spot market price prediction Energy price prediction for each hour of the next optimization, period (i. e., the upcoming day) Day-ahead bid generation aFRR activation estimation Estimation of aFRR activation shares based on aFRR energy prices Day-ahead bid generation (b) Information provided by the FEMS Purpose Output of FEMS → Information sink Realization of DA spot market schedule Command to run device according to its device model Each deviceFacilityRealization of potential aFRR activation Realization of potential intraday schedule adjustment Daily submission of optimized DA spot market bids DA spot market bids DA marketFlexibilitymarkets Daily submission of optimized aFRR balancing market bids aFRR balancing market bids aFRR market Submission of ID spot market bids when unexpected aFRR activations or other unexpected schedule changes endanger the satisfaction of local energy needs ID spot market bids ID market 79 Chapter 4 Modeling in the Context of a Grid-responsive FEMS weighing up between the two considered market options. In the optimization problem formulated in Chapter 6, the ID spot market is not further considered. However, as this market segment allows us to realize intraday schedule adjustments to keep the balancing group of the facility balanced, it bears interesting options for handling the uncertainties discussed in Section 6.3. In this context, it is worth mentioning that we assume that the FEMS manages the consumption and generation of devices belonging to one dedicated balancing group, which the facility operator as BSP has to keep balanced (see also Section 1.1.4). Need for Predictions The optimization requires multiple predictions as bids to the DA and aFRR market have to be submitted one day in advance. Predictions address the remote grid side (upper box in the FEMS column in Figure 4.1) and the local facility side (lower box in the FEMS column). On the grid side, two predictions are used: firstly, the expected electricity prices at the DA market, and secondly, the expected aFRR ac- tivation probability in dependence on different aFRR energy prices. Furthermore, the proposed optimization assumes (see Section 4.3.1, assumption AaFRR6) that aFRR capac- ity prices are chosen such that aFRR bids are accepted into the aFRR pool, i. e., below the marginal aFRR energy price. On the facility side, predictions of the uncontrollable (i. e., exogenously given) electricity, heat, and cold demands are used. 4.1.3 Flexibility Markets In this thesis, we take the perspective of an aggregator of flexibilities. The third column in Figure 4.1 (flexibility markets) shows the electricity (DA and ID) spot market and the (aFRR) balancing market. The theoretical concepts of these markets are explained in detail in Chapter 2. In the following, we focus on the options for flexibility aggregators and related market interfaces that can be used. Direct vs. Indirect Market Participation Large prosumers can either participate directly in the DA and ID spot market or indirectly benefit from price variations via a third-party energy supplier. Furthermore, they can participate directly in the aFRR balancing market or indirectly provide their potential schedule adjustments to a third- party aggregator that combines them with other offers before offering them to the aFRR balancing market. In both cases, the intermediary may add a risk premium and take a certain profit margin for abstracting the process complexity and providing market access. In this thesis’ scenario, the FEMS maintains a balancing group and directly bids to the electricity spot market. Potential adjustments of the balancing group schedule 80 4.1 System Environment and Information Flows are offered to the aFRR balancing market according to the assumptions introduced in Section 4.3.1. Day-ahead Spot Market The market model of the DA spot market is an auction (as presented in Section 2.2.3). Per one-hour product, it results in one common energy price for all participants. At the EPEX DA spot market, bids for the 24 one-hour products of the upcoming day can be submitted till the auction gate closes at 12:00 h noon. A DA market bid ℬ DA 𝑡 for hour 𝑡 is defined by the following tuple [Eur20c]: ℬ DA 𝑡 = (𝑝DA 𝑡 , 𝜋DA 𝑡 ) (4.1) where 𝑝DA 𝑡 represents the power over the one-hour product time slot which should be bought (positive values represent buy bids) or sold (negative values represent sell bids), and 𝜋DA 𝑡 representing the energy price. An alternative day-ahead incentive for scheduling flexible prosumer devices is the intraday (opening) auction with quarter-hour products (as explained in Section 2.2.3). In this thesis, we chose the day-ahead instead of the intraday auction as its gate closure is closer to the aFRR balancing market gate closure and as it has higher market liquidity. Continuous Intraday Spot Market In this chapter, we discuss the concept of a flexibility-utilizing FEMS on a broader level than in the pure algorithmic optimiza- tion proposed later. In the proposed optimization, we do not optimize and submit bids to the continuous ID spot market. However, interfaces to the continuous intraday spot market are worth specifying in more detail, as they can be used for controlled intraday schedule adjustments. This possibility allows for decreasing the limitations coming along with the uncertainty introduced by the required predictions, as discussed in Section 6.3. The market model of the continuous ID market is a continuous double auction, i. e., trading is possible continuously (as presented in Section 2.2.3). In the continuous ID market, bids for the 96 quarter-hour products of the upcoming day can be submitted starting at 15:00 h till latest five minutes (within a TSO control area) or thirty minutes (between two TSO control areas) before the start of the respective quarter-hour. An EPEX continuous ID market bid for quarter-hour 𝑡 can be limited (with a price) or unlimited (without a price), where unlimited orders are matched at the best possible price without a price limitation [Eur20c]: ℬ ID 𝑡 = ⎧{ ⎨{⎩ (𝑝ID 𝑡 , 𝜋ID 𝑡 ) for limited orders (𝑝ID 𝑡 ) for unlimited orders (4.2) 81 Chapter 4 Modeling in the Context of a Grid-responsive FEMS with 𝑡 referring to the quarter-hour and 𝑝ID 𝑡 to the power that should be bought (positive values represent buy bids) or sold (negative values represent sell bids) within the respective quarter-hour. In the continuous ID market, the trading system continuously matches orders in the central, open, and anonymous order book aiming at the lowest price when buying and the highest price when selling. Consequently, a trade’s resulting price depends on the counterparty bids that are available in the order book for matching. aFRR Balancing Market The potential to adjust the facility’s load on spontaneous short-term activation requests (within a maximum of five minutes after the request) can be offered as capacity to the aFRR market. The focus on aFRR as a balancing service was already reasoned in Section 3.3.3. Negative aFRR market bids offer to increase the facility’s electric load, and positive aFRR bids offer to decrease the facility’s electric load. The rightmost column in Figure 4.1 (grid) shows the TSO, which activates aFRR bids based on its control area balance. We already showed that, in Germany, the four TSOs virtually operate one central control area (in Section 2.3.4). The TSOs continuously monitor the control area balance and activate aFRR bids of the facility if necessary (assuming they have been accepted into the aFRR pool based on the aFRR bid’s capacity price). Participation in the aFRR market is possible directly or indirectly via flexibility aggregators acting as third parties between the aFRR market and BSPs. Due to the pooling of multiple flexible devices, aggregators can offer divergent participation conditions, such as smaller minimum power levels. However, aggregators may want to take a certain profit share or offer price conditions divergent from the actual aFRR market prices. The aFRR market model represents a pay-as-bid auction (see Section 2.3). Bids for the six four-hour products of the upcoming day can be submitted till the auction’s gate closure at 9:00 h. A negative aFRR bid (i. e., increasing the facility’s demand) is defined by Equation 4.3 and a positive aFRR bid (i. e., decreasing the facility’s demand) by Equation 4.4: ℬ aFRR − 𝑡 = (𝑝aFRR − 𝑡 , 𝜋aFRR −,energy 𝑡 , 𝜋aFRR −,capacity 𝑡 ) (4.3) ℬ aFRR + 𝑡 = (𝑝aFRR + 𝑡 , 𝜋aFRR +,energy 𝑡 , 𝜋aFRR +,capacity 𝑡 ) (4.4) In both cases, 𝑝aFRR +/− 𝑡 refers to the balancing power, 𝜋aFRR +/−,energy 𝑡 to the aFRR energy price, and 𝜋aFRR +/−,capacity 𝑡 to the aFRR capacity price in time slot 𝑡. For negative balancing power we use positive power values, and for positive balancing power we use negative power values. Table 4.3 summarizes the above-explained market interfaces. The modeling of these markets is presented in the following sections. 82 4.2 Modeling of the Electricity Market Table 4.3: Interfaces for flexibility aggregators acting at day-ahead spot, intraday spot, and aFRR balancing markets. Market Options for action Decisions Max. frequency Bids Composition Per DA spot market buy energy daily ℬ DA = (𝑝DA, 𝜋DA) hour sell energy ID spot market buy energy unlimited ℬ ID = (𝑝ID) , or ℬ ID = (𝑝ID, 𝜋ID) quarter-hour sell energy aFRR balancing market offer power demand increase daily ℬ aFRR − = (𝑝aFRR −, 𝜋aFRR−,energy, 𝜋aFRR−,capacity) four hours offer power demand decrease daily ℬ aFRR + = (𝑝 aFRR +, 𝜋aFRR+,energy, 𝜋aFRR+,capacity) 4.2 Modeling of the Electricity Market This section presents how we use historical DA market prices for evaluating the flexibi- lization potential. Above, we showed that a bid to the DA spot market is composed as follows: ℬ DA 𝑡 = (𝑝DA 𝑡 , 𝜋DA 𝑡 ) (4.5) Focusing on the day-ahead auction, we assume perfectly predicted day-ahead prices coming in the form of a price forward curve. In the proposed optimization, the DA spot market bids’ power component 𝑝DA 𝑡 is defined as a decision variable, and the bids’ energy price 𝜋DA 𝑡 is assumed to be already known (i. e., exogenously given) at the time of making the bid. As stated below, this is a realistic assumption resulting in the fact that bids with the predicted price will always be accepted. In detail, we make the following assumptions regarding the DA spot market: ADA1 No impact of market participation on market conditions — We assume that a facility’s market participation has no impact on both electricity prices and trade- able energy amounts. This means that the market is assumed to be sufficiently liquid, in terms of traded energy, to always satisfy bids submitted by the facility. As the energy dimensions of facilities are relatively small compared to the overall energy amounts traded at the DA and ID spot market, facility bids can be seen as small enough to have no impact on the formation of market prices. As long as the 83 Chapter 4 Modeling in the Context of a Grid-responsive FEMS overall structure of market participants remains similar, this is an appropriate assumption. However, it is worth noting that the participation of a large share of prosumers would affect the formation of market prices by shifting the price matching point (due to a flatter demand curve in Figure 2.3). ADA2 Static grid fees and surcharges — We showed that specific surcharges must be added to each kilowatt-hour delivered via the public grid to account for grid fees and further taxes (see Section 2.2.4). We assume a fixed amount for these surcharges for energy bought via the spot market and consequently physically consumed via the public grid; however, not for energy sold to the market. This assumption reflects today’s regulation and results in asymmetric prices for buying and selling energy. In this context, it is worth noting that prosumer loads are characterized by a certain uncontrollable base load. Consequently, turning on a flexible on-site generator (such as a CHP) may not necessarily result in a sell bid. Instead, it may only decrease the energy amount that has to be bought via a buy bid. ADA3 Predictability of day-ahead prices — We assume that the electricity prices are available and known at the moment of deciding about the procurement. The EPEX day-ahead market is implemented as a call auction in which bids from buyers and sellers are collected by the central market authority till the gate closure at 12:00 h noon (as shown in Section 2.2.3.1). Then, the central trading system matches the prices, resulting in one price per day-ahead product (i. e., one kWh price per one-hour slot). We assume this price to be known at the time of optimization in the form of a price forward curve. The predicted price is at the cutting point of the demand and supply curve, as visualized in Figure 2.3. Given predicted prices for the upcoming day, the FEMS can perform the optimization and place the final buy bid such that it will be accepted (i. e., such that the buy bid’s price will be above the cutting point of the demand and supply curve). If the buying price prediction for a certain hour is too low (i. e., a price below the cutting point), the bid will not be accepted. If the buying price prediction is too high (i. e., a price above the cutting point), the bid will be accepted but result in lower costs than expected. To avoid the risk of unaccepted bids, a facility operator could rely on a third-party intermediary that guarantees time-variable hourly energy prices instead of maintaining an own balancing group and directly acting at the spot market. However, such a third-party instance may add a profit margin and 84 4.3 Modeling of the aFRR Balancing Market & aFRR Activations risk premium for the imperfect power demand forecast. 1 Due to identifiable price patterns and known fundamental influences (e. g., based on weather and time of day), accurate energy price prediction mechanisms for day-ahead spot markets are available [Wer14; Lag+20; LDD18; Kel+16]. Furthermore, EPEX day-ahead price predictions are commercially offered by prediction providers [Ene20; Pro20]. Therefore, this assumption can be seen as reasonable. It allows placing bids with the certainty that they get accepted. ADA4 Submission of bids at 0:00 h — The proposed optimization optimizes DA spot and aFRR balancing market bids. In Germany, the gate closure of the aFRR market (9:00 h) is three hours before the gate closure of the DA market (12:00 h noon). In our scenario, DA and aFRR market bids mutually depend on each other, and consequently, we assume the two kinds of bids to be optimized simultaneously. Furthermore, we assume that the daily bids are made directly before delivery. Therefore, the proposed optimization submits both the DA and aFRR market bids for the starting day at 0:00 h. This is a simplifying assumption that does not reflect practical requirements as this point in time lies outside the respective trading periods (as presented in Figure 2.2). This way, uncertainty potentially emerging between the day-ahead bid submission and delivery (e. g., regarding a device’s state of charge) is eliminated. However, this simplifying assumption can be seen as realistic when a power supplier is used as an intermediary providing time-variable tariffs based on the DA spot market. 4.3 Modeling of the aFRR Balancing Market & aFRR Activations Regarding the aFRR balancing market, we show how (publicly available) historical data sets can be combined for an ex-post simulation of the activation of aFRR market bids. 4.3.1 Assumptions In the course of this thesis, the market design of the aFRR market has changed from weekly to daily tendering periods and from 12-hour product time slots to 4-hour product time slots. These changes were introduced to facilitate the participation of alternative 1As the balance of the third-party’s balancing group suffers from imperfect power demand forecasts, the power supplier has to carry reBAP imbalance energy costs for deviations of the procured from the actually consumed electric energy. 85 Chapter 4 Modeling in the Context of a Grid-responsive FEMS balancing providers (see Section 2.4.4.3), as proposed within this thesis. The overall trend and consultations within the energy industry made these changes foreseeable. Consequently, the following assumptions regarding the aFRR market have already been made early enough: AaFRR1 Daily tendering periods — Till 2018, the aFRR market was characterized by weekly tendering periods. After that, the market design was changed to daily tendering periods to integrate alternative BSPs better into the aFRR market. A daily instead of a weekly tendering period comes along with two major advantages. Firstly, BSPs that rely on forecasts (such as CHP plants that have to satisfy local on-site demands) benefit from improved forecasts as they only have to look one day rather than one week into the future. Secondly, BSPs benefit as it becomes easier to meet the trade-off between acting at the DA market and providing aFRR. Within this thesis, we assume the tendering period to be one day. In the meanwhile this fits to the conditions in practice (as presented in Table 2.2). AaFRR2 Four-hour product time slots — Till 2018, the aFRR market was characterized by two time slots: peak tariff (6–22 h) and off-peak tariff (22–6 h). After that, the market design was changed to four-hour slots to integrate alternative BSPs better into the aFRR market. Consequently, each calendar day is separated into six positive and six negative aFRR products. Such a commitment that lasts for a smaller period of time improves the planning certainty. This, in particular, counts for demand-side BSPs that rely on predictions of local demands. We assume that aFRR bids can be made for individual four-hour slots. In the meanwhile, this reflects the conditions found in practice (as presented in Table 2.2). AaFRR3 Submission of bids at 0:00 h — With the change to daily aFRR tendering periods, the daily gate closure was set to 9:00 h on the day before delivery. As defined by assumption ADA4, we optimize and submit the DA spot market and aFRR market bids for the starting day simultaneously at 0:00 h. This simplifying assumption eliminates uncertainty between the day-ahead bid submission and the actual aFRR provision. As third-party aggregators can offer “virtual” balancing products independent of the actual aFRR market products, this can be seen as realistic. AaFRR4 Bids with continuous power steps — We assume that aFRR bids are possible in continuous power steps and that no minimum power requirement for an 86 4.3 Modeling of the aFRR Balancing Market & aFRR Activations aFRR bid exists. This means that aFRR bids can be submitted that are lower than currently required in practice (as of today, the minimum required power is 1 MW in cases where a BSP provides only one offer per aFRR product, or 5 MW in cases where a BSP provides more than one offer per aFRR product). This assumption supports the market participation of alternative BSPs on the demand side as their power capacities are smaller than the ones of conventional power plants. In addition to neglecting the minimum power limit, we assume that there are no restrictions on the power increment delta (as of today, the power increment is a multiple of 1 MW). While this does not directly reflect the aFRR market conditions, it can be seen as realistic: already today, aFRR bids with characteristics differing from the official market conditions are possible via aggregators acting between the aFRR market and the BSP. AaFRR5 One-minute based balancing power activation — We assume that aFRR bids are activated minute-based according to the aFRR energy price merit order and that single aFRR bids are either activated with the total offered capacity or not at all. In borderline cases where the TSO’s aFRR demand would partially activate an aFRR bid, the respective aFRR bid will be activated with its full power band. Therefore, partial activations of aFRR bids do not occur in our modeling. Furthermore, using averaged one-minute instead of four-second activation signals results in the fact that ramping times do not have to be considered in the bid’s activation signal. Neglecting the special case of partial aFRR activations is reasonable, particularly in combination with assumption AaFRR4 (no minimum power requirement for an aFRR bid). AaFRR6 aFRR capacity prices scaled down based on historical market design — The presented aFRR modeling focuses on the impact of aFRR energy prices on the activation of aFRR bids. For the activation of an aFRR bid, the aFRR capacity price is not further relevant once an offer is accepted into the aFRR pool. The proposed optimization assumes that aFRR bids are accepted into the aFRR pool, i. e., that a price is chosen below the marginal aFRR capacity price. In the evaluation, we use historical marginal aFRR capacity prices. However, due to market design changes, available historical capacity prices are based on different conditions: they are based on tendering periods of one week and peak and off-peak product slots (HT/NT). As we assume the tendering period to be one day (instead of one week; assumption AaFRR1) and the time slot size to be four hours (instead of peak and off-peak slots; assumption AaFRR2), we linearly scale down historical aFRR capacity prices based on the temporal share 87 Chapter 4 Modeling in the Context of a Grid-responsive FEMS of the four-hour product slots. Therefore, we use ̂𝜋aFRR +/−,capacity 𝑡 to represent the (positive or negative) marginal aFRR capacity price for one hour of aFRR provisioning in hour 𝑡. This allows considering realistic aFRR capacity prices that fit the assumed—and in the meanwhile implemented—market design with four-hour aFRR product slots. 4.3.2 Ex-post Simulation of aFRR Activations & Data Processing In Section 2.3, we showed that the capacity price of an aFRR bid decides whether the bid is accepted into the aFRR pool. Once accepted, the aFRR energy price merit order is used to decide whether a bid is activated. Furthermore, we showed that the TSOs continuously (on a four-second basis) determine the aFRR power demand for the GCC. We explained that this results in continuous activations of aFRR bids and a continuously changing marginal position within the aFRR energy price merit order. Now, we present an ex-post simulation that allows determining the activation of an aFRR bid in the past. For a given aFRR bid, our ex-post simulation results in activation signals on a one-minute basis (see AaFRR5). This allows for deriving the activated aFRR energy and the monetary impact through aFRR energy price revenues. Our simulation uses the following data sets (whose interfaces and formats were subject to multiple changes in recent years2): Data set 1: Marginal aFRR capacity prices — The marginal aFRR capacity price for each product period is the highest aFRR capacity price accepted into the pool. Given historical marginal aFRR capacity prices, we can derive whether a bid with a given capacity price is accepted into the aFRR pool (if the bid’s capacity price is below or equal to the marginal capacity price) or not (if the bid’s capacity prices is above the marginal capacity price). We use marginal aFRR capacity prices regularly published by the TSOs [Deu20h]. Data set 2: aFRR energy price merit order lists — For each aFRR product, we can generate aFRR energy price merit-order list by sorting the accepted bids according to their energy prices. Therefore, we use anonymized aFRR bids composed of the offered aFRR balancing power, the requested aFRR energy price, and the requested capacity price. The anonymized bids are regularly published by the TSOs [Deu20h]. Data set 3: aFRR power demand of the Grid Control Cooperation — We already showed that aFRR controllers within the GCC are coupled via a superior 2See Measure 17 of the BMWi White Paper [Bun15a], which aims at creating more transparency concerning market data, as discussed in Section 2.4.4.1. 88 4.3 Modeling of the aFRR Balancing Market & aFRR Activations controller, such that the activation of aFRR bids follows a common aFRR energy price merit order (see Section 2.3.4). Two options can be recognized for approximating the latest activated aFRR bid within the common aFRR energy price merit order. Firstly, the aFRR power demand of the GCC can be used in 4-second granularity as provided by the TSOs based on operational measurements [Deu20g]. Secondly, the aFRR power actually delivered by BSPs can be used in 15-minute granularity [Deu20h]. The TSOs provide both data sets, and we use the first data set for the reasons discussed below. Regarding data set 3, we preferred the aFRR power demand in 4-second granularity over the actually delivered aFRR power in 15-minute granularity. It is important to understand that the 4-second aFRR power demand does not directly reflect the finally provided aFRR power, as BSPs have certain flexibility in reacting to an aFRR activation signal. Pursuing the goal of simulating aFRR activations, we chose the high-resolution aFRR power demand, as the alternative low temporal resolution in quarter-hour granular- ity comes with two major disadvantages. The first disadvantage is that the distribution of activations within a quarter-hour slot cannot be derived without further assumptions. For instance, a quarter-hour averaged aFRR power demand of 50 MW may be the result of a 7.5-minute activation of 25 MW, and a 7.5-minute activation of 75 MW, or various other possible distributions. As the requested aFRR power is crucial for determining the activated aFRR bids (according to the aFRR energy price merit order), assumptions regarding the activation characteristics within a quarter-hour slot can have a significant effect. The second disadvantage when using the quarter-hour data is that negative and positive balancing power is never activated simultaneously. Therefore, an additional assumption regarding the distribution of the negative and positive activation time within each quarter-hour slot would be required. Consequently, based on the quarter-hour data, a detailed evaluation of aFRR activations on a minute basis is impossible without further assumptions. As the introduction of such assumptions may potentially result in serious deviations from the actual aFRR activation behavior, we decided to use the four-second aFRR power demand values. For determining whether a given aFRR bid was activated, we define the minutely marginal aFRR energy price ̂𝜋aFRR,energy 𝑡 . It is specific to the activation direction in the given minute 𝑡, and defined as the highest aFRR energy price at which an aFRR bid in a given minute was activated. Consequently, given the activation direction, all respective offers with an aFRR energy price below this marginal price have been activated. Figure 4.2 illustrates how the anonymized aFRR bids (data set 2) and the aFRR power demand (data set 3) are processed. It results in an average aFRR power demand for a specific minute 𝑡 and the respective marginal aFRR energy price for the resulting 89 Chapter 4 Modeling in the Context of a Grid-responsive FEMS Negative aFRR, sub tariff Negative aFRR, main tariff 1) aFRR power demand of the GCC Input: aFRR demand in four-second granularity Output: average aFRR demand in one-minute granularity Positive aFRR, sub tariff Positive aFRR, main tariff Accumulated aFRR power (MW)aFRRpower demand(MW)aFRR energy Price (EUR/MWh) Time 2) Anonymized aFRR market bids Input: all aFRR bids (power and energy price) per product Output: merit-order list per product (as visualized below) Result per minute: 3) Lookup Input: aFRR power demand (per minute) and merit-order lists (per week) Output: marginal aFRR energy price aFRR power demand (MW) Marginal aFRR energy price (EUR/MWh) t (min) Figure 4.2: Calculation of the minutely marginal aFRR energy price based on publicly available data. balancing direction in this minute. Hence, for each minute, we have either a marginal aFRR energy price for negative or positive balancing power. The calculation follows the following three high-level steps, which are concretized in more detail in Algorithm 4.1: Step 1: Calculation of the minutely averaged aFRR power demand of the GCC (using data set 3) Step 2: Generation of the aFRR energy price merit order lists based on anonymized aFRR bids (using data set 2) Step 3: Lookup of the marginal energy price based on steps 1 and 2 In the above discussion on market interfaces (in Section 4.1.3), we showed that negative and positive aFRR bids for a four-hour slot are defined as follows: ℬ aFRR − 𝑡 = (𝑝aFRR − 𝑡 , 𝜋aFRR −,energy 𝑡 , 𝜋aFRR −,capacity 𝑡 ) (4.6) ℬ aFRR + 𝑡 = (𝑝aFRR + 𝑡 , 𝜋aFRR +,energy 𝑡 , 𝜋aFRR +,capacity 𝑡 ) (4.7) 90 4.4 Modeling of the Facility Side Assuming that an aFRR bid is accepted into the aFRR pool based on the capacity price, we can ex-post simulate the bid’s activation. Using the calculated minutely aFRR power demand (𝑝aFRRdemand) and the calculated minutely marginal aFRR energy price ( ̂𝜋aFRR,energy 𝑡 ) for the respective balancing direction, we determine the activated negative and positive balancing power for a given minute 𝑡 as follows: 𝑝 aFRR−,act 𝑡 = ⎧{ ⎨{⎩ 𝑝aFRR − 𝑡 if (𝑝aFRRdemand > 0) ∧ (𝜋aFRR−,energy 𝑡 ≤ ̂𝜋aFRR,energy 𝑡 ) 0 in all other cases (4.8) 𝑝 aFRR +,act 𝑡 = ⎧{ ⎨{⎩ 𝑝aFRR + 𝑡 if (𝑝aFRRdemand < 0) ∧ (𝜋aFRR+,energy 𝑡 ≤ ̂𝜋aFRR,energy 𝑡 ) 0 in all other cases (4.9) 4.4 Modeling of the Facility Side In this section, we provide mathematical models for the facility side. In general, we can distinguish white box, black box, and gray box models [SB17]. White box models are completely based on the replication of the physical behavior of the real system, which bears the potential for high accuracy, but also comes with high complexity. Black box models are based on a more abstract description of the relations between input and output parameters of the system, e. g., based on measurements that implicitly allow mimicking the physical behavior. Gray box models are a mix of white and black box models: they combine knowledge about the physical behavior of the real system with further information, such as measured data. To reduce the modeling complexity, we focus on gray box models. This is supported by practical requirements, as devices are usually operated without explicit knowledge of physical details and parameters. Furthermore, predictive DSM optimizations are subject to uncertainty, hence reducing the need for very high accuracy. The presented models serve as a basis for the later proposed optimization and the simulation-based evaluation. The CHP and battery model build upon the modeling elaborated in [Huf15]. Notation We denote devices as 𝑑name ∈ 𝔻 with name being a unique device name as defined in the following sections and 𝔻 being a set with all devices considered in the optimization. Within sections that clearly focus on variables related to a certain device, we do not explicitly tag the variables with an index describing the device. Otherwise, to distinguish variables of different devices, we add an index describing the device. Indices 91 Chapter 4 Modeling in the Context of a Grid-responsive FEMS Algorithm 4.1 Calculation of minutely marginal aFRR energy prices. Inputs: 1. 𝑝 𝑤,𝑠,𝑑 𝑖 : Multi-dimensional array containing the power of the 𝑖-th accepted aFRR bid of the energy price sorted merit-order list for each tendering week 𝑤 (be- tween 𝑡start and 𝑡end), tariff slot 𝑠 ∈ {peak, off Peak}, and balancing direction 𝑑 ∈ {aFRR −, aFRR+}. 2. 𝜋𝑤,𝑠,𝑑 𝑖 : Multi-dimensional array containing the energy price of the 𝑖-th accepted aFRR bid of the energy price sorted merit-order list for each tendering week 𝑤 (between 𝑡start and 𝑡end), tariff slot 𝑠 ∈ {peak, off Peak}, and balancing direction 𝑑 ∈ {aFRR −, aFRR+}. 3. 𝑝aFRRdemand,𝑡: Array containing the averaged aFRR power demand for each one- minute slot 𝑡 (between 𝑡start and 𝑡end). Steps: for each minute 𝑡 between 𝑡start and 𝑡end do 𝑤 ← tendering week that covers minute 𝑡 𝑠 ← tariff slot ∈ {peak, off Peak} that covers minute 𝑡 if 𝑝aFRRdemand,𝑡 < 0 then 𝑑 ← aFRR + else if 𝑝aFRRdemand,𝑡 > 0 then 𝑑 ← aFRR − else 𝑑 ← ∅ end if if 𝑑 == ∅ then ̂𝜋aFRR,energy 𝑡 ← ∅ else 𝑛activated ← 0 ▷ number of activated bids 𝑝activated ← 0 ▷ sum of activated power while 𝑝activated ≤ ∣𝑝aFRRdemand,𝑡∣ do 𝑛activated ← 𝑛activated + 1; 𝑝activated ← 𝑝activated + ∣𝑝𝑤,𝑠,𝑑 𝑛activated∣ end while ̂𝜋aFRR,energy 𝑡 ← 𝜋𝑤,𝑠,𝑑 𝑛activated end if end for Outputs: 1. 𝑑𝑡: Array containing the aFRR activation direction for each one-minute slot 𝑡 (between 𝑡start and 𝑡end). 2. ̂𝜋aFRR,energy 𝑡 : Array containing the marginal aFRR energy price for each one-minute slot 𝑡 (between 𝑡start and 𝑡end). 92 4.4 Modeling of the Facility Side written in non-italic text describe the related variable more closely, and indices written in italics refer to variables. We write device names as subscript indices and energy forms as superscript indices. Taking the perspective of prosumers, we follow the load convention (also referred to as passive sign convention) and use positive power and energy values for referring to demand, and negative power and energy values for referring to supply. 4.4.1 Facility Demands We define a facility’s electricity, heat, and cold demands as positive power values (W) denoted as follows, with 𝑡 referring to the respective time step: • 𝑝el demand,𝑡: The facility’s exogenously given electric power demand in time step 𝑡. • 𝑝heat demand,𝑡: The facility’s exogenously given heat power demand in time step 𝑡. • 𝑝cold demand,𝑡: The facility’s exogenously given cold power demand in time step 𝑡. In office building settings, thermal heat and cold demands usually result from space heating and cooling devices that aim at keeping the room temperature at a desired level [Arb20]. In industrial settings, these demands usually result from process heating (such as drying or melting) or process cooling (such as cooling of equipment). Heat demands are satisfied by heating devices, and cold demands are satisfied by cooling devices. Concrete power values in the facility context are presented in Chapter 8. There, the granularity of the exogenously given demands is assumed to be Δt = 1 h. As cold physically represents the absence of heat, cooling describes the process of removing heat from a system. Therefore, we use the term cold energy to refer to negative heat energy (meaning that a cold demand of 1 kWh physically represents a heat demand of −1 kWh). 4.4.2 Battery Storage System A battery energy storage (BES) is a buffer for electric energy, which is based on electro- chemical reactions. Batteries can consume electric energy, referred to as charging, for later generating electric energy, referred to as discharging. A battery’s state of charge (SOC) describes the ratio of charged energy and the overall chargeable energy in a per- centage value [ZL11]. Batteries are operated between their lower SOC bound (storage empty) and their upper SOC bound (storage full), and with a certain loss between the energy charged and the energy discharged [SS14]. A battery consists of one or more electrochemical cells. Research addresses different cell technologies and today’s most 93 Chapter 4 Modeling in the Context of a Grid-responsive FEMS commonly used cell technology is based on lithium-ion. Battery Management Systems (BMSs) manage the cells by monitoring and controlling voltage, current, temperature, and coolant flow, and calculating values such as the SOC. Depending on the battery’s cell technology, adjusting the charging and discharging is possible in a very flexible way regarding power and the speed of reaction to the power level. BES systems differ concerning the maximum charge and discharge power (in W), the capacity (in Wh), the BMS strategy, or the expected lifetime performance. The relation between the charge/discharge power and the capacity is sometimes also described by the C factor (which usually is defined as a battery storage system’s ratio of ampere to ampere hour). The lifetime performance can be measured using the number of possible full charging-discharging cycles till the capacity falls below a certain threshold such as 80 % of the original capacity. Depending on the cell technology, in order to keep the battery healthy, BMSs may limit the nominal capacity to a lower usable capacity. For lithium-ion batteries, we distinguish the nominal capacity representing the theoretical maximum capacity, and the usable capacity. Commercial available BES systems for households aim at increasing the self-consumption of primarily rooftop PV generation; they have a capacity in the range of approximately 5–10 kWh. BES systems for electric vehicles are primarily used to drive an electric engine and have a capacity in the range of approximately 30–100 kWh. Battery storages for commercial purposes range from hundreds of kilowatt-hours to tens of megawatt-hours and today often aim at providing on-site backup power or FCR. Batteries are charged and discharged in direct current (DC). As public grids and the vast majority of local grids are operated in alternating current (AC), a power inverter from AC to DC is required for charging the battery, and a power inverter from DC to AC for discharging. A special case are batteries charged via local PV systems. They can be DC-coupled with the local PV system, hence eliminating DC-AC-DC conversion losses [Wen+20]. Furthermore, in the context of PV systems, hybrid DC-to-AC inverters are available that can convert both DC power from a battery and DC power from PV panels. We define a BES system as a bundle composed of the battery, the BMS, and the (AC-to- DC and DC-to-AC) power inverter. This allows the BES system to consume and generate electric energy in AC. Battery energy storage systems are commonly also referred to as battery storage systems. 4.4.2.1 Operating Strategies & Flexibilization Potential In Germany, most of today’s battery storages found on the demand side follow the goal to increase the self-consumption of surplus on-site PV or wind power, to minimize power peaks, or to increase the autarky from the external grid by providing backup 94 4.4 Modeling of the Facility Side Algorithm 4.2 Naive operating strategy for increasing the self consumption of on-site provided energy via a battery storage system. while true do 𝑝balance ← power balance measured at the grid coupling point ▷ negative in case of power supply to the public grid ▷ positive in case of power demand from the public grid if 𝑝balance < 0 and 𝑆𝑂𝐶battery < 𝑆𝑂𝐶battery then charge battery: 𝑝battery = −1 ⋅ max(𝑝balance, 𝑝battery) else if 𝑝balance > 0 and 𝑆𝑂𝐶battery > 𝑆𝑂𝐶battery then discharge battery: 𝑝battery = −1 ⋅ min(𝑝balance, 𝑝 battery) end if wait for a predefined time interval Δt end while power [Hop+14]. In the absence of time-variable electricity prices, an increase in self- consumption of on-site provided energy can be realized by a simple operating strategy. Such as strategy is exemplified in Algorithm 4.2, where 𝑆𝑂𝐶battery and 𝑆𝑂𝐶battery repre- sent the minimum and maximum accepted SOC, 𝑝battery the maximum discharge power as negative power value, and 𝑝 battery the maximum charge power as positive power value. More advanced operating strategies depend on the scenario. In recent years, FCR provisioning via battery storage systems gained popularity. In 2015, dedicated prequalification requirements were introduced to enable them to par- ticipate in the FCR market [Deu15a]. The minimum (aggregated) power capacity is 1 MW. As of today, FCR provisioning with batteries is mainly implemented via aggrega- tors interconnecting multiple smaller battery storage systems and abstracting market access barriers. In 2020, 60 MW of battery storage systems were prequalified for FCR [Deu20f], which lies in the area of about 10 % of the overall FCR capacity acquired by the TSOs. FCR provision is based on decentralized proportional controllers that use the frequency to determine the activated power (as explained in Section 2.3.1). Therefore, local measurements of the grid frequency are sufficient. The flexibilization potential concerning DA and aFRR market participation is as follows. Energy can be bought or sold via the DA market as long as charging or discharging with the required power is possible over one full hour. The power required to satisfy the DA market schedule determines the remaining flexibility for potential aFRR provisioning. Negative and positive balancing power can be offered as long as the battery’s remain- ing capacity allows increasing or decreasing the power level accordingly: after a full activation over four hours, the SOC must still be within the battery’s capacity limits. 95 Chapter 4 Modeling in the Context of a Grid-responsive FEMS Today’s common use cases (increasing self-consumption, minimizing power peaks, providing backup power, or providing FCR balancing power) can be realized by solely reacting to local measurements, e. g., of power or frequency. In contrast, the economic optimization incentivized by DA spot and aFRR balancing markets requires more predic- tive operating strategies and additional information exchange (of spot market prices or aFRR activation signals) between the FEMS and facility-external entities. 4.4.2.2 Formalization In this thesis, we model a battery storage system using the following parameter set: 𝒟battery = (𝐶, 𝑝, 𝑝, 𝑛, 𝜂(𝜆)) (4.10) The parameters are described in the following. 𝐶 refers to the usable capacity indicat- ing how much energy the battery can buffer, measured in kWh. The maximum discharge power (negative power value) and the maximum charge power (positive power value) are denoted as 𝑝 and 𝑝 respectively, where 𝑛 ∈ ℕ+ discrete power levels are possible for both charging and discharging. For referring to concrete power levels we introduce a variable 𝜆 ∈ {−𝑛, … , 𝑛} where −𝑛 ≤ 𝜆 < 0 represents discharging, 𝜆 = 0 represents being idle, and 0 < 𝜆 ≤ 𝑛 represents charging. The charge and discharge efficiency depend on the power level. It is defined as function 𝜂(𝜆) ∶ {−𝑛, … , 𝑛} → [0, 1]) that maps the power level 𝜆 to the charge efficiency (if 𝑛 > 0) or discharge efficiency (if 𝑛 < 0), including both the efficiency of the power inverter and the battery. In Chapter 8, these parameters are set using data from real batteries. We assume that the state of charge has no impact on the charge or discharge power. This, in particular, means that we do not separate between constant power and constant voltage phases, which is a simplified modeling. This allows us to calculate the battery’s power based on the power level 𝜆 ∈ {−𝑛, … , 𝑛} via the function 𝑝(𝜆): 𝑝(𝜆) = ⎧ {{ ⎨ {{ ⎩ 𝑝 ⋅ 𝜆 𝑛 if 𝜆 > 0 (charging) 0 if 𝜆 = 0 (idle) 𝑝 ⋅ ∣ 𝜆 𝑛 ∣ if 𝜆 < 0 (discharging) [W] (4.11) On this basis, the energy delta Δ𝑒𝑡 provided in time step 𝑡 can be described in depen- dence of the power level 𝜆𝑡 in this time step: Δ𝑒𝑡 = 𝑝(𝜆𝑡) ⋅ 𝜂(𝜆𝑡) ⋅ Δ𝑡 [Wh] (4.12) with Δ𝑡 representing the duration of the time step. 96 4.4 Modeling of the Facility Side The energy contained in the battery storage at the end of time step 𝑡 can be calculated recursively by Equation 4.13. The state of charge 𝑆𝑂𝐶𝑡 of the battery storage with a usable capacity 𝐶 at the end of time step 𝑡 can be calculated by Equation 4.14: 𝑒𝑡 = 𝑒𝑡−1 + Δ𝑒𝑡 [Wh] (4.13) 𝑆𝑂𝐶𝑡 = 𝑒𝑡 𝐶 ⋅ 100 % [%] (4.14) The restrictions regarding the state of charge 𝑆𝑂𝐶𝑡 which have to be satisfied over all time steps 𝑡 are based on the minimum accepted 𝑆𝑂𝐶 (we define 𝑆𝑂𝐶 = 0 %) and the maximum accepted 𝑆𝑂𝐶 (we define 𝑆𝑂𝐶 = 100 %): 𝑆𝑂𝐶 ≤ 𝑆𝑂𝐶𝑡 ≤ 𝑆𝑂𝐶 [%] (4.15) Further restrictions of the battery storage are the maximum charge and the maximum discharge power, which also have to be met in all time steps 𝑡: 𝑝 ≤ 𝑝𝑡 ≤ 𝑝 [W] (4.16) with 𝑝 being the maximum discharge power (i. e., the lowest possible negative power value) and 𝑝 being the maximum charge power (i. e., the highest possible positive power value). 4.4.3 Thermal Energy Storage Thermal energy storages (TESs) allow buffering thermal heat or cold energy and hence decoupling the related generation and consumption [AHP12; Ene+20]. To buffer the thermal generation of a CHP plant or a condensing boiler, a thermal heat energy storage can be used. To buffer the thermal generation of a chiller, a thermal cold energy storage can be used. In the context of the heating and cooling of commercial facilities, thermal energy storage tanks are usually containers made of steel, (fibre-reinforced) plastic, or concrete. Usually, they contain a medium such as water whose temperature can be heated up (heat storage) or cooled down (cold storage) to a temperature level required to satisfy the facility’s thermal on-site demands. The most widely used liquid for thermal storage is water (in the liquid phase) [TBH09]. Cold storages may also use brine to lower the freezing point of water. Thermal energy storage tanks come in sizes of about 0.1 m3 (domestic hot water storages) up to 12 000 m3 (district heating) [TBH09]. Depending on the use case and the required temperature level, thermal energy storages with different 97 Chapter 4 Modeling in the Context of a Grid-responsive FEMS materials and target temperatures can be recognized, such as high-temperature energy storages (operated at temperatures above 500 °C) or ice storages. We focus on thermal energy storages used as a buffer between a facility’s on-site heat or cold generators on the one side, and the final heating and cooling demands on the other site. Being used to buffer thermal energy, thermal energy storages are also referred to as thermal buffer storages. We also refer to them simply as heat storages or cold storages. 4.4.3.1 Flexibilization Potential The thermal energy that can be buffered by a certain medium can be calculated using its specific heat capacity 𝑐 and its density 𝜌. For example, the following two equations present the thermal energy that can be buffered using the medium water and the medium air (based on physical constants [HMS17] and assuming a constant temperature of 20 °C and a constant pressure): 𝑐water [J/(kgK)] ⋅ 𝜌water [kg/m3] = 4 173.64 kJ/(m3K) = 1.16 kWh/(m3K) (4.17) 𝑐air [J/(kgK)] ⋅ 𝜌air [kg/m3] = 0.119 833 kJ/(m3K) = 0.000 333 kWh/(m3K) (4.18) It can be seen that water in thermal energy storages, compared to air in buildings, can buffer a significantly higher amount of energy per volume: thermal energy buffering potential of air thermal energy buffering potential of water = 0.000 333 kWh/(m3K) 1.16 kWh/(m3K) = 0.029 % (4.19) Alternatively, the building mass (e. g., concrete) could be used as a thermal buffer. In this thesis, for flexibilizing the runtime and power of heat and cold generating devices, we focus on the temperature within thermal energy storages and not on the temperature within buildings. The proposed optimization adjusts the thermal energy flowing into the thermal storages and assumes the building’s final thermal demands as uncontrollable and exogenously given (see Section 4.4.1). This results in a less invasive control compared to the utilization of the temperature range in buildings. Table 4.4 shows how well thermal generators and storages can be used for shifting electric energy generation and consumption [KG17]. We can distinguish between electric energy consumption (in the case of heat pumps or chillers) and electric energy generation (in the case of CHPs).3 The electric load shifting potential of these devices is limited 3The electric and thermal efficiency (𝜂el and 𝜂th) and the coefficient of performance (COP) are explained in the later modeling of the respective devices. 98 4.4 Modeling of the Facility Side Table 4.4: Potential of thermal generators to shift electric energy consumption (in the case of heat pumps or chillers) or electric energy generation (in the case of CHPs), quantified with typical values. Thermal storage Thermal generator Ratio of electric to thermal load (𝑝 el / 𝑝th) Heat storage CHP 𝜂el chp / 𝜂th chp ≈ 40 % Heat pump 1 / 𝐶𝑂𝑃heatPump ≈ 20 % Cold storage Chiller 1 / 𝐶𝑂𝑃chiller ≈ 20 % by the size of the thermal energy storage. The table clarifies that a CHP can shift up to 0.4 kWh of electric energy generation with each 1 kWh of shifted thermal energy generation. A heat pump that can shift up to 0.2 kWh of electric energy consumption with each 1 kWh of shifted thermal energy generation. A chiller can shift up to 0.2 kWh of electric energy consumption with each 1 kWh of shifted thermal energy generation. As an order of magnitude, it is worth noting that 100 kWh of thermal energy can be stored in a thermal water storage with a volume of approximately 8.6 m3 in form of a temperature delta of ΔT = 10 K (see Equation 4.17). The thermal buffering potential can be increased by increasing the temperature band accepted in the thermal buffer [Lös+14]. However, the temperature of pure water can only be increased in a limited range as water only provides an operation range between 0 °C (freezing) and 100 °C (boiling) [TBH09]. Furthermore, an increased temperature can come along with decreased efficiencies of the thermal generators and increased storage losses. 4.4.3.2 Formalization We define a thermal energy storage by the following parameter set: 𝒟thBuffer = (𝑉, 𝑇, 𝑇, 𝜌, 𝑐) (4.20) The parameters are described in the following. To begin with, the energy 𝑒𝑡 stored in a thermal energy storage at the end of time step 𝑡 can be formalized as follows: 𝑒𝑡 = 𝑒𝑡−1 + Δ𝑒final 𝑡 [Wh] (4.21) with Δ𝑒final 𝑡 = Δ𝑒in 𝑡 − Δ𝑒out 𝑡 , i. e., the sum of the thermal energy added to the thermal storage and the thermal energy removed from the thermal storage in the respective time step. 99 Chapter 4 Modeling in the Context of a Grid-responsive FEMS We first look at the case of a hot water storage. In our exemplary facility setup, on the one hand, thermal heat can be added by the CHP plant and the condensing boiler (see Sections 4.4.4 and 4.4.5), as presented in Equation 4.22. On the other hand, thermal heat can be removed by the uncontrollable final on-site heating demand (see Section 4.4.1), as presented in Equation 4.23: Δ𝑒in 𝑡 = 𝑝heat chp,𝑡 ⋅ Δ𝑡 + 𝑝heat condBoiler,𝑡 ⋅ Δ𝑡 [Wh] (4.22) Δ𝑒out 𝑡 = 𝑝heat demand,𝑡 ⋅ Δ𝑡 [Wh] (4.23) Now we look at the cold water storage. In our exemplary facility setup, on the one hand, thermal cold can be added by the air conditioning system’s chiller (see Section 4.4.6), as presented in Equation 4.24. On the other hand, thermal cold can be removed by the uncontrollable final on-site cooling demand (see Section 4.4.1), as presented in Equation 4.25: Δ𝑒in 𝑡 = 𝑝cold chiller,𝑡 ⋅ Δ𝑡 [Wh] (4.24) Δ𝑒out 𝑡 = 𝑝cold demand,𝑡 ⋅ Δ𝑡 [Wh] (4.25) For both the hot and cold water storage, we assume the thermal storage medium to be water in the liquid aggregate state, i. e., water with a temperature > 0 °C and < 100 °C. This way, we do not have to consider phase changes in the modeling. In general, the temperature of the medium in the thermal storage can be calculated based on the thermal energy added to or removed from the thermal storage. This requires the medium’s specific heat capacity 𝑐. It describes the thermal energy (J) required to raise the temperature of a certain mass (kg) by 1 K. Consequently, the specific heat capacity is defined by the unit J/(kgK). For a thermal storage tank with a volume 𝑉 (m3) which is filled with a medium with the density 𝜌 (kg/m3) and the specific heat capacity 𝑐 (J/(kgK)), the temperature 𝑇𝑡 (K) at the end of time step 𝑡 can be calculated as follows: 𝑇𝑡 = 𝑒𝑡 (𝑉 ⋅ 𝜌) ⋅ 𝑐 [K] (4.26) The following constraint guarantees that the minimum temperature 𝑇 and the maxi- mum temperature 𝑇 defined for the medium in the thermal storage are not violated: 𝑇 ≤ 𝑇𝑡 ≤ 𝑇 (4.27) 100 4.4 Modeling of the Facility Side The thermal storage’s temperature can also be represented as a percentual state of charge. As our model only addresses a limited temperature range, we assume a constant density and specific heat capacity. Then, the temperature changes linearly to the added or removed energy. For a hot water storage, 𝑇 equals an empty thermal storage and 𝑇 equals a full thermal storage. For a cold water storage, 𝑇 equals an empty thermal storage and 𝑇 equals a full thermal storage. This is represented by the following Equation, which is valid for all temperatures within the specified temperature range: 𝑆𝑂𝐶𝑡 = ⎧ {{{ ⎨ {{{ ⎩ 𝑇𝑡 − 𝑇 𝑇 − 𝑇 ⋅ 100 % for a hot water storage ∣(𝑇𝑡 − 𝑇)∣ 𝑇 − 𝑇 ⋅ 100 % for a cold water storage [%] (4.28) Our modeling does not consider thermal losses via the exterior wall or transportation losses from the heat or cold generating devices to the thermal energy storage. 4.4.4 Combined Heat and Power Plant A combined heat and power plant (CHP) consists of an engine and a generator. The fuel used for driving the engine is usually natural gas or diesel. The engine drives the generator, which then generates electricity. During the combustion of the fuel, heat is generated, which can meaningfully be used to satisfy heating demands. CHPs are available in different sizes in terms of generation capacity. Use cases range from small residential houses up to large industrial facilities or the heating of whole city districts (via thermal district heating grids) [Wol14]. Simultaneously generating electricity and heat is also referred to as cogeneration. In contrast to pure fuel-based electricity generation, cogeneration represents a more efficient use of fuel because it allows for the productive utilization of heat arising from electricity generation, which otherwise would be wasted. By simultaneously generating both thermal and electric energy, CHPs achieve an overall efficiency of about 90 % [Qua20; ASU14]: usually out of the energy provided by the fuel (100 %), about 30 % can be converted to electricity and about 60 % to heat; the remaining 10 % are dissipation. This represents a relatively high overall efficiency compared to large and centralized conventional power plants. Large coal power plants, in contrast, have an electric efficiency of about 35–45 % as the accruing heat usually is lost and not meaningfully used to satisfy nearby heat demands [Qua20]. 101 Chapter 4 Modeling in the Context of a Grid-responsive FEMS 4.4.4.1 Operating Strategies & Flexibilization Potential The decision of how to operate a CHP depends on the heat and electricity demands that have to be satisfied. From the viewpoint of a CHP plant operator, a CHP’s profitability is determined by the alternative costs for electricity and heat, the feed-in compensation for electricity (and potentially heat), the fuel costs, the CHP plant’s runtime, and the procurement costs for the CHP plant. In the traditional view, with the absence of DSM incentives, CHPs are often only profitable if they run for a reasonably long time of the year. The two traditional operating strategies are as follows [ASU15; Zap15]: • Heat-driven: In the heat-driven operation, the on-site heat demand determines the runtimes of the CHP plant. The CHP plant is turned on to satisfy the heat demand, and the generated electricity is seen as a by-product. This is the most common operation mode, which is particularly useful if the local heat demand and buffer are limiting elements. • Electricity-driven: In the electricity-driven operation, the on-site electricity de- mand determines the runtimes of the CHP plant. The CHP plant is turned on to satisfy the on-site electricity demand. This is particularly useful if the primary goal is satisfying the local electricity demand. Incentives for this may be external electricity prices or grid fees based on peak loads. Traditionally, CHPs are dimensioned to run a reasonably long time of the year. For the dimensioning, the thermal load duration curve (in case of heat-driven operation) or the electric load duration curve (in case of electricity-driven operation) can be consulted. For profitability reasons, it is common to intentionally dimension the CHP plant too small to cover the entire on-site heat demand over the whole year and to use an additional peak load burner (i. e., a condensing boiler as presented in Section 4.4.5) to satisfy the high heat demand in winter. Considering the higher procurement costs for a larger CHP, the additional usage of a peak load burner usually turns out to be more profitable. The flexibilization potential concerning DA and aFRR market participation is as follows. As long as the heat generated by the CHP plant in one hour can be used or buffered in an appropriately dimensioned thermal storage, the related electric energy can be used to adjust the DA market schedule (i. e., probably to increase the facility’s overall schedule such that less electric energy has to be bought). The power scheduled via the DA market can be adjusted in both directions if the CHP is on and the chosen power level is between the minimum and the maximum. In cases where the CHP is operated together with a condensing boiler, the CHP plant’s generation can be decreased without further constraints as the condensing boiler can substitute the CHP’s heat generation. 102 4.4 Modeling of the Facility Side However, increasing the CHP plant’s generation requires a corresponding heat demand or a thermal storage that can buffer the heat generation coming with a full aFRR activation over four hours. In recent years, market participants targeting the aFRR optimization of on-site CHPs can be recognized [Nex19]. The implementation of traditional heat or electricity driven operating modes can be realized by solely reacting to local measurements. In a heat-driven operation, the flow and return temperature can be used to determine the heat demand. In an electricity- driven operation, the electric power demand can be measured. In contrast, the economic optimization incentivized by the DA and aFRR markets requires a predictive operating strategy interacting with the market side. Significant restrictions for such an economic optimization come from the requirement that the on-site heat demand always has to be satisfied and that only limited heat buffer capacity is available. Furthermore, power level adjustments may influence the CHP plant’s efficiency. 4.4.4.2 Formalization In this thesis, we consider a CHP with a stepwise controllable fuel consumption. It is modeled by the following parameter set: 𝒟chp = (𝜔, 𝑝fuel, 𝑝 fuel, 𝑛, 𝜂el(𝜆), 𝜂th(𝜆)) (4.29) The parameters are described in the following. The parameter 𝜔 ∈ ℕ+ describes the number of successive time steps for which the CHP plant can be either switched on or off. 𝑝fuel describes the minimum selectable fuel consumption (in W) if the CHP is on, and 𝑝 fuel describes the maximum selectable fuel consumption (in W) if the CHP is on. In order to satisfy practical limitations on the controllability, we assume that the CHP can be controlled in 𝑛 equally-distributed power levels between the minimum and maximum fuel consumption power (with the minimum and the maximum fuel consumption power being considered as one power level, too). A control band of about 50–100 % is common [ASU14]. The state of the CHP plant in time step 𝑡 can be described by Equation 4.30. In the later proposed optimization and evaluation the length of a time step is defined to be Δ𝑡 = 1 min. Our modeling, however, is independent of the time step length. 𝑠𝑡 = ⎧{ ⎨{⎩ 1 CHP is on 0 CHP is off (4.30) 103 Chapter 4 Modeling in the Context of a Grid-responsive FEMS t (min) Power ̅𝑝𝑝𝑓𝑓𝑓𝑓𝑓𝑓𝑓𝑓 0 0 𝒔𝒔𝒕𝒕 = on Control band when on Power delta 70 80 90 100 110 12060 Power level 𝜆𝜆=1𝑝𝑝𝑓𝑓𝑓𝑓𝑓𝑓𝑓𝑓 𝜆𝜆=5 𝜆𝜆=4 𝜆𝜆=3 𝜆𝜆=2 𝜆𝜆=0 Figure 4.3: The control band of a device as defined by its discrete power levels. We assume that the CHP plant can switch between the two states every 𝜔 time step, whereas in-between the CHP can be either on in all time steps or off in all time steps. This means the CHP is always on or off for a multiple of 𝜔 time steps: ∀𝑡 ∈ {0, 𝜔, 2𝜔, 3𝜔, … } ∶ ⎛⎜ ⎝ 𝑡+𝜔−1 ∑ 𝑡 𝑠𝑡⎞⎟ ⎠ ∈ {0, 𝜔} (4.31) If the CHP plant is in the state on, the fuel consumption can (in each time step) be stepwise regulated within a certain control band defined by the minimum and maximum fuel consumption. This is visualized in Figure 4.3 in which we assume 𝜔 = 60 min. In practice, smaller time frames for state changes (off to on and on to off) are possible depending on the concrete CHP. However, a high number of switching cycles may influence the CHP’s wear. When in the state on, the upper control band bound 𝑝 represents the maximum fuel consumption, and the lower control band bound 𝑝 the minimum: 𝑝fuel ≤ 𝑝fuel 𝑡 ≤ 𝑝fuel [W] (4.32) The regulation within the control band is possible in 𝑛 power levels, with 𝑛 ∈ {2, … , ∞} depending on the concrete CHP’s technical capabilities (in Figure 4.3, 𝑛 = 5 is assumed). In order to separate between the 𝑛 power levels in each time step 𝑡, we introduce the variable 𝜆𝑡 ∈ {0, … , 𝑛 − 1} for referring to the power level. We restrict the power level to 𝜆𝑡 = 0 in the state 𝑠 = 0 and to 𝜆𝑡 ∈ {1, … , 𝑛 − 1} in the state 𝑠 = 1. On this basis, the fuel consumption of a CHP can be calculated based on the power level: 104 4.4 Modeling of the Facility Side 𝑝fuel(𝜆) = ⎧{ ⎨{⎩ 𝑝fuel + (𝑝fuel − 𝑝fuel) ⋅ 𝜆+1 𝑛−1 if 𝑠 = 1 0 if 𝑠 = 0 [W] (4.33) Based on the combustion of fuel, the resulting electric output 𝑝el 𝑡 and thermal output 𝑝th 𝑡 can be calculated for each time step 𝑡. This is done analogously to the calculation of the fuel consumption. However, for both the electric and the heat output, the power level (𝜆𝑡) dependent energy conversion efficiency has to be considered. This power level dependent efficiency is provided by the function 𝜂el(𝜆) ∶ {0, … , 𝑛 − 1} → [0, 1] (fuel to electric) and 𝜂th(𝜆) ∶ {0, … , 𝑛 − 1} → [0, 1] (fuel to thermal). Both functions map a given power level 𝜆 to the related efficiency. Based on the power level dependent efficiency, the electric output 𝑝el and the thermal output 𝑝th can be calculated as follows: 𝑝el(𝜆) = ⎧{ ⎨{⎩ 𝑝fuel(𝜆) ⋅ 𝜂el(𝜆) if 𝑠 = 1 0 if 𝑠 = 0 [W] (4.34) 𝑝th(𝜆) = ⎧{ ⎨{⎩ 𝑝fuel(𝜆) ⋅ 𝜂th(𝜆) if 𝑠 = 1 0 if 𝑠 = 0 [W] (4.35) Consequently, the fuel energy delta, the electric energy delta, and the heat energy deltas arising from a specific time step 𝑡 can be described in dependence of the power level 𝜆𝑡 within this time step: Δ𝑒fuel 𝑡 = 𝑝fuel(𝜆𝑡) ⋅ Δ𝑡 [Wh] (4.36) Δ𝑒el 𝑡 = 𝑝el(𝜆𝑡) ⋅ Δ𝑡 [Wh] (4.37) Δ𝑒heat 𝑡 = 𝑝heat(𝜆𝑡) ⋅ Δ𝑡 [Wh] (4.38) Figure 4.3 shows that the delta between two consecutive power levels for the fuel consumption is constant: the fuel consumption is linear to the power level 𝜆𝑡. However, this is different for the (electric and thermal) output: the non-linearity introduced in Equation 4.34 (electric power output) and Equation 4.35 (thermal power output) between the power level 𝜆 and the power output results in the fact that the (output) power delta between two neighboring power levels can differ. In addition to the above technical restrictions, the degree of freedom for operating the CHP plant is restricted by the connected thermal storage. As described in Section 4.4.3, the thermal energy storage has to be operated in a certain temperature range (see Equation 4.27). It is heated up by the CHP and the condensing boiler (see Equation 4.22), 105 Chapter 4 Modeling in the Context of a Grid-responsive FEMS and cooled down by the facility’s uncontrollable final heat demand (see Equation 4.23). In the evaluation, we consider a CHP using gas as fuel. 4.4.5 Condensing Boiler Condensing boilers are (water) heaters usually fueled by natural gas or diesel. They burn fuel and use a heat exchanger to transfer the resulting heat energy to water, consequently raising the water temperature. In contrast to conventional boilers, condensing boilers extract additional heat from waste heat in flue gases by condensation of the water vapor, which otherwise would be lost [HG15]. Condensing boilers are commonly used in combination with CHP systems as it usually is not lucrative to dimension a CHP such that it can satisfy all heat demand peaks occurring over the year. Instead, driven by investment costs, CHPs are often dimensioned such that they only cover a share of the heat demand peaks, and condensing boilers are supplementarily used to cover the remaining demand [ASU15]. Therefore, condensing boilers operated in the context of CHPs are also referred to as peak load burners. A sufficiently dimensioned condensing boiler is able to substitute a CHP’s thermal generation. Today’s condensing boilers can achieve energy conversion efficiencies (natural gas to heat) of up to about 95–97 % [Vie19]. 4.4.5.1 Operating Strategies & Flexibilization Potential Condensing boilers usually follow a rule-based operating strategy that solely reacts to local measurements. The flow and return temperatures reflect the need for heat supply, which sets the basis for an on-off control: The condensing boiler is turned on as soon as a defined minimum temperature bound is reached and turned off as soon as a defined upper temperature bound is reached. The flexibilization potential of peak load burners concerning DA and aFRR market participation has already been addressed in the context of the CHP plant operation (see Section 4.4.4). It was shown that the condensing boiler’s capability to substitute the heat generation of a CHP is beneficial as it increases the potential of a CHP to provide negative balancing power (i. e., to be financially rewarded for offering to turn off the CHP). This is because condensing boilers may take over the heat production and hence guarantee the satisfaction of the final on-site heat demand independent of balancing power activation requests. Furthermore, an optimized scheduling may theoretically prefer the heat supply provided by the condensing boiler to the heat supply provided by the CHP as it allows the CHP to provide positive balancing power (i. e., to be financially rewarded for offering to turn on the CHP). However, in contrast to today’s operating 106 4.4 Modeling of the Facility Side strategies, the economic optimization incentivized by the DA and aFRR markets requires predictive operating strategies interacting with the market side. 4.4.5.2 Formalization We define a condensing boiler by the following parameter set: 𝒟condBoiler = (𝑝 fuel, 𝜂th) (4.39) The parameters are described in the following. 𝑝 fuel describes the maximum possible power value (W) up to which the condensing boiler can be controlled. Reflecting the relatively good controllability of condensing boilers (via a valve adjusting the fuel supply), we model condensing boilers as continuously controllable: 0 ≤ 𝑝fuel 𝑡 ≤ 𝑝 fuel [W] (4.40) The efficiency factor for the fuel-to-heat conversion of the condensing boiler is de- scribed by 𝜂th ∈ [0, 1]. It is assumed to be independent of the thermal storage’s temperature, which is a simplifying assumption. It is chosen due to the relatively small efficiency range mainly based on the return water temperature and only to a slight degree on the power level [Bal+17]. Consequently, the thermal power within a time step 𝑡 and the resulting energy delta can be calculated as follows: 𝑝th 𝑡 = 𝑝fuel 𝑡 ⋅ 𝜂th [W] (4.41) Δ𝑒th 𝑡 = 𝑝th 𝑡 ⋅ Δt [Wh] (4.42) We assume the condensing boiler to be sufficiently dimensioned (i. e., that 𝑝fuel is high enough) to cover the facility’s peak heat demand in any time step 𝑡. This means that in case of an empty thermal storage (i. e., when the minimum storage temperature is reached) and the absence of other heat-generating sources (i. e., when the CHP plant is off), the condensing boiler can be used to satisfy the heat demand such that the minimum thermal storage temperature is never undershot. In the evaluation, we consider a condensing boiler using gas as fuel. 4.4.6 Air Conditioning In the following, we model an air conditioning (AC) system to demonstrate how a device associated with the energy form cold can be integrated into the FEMS and the overall optimization. It is worth mentioning that, within this chapter, we present the 107 Chapter 4 Modeling in the Context of a Grid-responsive FEMS Exogenous cold demand (facility usage) Cold distribution Chiller with thermal cold storage tank Cold generation Cold demandHeat exchange Cold storage Thermal energy storage Electric energy Cooling coils Cooling tower Storage losses Transmission losses Total cold energy provided by environment + chiller Cold energy available after buffering Cold energy available after distribution Auxiliary electric energy Circulating Pumps Air Conditioning System Chiller Con- denser Eva- porator Figure 4.4: Components of a chiller-driven air conditioning system. interfaces and relations between different energy forms on a comprehensive systemic level. In contrast, in the quantitative in-depth evaluation of the proposed algorithmic optimization, we do not further consider the AC system in favor of a clear focus on the battery storage system and the CHP plant. The subsequently presented modeling addresses a central AC system as depicted in Figure 4.4. Such AC systems are commonly used for cooling purposes in commercial and industrial facilities [Alb18; Wan01]. They cool air (e. g., in office rooms) by circulating it through cooling coils that are filled with a circulating fluid which is distributed from a central (compression) chiller [Wan01]. The most common fluid for thermal storage and transfer is water [TBH09]. On the right side in the Figure, we see the space cooled down via coils filled with the circulating fluid, hence resulting in a “heat discharge” of the room. The depicted cold distribution circuit is driven by circulating pumps. The cooling coils use the circulating fluid delivered from the cold storage to cool down the space. This heats up the circulating fluid and consequently the thermal energy storage. The circuit left to the thermal energy storage is connected to the chiller, which uses electricity to remove heat from the circulating fluid via vapor compression to the outside environment, e. g., via cooling towers. Therefore, the chiller uses the condenser and evaporator, and a compressor driven by an electric motor [Wan01]. This way, the electricity-consuming chiller cools down the circulating fluid’s temperature and, consequently, the chilled water in the thermal energy storage. 108 4.4 Modeling of the Facility Side The system boundary of the modeled chiller is clarified in Figure 4.4. It is motivated by an abstracted scheme generalizing the variety of individual air conditioning system setups [KHT16]. It is worth noting that this is a simplified illustration: real AC systems are equipped with various pumps, and cooling circuits may be nested (e. g., for various cooling zones) or interlinked via controlling valves (e. g., for mixing the cold flow from the thermal energy storage with the untreated heat return from the cooling coils, or for bypassing the cold storage). Furthermore, different technical realizations of the chiller itself and different ways for combining heating, ventilation, and air conditioning (HVAC) as well as for cascading multiple chillers exist [Wan01]. Consequently, a wide range of different air conditioning systems fitting individual cooling needs can be found in practice. We assume the cold demand to the right of the cold storage tank (i. e., the facility’s cold demand, including transmission losses occurring during the distribution) as exogenously given (see Section 4.4.1). Accordingly, an optimization focusing on flexibilizing the runtime and power level of the chiller is meaningful. Due to the relatively small share of the electric energy required by auxiliary AC system components such as the circulating pumps, we do not further consider their electricity demand in our modeling. For describing the efficiency of chillers, the coefficient of performance (COP) is used. It describes the relation of the useful thermal power output to the required electric power input: 𝐶𝑂𝑃 = 𝑝th 𝑝el (4.43) In contrast to efficiency values, COP values can be larger than 1 ( ∧ = 100 %). This is due to the fact that a chiller (or a heat pump which is described using a COP, too) transfers heat from one place to another place, instead of just converting the electric power input to the thermal power output. Common COP values for chillers are in the range of about 3–5 [Yu+14; YH19; Alo+19]. This means that the chiller removes 3–5 kilowatt-hours of heat from the building’s air per 1 kilowatt-hour of electric energy provided to the chiller. Factors influencing the COP are presented in the following modeling. 4.4.6.1 Operating Strategies & Flexibilization Potential On a high level of abstraction, chillers are operated using an on-off operating strategy, potentially running in partial load. Depending on the cold demand derived from the flow and return temperatures, they start and stop cooling down the liquid medium in the cold storage circuit. If a specific maximum temperature bound is reached, the chiller starts operating, and if a specific minimum temperature bound is reached, it stops. The 109 Chapter 4 Modeling in the Context of a Grid-responsive FEMS decision for running in partial load may be based on the level of the overall cold demand. Further downstream components such as pumps and valves may be controlled based on additional measurements, e. g., of temperature and pressure. The flexibilization potential concerning DA and aFRR market participation is as follows. Participation in the DA market scheduling is possible as long as a power level can be kept for multiples of one-hour slots without violating the thermal cold storage’s minimum temperature. Depending on the power level scheduled via the DA market, the power level can theoretically be adjusted in both directions. However, providing aFRR must also be possible without violating the connected thermal storage restrictions in case of a full aFRR activation over four hours. The chiller’s ability to provide aFRR depends on the cold storage size and the cold demand. In contrast to the CHP and condensing boiler, cold generation can usually not be substituted. Therefore, to prevent thermal discomfort, only comparatively small power levels are possible for positive aFRR provisioning (i. e., for the provision to turn off the chiller). The economic optimization of the chiller based on the DA and aFRR market requires a predictive operating strategy interacting with the market side. Significant restrictions for such an economic optimization are similar to the ones the CHP plant has to deal with: the on-site cold demand always has to be satisfied, the cold buffer capacity is limited, and the decisions to adjust runtimes and power levels influence the efficiency. In addition to the CHP plant, the chiller’s efficiency (represented by the COP) depends on the temperature lift (as a chiller not solely converts the provided input energy but uses it to move existing heat). 4.4.6.2 Formalization We model an AC system’s chiller by the following parameter set: 𝒟chiller = (𝜔, 𝑝el, 𝑝el, 𝑛, 𝐶𝑂𝑃(𝜆, 𝜏)) (4.44) The parameters are described in the following. The parameter 𝜔 ∈ ℕ+ describes the number of successive time steps for which the chiller can be either switched on or off. 𝑝el and 𝑝el describe the minimum and the maximum power demand if the chiller is on, and 𝑛 describes the number of controllable power levels between 𝑝el (inclusive) and 𝑝el (inclusive). We chose this discretization to satisfy potential practical limitations on the controllability. The function 𝐶𝑂𝑃(𝜆, 𝜏) ∶ {0, … , 𝑛 − 1} × 𝕋 → ℝ+ describes a function representing the chiller’s COP. It is based on two inputs: the power level 𝜆 ∈ {0, … , 𝑛 − 1} and the reference temperature delta 𝜏 ∈ 𝕋 between the heat exchanger and the cold storage, measured in Kelvin. In an operational optimization, the temperature deltas 110 4.4 Modeling of the Facility Side used as input to the COP function will be discretized as the chiller’s COP usually is only available for selected temperature deltas. However, this discretization does not result from a technical limitation; instead, it is a simplification of the COP analysis motivated by the goal of being easily adaptable to different facilities with different chillers. Consequently, 𝕋 describes the set of all temperature deltas for which reference COP measurements are available, and 𝜏 ∈ 𝕋 [K] describes one specific reference temperature delta. The state of the chiller in minute 𝑡 can be described as: 𝑠𝑡 = ⎧{ ⎨{⎩ 1 Chiller is on 0 Chiller is off (4.45) We assume that the chiller can switch between the two states every 𝜔 time steps, whereas in-between the chiller can be either on in all time steps or off in all time steps (as in the case of the CHP plant, see Section 4.4.4). This means the chiller is always on or off for a multiple of 𝜔 time steps: ∀𝑡 ∈ {0, 𝜔, 2𝜔, 3𝜔, … } ∶ ⎛⎜ ⎝ 𝑡+𝜔−1 ∑ 𝑡 𝑠𝑡⎞⎟ ⎠ ∈ {0, 𝜔} (4.46) The possibility of state changes (off to on and on to off) differs depending on the concrete chiller. It may be possible in the areas of down to minutes; however, a high number of switching cycles may influence the chiller’s wear. The chiller’s COP is based on both the power level 𝜆𝑡 and the temperature difference 𝛿𝑡 between the heat exchanger and the cold storage. This temperature difference in time step 𝑡 is calculated as follows: 𝛿𝑡 = 𝑇heatExchanger 𝑡 − 𝑇thBuffer,cold 𝑡 [K] (4.47) where 𝑇heatExchanger 𝑡 is the temperature at the heat exchanger and 𝑇thBuffer,cold 𝑡 the temperature in the cold storage in time step 𝑡. Based on a given power level 𝜆 and a given temperature difference 𝛿, the chiller’s electric power consumption 𝑝el and its thermal power generation 𝑝th can be calculated as follows (the interpolated COP function 𝐶𝑂𝑃interpol(𝜆, 𝛿) is described below): 𝑝el(𝜆) = ⎧{ ⎨{⎩ (𝑝el + (𝑝el − 𝑝el) ⋅ 𝜆 𝑛−1 ) if 𝑠 = 1 0 if 𝑠 = 0 [W] (4.48) 𝑝th(𝜆, 𝛿) = ⎧{ ⎨{⎩ 𝑝el(𝜆) ⋅ 𝐶𝑂𝑃interpol(𝜆, 𝛿) if 𝑠 = 1 0 if 𝑠 = 0 [W] (4.49) 111 Chapter 4 Modeling in the Context of a Grid-responsive FEMS Consequently, the electric energy delta (consumption) and the thermal energy delta (generation) in a certain time step 𝑡 can be calculated as follows: Δ𝑒el 𝑡 = 𝑝el(𝜆𝑡) ⋅ Δt [W] (4.50) Δ𝑒th 𝑡 = 𝑝th(𝜆𝑡, 𝛿𝑡) ⋅ Δt [W] (4.51) The chiller’s COP is based on the power level 𝜆 and the temperature difference 𝛿 between the heat exchanger and the cold storage temperature. The COP function 𝐶𝑂𝑃(𝜆, 𝜏) used as input for the modeling of the chiller assumes discretized temperature deltas 𝜏𝑖 ∈ 𝕋. As already stated, this is due to the fact that a chiller’s COP is usually only known for selected temperature deltas. For a better understanding, the set of possible parameter combinations for the COP function 𝐶𝑂𝑃(𝜆, 𝜏) can also be depicted in the form of the following matrix: power level ⟶ ⎛⎜⎜⎜⎜⎜⎜ ⎝ ⎞⎟⎟⎟⎟⎟⎟ ⎠ 𝐶𝑂𝑃(0, 𝜏1) 𝐶𝑂𝑃(1, 𝜏1) … 𝐶𝑂𝑃(𝑛 − 1, 𝜏1) temperature delta ↓ 𝐶𝑂𝑃(0, 𝜏2) 𝐶𝑂𝑃(1, 𝜏2) … 𝐶𝑂𝑃(𝑛 − 1, 𝜏2) ⋮ ⋮ ⋱ ⋮ 𝐶𝑂𝑃(0, 𝜏|𝕋|) 𝐶𝑂𝑃(1, 𝜏|𝕋|) … 𝐶𝑂𝑃(𝑛 − 1, 𝜏|𝕋|) (4.52) At this 𝜏𝑖 describes the 𝑖-th reference temperature delta from the (ascending) sorted set 𝕋 with the available reference temperature deltas. Due to the practical limitation of the available COP reference measurements to |𝕋| temperature deltas, COP values between two available temperature levels (i. e., between two rows in one column in the matrix shown in Equation 4.52) can be interpolated. More concrete, the chiller’s COP for time step 𝑡 is either known due to available reference measurements or it can be interpolated if the temperature delta is in the range [min(𝕋), max(𝕋)]. However, an extrapolation below the minimum or above the maximum temperature delta does not seem realistic due to the unpredictable COP behavior outside the reference measurements. Therefore, the closest available COP value can be used in such cases. 112 4.4 Modeling of the Facility Side The interpolation function maps the power level 𝜆 ∈ {0, … , 𝑛 − 1} and the actual temperature delta 𝛿 ∈ ℝ [K] to the COP: 𝐶𝑂𝑃interpol(𝜆, 𝛿) = ⎧ { { { { { ⎨ { { { { { ⎩ 𝐶𝑂𝑃(𝜆, 𝛿) if 𝛿 ∈ 𝕋 𝐶𝑂𝑃(𝜆, min(𝕋)) if 𝛿 < min(𝕋) 𝐶𝑂𝑃(𝜆, max(𝕋)) if 𝛿 > max(𝕋) (𝐶𝑂𝑃(𝜆, 𝜏)+ if (𝛿 ∉ 𝕋)∧ (𝐶𝑂𝑃(𝜆, 𝜏) − 𝐶𝑂𝑃(𝜆, 𝜏)) ⋅ 𝛿−𝜏 𝜏−𝜏 ) (min(𝕋) < 𝛿 < max(𝕋)) (4.53) with 𝜏 ∈ 𝕋 representing the reference temperature delta (used for the COP mea- surement) below the temperature delta 𝛿, and 𝜏 ∈ 𝕋 the reference temperature delta above the temperature delta 𝛿 (which means 𝜏 = max({𝑥 ∈ 𝕋 ∣ 𝑥 < 𝛿}) and 𝜏 = min({𝑥 ∈ 𝕋 ∣ 𝑥 > 𝛿})). After providing a detailed understanding of the system environment of a FEMS, the following chapter analyzes the characteristics of the aFRR balancing market. 113 CHAPTER 5 Analysis of aFRR Activations In this chapter, we analyze the nature of aFRR activations. As balancing power is used to handle power schedule deviations that cannot be handled via electricity spot markets anymore, it is immanent to balancing power that the activation cannot be perfectly predicted. However, in the cases of aFRR and mFRR, the energy price of a balancing power bid determines the position in the merit order list, and hence the activation probability: a cheap balancing power bid is always more likely to be activated than a more expensive one. We start this chapter with a qualitative discussion of demand and supply uncertainties resulting in the need for balancing power. After understanding the fundamental reasons for balancing power activation, we use the aFRR modeling presented in Section 4.3 to map historical aFRR energy prices to the historical activation duration. The elaborated statistically expected aFRR activation duration within a given time frame in dependence of the aFRR energy price is used as input for the optimization presented in the next chapter. Furthermore, we analyze the related activation uncertainty from the viewpoint of a BSP, and the historical development of the relation between aFRR energy prices and aFRR activations. Finally, the chapter concludes with a discussion of how the gained insights can be used for the optimization of aFRR bids. Core contributions presented in this chapter have already been published in [Lös+18], as stated in the respective sections. 5.1 Uncertainties Resulting in the Need for Balancing Power In the following, we discuss factors with impact on the need for balancing power. Firstly, we look at technical reasons and, secondly, we look at the impact of major regulatory aspects. Finally, we discuss the expected development of the future need for balancing power. 115 Chapter 5 Analysis of aFRR Activations 5.1.1 Technical Reasons The generation of schedules for flexible generators and consumers (and trading at elec- tricity markets) is based on predictions of the expected feed-in and feed-out. Deviations from planned schedules to the actually realized schedules are common. The major technical reasons resulting in the need for balancing power are as follows (see [Con08]): • Demand side forecast errors: Forecast errors of the power demand result in devi- ations from planned schedules. In Germany, forecasting power demand schedules is either based on standard load profiles or registering power measurements. For forecasting the demand of consumers with a demand below 100 000 kWh/a, BRPs use standard load profiles [VB99] in quarter-hour granularity.1 For consumers above this threshold, BRPs use registering power measurement to monitor actual quarter hour profiles for improving the quarter-hourly procurement schedules and hence minimizing demand deviations. Self-consumption (e. g., via on-site PV or CHP plants, potentially coupled with local battery storage systems) and automated optimization of the energy consumption (e. g., according to external load-shifting incentives) increase the uncertainty in demand schedules and make accurate forecasts more complicated. Consequently, smart metering systems that provide more accurate consumption data allow minimizing forecast error. • Demand side noise: Average power deviations of the predicted quarter-hour power schedule from the actual quarter-hour power schedule are considered as forecast errors (as described above). In contrast, deviations of the actual power from the quarter-hourly average power are considered as noise. In other words, noise refers to the feed-out uncertainty within quarter-hour balancing group slots. Although stochastic averaging effects due to a large number of consumers in a grid decrease the noise within a quarter hour, it cannot be fully avoided. • Supply side forecast errors: Feed-in of renewable energy sources such as PV, wind, or hydro power relies on stochastic weather conditions. As the generation of respective supply schedules requires forecasts, these schedules are fraught with uncertainty, and deviations of the actual feed-in from these forecasts result in imbalances. Consequently, in particular the increasing share of volatile and uncertain generation of renewable energy resources on the overall power plant mix influences the level of forecast errors [HZ13]. 1See § 12 of the German Electricity Network Access Regulation (German: “Stromnetzzugangsverordnung” (StromNZV)). 116 5.1 Uncertainties Resulting in the Need for Balancing Power • Outages on the supply side: In particular the feed-in of electric energy can be subject to unexpected outages. Outages are manifold and can concern different grid resources such as power plants, transmission lines, or transformers. The age of grid equipment as well as its maintenance influence the probability of outages. In particular outages of large conventional power plants that are characterized by relatively high power capacities can have a high impact on the need for balancing power. Consequently, to be prepared for outages of large conventional power plants, relatively high balancing power capacities have to be reserved. • Schedule leaps between spot market time slots: Balancing group schedules are based on quarter-hour time slots (which, as of today, represent the finest product granularity at electricity spot markets). Depending on the technical unit, targeted power changes between two quarter hours do not immediately take effect, but follow a certain ramp. Power ramps occurring when increasing or decreasing generation or consumption result in schedule leaps, and hence feed-in and feed-out imbalances that have to be handled by balancing power. Noise is mainly handled by FCR, prediction errors are mainly handled by aFRR and mFRR, and longer lasting outages are mainly handled by mFRR. As already presented in more detail in Section 2.3.1, mFRR releases aFRR such that aFRR becomes available again for more short-term forecast errors, and aFRR releases PCR as PCR is required for quickly handling noise. 5.1.2 Impact of Regulation Technically, the need for balancing power is mainly caused by the above discussed reasons. In addition, regulation influences the demand for balancing capacity as follows: • Incentives to keep balancing groups balanced: BRPs should be incentivized to keep balancing group imbalances as low as possible. This can be reached economically by regulation that requires BRPs to pay for schedule imbalances in form of the imbalance energy price (reBAP, see Section 2.3.3). The higher the imbalance energy price, the higher the incentive for balancing responsible parties to improve forecast accuracy for minimizing schedule deviations. In case of imbalances that emerge early enough such that an intraday schedule adjustment still is possible, a BRP can eliminate or at least minimize the imbalance by trading at the intraday market. The price level of the imbalance energy price, and hence the resulting incentives for BRPs to keep their balancing groups balanced, can be controlled by adjusting its calculation method. In Germany, to better incentivize 117 Chapter 5 Analysis of aFRR Activations BSPs to actively counteract balancing group imbalances, the BNetzA adjusted the reBAP calculation method in 2020 (by coupling reBAP imbalance energy prices to spot market prices such that reBAP costs cannot be cheaper than spot market costs) [Bun20b]. • Control area size: Due to averaging effects, the potential for mutual compensa- tions of demand and supply side forecast errors increases with the control area size. For example, one balancing group may be overfed while another balancing group is underfed, hence resulting in a mutual compensation and a lower need for balancing power. Consequently, due to averaging effects, larger control areas need to hold back only a smaller share of the overall power capacity as balancing capacity (see Section 2.3.4 on the Grid Control Cooperation). • Definition of safety level: One way to represent the safety level of balancing power provision is by means of a metric representing the timely share (e. g., over a year) in which the required balancing power is allowed to be higher than the balancing capacity procured by the TSOs. If the grid frequency cannot be hold at the acceptable level via balancing power measures, the backup scheme presented in Section 2.3.6 is used. In Germany, in addition to balancing power, the German Ordinance on Agreements on Disconnectable Loads2 allows to additionally dis- connect so called “disconnectable loads” or “fast disconnectable loads”. Adjusting the timely share in which the actually required balancing power is allowed to be higher than the purchased balancing capacity indirectly influences the balancing demand. 5.1.3 Outlook on Future Development As of today, conventional power plants still provide a significant share of balancing power [Deu20f]. Due to the replacement of nuclear and coal power plants by renewable power plants, multiple adjustments of balancing market conditions to facilitate the integration of renewables have already been made in recent years, as already discussed in detail in Section 2.4.4.3. The further development of the demand for balancing power (by TSOs) and the supply of balancing power (by BSPs) will be influenced by the above discussed technical and regulatory aspects. Table 5.1 discusses current developments that can be recognized as crucial for the demand and supply of balancing power. Out of the shown factors, studies in particular expect the variability and/or uncertainty of renewable generation to be responsible for an increased need for balancing 2German: “Verordnung über Vereinbarungen zu abschaltbaren Lasten” (AbLaV) 118 5.2 Implications of aFRR Energy Prices Choices Table 5.1: Influences on balancing power demand and supply; based on [Deu13; ASH15] and enriched by further factors. (a) Balancing power demand Factors influencing the balancing power demand Direction •Increasing share of fluctuating renewable energy sources demand ↑ •Increasing share of uncertain loads introduced by electric mobility •Increasing scope of the Grid Control Cooperation demand ↓ •Increasing short-term intraday trading volume •Increasing forecasts quality of renewable feed-in •Increasing insights into demand side behavior via smart metering systems (b) Balancing power supply Factors influencing the balancing power supply Direction •Decreasing product time slots and minimum required power levels supply ↑•Increasing market entrance of new BSPs due to lower barriers and pooling •Increasing share of conventional power plants operated in partial load •Increasing share of grid bottlenecks and need for grid expansion supply ↓ power capacities [HZ13; EMK11]. Furthermore, variable renewable energy sources are expected to change the relation between available balancing power capacities on the one hand, and their activation on the other hand [Agr+14]. However, balancing power capacities that are required by the TSOs and offered by BSPs, as well as their activation and the overall balance, are difficult to quantify. This is aggravated by the presence of different temporal granularities of balancing services (FCR, aFRR and mFRR) and different balancing power directions (negative, positive). In the end, the balance of the factors presented in Table 5.1 will determine the future price levels at the different balancing market segments. 5.2 Implications of aFRR Energy Prices Choices After we have seen that multiple stochastic (and by nature not perfectly predictable) reasons for the activation of aFRR exist, we subsequently analyze the impact of the aFRR energy price onto the share of balancing power bid activations and derive the revenue potential. Figure 5.1 visualizes the aFRR demand (of the GCC) over an exemplary 15-minute time slot and shows the activation times of three exemplary BSPs whose 119 Chapter 5 Analysis of aFRR Activations activation according to MOL activation according to MOL cheap bids Positive aFRR expensive bids cheap bids expensive bids Negative aFRR-300 -200 -100 0 100 200 300 13:15 13:3013:20 13:25 Time (exemplary quarter hour extract)aFRR power demand (MW) BSP 3 („high“ EP) BSP 1 („low“ EP) BSP 2 („medium“ EP) Figure 5.1: Activation of three exemplary aFRR bids with different aFRR energy prices (EP) based on the TSO’s aFRR power demand. aFRR bids are characterized by a “low”, a “medium”, and a “high” aFRR energy price. It can be seen that activation depends on the position within the aFRR energy price merit order as bids with low energy prices are always activated prior to bids with high energy prices. In recent years, aFRR market conditions were subject to multiple changes. As already explained in Section 2.4.4.3, the change of tendering periods and time slot sizes, the introduction of the mixed-price mechanism (which was rolled back within a year after its introduction), or the introduction of additional aFRR energy auctions came along with weighty changes to either the market interface or the behavior of market participants. The limitation of the time spans quantitatively investigated within this section results from our focus on the assumptions and modeling presented in Section 4.3. During the realization of this thesis, key aspects of this section on the implications of aFRR energy price choices have already been published in [Lös+18]. Large parts of the rest of this section are taken verbatim from this publication, including Figure 5.2. 120 5.2 Implications of aFRR Energy Prices Choices 10 20 30 40 50 60 70 80 90 100 0 -40 -20 0 20 40 60 80 100 120 140 160 aFRR energy price (EUR/MWh)Annual share of activations (%) Year 2012 2013 2014 2015 2016 Direction NEG POS (a) Annual share of aFRR bid activations for different aFRR energy prices based on continuous 1 MW bids. -150 -100 -50 0 50 100 150 200 250 -40 -20 0 20 40 60 80 100 120 140 160 aFRR energy price (EUR/MWh)Annual activation-based revenue (kEUR) Year 2012 2013 2014 2015 2016 Direction NEG POS (b) Annual activation-based revenue for different aFRR energy prices based on continuous 1 MW bids, derived from the annual share of aFRR bid activations shown in the left chart. Figure 5.2: Impact of aFRR energy prices on aFRR bid activation and the related activation- based revenues; based on the modeling and data sources presented in Section 4.3. 5.2.1 aFRR Activations Based on the ex-post aFRR simulation introduced in Section 4.3, we analyze impacts of the choice of the energy price as well as their historical developments. Assuming a continuous 1 MW aFRR bid in each weekly auction of the years 2012–2016, Figure 5.2a shows the relation between the energy price and the share of activations over the respective whole year. We distinguish between positive balancing power (blue line) and negative balancing power (red line); differences between peak and off-peak products3 are not further investigated in this thesis. It can be understood that, over any auction period, a cheap balancing power bid is always activated for at least the same duration as a more expensive bid. The figure shows that a positive balancing power bid with an exemplary energy price of 50 EUR/MWh would have been activated 25% of the year 2016, whereas a negative balancing power bid with the same price would have been activated 5% of the same year. Further, it can be recognized that for negative balancing power the cheapest energy price bids are negative (i. e., direction of payment not from TSO to BSP, but from BSP to TSO). This is due to the fact that balancing power traditionally is provided by power plants, and negative balancing power corresponds to ramping down their generation 3German: “Haupttarif (HT), Nebentarif (NT)” 121 Chapter 5 Analysis of aFRR Activations which results in the avoidance of fuel costs. The curve for positive balancing power does not contain any negative balancing power prices as power plants providing positive balancing power have to pay additional fuel costs to increase their power output. Hence, from the viewpoint of the TSOs, negative balancing energy can be seen as cheaper than positive balancing energy. It can also be recognized that the cheapest negative and the cheapest positive balancing power bid of each year, i. e., the two leftmost data points, sum up to a share of activations of approximately 100%. This means that the cheapest balancing power bid of each direction has (almost) always been activated in case of respective grid needs (while, e. g., in year 2016 positive balancing power was activated more often). 5.2.2 aFRR Revenue Potential Given the goal of ex-post analyzing the impact of the energy price choice, it is assumed that an examined balancing power bid is added into the existing merit order list. In retrospect, a fictional balancing power bid with an energy price cheaper than the actually occurred cheapest balancing power bid would have been activated prior to it, resulting in the same share of activations.4 Based on this assumption, Figure 5.2b shows the energy price based balancing power revenues that could have been realized by a BSP that bids 1 MW of positive balancing power (blue line) or 1 MW of negative balancing power (red line) with the same energy price for all weekly auctions in the respective year. For each aFRR product 𝑖, the revenue is calculated as follows (with 𝑝aFRR representing the offered aFRR power, Δact t representing the activation time, and 𝜋aFRR,energy representing the aFRR energy price): Activation-based revenue [EUR] = 𝑝aFRR 𝑖 ⋅ Δact t,𝑖 ⋅ 𝜋aFRR,energy 𝑖 (5.1) As the activation of bids follows the energy price MOL, the following essential trade-off in optimizing an aFRR bid’s energy price can be recognized. A higher energy price increases the revenue per time unit, however results in a shorter activation time. A lower energy price decreases the revenue per time unit, however results in a higher activation time. In Figure 5.2b it can be recognized that with an increase in the energy price, the balancing power revenue first increases until a peak is reached, then it decreases. During the incline left to the peak, a higher energy price increases revenues because the energy price outweighs the lower activation time. After the peak, a higher energy price 4Represented graphically, this means that the curves in Figure 5.2a could be continued horizontally on their leftmost point, till -∞. 122 5.2 Implications of aFRR Energy Prices Choices decreases the revenues because the lower activation time outweighs the higher energy price. 5.2.3 Historical Development Figure 5.2a additionally shows the development of the share of activations of a con- tinuous 1 MW bid in the years 2012–2016. When looking at a certain energy price, a clear tendency to a decreased share of activations for positive balancing power can be recognized. It can be seen that a positive balancing power bid with an energy price of 100 EUR/MWh was activated 20% of the year 2012, over the years decreasing down to 5% in the year 2016. From the TSO viewpoint, the left-shift of the activation share curves represents decreased costs for a certain amount of balancing energy. Consequently, over the last years, the decreased share of activations for given energy prices resulted in decreased aFRR revenues for BSPs. Assuming a continuous bid of 1 MW in each single weekly auction, the development of the annual energy price based aFRR revenues is depicted in Figure 5.2b. Various factors are responsible for the visualized changes in the relation between energy price and the share of activations. Subsequently, we discuss four major factors (whereby it has to be noted that, traditionally, the largest share of BSPs is found on the generation side): • Fuel costs: Traditionally, costs for satisfying balancing power activations are mainly fuel-related. A separation can be drawn between positive and negative aFRR. For the provision of positive aFRR, a flexible power plant has to increase its power output, and hence the operator is motivated to set the energy price such that at least the additional fuel costs are covered in case of an activation of her aFRR bid. Over the last years decreasing fuel costs result in a tendency to lower aFRR energy prices and to shift the activation share curve for positive balancing power to the left. For the provision of negative aFRR, a flexible power plant has to decrease its power output, which results in fuel cost savings for the operator. Hence, as negative balancing power providers could save less fuel costs, there was a decreased willingness to pay for activations of negative balancing power bids, hence increasing aFRR energy prices and shifting the activation share curve for negative balancing power to the right. • Competition between aFRR providers: It can clearly be recognized that the number of prequalified aFRR providers significantly increased over the last years [Deu19b]. In a competitive market under otherwise equal conditions, the higher amount of competitors tends to lower aFRR energy prices and hence to shift both 123 Chapter 5 Analysis of aFRR Activations activation share curves to the left. However, this is attenuated by the subsequently described strategic bidding behavior and the fact that aFRR providers benefit from capacity prices as additional income component. • Strategic bidding behavior of aFRR providers: Analyzing single aFRR bids (independent of whether they are activated or not) shows that the power-weighted energy prices of bids have increased during the last years for both positive and negative balancing power [OEO18]. This may be explained by strategic market participants that are deliberately trying to place their bids at the end of the energy price MOL in order to avoid activations while still earning the capacity price. To some degree, an increase in strategic aFRR bids tends to increase aFRR energy prices and hence to shift both activation share curves to the right. In 2020, the intraday aFRR energy auctions were introduced to counter the impact of strategic bids due to a higher energy price competition [Bun17c]. • aFRR demands by TSOs: Mainly due to the increased quality of feed-in forecasts, the weekly aFRR demand procured by the TSOs has slightly decreased over the last years [HZ15]. In a properly functioning aFRR market with a stable number of market participants, the lower aFRR demand tends to lower aFRR energy prices and hence to shift both activation share curves to the left. Predictions, however, show that an increasing share of renewable energy resources, potentially may turn this trend around within the next decades [Agr+14]. The above discussed trends contributed significantly to the development of aFRR activation shares and the aFRR revenue potential as visualized in Figures 5.2a and 5.2b. 5.3 Uncertainty of aFRR Activations In the previous sections, the impact of the aFRR energy price on the activation share (Figure 5.2a) as well as on the activation-based revenue (Figure 5.2b) was analyzed on a one-year basis. As refinement of this, Figure 5.3 shows a box plot diagram for selected aFRR energy prices. It is based on all four-hour slots (which represents today’s product time slot size at the aFRR market; see Section 4.3.1) of the exemplary year 2016 and shows the distribution of the timely shares of aFRR activations. Each data point represents the activation share within one four-hour slot. Consequently, from the viewpoint of a BSP, the box plot diagram shows the actually experienced activation uncertainty when bidding a certain aFRR energy price. In this context, it is worth mentioning that a BSP must be able to always deliver a full activation over the full product slot, independent of the historically experienced activation share. 124 5.3 Uncertainty of aFRR Activations 0 10 20 30 40 50 60 70 80 90 100Relative activation share of 4-h product (%) -20 -10 0 10 20 30 40 50 60 70 80 90 100 110 120 130 140 150 aFRR energy price (€/MWh) (a) Negative aFRR 0 10 20 30 40 50 60 70 80 90 100Relative activation share of 4-h product (%) -20 -10 0 10 20 30 40 50 60 70 80 90 100 110 120 130 140 150 aFRR energy price (€/MWh) (b) Positive aFRR Figure 5.3: Distribution of historically experienced aFRR activation shares given a certain aFRR energy price: each data point represents the percentage activation share within a four-hour aFRR product slot; data basis is all four-hour slots of the year 2016, based on the modeling presented in Section 4.3. We start with a closer look at negative balancing power (Figure 5.3a). It can be seen that for high energy prices above 60 EUR/MWh the activation share turned out to be below 2 % or 4.8 min of a four-hour slot for more than 75 % of all four-hour slots of the year. Furthermore, it can be seen that the interquartile range (i. e., the 50 % area between the lower and the upper quartile) decreases with an increasing aFRR energy price. From the viewpoint of an BSP this means that the certainty to be activated for a certain time share increases with higher aFRR energy prices. This can be explained by the fact that aFRR bids are activated more seldom/shorter the closer they are located at the end of the aFRR energy price merit order. As expected, bids with rather low aFRR energy prices are activated more often/longer. It can be seen that the activation shares of bids that are located closer to the beginning of the aFRR energy price merit order were more distributed over the different four-hour slots. For example, the median activation of a bid with a relatively low energy price of 10 EUR/MWh is about 7 min (3 %) within a four-hour slot, where in 75 % of all investigated four-hour slot the bid’s activation lies between 34 min (14 %) and 0 min. Now, we take a closer look at positive balancing power (Figure 5.3b) where the situation is similar. Again, it can be seen that the distribution of the activation shares is relatively low for high energy prices. For example, bidding an energy price above 100 EUR/MWh resulted in an activation share below 2 % or 4.8 min of a four-hour slot in more than 75 % of all four-hour slots of the year. Again, it can also be seen that the the 125 Chapter 5 Analysis of aFRR Activations activation uncertainty a BSP is faced with (which can be represented by the interquartile range representing the 50 % area between the lower and the upper quartil) decreases with higher aFRR energy prices. Furthermore, it can also be seen that bids with rather low aFRR energy prices are activated more often and with a higher uncertainty. For example, the median activation of a bid with an energy price of 30 EUR/MWh (i. e., a bid located close to beginning of the aFRR energy price merit order) was about 2 h 29 min (62 %) of an four-hour slot, where in 50 % of all investigated four-hour slots the bid’s activation was between 1 h 41 min and 3 h 0 min (42–75 %). The reason why the box plots for energy prices below 30 EUR/MWh do not differ is caused by the fact that we take the viewpoint of the aFRR provider: our ex-post simulation integrates an aFRR bid that should be examined into the historically experienced aFRR energy price merit order (see Section 4.3). Consequently, if a BSP had submitted an aFRR bid with an energy price below the historically lowest occurred energy price, it would have been added prior to the original bid, and hence always be activated as often as the cheapest bid. For both balancing directions, we can see outliers resulting from the stochastic nature of aFRR activation. It can be recognized that their absolute impact is minimized with increasing aFRR energy prices. This can be explained by the fact that higher aFRR energy prices are closer to the end of the merit order list, and are hence by nature activated less often. Furthermore, it is worth mentioning that an increasing competition at the aFRR market resulted in the rather steep decrease of the relative activation share with increasing aFRR energy prices. In the above discussion of the historical development over the years, we already showed that the decrease of the activation share coming with higher aFRR energy prices historically used to be more flat. In addition to the aFRR energy price, further features with influence on an aFRR bid’s activation can be recognized. They can be used to minimize the activation uncertainty a BSP is faced with when bidding a certain aFRR energy price. In [Spa15] and [Hol16] we ex-post investigated the impact of the time (month of year, hour of day) on the relationship between aFRR energy prices and related aFRR activations. It was shown that certain patterns can be recognized, e. g., between peak and off-peak tariff slots. In [Wag17] we investigated the potential of additionally (to the aFRR energy price) considering data from the ENTSO-E transparency platform (such as spot market trading volume, or renewable feed-in) to predict aFRR activation shares by using the machine learning techniques Random Forests and Gradient Boosting. In [Wag17], out of the investigated features, the most relevant ones for increasing the prediction quality of the activation share (of four-hour aFRR slots) turned out to be the respective aFRR energy price’s activation share from the prior week, the spot market day-ahead base volume and the spot market day-ahead base price. It was shown that the confidence interval of 126 5.4 Provisioning of Balancing Services via the Demand Side a certain aFRR energy price’s activation share (within a four hour aFRR slot) could be significantly improved when additionally considering these features. However, as the optimization scheme presented in this work is generically independent of the concrete input data, we do (due to focus reasons) not provide a more detailed quantitative discussion of additional features that influence the aFRR activation. Within this thesis, we focus on the relation between aFRR energy prices and aFRR activations. 5.4 Provisioning of Balancing Services via the Demand Side Traditionally, balancing services are provided by generators on the supply side [Deu20f]. In recent years, the share of alternative BSPs located on the demand side increased. Providing balancing power via consumers or generators that are located on-site at traditional demand side entities comes along with two major challenges. Firstly, aFRR activations may result in balancing groups imbalance, and the BRP and the BSP may be different entities. Secondly, aFRR activations may result in later catch-up effects. In the following, these two challenges are discussed in more detail. 5.4.1 Balancing Group Allocation Final consumers that want to provide balancing power are usually located within the balancing group of their electricity supplier. Consequently, balancing power activations have an impact on the balance of the supplier’s balancing group (and hence its reBAP imbalance costs). With the rise of demand-side BSPs and related questions, the BNetzA defined that electricity suppliers have to allow final consumers allocated to their balanc- ing groups to provide aFRR and mFRR [Bun17e]. With the introduction of a so called “corrected model”, the BNetzA states that the aFRR activation energy can be subtracted from the BRP’s balancing group. This in particular means that a BRP does not have to deal with balancing group deviations directly caused by balancing power activations within its balancing group. To correct the balancing group schedules accordingly after an activation, a schedule exchange between the BSP and the BRP is required (according to the BNetzA, the BRP may charge the BSP for this service). In practice, the BSP may be an aggregator instead of the final consumer himself. Therefore, the definition of the market communication in context of the “corrected model” [Bun17e] allows that the energy delta directly resulting from a aFRR/mFRR activations of a final consumer that is allocated to its electricity supplier’s balancing group, does not result in monetary disadvantages for the respective BRP. However, in addition to direct schedule adjustments 127 Chapter 5 Analysis of aFRR Activations t Power Acti- vation t Power Acti- vation (a) Traditional BSP on the supply side: balancing power activation has no impact on future power schedule t Power Acti- vation t Power Acti- vation Catch-up effect Catch-up effect (b) Alternative BSP on the demand side: balancing power activation may result in future power schedule adjustments (catch-up effect) to satisfy on-site needs Figure 5.4: Balancing power provision via alternative BSPs resulting in catch-up effects. of aFRR activations, activations may also have temporal delayed impacts on schedules, hence potentially resulting in future balancing group imbalances as described in the upcoming section. 5.4.2 Catch-up Effects The activation of balancing power has no impact on the further power schedules for traditional generators. However, for consumers or generators on the demand side, balancing power activations may result in catch-up effects5. Catch-up effects describe power schedule adjustments that are required to satisfy on-site needs after unplanned schedule adjustments due to the activation of balancing power [50H+16]. Such on-site needs may, e. g., be the heat demand satisfied by a combined heat and power plant, the cool demand satisfied by an air conditioning unit, or the mobility demand satisfied by an electric vehicle. If, for example, a CHP plant was turned off for a quarter hour due to a negative balancing power activation, this comes along with a lack of heat generation within this quarter hour. Therefore, as the on-site heating demand still has to be satisfied, this may have an impact on the CHP runtime resulting in the fact that the CHP later may run a quarter hour longer than originally expected. Potential implications of balancing power activations in form of catch-up effects are visualized in Figure 5.4. The left side visualizes the power schedule of a traditional BSP, i. e., a generator on the supply side. It can be seen that a reverse activation has no further impact on the power schedule. 5German: “Nachholeffekte” 128 5.4 Provisioning of Balancing Services via the Demand Side The right side visualizes an alternative BSP located on the demand side. It can be seen that a balancing power activation may have further impact on the power schedule: the quantity of energy which was increased/decreased due to the activation, may later be decreased/increased in order to satisfy the local on-site needs. However, it is difficult to state how exactly (power and energy dimension) a catch-up effect and its implication on involved parties will look like. Therefore, the German Federal Ministry for Economic Affairs and Energy6 (BMWi) accompanied a stakeholder consultation regarding the handling of catch-up effects [50H+16]. As result, among others, the introduction of three classes of catch-up effects has been proposed for further analysis [50H+16]: • Class 1: No catch-up effect In this class, it was suggested that a white list should name processes that do not result in catch-up effects. This may in particular be industrial generation units that are continuously operated at a high utilization rate, or heat processes that can be substituted. • Class 2: Catch-up effect within 24 to 48 hours This class was suggested as default class if neither Class 1 nor Class 3 do fit. In this case, it is assumed that balancing power activation results in schedule adjustments within the same day or within up to the next day. It was suggested that directly after the activation, an updated schedule for this time span should be provided by the BSP to the BRP. Hence, depending on the time of activation the schedule will cover between 24 and 48 hours. Based on this updated schedule, the BRP can adjust its trading activities at the spot markets to keep its balancing group balanced. • Class 3: Catch-up effect within 12 hours This class was suggested for BSP that can demonstrate that catch-up effects always occur within 12 hours after the activation. In this case, the updated power schedule can always be limited to this time frame. As of today, regulation does not explicitly consider the handling of implications of catch-up effects [Bun17e]. This can be explained by the fact that demand-side BSPs are still the minority, and as the largest share of BSPs is located on the traditional supply side [Deu20f]. However, the fact that catch-up effects bring a high uncertainty into the power schedule of the corresponding balancing group is recognized as a problem by both, industry [50H+16; Deu16] and the regulator [Bun17e]. Therefore, the importance of properly managing catch-up effects is assumed to increase with a rising number of 6German: “Bundesministerium für Wirtschaft und Energie” (BMWi) 129 Chapter 5 Analysis of aFRR Activations BSPs on the demand side. This is confirmed by the BNetzA, which explicitly states that there are only limited experiences regarding the impact of catch-up effects. Quantifying catch-up effects is a challenging task as they are not only based on technical parameters, but also on economic decisions of the final consumer, thus requiring further analyses by the energy industry [Bun17e]. Consequently, the BNetzA states that further insights are required to decide about potential regulatory measures aiming at obligating final consumers to manage catch-up effects in the aftermath of balancing power activations [Bun17e]. 5.5 Utilization of Insights for the Optimization of aFRR Bids Above, we showed that the choice of the aFRR energy price has a great impact on the bid’s activation. We also examined a BSP’s revenue potential through aFRR activations and discussed challenges for demand-side BSPs. Based on these insights, this section discusses three major aspects that have to be considered when optimizing the aFRR energy price of a demand-side BSP: 1. Activation costs: The profit of a BSP results from the aFRR revenues minus the actual aFRR activation costs that the BSP has to bear for fulfilling the activation. Consequently, profit-seeking BSPs have to consider their actual aFRR activation costs in the bid generation. 2. Opportunity costs: A BSP’s commitment to hold back a certain flexibility for aFRR provisioning limits its freedom for spot market based scheduling. Consequently, BSPs striving for profit maximization should consider opportunity costs at spot markets. 3. Catch-up effects: Demand-side BSPs are characterized by catch-up effects, i. e., implications of aFRR activations on future loads. Consequently, in order to satisfy local on-site needs (electricity, heat, cold) and to fulfill the responsibility to keep the balancing group balanced at any point in time even after an aFRR activation, demand-side BSPs should consider catch-up effects already in the bid generation. When addressing these aspects, BSPs can use the elaborated relation between an aFRR bid’s energy prices and its activation for their benefit. In the following, we discuss the three aspects in more detail. 130 5.5 Utilization of Insights for the Optimization of aFRR Bids 5.5.1 Consideration of aFRR Activation Costs During the realization of this thesis, key aspects of this section on aFRR activation costs have already been published in [Lös+18]. Large parts of the rest of this section are taken verbatim from this publication, including Figure 5.5. Activation costs may be positive in case of real costs, or negative in case of savings. Considering activation costs, a BSP’s activation-based aFRR profit for each aFRR product 𝑖 can be calculated as follows (with 𝑝aFRR representing the offered aFRR power, Δact t representing the activation time, 𝜋aFRR,energy representing the aFRR energy price, and 𝜋act representing the activation price (EUR/MWh) a BSP has to pay in case of an aFRR activation7): Activation profit [EUR] = 𝑝aFRR 𝑖 ⋅ Δact t,𝑖 ⋅ 𝜋aFRR,energy 𝑖 − 𝑝aFRR 𝑖 ⋅ Δact t,𝑖 ⋅ 𝜋act 𝑖 (5.2) In the case of traditional BSPs, positive balancing power requires ramping up a power plant resulting in additional fuel costs (i. e., positive activation costs), and negative balancing power requires ramping down a power plant resulting in fuel savings (i. e., negative activation costs). For illustration, we subsequently stick with this traditional scenario, although the presented results can also be applied to technical units where the composition of activation costs may be significantly different, such as in the case of aFRR-providing demand-side units. Given the traditional scenario of a power plant, Figure 5.5 shows the annual activation-based aFRR profits after subtracting the accruing activation costs in form of fuel costs (i. e., positive activation costs for positive balancing power, and negative activation costs for negative balancing power). The graph shows results for four different fuel costs again assuming continuous bids of 1 MW for all products in all weekly auctions in year 2016.8 It is visible that activation costs greatly influence a BSP’s profits, and that the energy price to achieve maximum profit varies depending on the activation cost. For positive balancing power, higher fuel costs lead to a shift of the profit curve to the right as higher energy prices are necessary to generate profits. Furthermore, the profit curve for positive balancing power is flatter with higher fuel costs as less profit is generated per activated time unit. For negative balancing power, higher fuel costs lead to a shift of the curve to the left as they can be saved when being activated, hence allowing for profits with lower energy prices. In addition, the profit curve for negative balancing power gets more steep with higher fuel costs as higher savings can be achieved per activated time 7The activation price may, e. g., reflect the price for additionally required fuel in case of a generator. 8Activation costs of 0 EUR/MWh represent the scenario discussed in Section 5.2 (which focuses on pure revenues resulting from aFRR activation). 131 Chapter 5 Analysis of aFRR Activations -200 -150 -100 -50 0 50 100 150 200 -60 -40 -20 0 20 40 60 80 100 120 140 160 aFRR energy price (EUR/MWh)Annual activation-based profit, consideringadditional or saved fuel costs (kEUR) Fuel costs (EUR/MWh) 0 20 40 60 Direction NEG POS Figure 5.5: Annual activation-based profit for different aFRR energy prices after considering different activation costs, based on continuous 1 MW bids over the whole year 2016; in the traditional case of aFRR provisioning via a power plant, activation costs represent additional fuel costs (for positive aFRR) or fuel cost savings (for negative aFRR). unit. This example illustrates the importance of incorporating individual activation cost when placing bids at the aFRR market. It demonstrated how the presented simulation of historical aFRR bid activations as well as the derived insights regarding the relation between energy prices and the activations can be utilized to increase aFRR profits. 5.5.2 Consideration of Opportunity Costs: Trade-off Between aFRR and Spot Market Demand-side devices have to be operated for a certain share of the time in order to satisfy the local on-site needs. Generated energy (in the case of, e. g., CHP plants) or consumed energy (in the case of, e. g., a chiller) has impact on the aggregated load schedule (of the facility). In our scenario the required energy is bought via the DA spot market. Consequently, generating an aFRR bid (composed of aFRR capacity and energy price) has to consider the opportunity costs at the DA spot market. Runtime, power level and the offered capacity have to simultaneously weigh up between the day-ahead spot market (decision per one-hour slot) and the aFRR market (decision per four-hour slot). An aFRR bid requires holding back the potential to adjust the power up- and/or downwards. Consequently, offering upwards balancing power, price valleys at the DA market cannot be fully utilized. Alternatively, offering downwards power, price peaks 132 5.5 Utilization of Insights for the Optimization of aFRR Bids aFRR activation (decreased power) Catch-up effect (increased power) t Power p Power schedule Expected aFRR activation ① ② ②① ③ p Additional purchase (expected catch-up effect) ③ t SOC SOC Resulting SOC SOC ① Day-ahead spot market based power: The power level can be optimized in one-hour granularity based on predicted day-ahead spot market prices and aFRR opportunity costs. ② aFRR capacity and aFRR energy price: The offered aFRR capacity and aFRR energy price can be optimized depending on spot market opportunity costs, where the choice of the aFRR energy price allows steering towards a desired aFRR activation share. ③ Catch-up effects: aFRR activations can result in an excess or shortage of energy, which can already be considered in the optimization of ① and ②, in order to always satisfy local needs and to fulfill the responsibility to keep the balancing group balanced. Figure 5.6: Optimization of aFRR energy prices: demand-side aFRR providers are faced with opportunity costs and catch-up effects; opportunity costs address the trade-off between opportunities at the aFRR balancing market and the spot market; catch-up effects address the responsibility to always satisfy local needs and to keep the balancing group balanced. at the DA market cannot be fully avoided. Both result in lower cost savings at the DA market, also referred to as opportunity costs. Opportunity costs describe the loss of potential cost savings (via the DA market or the aFRR market) when one particular alternative is chosen over the other. Consequently, when aiming at profit maximization, it is essential to simultaneously weigh up between the two market opportunities. The change from weekly aFRR auctions with peak and off-peak tariff slots to daily auctions with four-hour time slots during the course of this thesis, makes this decision more dynamical and considerably increases the scope for decision making, in particular for demand-side BSPs. Traditional aFRR providers (i. e., power plants that are operated for satisfying external demands) are faced with this challenge, too, but only to a limited degree. While traditional power plant operators have to weigh up between which power level to provide to the day-ahead market and which power level to provide to the aFRR market, they do not have to additionally consider the local on-site energy needs that have to be satisfied (and which are flexible, e. g., due to local buffer storages). 133 Chapter 5 Analysis of aFRR Activations The trade-off between using the available flexibility for providing aFRR vs. for the cost-optimal purchase at the DA market is visualized in Figure 5.6. Point 1 illustrates the DA market based schedule, and point 2 the aFRR activation (the explanation of point 3 follows in the next section). The above explained trade-off between the two market alternatives that depend on and limit each other can be recognized. 5.5.3 Consideration of Catch-up Effects One major difference between traditional BSPs on the supply side (power plants) is that alternative BSPs on the demand side have to satisfy local on-site demands, as discussed in detail in Section 5.4. In general, balancing power activation must not have any influence on the system balance at a later point in time [50H+16]. Consequently, energy deltas resulting from aFRR activations at a later point in time (= catch-up effect) should be considered in the balancing group. While catch-up effects are not yet a clearly regulated topic, due to the still limited share of demand-side BSPs, their relevance increases [Deu16; Bun17e]. In the scenario considered in this thesis (see Section 1.1.4), we assume that the BSP (i. e., the aFRR provider) takes the energy deltas arising from aFRR activations into his own balancing group. Therefore, the expected catch-up effects based on the expected aFRR activations (which are by nature fraught with uncertainty) can already be considered in the bid generation. This is visualized and explained in Figure 5.6 in which point 3 illustrates the expected catch-up effect which can be flexibly scheduled. These elaborated findings regarding aFRR provisioning are integrated into the problem formulation in the upcoming Chapter 6. Taking the perspective of a prosumer, we formulate an optimization problem in which aFRR activation costs, opportunity costs at the DA spot market, and catch-up effects are inherently integrated. 134 CHAPTER 6 Formalization of the Optimization Problem for Value Stacking of Flexibility at Day-ahead Spot and aFRR Balancing Markets The previous chapters provided detailed insights into spot and balancing markets, inter- faces in the context of a multi-modal Facility Energy Management System, characteristics of flexible facility devices, and the aFRR activation behavior. Building on this knowledge, this chapter proposes an optimization for flexibility value stacking and presents the corresponding mathematical formulation. The optimization algorithm is intended to be deployed within the proposed FEMS. It couples the energy forms of electricity, heat, cold, and gas to turn on-site flexibility in electricity consumption and generation into a financial benefit. In the considered scenario, the facility operates its own balancing group with access to the DA spot and aFRR balancing market. Consequently, the op- timization task is to schedule the runtime and power of flexible devices, motivated by two competing incentives. Firstly, energy prices at the DA spot market motivate shifting electricity consumption and generation. Secondly, the aFRR balancing market motivates providing capacity in the form of potential short-term schedule adjustments in order to realize additional revenues. We discuss the optimization problem’s constraints and interdependencies concerning devices, storages, energy forms, and market bids, as well as its complexity. Due to the need for predicted inputs and the stochastic nature of aFRR bid activations, we also address the resulting issue of uncertainty. This chapter completes with a discussion of the suitability of different algorithmic approaches to efficiently solve the introduced problem. 135 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility 6.1 Problem Formulation In this section, we formulate the optimization problem covering the objective function, decision and non-decision variables, and constraints for the optimization. The modeling of facility devices, the DA spot market, and the aFRR balancing market, as well as related assumptions, was presented in detail in Chapter 4. 6.1.1 Decision Variables The goal of the optimization is to use the flexibility regarding runtime and power of electricity consumers or generators to decrease the overall energy costs of a facility (which can be seen as a natural aggregation instance of a prosumer). By simultaneously considering both the DA spot market and the aFRR balancing market, cost savings cannot only be achieved by price-based scheduling, but also by generating additional revenues via the balancing market. The foundation for the optimization is provided by the models presented in Chapter 4. There, we presented the overall system environment (see Figure 4.1) and the market interfaces to the DA and aFRR markets (see Table 4.3). We assumed daily bidding periods for both the DA spot market (see Section 4.2) and the aFRR balancing market (see Section 4.3). Furthermore, we showed that the device capabilities regarding power adjustments differ strongly between different device classes (see Section 4.4). Therefore, aFRR bids are made per device, if at all. The output of the daily optimization for each facility device 𝑑 ∈ 𝔻 is represented by the decision variables visualized in Figure 6.1. Hour of day 0 4 8 12 16 Negative aFRR market 𝑝𝑝𝑑𝑑,𝑡𝑡 el,DA  𝑝𝑝𝑑𝑑,𝑡𝑡 el,aFRR −  𝜋𝜋𝑑𝑑,𝑡𝑡 aFRR−,energy 20 Positive aFRR market Day-ahead spot market  𝑝𝑝𝑑𝑑,𝑡𝑡 el,aFRR +  𝜋𝜋𝑑𝑑,𝑡𝑡 aFRR+,energy 24 Figure 6.1: Decision variables of the optimization problem for each device 𝑑 ∈ 𝔻. Figure 6.1 shows two kinds of bids resulting from the day-ahead optimization: • Bids to the day-ahead spot market: DA spot market bids can (but do not have to be) be made for each of the 24 one-hour slots. Each time slot consists of one 136 6.1 Problem Formulation power value, which is assumed to be constant over the whole time slot. The power values over multiple time slots represent the planned day-ahead schedule. We decided to use power instead of energy values for device schedules as it simplifies the integration of aFRR bids and activations. DA market energy prices are not defined as decision variables as we assume perfectly predicted energy prices in the form of a price forward curve (see Section 4.2, assumption ADA3). • Bids to the aFRR balancing market: aFRR bids can be made for each of the six aFRR four-hour product slots. Per aFRR product time slot either no aFRR bid, a negative aFRR bid, a positive aFRR bid, or both can be submitted. Each aFRR bid consists of one power value (representing the possible schedule deviation) and one aFRR energy price (which we use to represent the expected aFRR activation share). aFRR capacity prices are not defined as decision variables as we assume perfectly predicted marginal aFRR capacity prices (see Section 4.3, assumption AaFRR6). The relation between an aFRR bid’s energy price and its activation was analyzed in Chapter 5. We showed that the choice of the aFRR energy prices, to some degree, allows steering the bid’s expected activation share (of the aFRR product time slot). By mapping the aFRR bid’s energy price to its expected activation durations, an expected aFRR activation schedule can be generated for each aFRR bid (see Section 6.2.3). This expected schedule can be used to calculate the costs or revenues expected at the time of the daily bid optimization. Although the temporal share of aFRR activations can approximately be controlled by choice of the aFRR energy price, it is worth mentioning that they cannot be perfectly predicted due to the stochastic nature of balancing power. Consequently, after the bid submission, deviations from expected aFRR activations can occur at any time. Therefore, we introduce restrictions guaranteeing that a submitted aFRR bid can always be fully activated even though an activation is not expected based on the chosen aFRR energy price. 6.1.2 Objective Function The objective function for the daily optimization is defined as follows: min 𝑐total = 𝑐DA − 𝑟aFRR + 𝑐gridFees + 𝑐gas + 𝑐wear (6.1) For an intuitive understanding, we distinguish between costs (𝑐) and revenues (𝑟). In the given scenario, two aspects are important to understand. Firstly, the DA market does not necessarily result in costs. It may also result in revenues (i. e., negative costs) if 137 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility the facility sells and not only buys energy or in the case of negative spot market prices. Secondly, the aFRR market does not necessarily result in revenues. It may also result in costs (i. e., negative revenues) as aFRR bids can be characterized by negative aFRR energy prices and hence result in costs for the BSP in the case of aFRR activations (see analysis in Section 5.2). Based on the traditionally common case, we label DA market cost components as costs, while we label aFRR market cost components as revenues. The individual cost components are defined by Equations 6.2 to 6.7. For a better understanding, we highlight decision variables in these equations by framing them. Taking the viewpoint of prosumers, we follow the load convention and use a positive sign for power and energy values to indicate demand and a negative sign to indicate supply. We start with the DA spot market based costs that depend on the device scheduling. They are defined as follows: 𝑐DA = 23 ∑ 𝑡=0 ⎛⎜ ⎝⎛⎜ ⎝ 𝑝el demand,𝑡 ⋅ Δt + ∑ 𝑑∈𝔻 ( 𝑝el,DA 𝑑,𝑡 ⋅ Δ𝑡)⎞⎟ ⎠ ⋅ 𝜋el,DA 𝑡 ⎞⎟ ⎠ (6.2) where: 𝑝el demand,𝑡 = the facility’s expected uncontrollable electric power demand in time slot 𝑡 (see Section 4.4.1) Δt = length of a time slot (in the considered market setup 1 h) 𝑝el,DA 𝑑,𝑡 = the electric power requested from or provided to the DA spot market by a flexible device 𝑑 ∈ 𝔻 in time slot 𝑡 𝜋DA 𝑡 = the expected DA spot market energy price in time slot 𝑡 The expected aFRR market based revenues are composed of revenues that are paid for the provision of capacity (based on the aFRR capacity price) and revenues that are paid in the case of bid activations (based on the aFRR energy price). The overall aFRR market based revenues are defined as follows, separated by negative and positive aFRR: 𝑟aFRR = 𝑟aFRR − + 𝑟aFRR + (6.3) 𝑟aFRR − = 23 ∑ 𝑡=0 ∑ 𝑑∈𝔻 ⎛⎜⎜⎜⎜⎜⎜⎜ ⎝ 𝑝el,aFRR − 𝑑,𝑡 ⋅ Δt ⋅ 𝜋aFRR −,energy 𝑑,𝑡 ⋅ 𝑓 aFRR − 𝑡 ( 𝜋aFRR −,energy 𝑑,𝑡 ) ⎫} ⎬}⎭ Revenues via aFRR energy price + 𝑝 el,aFRR − 𝑑,𝑡 ⋅ 𝜋aFRR −,capacity 𝑡 } Revenues via aFRR capacity price ⎞⎟⎟⎟⎟⎟⎟⎟ ⎠ (6.4) 138 6.1 Problem Formulation 𝑟aFRR+ = 23 ∑ 𝑡=0 ∑ 𝑑∈𝔻 ⎛⎜⎜⎜⎜⎜⎜⎜⎜⎜ ⎝ ∣ 𝑝el,aFRR + 𝑑,𝑡 ∣ ⋅ Δt ⋅ 𝜋aFRR +,energy 𝑑,𝑡 ⋅ 𝑓 aFRR + 𝑡 ( 𝜋aFRR +,energy 𝑑,𝑡 ) ⎫ } ⎬ } ⎭ Revenues via aFRR energy price + ∣ 𝑝el,aFRR + 𝑑,𝑡 ∣ ⋅ 𝜋aFRR +,capacity 𝑡 } Revenues via aFRR capacity price ⎞⎟⎟⎟⎟⎟⎟⎟⎟⎟ ⎠ (6.5) where: 𝑝 el,aFRR +/− 𝑑,𝑡 = the electric power offered as (positive or negative) aFRR ca- pacity for device 𝑑 ∈ 𝔻 in time slot 𝑡 𝜋aFRR +/−,energy 𝑑,𝑡 = the aFRR energy price of a (positive or negative) aFRR bid for device 𝑑 ∈ 𝔻 in time slot 𝑡 𝑓 aFRR +/− 𝑡 (𝜋) = a function ℝ → [0, 1] that maps the aFRR energy price of a (positive or negative) aFRR bid for time slot 𝑡 to the expected temporal activation share within Δt (see Section 6.2.3) 𝜋aFRR +/−,capacity 𝑡 = the expected marginal capacity price for (positive or negative) aFRR in time slot 𝑡 Grid fees and related taxes (see Section 2.2.4) have to be paid for electric energy drawn from the public grid but not for electric energy provided to the public grid. For final consumers that provide negative aFRR (i. e., increasing on-site consumption or decreasing on-site generation), aFRR activations result in a higher consumption from the public grid. Due to the increasing share of demand-side BSPs, regulation in recent years has addressed the question of which fees and related taxes demand-side BSPs have to pay for this grid-supportive increase in the consumption [Bun15b; Bun17e]. As of today, demand-side BSPs have to pay grid fees and related taxes for the additional consumption in the case of aFRR activations. However, consumption peaks introduced through aFRR activations are neglected in the calculation of the capacity-based grid fees [Bun12b]. The complexity and diversity of grid fee regulation and the rising share of demand-side BSPs resulted in exceptions in individual cases [Deu18a]. Consequently, we distinguish both cases in the evaluation in Chapter 8: provisioning of negative aFRR with and without accruing grid fees and related taxes. The expected grid fees and related taxes depending on the day-ahead optimized schedules are presented in Equation 6.6. The equation depicts the case in which grid fees and related taxes for negative aFRR activation have to be paid. For the case where negative aFRR activation is not subject to grid fees and related taxes, the middle 139 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility summand of the inner summation loop is omitted: 𝑐gridFees = 23 ∑ 𝑡=0 ⎛⎜⎜⎜⎜⎜⎜⎜⎜⎜⎜⎜⎜ ⎝ max ⎛⎜⎜⎜⎜⎜⎜⎜⎜⎜⎜⎜⎜ ⎝ ⎛⎜⎜⎜⎜⎜⎜⎜⎜⎜⎜⎜⎜ ⎝ 𝑝el demand,𝑡 ⋅ Δt + ∑ 𝑑∈𝔻 ⎛⎜⎜⎜⎜⎜⎜⎜ ⎝ 𝑝 el,DA 𝑑,𝑡 ⋅ Δt + 𝑝el,aFRR − 𝑑,𝑡 ⋅ Δt ⋅ 𝑓 aFRR − 𝑡 ( 𝜋aFRR −,energy 𝑑,𝑡 ) + 𝑝el,aFRR + 𝑑,𝑡 ⋅ Δt ⋅ 𝑓 aFRR + 𝑡 ( 𝜋aFRR +,energy 𝑑,𝑡 ) ⎞⎟⎟⎟⎟⎟⎟⎟ ⎠ ⎞⎟⎟⎟⎟⎟⎟⎟⎟⎟⎟⎟⎟ ⎠ , 0 ⎞⎟⎟⎟⎟⎟⎟⎟⎟⎟⎟⎟⎟ ⎠ ⋅ 𝜋gridFees 𝑡 ⎞⎟⎟⎟⎟⎟⎟⎟⎟⎟⎟⎟⎟ ⎠ (6.6) where: 𝜋gridFees 𝑡 = the grid fees and related taxes per unit of consumed energy for time slot 𝑡 It is important to note that the energy-based grid fees and related taxes may be time-variable, e. g., in the case of atypical grid usage1 or in future regulatory scenarios. Regarding the considered grid fee surcharges, it is furthermore worth mentioning that the grid fee pricing scheme in Germany depends on the annual utilization hours (defined as the annual energy demand in kWh divided by the maximum quarter-hourly power demand in kW). Below a certain threshold (usually 2 500 h), a large share of the final grid fees is based on the consumed energy (EUR/kWh), and above this threshold, a large share of the final grid fees is based on the actually measured (quarter-hourly averaged) power peak (EUR/kW per month or year). This was also discussed in Section 2.2.4. In the evaluation presented later, we focus on the first case and do not further investigate the capacity-based grid fee component. We do not optimize the facility’s power peak, although this can be expressed monetarily by the capacity-based grid fee component. To consider peak load based costs, a further cost component can be added to the objective function. When introducing such a cost component, so far realized power peaks have to be tracked such that new power peaks will result in additional costs. The expected gas consumption and hence the resulting gas costs can be derived from the DA market schedules and the expected aFRR activations. The expected gas costs are defined as follows: 𝑐gas = 23 ∑ 𝑡=0 ∑ 𝑑∈𝔻 (𝑝 gas 𝑑,𝑡 ⋅ Δ𝑡 ⋅ 𝜋gas) (6.7) where: 𝑝gas 𝑑,𝑡 = the gas power consumed by device 𝑑 ∈ 𝔻 in time slot 𝑡 𝜋gas = the gas energy price (which we assume to be independent of the time of consumption) 1German: “Atypische Netznutzung”, see § 19 of the German Electricity Grid Charges Ordinance (Strom- netzentgeltverordnung (StromNEV)) 140 6.2 Constraints In practice, adjusting device schedules may result in additional wear costs 𝑐wear. They are device-specific and can additionally be considered in the optimization by introducing related cost terms, e. g., for ramping up or down a CHP plant. For clarity and focusing on the core contributions, we do not consider wear costs in the following. 6.2 Constraints This section presents constraints for the optimization. We divide them into constraints related to devices and storages, aFRR bids, (expected and unexpected) aFRR activations, and demands. 6.2.1 Devices and Storages Devices and storages were modeled in Section 4.4. In the following, we summarize the key characteristics of the presented models with respect to the optimization. 6.2.1.1 Controllable Devices We define the set of controllable devices subject to the optimization as 𝔻. Table 4.1 outlines the high heterogeneity of the considered devices and shows that our modeling and the proposed optimization are very generic regarding the energy forms a device consumes or generates. In the following, the device-related constraints modeled in Section 4.4 are summarized with respect to common interfaces. We showed that each device is associated with one or more energy forms 𝜉 ∈ {el, heat, cold, gas}. While the constraints introduced in the following are mainly re- lated to electricity, we presented further constraints establishing a link between a device’s electric power value 𝑝el 𝑑,𝑡 and its power value for additional energy forms (po- tentially 𝑝heat 𝑑,𝑡 , 𝑝cold 𝑑,𝑡 , 𝑝gas 𝑑,𝑡 ). We showed that the relations between electric, heat, cold, and gas power can come along with non-linearities, e. g., due to non-linear efficiencies concerning the power level. We defined the power level 𝜆𝑑,𝑡 of a device 𝑑 in time step 𝑡 and showed how the power level is used to derive a device’s power 𝑝𝜉 𝑑,𝑡 and the resulting energy delta Δ𝜉 𝑑,𝑡 for each energy form 𝜉 a device is associated with. It is common for flexible devices that their control band is limited by minimum and maximum power bounds 𝑝𝜉 𝑑 < 𝑝𝜉 𝑑,𝑡 < 𝑝 𝜉 𝑑. These are indirectly represented by the minimum and maximum power level 𝜆𝑑 < 𝜆𝑑,𝑡 < 𝜆𝑑 (see Figure 4.3). We showed that both power bounds can be negative or positive, depending on the device and energy 141 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility form. For example, considering a chiller, both 𝑝el chiller and 𝑝el chiller are positive (electricity consumer). For of a battery storage system, 𝑝 el battery is positive for charging (electricity consumer) and 𝑝el battery is negative for discharging (electricity generator). Considering a CHP, 𝑝el chp and 𝑝el chp are both negative (electricity generator). 6.2.1.2 Storages We consider storages as a special type of devices. In the considered scenario, the flexibility of each considered device originates from an associated energy storage, also referred to as a buffer. Electric energy storages are modeled in Section 4.4.2 and thermal (heat and cold) energy storages in Section 4.4.3. In contrast to electric energy storages, whose SOC is directly controllable via the power level (charging/discharging), the SOC of thermal energy storages is only indirectly controllable via thermal generators and the thermal demand. Subsequently, storage-related constraints are summarized with respect to common interfaces. Figure 4.1 visualizes the physical connection between devices and energy storages and Table 4.1 summarizes the involved energy forms. For the calculation of the SOC, we differentiate between electric battery energy storages and thermal heat or cold energy storages. The basis for the calculation of a storage’s SOC is the energy delta Δ𝜉 𝑑,𝑡 provided by a device based on its power level step 𝜆𝑑,𝑡. Common to energy storages is that their SOC must always remain within the lower and upper SOC bounds 𝑆𝑂𝐶𝑑 and 𝑆𝑂𝐶𝑑. Consequently, at the time of the day-ahead optimization, the expected SOC of the energy storage related to a device 𝑑 is constrained as follows, whereby we define the start of the daily optimized time period as time step 𝑡 = 0 and its end as time step 𝑡 = 23: ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ 𝑆𝑂𝐶𝑑 ≤ 𝑆𝑂𝐶exp 𝑑,𝑡 ≤ 𝑆𝑂𝐶𝑑 (6.8) Constraints that address aFRR bids and ensure a valid SOC in the case of unexpected aFRR activation are introduced later. For the optimization, we define the initial SOC for the first time step of the optimization period to be the actually measured (or simulated) SOC. Without additional constraints, the SOC at the end of the optimization period would indirectly result from the cheapest schedule of the considered day. However, it may be advantageous to accept higher costs in one optimization period (e. g., due to intentionally charging a battery to a higher SOC in the last time step). This is meaningful if it allows decreasing costs in the following optimization period by a higher level (e. g., due to discharging cheap energy of the previous day in times of high spot market prices). With respect to the optimal SOC at the 142 6.2 Constraints end of a day, different options can be recognized to utilize potential synergies between two consecutive days. Firstly, it is possible to choose an explicit SOC for the last time step based on a pattern analysis of DA spot market prices. For example, Figure 2.4 shows that, on average, the first hours of a new day (i. e., the hours after 0:00 h) are characterized by relatively low energy prices. Therefore, an appropriate choice could be to start a new day with an empty buffer storage. Secondly, it is possible to assign a monetary value to the energy contained in the storage in the last time step of the optimization period. This will dynamically result in different end SOCs for different days, depending on the occurring prices. We choose this second approach as the freedom for dynamic end SOCs allows us to deal with dynamic market situations. Thirdly, a rolling optimization horizon can be applied to optimize the day under consideration for the market bids and a specific time period afterward. Optimizing over a longer optimization period, e. g., of two days, the cheapest schedule over both days would indirectly determine the resulting SOC for the end of the first day. However, the drawback of this third approach is that it requires looking further into the future. Therefore, the required price and demand predictions come along with a higher uncertainty (as they have to cover, e. g., two days instead of only one). 6.2.2 aFRR Bids In the given scenario with a high heterogeneity regarding the flexibility characteristics of the considered devices, we decided to choose the aFRR energy price (and hence the desired aFRR activation share) per device. We can distinguish between constraints related to the aFRR product slot size (each aFRR bid is valid for a four-hour slot) and constraints related to the aFRR power level (aFRR and DA market bids are constrained by the minimum and maximum power bounds). As aFRR is provided in four-hour slots, constraints have to guarantee that an aFRR bid is always made for all hours within an aFRR product time slot or for none. Concerning the aFRR bid’s power component, this is defined as follows: ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 4, 8, … , 20} ∶ 𝑝el,aFRR − 𝑑,𝑡 = 𝑝el,aFRR − 𝑑,𝑡+1 = 𝑝el,aFRR − 𝑑,𝑡+2 = 𝑝el,aFRR − 𝑑,𝑡+3 (6.9) ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 4, 8, … , 20} ∶ 𝑝el,aFRR + 𝑑,𝑡 = 𝑝el,aFRR + 𝑑,𝑡+1 = 𝑝el,aFRR + 𝑑,𝑡+2 = 𝑝el,aFRR + 𝑑,𝑡+3 (6.10) 143 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility Likewise, aFRR energy prices are defined to be equal for each hour within the four-hour aFRR product slot: ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 4, 8, … , 20} ∶ 𝜋aFRR −,energy 𝑑,𝑡 = 𝜋aFRR −,energy 𝑑,𝑡+1 = 𝜋aFRR −,energy 𝑑,𝑡+2 = 𝜋aFRR −,energy 𝑑,𝑡+3 (6.11) ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 4, 8, … , 20} ∶ 𝜋aFRR +,energy 𝑑,𝑡 = 𝜋aFRR +,energy 𝑑,𝑡+1 = 𝜋aFRR +,energy 𝑑,𝑡+2 = 𝜋aFRR +,energy 𝑑,𝑡+3 (6.12) For each device 𝑑 and each time step 𝑡, the aFRR capacity that can be offered to the aFRR market is limited by the device’s lower and upper power bound, 𝑝el 𝑑 and 𝑝 el 𝑑 , and the device’s power level based on the DA spot market. This is represented by the following two constraints for negative aFRR (Equation 6.13) and positive aFRR (Equation 6.14): ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ 𝑝𝑑 ≤ 𝑝el,DA 𝑑,𝑡 + 𝑝el,aFRR − 𝑑,𝑡 ≤ 𝑝𝑑 (6.13) ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ 𝑝𝑑 ≤ 𝑝el,DA 𝑑,𝑡 + 𝑝el,aFRR + 𝑑,𝑡 ≤ 𝑝𝑑 (6.14) 6.2.3 aFRR Activation We can distinguish between constraints related to expected and unexpected aFRR activations. We use expected aFRR activation to refer to a historically expected temporal activation share based on the aFRR energy price (as analyzed in Section 5.2). In contrast, we use unexpected aFRR activations to refer to deviations thereof. 6.2.3.1 Expected aFRR Activation The expected electric energy delta provided by the different devices can be calculated based on their DA and aFRR market bids. Therefore, we define the expected temporal aFRR activation share using the two functions 𝑓 aFRR − 𝑡 ∶ ℝ → [0, 1] and 𝑓 aFRR + 𝑡 ∶ ℝ → [0, 1]. They map the energy price of a negative or positive aFRR bid for time step 𝑡 to the expected temporal activation share within Δt = 1 h, based on the insights gained in Chapter 5. Using these functions, Equation 6.15 calculates the expected energy delta 144 6.2 Constraints for device 𝑑 in time step 𝑡: ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ Δ𝑒el,exp 𝑑,𝑡 = 𝑝el,DA 𝑑,𝑡 ⋅ Δ𝑡 + 𝑝el,aFRR − 𝑑,𝑡 ⋅ Δ𝑡 ⋅ 𝑓 aFRR − 𝑡 (𝜋aFRR −,energy 𝑑,𝑡 ) + 𝑝el,aFRR + 𝑑,𝑡 ⋅ Δ𝑡 ⋅ 𝑓 aFRR + 𝑡 (𝜋aFRR +,energy 𝑑,𝑡 ) (6.15) It can be seen that we assume aFRR bids to be activated uniformly distributed over the individual hours within an aFRR product time slot. The impact of the discrepancy between the expected and activated aFRR capacity is evaluated in Chapter 8. While Equation 6.15 refers to the expected energy delta based on the expected aFRR activation, the upcoming section presents additional constraints that guarantee that a submitted aFRR bid can also be activated in the case of unexpected aFRR activation. For devices dealing with different energy forms 𝜉 ∈ {heat, cold, gas} in addition to electricity, the modeling in Section 4.4 shows how the expected heat, cold, and gas energy deltas (Δ𝑒heat,exp 𝑑,𝑡 , Δ𝑒cold,exp 𝑑,𝑡 , and Δ𝑒gas,exp 𝑑,𝑡 ) can be calculated in parallel to the expected electric energy delta (Δ𝑒el,exp 𝑑,𝑡 ). Out of the considered devices, the condensing boiler is a special case in which only the energy forms gas and heat are involved, but no electric energy. Therefore, the condensing boiler only results in an expected gas and heat energy delta. 6.2.3.2 Unexpected aFRR Activation Although our aFRR activation analysis in Chapter 5 showed that the aFRR activation share can be steered within a certain range by adjusting the aFRR bid’s energy price, it is essential for a BSP to guarantee that a submitted aFRR bid can always be activated upon request within the whole aFRR product time slot (i. e., shorter or longer than expected). In the most extreme unexpected cases, an aFRR bid with a very low energy price (that results in a position at the beginning of the merit order list) would not be activated at all within the whole four-hour slot, or an aFRR bid with a high energy price (that results in a position at the end of the merit order list) would be activated continuously over the whole four-hour slot. Consequently, we differentiate between two extreme cases for aFRR activation: • Extreme activation case 1: Maximum negative aFRR activation. A negative aFRR bid is continuously activated with the maximum offered power over the whole aFRR product slot, and positive aFRR is not activated at all. 145 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility • Extreme activation case 2: Maximum positive aFRR activation. A positive aFRR bid is continuously activated with the maximum offered power over the whole aFRR product slot, and negative aFRR is not activated at all. Depending on whether a device is an electricity generator or consumer, negative aFRR activation or positive aFRR activation result in an increase or decrease of the energy delta for the different energy forms associated with the device. For example, for a chiller (electricity consumer, cold generator), the activation of negative aFRR results in a positive cold energy delta. In contrast, for a CHP plant (electricity generator, heat generator), the activation of negative aFRR results in a negative heat energy delta. Figures 6.2a, 6.2b and 6.2c visualize three potential courses of a storage’s SOC over time (e. g., of an battery storage system or a thermal energy storage associated with a chiller) based on different expected aFRR activations. The upper chart is based on one bid for negative aFRR, the middle chart is based on two simultaneous bids, one for negative aFRR and one for positive aFRR, and the lower chart is based on one bid for positive aFRR. The two extreme aFRR activation cases are visualized by the three red upper lines (continuous maximum negative activation) and the three lower red lines (continuous maximum positive activation). It has to be guaranteed that these two extreme activation cases can always be realized, which allows for every possible aFRR activation combination. Consequently, the optimization has to be constrained such that the whole SOC band between the two SOCs bounds resulting from the extreme activation cases is guaranteed to be within the storage’s minimum and maximum SOC bounds, 𝑆𝑂𝐶 and 𝑆𝑂𝐶, in each time step. We introduce the following two constraints to ensure that the SOC remains within the valid SOC band in the case of any aFRR activation between the two extreme activation cases. It depends on the device (electricity generator or consumer) whether a specific aFRR direction increases or decreases the SOC. We denote the maximum reachable SOC in the case of either continuous negative or continuous positive aFRR activation as 𝑆𝑂𝐶maxUpAct 𝑑,𝑡 . Similarly, the minimum reachable SOC in the case of either continuous negative or continuous positive aFRR activation, is defined as 𝑆𝑂𝐶maxDownAct 𝑑,𝑡 : ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ 𝑆𝑂𝐶𝑑 ≤ 𝑆𝑂𝐶maxUpAct 𝑑,𝑡 ≤ 𝑆𝑂𝐶𝑑 (6.16) ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ 𝑆𝑂𝐶𝑑 ≤ 𝑆𝑂𝐶maxDownAct 𝑑,𝑡 ≤ 𝑆𝑂𝐶𝑑 (6.17) 𝑆𝑂𝐶maxUpAct 𝑑,𝑡 and 𝑆𝑂𝐶maxDownAct 𝑑,𝑡 are based on the energy added to or removed from the storage in the two extreme aFRR activation cases. Regarding electricity, we can dif- ferentiate between the maximum electric energy delta resulting from extreme activation 146 6.2 Constraints t t t + 4 h SOC Expected SOC SOC in case of continuous aFRR– activation SOC in case of no aFRR activation Negative aFRR bid with a certain energy price Required guarantee on SOC band / flexibility reserved SOC SOC (a) Required SOC band guarantee in the case of one aFRR bid for negative aFRR. t t t + 4 h SOC Expected SOC SOC in case of continuous aFRR– activation Negative aFRR bid + positive aFRR bid, each with a certain energy price Required guarantee on SOC band / flexibility reserved SOC in case of continuous aFRR+ activation SOC in case of no aFRR activation SOC SOC (b) Required SOC band guarantee in the case of two simultaneous aFRR bids, one for negative aFRR and one for positive aFRR. Legend: Expected SOC changes t t t + 4 h SOC Expected SOC SOC in case of no aFRR activation Positive aFRR bid with a certain energy price Required guarantee on SOC band / flexibility reserved SOC in case of continuous aFRR+ activation due to positive aFRR activation due to negative aFRR activation SOC SOC (c) Required SOC band guarantee in the case of one aFRR bid for positive aFRR. Figure 6.2: Expected aFRR activations and required SOC band guarantees: demand-side BSPs have to guarantee that the two extreme aFRR activation cases (represented by the upper and lower red lines) can always be realized, which allows for every possible aFRR activation in between. 147 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility case 1 (Equation 6.18) and the minimum electric energy delta resulting from extreme activation case 2 (Equation 6.19): ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ Δ𝑒el 𝑑,𝑡 = 𝑝el,DA 𝑑,𝑡 ⋅ Δ𝑡 + 𝑝el,aFRR − 𝑑,𝑡 ⋅ Δ𝑡 (6.18) ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ Δ𝑒el 𝑑,𝑡 = 𝑝el,DA 𝑑,𝑡 ⋅ Δ𝑡 + 𝑝el,aFRR + 𝑑,𝑡 ⋅ Δ𝑡 (6.19) These two electric energy deltas set a maximum and minimum bound for all possible electric energy deltas resulting from all potential aFRR bid activations. In addition to electricity, devices can be associated with other energy forms. Depending on the device, the extreme heat, cold, or gas energy deltas (Δ𝑒 heat 𝑑,𝑡 and Δ𝑒heat 𝑑,𝑡 , Δ𝑒 cold 𝑑,𝑡 and Δ𝑒cold 𝑑,𝑡 , and Δ𝑒gas 𝑑,𝑡 and Δ𝑒 gas 𝑑,𝑡 ) are calculated in parallel to the electric energy deltas, based on the device-specific equations presented in Section 4.4. We define Δ𝑒𝑑,𝑡 as the minimum and Δ𝑒𝑑,𝑡 as the maximum supply regarding the respective energy form. The calculation of the expected SOC (in Equation 6.8) is based on the expected energy delta (Equation 6.15). Analogously, the calculation of the extreme SOCs (Equations 6.16 and 6.17) is based on the extreme energy deltas (Equations 6.18 and 6.19). The expected SOCs and energy deltas are used to determine the expected costs that are minimized according to the objective function. In contrast, the extreme SOCs and energy deltas resulting from the two potential extreme aFRR activation cases are needed to guarantee that aFRR bids can be activated at any point in time within the respective product slots. 6.2.4 Demands Demands of the facility were introduced in Section 4.4. This section puts those demands into the context of the optimization problem. In addition to guaranteeing the potential activation of aFRR bids at any point in time, it is crucial that the facility’s electricity, heat, cold, and gas demands are always satisfied. No dedicated constraints are required to cover the facility’s electricity or gas energy demand. We define that the sum of the facility’s electric energy demand that is not satisfied on-site is procured via the DA market and hence drawn from the public grid, as clarified by the objective function component defined in Equation 6.2. In parallel, no additional constraints are required regarding the gas demand as we define that it is exclusively satisfied by the public gas grid, as clarified in Equation 6.7. In the given facility setup, in contrast to the electric or gas energy demand, the heat or cold energy demand can only be satisfied via on-site devices. For this purpose, the energy contained in the local heat or cold storage is adjusted according to the supply (based on related device schedules) and the demand (based on the facility’s exogenously 148 6.3 Discussion of Uncertainty given demand, see Section 4.4.1). Consequently, the facility’s final energy deltas for the energy form 𝜉 ∈ {heat, cold} can be calculated as follows. Equation 6.20 shows the facility’s maximum final energy delta (in the case of maximum generation through aFRR activation) and Equation 6.21 the minimum (in the case of minimum generation through aFRR activation): ∀𝑡 ∈ {0, 1, … , 23} ∶ Δ𝑒𝜉 ,total 𝑡 = ( ∑ {𝑑∈𝔻 ∣ 𝑑 associated with energy form 𝜉} Δ𝑒𝜉 𝑑,𝑡) − 𝑝𝜉 demand,𝑡 ⋅ Δt (6.20) ∀𝑡 ∈ {0, 1, … , 23} ∶ Δ𝑒𝜉 ,total 𝑡 = ( ∑ {𝑑∈𝔻 ∣ 𝑑 associated with energy form 𝜉} Δ𝑒𝜉 𝑑,𝑡) − 𝑝𝜉 demand,𝑡 ⋅ Δt (6.21) For each related device, Δ𝑒 𝜉 𝑑,𝑡 and Δ𝑒 𝜉 𝑑,𝑡 represent the expected hourly maximum and minimum energy deltas resulting from the two extreme aFRR activation cases (as calcu- lated above in Equations 6.18 and 6.19). The facility’s predicted uncontrollable hourly demand 𝑝𝜉 demand,𝑡 is defined to be given as exogenous input (in Section 4.4.1). Conse- quently, for the facility’s central heat and cold storages, we relate the SOC constraints introduced in Equations 6.16 and 6.17 to the resulting maximum and minimum final energy deltas Δ𝑒𝜉 ,total 𝑡 and Δ𝑒 𝜉 ,total 𝑡 . This way, given accurate demand predictions, the introduced constraints ensure the satisfaction of the facility’s heat and cold demands also in case of arbitrary activations of submitted aFRR bids. 6.3 Discussion of Uncertainty Providing bids to the DA spot market and potential schedule deviations to the aFRR balancing market one day in advance is accompanied by uncertainty. Figure 6.3 visualizes the uncertainty at the time of the day-ahead optimization (left side) and potential impacts during the execution of the optimized schedules after the day-ahead optimization (right side). Variables subject to uncertainty during the day-ahead optimization are highlighted in red. We can distinguish uncertainties at the time of the day-ahead optimization as follows: • Uncertainty in optimization input: Regarding the optimization inputs, two types of uncertainty can be found at the time of the optimization. Firstly, the predictions of the uncontrollable electricity, heat, and cold demands are uncertain. They are distorted by changing weather conditions or unexpected facility usage. 149 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility Secondly, the elaborated relation between aFRR energy prices and aFRR activations is subject to the stochastic nature of aFRR activations. Both types of inputs to the optimization cannot be perfectly predicted. In addition, as the optimization uses predicted DA spot market prices (see Section 4.2, assumption ADA3) and predicted marginal aFRR capacity prices (see Section 4.3.1, assumption AaFRR6), submitted bids may not be accepted. • Uncertainty in optimized schedules: The two above-discussed causes for un- certainty may influence the optimized device schedules. Firstly, the uncertain energy demands result in uncertainty in the day-ahead optimized schedules as more or less energy than required may be procured. Secondly, the uncertain aFRR activation results in uncertain expected energy deltas. • Uncertainty in expected costs and revenues: Finally, the two above-discussed causes for uncertainty may influence the expected costs. Firstly, the uncertain energy demands result in uncertain spot market procurement and potentially in imbalance energy costs if the schedules are not further corrected via intraday trading (see also Section 2.3.3). Secondly, the uncertain aFRR activation results in uncertain aFRR revenues or costs. The uncertainties at the time of the day-ahead optimization, potential impacts, and their relations are visualized in Figure 6.3. It shows how the discussed uncertainty potentially leads to a discrepancy between the expected and actually realized costs. 6.4 Characterization of the Optimization Problem In this section, we compare optimization methods regarding their suitability to effi- ciently solve the presented problem. We start by discussing the characteristics and requirements concerning the optimization problem formulated in the previous sections. In Section 2.5, we already presented the fundamentals of mathematical optimization, covering a classification of optimization problems and a general discussion of how to choose an appropriate optimization method. 6.4.1 Mathematical Properties In this section, we discuss properties that influence the choice of the solving method. The following properties are based on the mathematical nature of the problem: 150 6.4 Characterization of the Optimization Problem Uncertainty at time of day-ahead optimization Potential impacts of uncertainty Optimization input Optimization output: Device schedules Optimization output: Costs/revenues Uncertainty may result in lower or higher costs than expected Devices may have to run shorter or longer to fulfill on-site needs Mapping of aFRR energy prices to expected activations  Expected temporal aFRR activation share Exogenous demands  Predicted electric energy demand  Predicted heat energy demand  Predicted cold energy demand … Condensing boiler schedule CHP plant schedule Battery schedule DA spot market bids (1 h slots)  Expected energy Negative aFRR bids (4 h slots)  Capacity  Energy price Positive aFRR bids (4 h slots)  Capacity  Energy price Gas consumption (1 h slots)  Expected energy Expected energy Expected energy Expected schedules for all energy forms for all devices … Condensing boiler costs/revenues CHP plant costs/revenues Battery costs/revenues DA spot market bids (1 h slots)  Expected daily energy costs Negative aFRR bids (4 h slots)  Daily capacity price revenues  Expected daily energy price revenues Positive aFRR bids (4 h slots)  Daily capacity price revenues  Expected daily energy price revenues Gas consumption (1 h slots)  Expected daily gas costs Uncontrollable facility costs DA spot market bids (1 h slots)  Expected daily energy costs Expected overall costs/ revenues Actual aFRR activation may be shorter or longer Actual demands may be lower or higher Additional costs/revenues for intraday schedule readjustments may arise Additional costs/revenues for intraday schedule readjustments may arise Less or more energy may be required to fulfill on-site needs Unexpected aFRR acti- vations may potentially be compensated over time Less or more energy may be provided via aFRR activations aFRR revenues may be lower or higher Figure 6.3: Uncertainty at the time of the day-ahead optimization (left side) and potential impacts on the execution of the device schedules (right side). 151 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility • Non-linearity in objective function and constraints: Non-linearity can be found in both the objective function and the constraints. In the objective function’s cost components regarding the aFRR market, some decision variables are multiplied by each other: Equations 6.4 and 6.5 show that the aFRR market revenues are based on the expected timely aFRR activation share, which is a function of the aFRR energy price. Additionally, non-linear constraints can be found in the device modeling (in Section 4.4). For example, for the CHP, the (electric and thermal) output depends on the chosen power level and the energy conversion efficiency, which is a function of the former (see Equations 4.34 and 4.35). Furthermore, in the case of an AC system or heat pump, the COP may non-linearly depend on the delta between a source and sink temperature as well as the power level (see Equation 4.49). In this case, the non-linearity is complicated by the fact that the COP additionally depends on actions chosen previously. Consequently, by nature, the optimization problem is non-linear. We discuss options for a linearization by introducing certain assumptions in Section 6.5.1. • Discreteness of decisions: We showed, in Section 4.4, that (at least some) elec- tricity consumers and generators are controlled stepwise and not continuously. In order to incorporate this technically given stepwise controllability of devices, we use discrete instead of continuous decision variables, which classifies the problem as a discrete optimization problem. • Indivisibility of the problem: Regarding the indivisibility of the optimization problem, we can distinguish three aspects. The first aspect is the indivisibility regarding the cost components in the objective function. Although the objective function has multiple cost components, they cannot be separated and solved independently. This is because aFRR bids represent power schedule changes that are always relative to the DA spot market based schedules. Although an iterative optimization could generate bids for the two markets (DA spot, aFRR balancing) one after another, this would not automatically lead to the global optimum of bids. The second aspect is the indivisibility of the optimization problem regarding single devices. Devices cannot be optimized individually as soon as maximum power bounds for the whole facility are relevant for technical or economic reasons. Within this thesis, a facility-wide maximum power threshold is not explicitly considered; however, it is a common requirement resulting from capacity-based grid fees or technical restrictions. Consequently, dividing the overall optimization problem into multiple optimization problems for individual devices is not possible, and a joint optimization of all devices is required. Finally, the third aspect is the indivisibility of the optimization problem regarding time. The optimization problem cannot be 152 6.4 Characterization of the Optimization Problem split time-wise within a bidding period as decisions regarding the storages’ SOCs and the devices’ runtime constraints are related to decisions in previous time steps. • Dimension of decision space: In the visualization of decision variables in Fig- ure 6.1, 24 one-hour product time slots and 12 four-hour product time slots can be recognized. Each one-hour time slot requires one decision for the DA spot market per device (𝑝 el,DA 𝑑,𝑡 ). Each four-hour time slot requires two decisions for the aFRR balancing market per device (𝑝 el,aFRR +/− 𝑑,𝑡 , 𝑝el,aFRR +/− 𝑑,𝑡 ). Consequently, the dimension of the daily decision space can be expressed as follows: Dimension = ( 1 decision DA slot ⋅ 24 DA slots + 2 decisions aFRR slot ⋅ 12 aFRR slots) ⋅ |𝔻| (6.22) It is worth mentioning that the dimension of an optimization problem is only one aspect of determining its computational difficulty. Further factors include non- linearity, discreteness, the number of local minima, or constraint characteristics. 6.4.2 Non-functional Requirements In addition to the mathematical properties detailed in the previous section, the nature of the given optimization problem requires the following non-functional requirements to be considered in the choice of an optimization method: • Time-constrained optimization period: The daily day-ahead optimization output consists of bids to the DA spot and aFRR balancing markets. These markets are characterized by time-constrained bidding periods (see Figure 2.2). Therefore, it must be guaranteed that the optimization is either finished before the gate closure time or that it provides a valid solution when stopped. Furthermore, the optimization requires SOCs for the beginning of the optimization period as inputs. However, they are subject to uncertainty (due to demand predictions, uncertain aFRR activations, and deviation of the reality from models). Consequently, as SOC assumptions are more accurate the later the optimization starts, short optimization times are beneficial. • Extensibility regarding further devices: Aiming at demand and supply flex- ibilization in the context of facilities, a wide range of relevant devices can be considered. In Chapter 4, representative devices for facilities are presented. How- ever, other flexible devices and variants of the presented devices exist. For this reason, the FEMS optimization must be easily adjustable for the application in different facilities with different devices and different device configurations. It 153 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility should be easily possible to adjust the optimization to new devices that are not yet considered, bearing in mind that appropriate linearizations to handle potential non-linearities introduced by these devices may not be available. • Extensibility regarding additional objectives: This thesis focuses on utilizing electric flexibility for monetization via the DA spot and aFRR balancing markets. In practice, additional objectives are worth considering in the optimization. In particular, minimizing the facility’s power peak (which can be expressed mone- tarily through the capacity component of the grid fees) may be of high interest. Further aspects worth considering may be costs for additional wear (e. g., through influences of the optimization on the aging processes of devices), explicit eco- logical goals (e. g., concerning reduced greenhouse gas emissions), or further market segments. The optimization method should be flexible enough to handle extensions to include additional incentives for prosumer flexibilization. 6.5 Options for Solving Non-linear Optimization Problems A wide range of optimization methods can be found in the existing literature (as presented in Section 2.5). We showed that a clear classification of optimization problems is complicated by the fact that research looks at optimization from different disciplines and with different foci, often either motivated by theoretical consideration or by the desire to solve practical problems. One way of deciding which optimization method to choose for which problem is presented in Figure 2.12. It shows that a common way to solve non-linear optimization problems efficiently is using heuristic optimization methods. However, if the introduction of additional assumptions allows simplifying a non-linear problem to a linear problem with a precision that is good enough with respect to the specific application, linear optimization methods can be beneficial. In the following, we discuss different options well-suited for optimizing non-linear problems as the one presented. 6.5.1 Linearization and Application of Exact Solving Methods Solving linear optimization problems has evolved into a mature discipline of mathemati- cal optimization over the last decades. As presented in Section 2.5, linear optimization covers well-studied standard methods for finding global optimums, such as the simplex method or the interior-point method. Concerning practical application, we showed that 154 6.5 Options for Solving Non-linear Optimization Problems Linear Programming (LP) addresses linear optimization problems in which both the objective function and all constraints are linear and which exclusively exhibit continuous decision variables. In contrast, we showed that Mixed Integer Linear Programming (MILP) deals with linear optimization problems with at least one discrete decision variable. The introduced problem has a non-linear objective function, non-linear constraints, and discrete decision variables, as shown in Section 6.4.1. Despite this non-linearity, it is often possible to approximate objective functions and constraints with sufficient quality through the linearization of the original model. Linearization can be achieved by replacing non-linear relationships with approximated linear relationships, e. g., by piecewise linearization via additional binary variables [Hu+13] or via Special-Ordered- Set (SOS) variables [Mil+15]. For many problems, linear optimization methods such as the simplex or interior-point methods tend to require relatively low computational effort compared to other methods. In practical applications, the formulation and solving of problems using MILP gained popularity, which is also driven by the availability of corresponding standard software solvers such as CPLEX or Gurobi. However, linearization also comes with disadvantages. The linearization of problems is not always practicable as it comes with the need for additional helper variables and additional mathematical terms. This not only increases the modeling complexity and hence decreases the comprehensibility and extensibility of the problem, but it also increases the computational effort. Furthermore, using commercially available solvers can be seen as outsourcing the solving of an optimization problem. Some “black box” software solvers provide freedom to configure the used optimization algorithm; however, the detailed implementations may not be publicly available. This can be well-suited for one-time use in theoretical studies and potential analyses. Nevertheless, when used for optimizations deployed within operational energy management systems, it comes with disadvantages such as licensing, platform requirements, and external dependencies. 6.5.2 Dynamic Programming Dynamic Programming describes an optimization method for problems that require sequential decisions made over time [Bel66]. The term is in line with the historically established terminology in the field of Linear Programming (see Section 2.5). “Dynamic” refers to the multistage and time-varying aspects of the considered problems [Bel84]. Two fundamental principles of Dynamic Programming are recursion and memoization. Recursion means that Dynamic Programming aims at identifying a collection of sub- problems of the overall optimization problem. These subproblems are tackled one by one, starting with the smallest and using the results of subproblems to optimize larger 155 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility problem parts until all of the subproblems are solved [DPV06]. Memoization means that if a problem has been solved, the result is saved for future reference to avoid solving the same problem again. Dynamic Programming requires optimization problems to fulfill Richard Bellman’s principle of optimality [Bel52]. It describes that for some optimization problems, each optimal solution can be composed of optimal subsolutions. For example, this is the case for the traveling salesman problem, which aims at finding the shortest path connecting multiple locations 𝑥i within a geographical area. In this case, each partial path 𝑥l, … , 𝑥m within the overall shortest path 𝑥1, 𝑥2, … , 𝑥n is a shortest path itself. In such cases, the overall optimization problem can be separated into smaller subproblems that can be solved independently. A major challenge for Dynamic Programming is dividing a problem into efficiently solvable smaller subproblems that can be assembled to the overall solution [DPV06; Cor+09]. The definition of appropriate subproblems is a non-trivial task, and for the problem at hand, the separation into subproblems is not easy, as also discussed in Section 6.4.1. 6.5.3 Application of Metaheuristics The use of heuristics is a common way for approximately solving non-linear optimization problems. A heuristic is an algorithm that is not guaranteed to find an optimal solution; instead, it searches for a sufficiently good solution. Heuristics are well-suited for many practical applications. In particular, in scenarios where the input data is associated with uncertainty, only finding a close-to-optimal solution is often sufficient. metaheuristics are defined as abstract sets of structures, objects, and methods that can be adjusted to different optimization problems. A major challenge in designing optimization algorithms based on metaheuristics is finding an adequate mapping from the abstract structures, objects, and methods to the concrete problem [Kru+15]. Naive optimization methods such as a random or exhaustive search over all possible solution candidates are unsuitable for solving larger problems due to the combinatorial explosion [Kle14]. This is also the case for the presented optimization problem which is characterized by 48⋅|𝔻| dimensions, as derived in Section 6.4.1. The metaheuristics discussed in the following execute a directed search that aims at finding solutions that are good enough despite evaluating only a limited set of solution candidates. 6.5.3.1 Swarm Algorithms Swarm algorithms are inspired by the collective intelligence found in colonies of various animal species, such as birds, fishes, or ants. They solve optimization problems in a 156 6.5 Options for Solving Non-linear Optimization Problems probabilistic way by following three basic principles of the swarm behavior that can also be observed in nature [GB18]. The first principle is coherence, which describes that individuals orient themselves roughly toward the swarm’s center. The second principle is diffusion, which describes that individuals are motivated not to collide with their environment and neighbors and hence make their own decisions regarding their direc- tions, resulting in an expansion of the swarm. The third principle is alignment, which describes that individuals orient themselves based on their direct environment’s behavior, following their local neighbors. The combination of these three general principles leads to swarm behavior. As swarm algorithms conduct a directed random search for the optimal solution, they can be classified as stochastic optimization methods. Two promi- nent representatives of swarm algorithms are Particle Swarm Optimization (primarily for numerical optimization problems over continuous sets) and Ant Colony Optimiza- tion (primarily for combinatorial optimization problems over discrete sets). Particle Swarm Optimization comprises probabilistic algorithms inspired by the foraging behav- ior of birds and fishes [KE95; ES01]. Ant Colony Optimization comprises probabilistic algorithms inspired by the foraging behavior of ants [Bon99; Dor04]. Due to the presented problem’s discrete nature, we briefly shed light on the example of ant colony optimization and demonstrate how the basic principles could be applied to the given problem. Ant colony optimization is a probabilistic optimization method for solving problems that can be reduced to finding good paths through a graph. To transfer the concept of ant colony optimization to our problem, we can define a graph with different possible states for each hour of the bidding period (i. e., hours 1 to 24). The transitions between the hours could represent an allocation of all discrete decision variable combinations. This way, one state in hour 𝑡 would result in multiple new states in hour 𝑡 + 1, depending on the number of possible decision variable allocations. A possible solution candidate could be the path through the generated graph, with each transition representing a set of decision variable assignments with concrete values, and the states representing the SOC in the respective hour (after executing the schedule with the decision variables previously chosen). Using the concept of ant colony optimization, this graph could be traversed sequentially from hour 1 to hour 24, whereby the probability of choosing a path could depend on a weight for each transition. This weight could be adjusted each time after one specific path from hour 1 to hour 24 was chosen, and the overall solution candidate quality was evaluated. It could be adjusted such that good solutions have a higher probability of being chosen. One advantage of ant colony optimization is its inherent parallelism, as the individual routes through the solution graph can be evaluated independently. Another advantage is that the algorithm can be used in dynamically changing systems, as it can adapt well to changes, such as new energy demands or price information. 157 Chapter 6 Formalization of the Optimization Problem for Value Stacking of Flexibility 6.5.3.2 Evolutionary Computing The field of evolutionary computing studies evolutionary algorithms that mimic the process of biological evolution as presented by Darwin [ES15]. Evolutionary algorithms optimize a set of individual solution candidates using evolutionary principles, such as variation (crossover and mutation) and selection, in order to find a sufficiently good solution to an optimization problem. Evolutionary algorithms are based on a population of individual solution candidates with different characteristics. According to the Darwinian theory of evolution, the most well-fitted individuals have a higher chance of surviving and reproducing. This way, an offspring population with new individuals is generated from the genetic material of survivors, and advantageous properties resulting from random variation are preferred by natural selection. As evolutionary algorithms conduct a directed random search for the optimal solution, they can be counted to stochastic optimization methods. Historically, different types and subfields of evolutionary algorithms emerged in parallel. In particular, the following four (non-exhaustive) categories of evolutionary algorithms can be distinguished [Wei15; Bäc96]: • Genetic Algorithms (GAs): Genetic algorithms are a prominent representative of evolutionary algorithms. Typically, they solve optimization problems using binary encodings for solution candidates. Natural evolution is mimicked by crossover, mutation, and selection. • Evolutionary Strategies: Evolutionary strategies solve optimization problems by using vectors of real numbers to encode solution candidates. Typically, they focus on potentially self-adaptive mutation and survival selection. • Evolutionary Programming: Evolutionary programming solves optimization problems by focusing on the natural representation of the problem instead of focusing on a particular encoding of solution candidates. Typically, evolutionary programming puts a high emphasis on selection. • Genetic Programming: Genetic programming solves optimization problems pri- marily by developing computer programs in an evolutionary way, e. g., representing code by trees. The fitness is determined by the computer program’s ability to solve a problem. The terminology used in the context of evolutionary algorithms is based on biological evolution and briefly summarized in the following, where we focus on the subclass of genetic algorithms [ES15; Wei15]. In biology, the genotype describes an organism’s 158 6.5 Options for Solving Non-linear Optimization Problems complete set of genetic material, while the phenotype describes an organism’s observable appearance. Similarly, in GAs, the genotype describes the digital representation of an individual solution candidate (in the search space), and the phenotype describes the individual solution candidate’s decision variables (in the solution space). Mimicking natural evolution, GAs operate on a population, i. e., a set of individuals, also referred to as a generation. In both biology and GAs, a genotype represents an individual’s fitness only indirectly via the resulting phenotype. In biology, natural selection is driven by environmental conditions and causes individuals with high environmental strength (i. e., a high fitness) to be more likely to pass on their genes to the offspring generation. In GAs, the selection (also referred to as survival or environmental selection) of individuals is based on the fitness function. Evolutionary pressure results in the fact that individuals with low fitness tend to be eliminated in the transition to a new generation, while individuals with high fitness are retained with a higher probability. Important aspects in the design of a GA are the genotypic encoding describing the solution candidate’s phenotype and the related genotype-phenotype transformation. Motivated by the good adaptability to a wide range of scenarios with potential further objective function components and non-linearities, we chose to solve the introduced problem using a genetic algorithm. The implementation is detailed in the upcoming Chapter 7. Concluding this chapter and the discussion of options for solving non-linear optimization problems, it is worth mentioning stochastic programming and robust optimization (as introduced in Section 2.5.1), which provide alternative approaches for dealing with uncertainty in the optimization. 159 CHAPTER 7 Design and Implementation of a Genetic Algorithm In this chapter, we propose a genetic algorithm that can be deployed in the proposed Facility Energy Management System. The genetic algorithm solves the optimization problem of turning electric flexibility regarding time and power into monetary benefits via bidding to the day-ahead spot and aFRR balancing markets, as formulated in Chapter 6. After discussing major design choices and evolutionary operators in the context of genetic algorithms, we present their choice and configuration, the genotype-phenotype transformation, and the restriction handling. Then, focusing on a binary representation, we present exemplary bit string encodings suited for the exemplary chosen facility devices and show how they are embedded into the overall optimization scheme. The optimization builds upon the FEMS interfaces and simulation models presented in Chapter 4, and the aFRR activation insights gained in Chapter 5. 7.1 Methodology Genetic algorithms are metaheuristics providing a blueprint in the form of an abstract set of structures, objects, and methods that can be adjusted to different optimization problems [BR03]. General rules guaranteeing the design of an effective and efficient genetic algorithm are not available [Kru+15]. However, a methodological guideline can be described as follows [Wei15]: Firstly, clarity regarding requirements and design alternatives can be achieved by conducting a detailed requirements analysis covering a definition of the problem with a description of the phenotypic search space, the optimization goal, requirements on the optimization, and a description of problem- specific knowledge. For the given optimization problem, a detailed problem analysis was already presented in Chapter 6. Secondly, insights regarding the suitability of a genetic algorithm can be gained by a problem analysis and risk assessment that 161 Chapter 7 Design and Implementation of a Genetic Algorithm comprises a literature review (as presented in Chapter 3) as well as a discussion of the characteristics of the optimization problem and its complexity (as presented in Chapter 6). Finally, suppose the choice of a genetic algorithm turns out to fit well for solving a given problem. In that case, the genetic algorithm, appropriate operators, and different alternatives for the genotypic representation of the phenotypic search space can be designed, implemented, and comparatively evaluated. This chapter addresses the design and implementation of the proposed genetic al- gorithm, which can be considered as an iterative process composed of two sub-steps [Wei15]. The first step addresses the design and implementation of genetic operators, the genotype-phenotype transformation, and the fitness function. The second step addresses the parameterization of the genetic algorithm and the genetic operators, including an analysis of the search dynamic. We iteratively executed these steps to com- pare alternative encodings and achieve effective and efficient genotype representations and parameterizations. While our initial choice for genetic operators is based on the literature, details of the parameterization are presented in Section 8.3 of the upcoming chapter. 7.2 Design Choices and Genetic Operators In this section, we give an overview of important design choices and operators in the context of genetic algorithms and discuss them with respect to their adequacy for the given problem. 7.2.1 Optimization Cycle and Encoding Genetic algorithms mimic natural evolution in the form of an evolutionary optimization cycle, as illustrated in Figure 7.1. The figure also maps the different constraint handling options discussed later in Section 7.4.1. The optimization cycle is based on a population of solution candidates. It improves the quality of solution candidates in multiple iterations using the operators selection, crossover, and mutation, as described below. A fitness function allows rating solution candidates by assigning them a fitness value. The evaluation describes the transforma- tion of the genotype (i. e., the genetic constitution represented by a bit string) to the phenotype (i. e., the resulting solution). The genotype-phenotype transformation is described in more detail in the upcoming Section 7.3. For an efficient search of solutions, the balance between exploration and exploitation is important [ČLM13; HM20]. Exploration describes covering as much of the search 162 7.2 Design Choices and Genetic Operators Parent selection Crossover Mutation Survival selection Termination? Best solution Evaluation Evaluation Initialization Penalty function Legal decoding Genetic repair Adaptive mutation Crib death Legal parent selection Method of valid individuals Legal replacement Figure 7.1: Evolutionary optimization cycle and mapping of different constraint handling approaches; based on [Wei15]. space as possible, and exploitation describes focusing on improving the already found best solutions. In genetic algorithms, the balance between exploration and exploitation is reached by proper parameterization of the genetic operators crossover and mutation (mainly for exploration) and selection (mainly for exploitation). A common view is that the degree of exploration should decrease with search time, and the degree of exploitation should increase with search time. The literature discusses the impact of different parameters on exploration and exploitation [ES98] and suggests different strategies for controlling exploration and exploitation via the parameterization of genetic operators [ČLM13]. Different options are available for encoding a solution candidate’s phenotype [ES15]. The classical encoding used in genetic algorithms is binary encoding, which uses a bit string to represent the decision variables. Alternatives are, e. g., floating point repre- sentations. As we are optimizing discrete values (see Section 6.4.1), binary encoding is the native and most efficient way of representing information in a digital system. An exemplary bit-string based encoding is visualized in Table 7.1. The example shows two decision variables denoted as variables 𝑎 and 𝑏. The bits describe the genotype (i. e., the genetic constitution), and the decision variables describe the phenotype (i. e., the resulting solution as visualized in Figure 6.1). The transformation from a genotype 163 Chapter 7 Design and Implementation of a Genetic Algorithm to a phenotype is called genotype-phenotype transformation (or genotype-phenotype mapping). Using binary encoding, a genotype composed of 𝑛 bits can, at maximum, encode 2𝑛 different phenotypes. Table 7.1: Concept of the binary encoding of a phenotype. Phenotype ... Variable a Variable b ... Genotype ... 1 1 0 1 0 1 1 0 ... As genetic algorithms are metaheuristics providing a framework with abstract building blocks that must be adjusted to a concrete problem, a key aspect in designing genetic algorithms is finding adequate representations for the problem. Generic rules that guarantee to find suitable encodings do not exist; however, it is worth striving for the following three characteristics of an encoding [Kru+15]: 1. Similar phenotypes should be encoded by similar genotypes. 2. Similar genotypes should result in a similar fitness. 3. The valid search space should be closed for the genetic operators applied to the genotypes (i. e., the genetic operators should preferably not result in invalid solutions). It is worth noting that these characteristics are only guiding principles and, depending on the specific problem, it may be beneficial to deviate from these rules [Kru+15]. In the case of bit string encodings, one aspect supporting the first point is the usage of Gray codes rather than classical binary encoding [Wei15]. For example, in the case of a classical binary encoding, a mutation from the genotype value 011 (representing the decimal value 3) to the genotype value 100 (representing the neighboring decimal value 4), requires flipping all three bits, also referred as a Hamming distance [Ham50] of three. Gray codes can be used to minimize the Hamming distance. In Gray codes, each two directly neighboring values of the solution space are represented by two genotype bit strings with a Hamming distance of one, thus supporting that similar phenotypes are encoded by similar genotypes. The encodings presented later make use of Gray encoding. Before presenting the genotype-phenotype transformation for the problem at hand (in the upcoming Section 7.3), we now first discuss different genetic operators in detail. The summary of the operators presented in the Sections 7.2.2 to 7.2.4 is based on standard literature [Wei15; ES15]. 164 7.2 Design Choices and Genetic Operators 7.2.2 Initialization and Termination Initialization refers to the generation of the initial population and termination refers to how the evolutionary optimization cycle is stopped, resulting in the finally chosen (optimal or near optimal) solution candidate. Initialization It is common to define the initial population of a genetic algorithm as a set of randomly generated individuals, each represented by a genotype. Population sizes depend on the nature of the problem, and sizes commonly found in the literature are two-digit up to multiple hundreds or thousands [ES15]. Throughout the genetic optimization cycle, the genotype is altered in multiple generations. The fitness function can rate the actual solution by mapping the genotype to the phenotype. In the literature, two ways for determining the initial population are commonly found [Wei15; ES15]: • Random: Individuals for the initial population are randomly generated using a random number generator. • Pre-calculation: Individuals for the initial population are pre-calculated to decrease the search time or increase the solution quality. In this way, the algorithm can focus on areas of the search space with a high probability of containing the optimal solution (resulting in higher exploitation vs. exploration). However, this requires that a set of known solution candidates can be efficiently generated. A potential drawback of pre-calculating solutions is that by emphasizing exploitation early, the exploration may be restricted too early. Pre-calculating solution candidates with a high initial fitness may not be worth the effort. This is because fitness improvements that can be reached between two genera- tions are relatively high in the first generations while decreasing over time in further generations [Wei15]. Due to the lack of pre-calculated solution candidates, we choose to populate the first generation with randomly generated individuals. The typical behavior with relatively high fitness improvements in the first generations can be well recognized in the evaluation in Figure 8.5. Termination Different ways are possible to decide when to end the evolutionary optimization cycle. The most common ways are [Wei15; ES15]: • Number of generations or time: The optimization cycle is stopped after a cer- tain number of generations or a certain time. This is a commonly chosen way, particularly useful in the presence of restrictions to the available optimization time. 165 Chapter 7 Design and Implementation of a Genetic Algorithm • Fitness threshold: The optimization cycle is stopped after reaching a certain fitness threshold. For example, this can be done if the best possible fitness of an optimum solution can be estimated or if it is possible to define the fitness of a sufficiently good solution. • Stagnating fitness improvement delta: The optimization cycle is stopped if the fitness of, e. g., the best solution candidate of a generation is not improved by more than a certain threshold compared to the previous generation. • Allocated budget threshold: The optimization cycle is stopped if the allocated bud- get in the form of computing power, such as CPU time or related costs, is reached. This may be particularly interesting for computation-intensive optimizations that are outsourced following the cloud computing paradigm. Due to the time restrictions introduced by the fixed gate closures at the DA and aFRR markets (see Section 6.4.2), we choose to stop the optimization after a fixed number of generations. This highly correlates with the optimization time. Therefore, in the evaluation in Section 8.3.3, we analyzed the fitness development over time and decided after how many generations to stop. 7.2.3 Selection, Crossover, and Mutation The three main operators of a genetic algorithm are the selection operator, the crossover operator, and the mutation operator. The selection operator results in an evolutionary pressure and steers the population towards solutions with high fitness. The crossover and mutation operators are responsible for variation within the population of solution candidates. Parent Selection The selection operator is used for nominating parents for the crossover. Mimicking the concept of survival of the fittest, the parent selection and the survival selection described below are the only directed part in the evolution of the solution candidates. The following three selection operators for choosing parent individuals are commonly found in the literature [Wei15; ES15]: • Fitness-proportional selection: The solution candidates of a population are sorted according to their fitness. Then, the selection is made with a probability pro- portional to the individuals’ fitness. Consequently, solution candidates with high fitness have a higher probability of being selected. 166 7.2 Design Choices and Genetic Operators • Rank-based selection: Again, the solution candidates of a population are sorted ac- cording to their fitness. Then, the selection is made with a probability proportional to the rank (in contrast to the fitness score, as in the case of the fitness-proportional selection). • Tournament selection: Multiple solution candidates are randomly chosen, e. g., two in case of binary tournament selection. Then, they are compared in a deter- ministic competition and the fittest solution candidate is chosen as the winner. Parent selection can happen with or without returning the selected solution candi- dates into the pool of possible solution candidates, whereby returning selected solution candidates is a way commonly chosen in the existing literature. We choose binary tournament selection (and return selected solutions candidates into the pool) as it is an established default operator repeatedly recognized to result in a good evolution of the solution candidates. Furthermore, using tournament selection results in performance benefits as the fitness rating is only required for the tournament candidates rather than for the whole population as in the case of the two other presented selection operators [ES15]. Survival Selection While the parent selection chooses parent individuals to extend the population by newly combined offspring individuals (generated via the crossover operator), the survival selection chooses individuals who survive into the next generation. Consequently, survival selection comes with a trade-off between the exploitation of individuals with high fitness and the exploration of the search space. In the literature, survival selection is also referred to as replacement or environmental selection [ES15]. Survival selection can be implemented in two manifestations defining how individuals are brought into the next generation [Wei15; ES15]: • Generational replacement: In each generation, the offspring individuals replace their parent individuals. If the offspring generation is the same size as the parent generation (which is the commonly recommended case [ES15]), an additional selection operator for the survival selection is not required. Then, only a parent selection operator is required to determine the parent individuals as described above. • Steady-state replacement: In steady-state replacement, in each generation, only a few individuals in the population are replaced by the offspring. These replaced individuals are not necessarily the parent individuals. In this case, an operator for the survival selection (or replacement) is required. In principle, the selection 167 Chapter 7 Design and Implementation of a Genetic Algorithm operators for parent selection presented above can be used; however, the existing literature suggests dedicated survival operators, e. g., depending on age or fitness [ES15]. Survival selection can be enhanced by the concept of elitism, which is also referred to as elitist selection. Elitism describes the idea of always keeping one or more of the fittest individuals in the population. It allows for protecting individuals with an already high fitness from further potentially destructive mutation. Consequently, applying elitism guarantees that the quality of the fittest solution candidate(s) will never decrease from one generation to the next. In the implementation presented later, we use the classical generational replacement, enhanced by the concept of elitism. Crossover The crossover operator combines selected parent individuals to generate offspring individuals. Crossover is also referred to as recombination. Commonly, two parent individuals are combined to generate two offspring individuals. In genetic algorithms, crossover probabilities are typically in the range of 60–90 % [Wei15]. Once the parent individuals are chosen by a selection operator, the crossover operator decides how they are combined for generation of the offspring individuals. The following three crossover operators are commonly found in the literature [Wei15; ES15]: • One-point crossover: Parent 1 and parent 2 are cut at the same randomly chosen point, and then one of the two parts of each parent is interchanged with the respective part from the other parent. If 𝑎1, 𝑎2 and 𝑏1, 𝑏2 are the two individuals 𝑎 and 𝑏 after the cut, the result of the crossover would be the individuals 𝑎1, 𝑏2 and 𝑏1, 𝑎2. • 𝑛-point crossover: This crossover variant is analogous to the one-point-crossover, however, with 𝑛 instead of one crossover points. The offspring individuals inherit parts from each of their parent individuals in an alternating way. • Uniform crossover: For each heritable part (i. e., each bit) of the offspring individ- ual, it is individually decided from which parent individual it is inherited. This choice can be made with the same probability for each parent or with different probabilities per parent. The latter allows steering towards inheriting more genetic information from one parent than the other. While the literature suggests further variants, high success rates are often reported for the two-point crossover. An increased ability to interchange selected parts of a solution candidate that potentially decrease the fitness can explain this. We choose the 𝑛-point 168 7.2 Design Choices and Genetic Operators crossover, which we adapt to the given problem as presented in Section 7.6. The impacts of different crossover probabilities are discussed in Section 8.3. Mutation In order to maintain genetic diversity in the population, mutation allows for exploring the search space by randomly changing individuals. The mutation operator is usually applied with a relatively low probability to not endanger the inheritance of the parental characteristics. If the mutation probability is too high, the search is equal to a pure random search. Then, the benefits of a directed search do not come into effect. The classical mutation operator for bit string encoded solution candidates is the bit flip. It changes a single bit from 0 to 1 or vice versa. For a bit string with length 𝑛, the existing literature, with a high consensus, suggests bit flip probabilities in the area of 1/𝑛 [Wei15]. Consequently, we mutate individuals by bit-wise flipping and discuss the impact of different bit flip probabilities in Section 8.3. 7.2.4 Fitness Evaluation In order to achieve a directed rather than a random search, the selection operators require calculating the solution candidates’ fitness values. This is done using a problem- specific fitness function applied to the phenotype. Consequently, the first step of the fitness evaluation is the transformation of a genotype to its phenotype. Commonly, the genotype-phenotype transformation and the application of the fitness function are the most time-consuming parts of the whole optimization cycle. Therefore, lazy evaluation can be used to improve evaluation performance. It describes the idea of not evaluating all solution candidates of the whole population but only the ones that require a fitness rating as the selection operator chooses them. Consequently, whether a lazy evaluation is possible depends on the selection operator. For example, in the case of tournament selection, only a selected set of solution candidates has to be compared. In contrast, fitness-proportional selection requires the evaluation of all solution candidates in order to sort them by their fitness. After laying the foundation with a detailed overview of the relevant concepts, the upcoming Sections 7.3 to 7.5 describe the overall genotype-phenotype transformation and the fitness evaluation for the problem at hand. 169 Chapter 7 Design and Implementation of a Genetic Algorithm 7.3 Genotype-Phenotype Transformation: Profile Generation We showed that a genotype represents an individual’s complete set of genetic material, and a phenotype represents the individual’s complete observable set of characteristics. The genotype is the bit string processed by the previously explained optimization cycle. We define the phenotype as device-specific DA power level profiles, aFRR capacity level profiles, and aFRR energy price profiles. The fitness function can rate these profiles to reflect the resulting cost savings. The phenotype of a device consists of one or more of the named profiles, with the number of profiles depending on the energy forms (electricity, heat, cold, gas) to which a device is linked. The overall genotype-phenotype transformation can be separated into three categories, which in turn can be separated into multiple steps as visualized in Figure 7.2: • Profile generation: steps P1 to P3 (explained in this section) • Constraint handling: steps C1 to C3 (explained in Section 7.4) • Fitness evaluation: steps F1 and F2 (explained in Section 7.5) We start by explaining the profile generation represented by the first three steps P1–P3. For each device, these steps transform a part of the bit string to a DA power level profile, two aFRR capacity level profiles (one for negative and one for positive aFRR), and two aFRR energy price profiles (again, one for negative and one for positive aFRR). We previously investigated alternative versions of the presented genetic algorithm [Huf15; Hol16]. It is worth noting that the version presented in the following strongly differs, e. g., regarding the overall structure, assumptions, and encodings. In the broader context of GA-based energy management, it is worth referring to Allerding [All14] and Mauser et al. [Mau17; Mau+16; Mau+14]. They propose optimizations and GA encodings for scheduling flexible devices in the context of buildings, mainly incentivized by price signals. However, in contrast to pure price-based scheduling, the provision of potential schedule deviations in the form of aFRR balancing power comes along with strongly different requirements, as presented in the previous Chapter 6. 170 7.3 Genotype-Phenotype Transformation: Profile Generation ⁝ ⁝ aFRR revenue device 1 DA power level profile t aFRR capacity level profile t aFRR energy price profile t (λ per 1 h) (aFRR energy price per 4 h) DA energy delta profile (per energy carrier) t aFRR energy delta profile (per energy carrier) t Bit string optimized by genetic algorithm Capacity-based aFRR revenues Device 1 Prediction of aFRR capacity prices Energy-based aFRR revenues (Δλ per 4 h) (kWh per 1 h) (kWh per 1 h) C2 C4 F1F1 F1 F2 F2F2 Total aFRR market revenues Total gas costs Total grid feesUncontrollable on-site demand (per energy carrier) t (kWh per 1 h) Total DA spot market costs Aggregation of all DA and aFRR electric energy delta profiles Aggregation of all DA and aFRR gas energy delta profiles Aggregation of all aFRR revenues Aggregation of all DA energy delta profiles Total energy costs Prediction of DA spot market prices F2 F2 Device 2 Device n The number of profiles per device depends on the energy form(s) a device is associated with pos. aFRRneg. aFRR pos. aFRRneg. aFRR DA power aFRR capacity P1 C1 P3Decoding Deriving schedules for the associated energy forms Deriving schedules for the associated energy forms 01010101…01010101 01010101…01010101 01010101…01010101 0101…01010 0101…01010 F2 F2 F2 F2 DecodingDecoding P2 C2 P C F Profile generation Constraint handling Fitness evaluation Legend: Numbered steps Mapping of aFRR energy price to expected activation Facility λ Δλ EUR/ MWh kWh kWh kWh aFRR energy price P2 P3 C4Figure7.2:Overviewoftheoverallgenotype-phenotypetransformationwithamappingofthestepsforprofilegeneration,constrainthandling,andfitnessevaluation. 171 Chapter 7 Design and Implementation of a Genetic Algorithm 7.3.1 Handling of Devices and Storages In general, we represent each device with a dedicated energy storage in the genotype as visualized in Figure 7.2. However, if multiple devices are connected to the same energy storage, and one of them does not directly consume or provide electric energy, this device can be treated differently. In the given setup, both the CHP and the condensing boiler are connected to the same thermal energy storage, which in turn is connected to the facility’s heat demand via the local heat grid (see Figure 4.1). Consequently, concerning heat generation, the CHP plant and the condensing boiler can be used to substitute each other. For the combined optimization of both devices, we make use of the fact that the facility’s heat demand can be satisfied by the sum of the CHP plant’s and the condensing boiler’s heat generation. Therefore, we abstain from introducing an additional degree of freedom for the condensing boiler by indirectly deriving the decisions regarding the condensing boiler from the decisions regarding the CHP. This way, only the CHP plant is explicitly represented in the genotype, and during the genotype-phenotype transformation, we define that the condensing boiler always satisfies the remaining heat demand. This allows for reducing the size of the genotypic search space. The implementation of this particular case is explained in more detail in the context of the fitness evaluation in Section 7.5.1. 7.3.2 P1: Mapping to Day-ahead Power Level Profiles Table 7.2: Generation of the DA power level profile 𝜆𝑑,𝑡 for device 𝑑 in hour 𝑡. (a) Encoding for devices with bidirectional power flow (e. g., battery storages) 𝑏 DA 𝑑,𝑡,2 𝑏 DA 𝑑,𝑡,1 𝑏DA 𝑑,𝑡,0 𝜆 DA 𝑑,𝑡 0 0 0 +3 0 0 1 +2 0 1 1 +1 0 1 0 +0 1 1 0 –0 1 1 1 –1 1 0 1 –2 1 0 0 –3 (b) Encoding for devices with unidirectional power flow (e. g., CHP plants) 𝑏DA 𝑑,𝑡,2 𝑏 DA 𝑑,𝑡,1 𝑏 DA 𝑑,𝑡,0 𝜆DA 𝑑,𝑡 0 0 0 0 (off) 0 0 1 1 0 1 1 2 0 1 0 3 1 1 0 4 1 1 1 5 1 0 1 6 1 0 0 7 In this step, for each device 𝑑 ∈ 𝔻, we convert a part of the genotype to a DA power level profile. A DA power level profile is a vector with 24 power levels 𝜆DA 𝑑,𝑡 that indirectly 172 7.3 Genotype-Phenotype Transformation: Profile Generation represent the hourly DA spot market power per device per day.1 In the device modeling in Section 4.4, we showed that the considered devices are controllable in different steps in the range of [𝑝𝜉 𝑑, 𝑝𝜉 𝑑]. We also showed that the power level 𝜆DA 𝑑,𝑡 can be converted to power values (see, e. g., Figure 4.3) for all energy forms with which a device is associated (see Table 4.1). Consequently, a device’s power level profile can be converted to power profiles for all related energy forms. For example, in the case of a CHP, the DA power level profile can be converted to a DA power profile for electricity, a DA power profile for heat, and a DA power profile for gas. The bit string encoding for determining the power level for the DA scheduling for one single hour is depicted in Table 7.2. In the table, 𝑏𝑑,𝑡,𝑖 refers to the 𝑖-th bit of the bit string part for device 𝑑 in time slot 𝑡. The exemplary depiction in the table assumes that 3 bits suffice for specifying the available power levels. We can distinguish two kinds of devices. For devices with bidirectional electric power flows (Table 7.2a), such as battery energy storage systems, 𝑝el 𝑑 is negative and 𝑝 el 𝑑 is positive. For devices with unidirectional electric power flows (Table 7.2b), such as CHP plants or AC units, 𝑝el 𝑑 and 𝑝 el 𝑑 are both either negative (CHP generating electric energy) or positive (chiller consuming electric energy). Given a device that can be controlled in 𝑛 power levels within its power range, these power levels can be represented by ⌈log2 𝑛⌉ bits using a binary representation. As DA spot market decisions are made per hour, we use ⌈log2 𝑛𝑑⌉ bits per hour for each controllable device 𝑑. Consequently, a device that is controllable in, e. g., 𝑛 = 8 power level steps requires ⌈log2 8)⌉ = 3 bits/hour or 72 bits/day for the power level profile, as shown in Table 7.2. 7.3.3 P2: Mapping to aFRR Capacity Level Profiles In this step, for each device 𝑑 ∈ 𝔻, a part of the genotype is converted to one aFRR − capacity level profile, and another part to one aFRR+ capacity level profile. An aFRR capacity level profile is a vector representing the power level deltas Δ𝜆aFRR − 𝑑,𝑡 for negative aFRR or the power level deltas Δ𝜆aFRR + 𝑑,𝑡 for positive aFRR, relative to the power level profile resulting from step P1 and per four-hour aFRR product slot. Consequently, the aFRR − capacity level profile and the aFRR+ capacity profile each result in six capacity values per device per day. The maximum possible downwards and upwards delta of the power level represents the aFRR capacity range. For each aFRR direction, 𝑛 different power level deltas can be represented by ⌈log2 𝑛⌉ bits using a binary representation. Depending on the device 1In the device modeling presented in Chapter 4, this entails a minimum runtime of 𝜔 = 60 min. 173 Chapter 7 Design and Implementation of a Genetic Algorithm Table 7.3: Generation of the aFRR capacity level profiles Δ𝜆aFRR − 𝑑,𝑡 and Δ𝜆aFRR+ 𝑑,𝑡 for device 𝑑 in four-hour aFRR slot 𝑡 ∈ {0, 4, 8, … , 20}. (a) Encoding for negative aFRR capacity: power level increase 𝑏 aFRR − 𝑑,𝑡,1 𝑏 aFRR− 𝑑,𝑡,0 Δ𝜆aFRR− 𝑑,𝑡 1 0 +3 1 1 +2 0 1 +1 0 0 +0 (b) Encoding for positive aFRR capacity: power level decrease 𝑏 aFRR+ 𝑑,𝑡,1 𝑏aFRR+ 𝑑,𝑡,0 Δ𝜆aFRR + 𝑑,𝑡 0 0 –0 0 1 –1 1 1 –2 1 0 –3 and the related energy storage capacity, it may be beneficial to limit the aFRR capacity by not considering the full range of possible power level deltas for aFRR provisioning. This, in particular, makes sense for devices for which it is likely that continuous aFRR provisioning with a certain power level over a full four-hour aFRR slot is not possible due to buffer limitations. We take a closer look at the usable aFRR capacity ranges in the evaluation. In step F1, which we present later in Section 7.5.1, we show how the power level delta is used for calculating the resulting energy deltas. For each device 𝑑 that provides 𝑛 possible power level deltas as aFRR capacity, ⌈log2 𝑛𝑑⌉ bits per four-hour aFRR slot are required. In our modeling, we limit the aFRR capacity to one-half of the full power band, resulting in the need for ⌈log2 𝑛/2⌉ bits per four-hour slot. Consequently, a device with four potential aFRR power level deltas requires ⌈log2 4⌉ = 2 bits per four-hour slot and aFRR direction, or 12 bits per day and aFRR direction, or 24 bits per day for both aFRR directions. The bit string decoding for the determination of the power level deltas, Δ𝜆aFRR − 𝑑,𝑡 and Δ𝜆aFRR + 𝑑,𝑡 , resulting in the aFRR capacity for one four-hour time slot is depicted in Table 7.3. It determines an aFRR capacity Δ𝜆𝑑,𝑡 for each four-hour slot 𝑡 ∈ {0, 4, 8, … , 20}. On this basis, we define the hourly aFRR capacity profile of device 𝑑 as follows: ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ Δ𝜆aFRR − 𝑑,𝑡 = Δ𝜆aFRR − 𝑑,⌊𝑡/4⌋⋅4 (7.1) ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ Δ𝜆aFRR + 𝑑,𝑡 = Δ𝜆aFRR + 𝑑,⌊𝑡/4⌋⋅4 (7.2) 7.3.4 P3: Mapping to aFRR Energy Price Profiles In this step, for each device 𝑑 ∈ 𝔻, we convert a part of the genotype to two aFRR energy price profiles. One aFRR energy price profile is generated for aFRR− and one aFRR energy price profile is generated for aFRR +Ġiven four-hour aFRR product slots, an 174 7.3 Genotype-Phenotype Transformation: Profile Generation Table 7.4: Generation of the aFRR energy price profiles 𝜋aFRR −,energy 𝑑,𝑡 and 𝜋aFRR+,energy 𝑑,𝑡 for device 𝑑 for four-hour aFRR slot 𝑡 ∈ {0, 4, 8, … , 20}. (a) Encoding for negative aFRR energy prices 𝑏 𝜋aFRR− 𝑑,𝑡,2 𝑏𝜋aFRR− 𝑑,𝑡,1 𝑏𝜋aFRR− 𝑑,𝑡,0 𝜋aFRR−,energy 𝑑,𝑡 0 0 0 𝜋aFRR − 1 0 0 1 𝜋aFRR − 2 0 1 1 𝜋aFRR − 3 0 1 0 𝜋aFRR − 4 1 1 0 𝜋aFRR − 5 1 1 1 𝜋aFRR − 6 1 0 1 𝜋aFRR − 7 1 0 0 𝜋aFRR − 8 (b) Encoding for positive aFRR energy prices 𝑏𝜋aFRR+ 𝑑,𝑡,2 𝑏𝜋aFRR+ 𝑑,𝑡,1 𝑏𝜋aFRR+ 𝑑,𝑡,0 𝜋aFRR+,energy 𝑑,𝑡 0 0 0 𝜋aFRR+ 1 0 0 1 𝜋aFRR+ 2 0 1 1 𝜋aFRR+ 3 0 1 0 𝜋aFRR+ 4 1 1 0 𝜋aFRR+ 5 1 1 1 𝜋aFRR+ 6 1 0 1 𝜋aFRR+ 7 1 0 0 𝜋aFRR+ 8 aFRR energy price profile results in six aFRR energy prices per day and aFRR direction. This way, an aFRR bid is based on the combination of an aFRR capacity level profile and an aFRR energy price profile. The analysis of aFRR energy prices conducted in Chapter 5 showed a high uncertainty in the mapping of aFRR energy prices to expected aFRR activations (see Figure 5.3). The option to choose from a large set of possible aFRR energy prices increases the possibility of steering toward the desired activation behavior. However, due to the associated uncertainty (particularly for low aFRR energy prices), a fine-granular distinction between different aFRR energy prices is not required. Furthermore, limited options imply a smaller solution space. We can represent 𝑛 different aFRR energy prices using ⌈log2 𝑛)⌉ bits. Due to the above reasons, we decided to choose from a set with eight different aFRR energy prices per aFRR direction. We denote the sets of aFRR energy prices to choose from as ℿaFRR − and ℿaFRR +, and use 𝜋aFRR − 𝑖 ∈ ℿaFRR − and 𝜋aFRR + 𝑖 ∈ ℿaFRR + to refer to the 𝑖-th reserve energy price of the respective ascendingly ordered set of aFRR energy prices. Consequently, as bids to the aFRR market are made per four-hour slot and when assuming eight different aFRR energy prices (i. e., |ℿaFRR −| = 8 and |ℿaFRR +| = 8), we can use ⌈log2 8⌉ = 3 bits per four-hour-slot per aFRR direction. Table 7.4 presents the chosen encoding for negative aFRR energy prices (Figure 7.4a) and positive aFRR energy prices (Figure 7.4b). It results in 3 bits per four-hour aFRR slot and aFRR direction, or 36 bits per day to represent all possible aFRR energy prices for both directions. 175 Chapter 7 Design and Implementation of a Genetic Algorithm 7.4 Genotype-Phenotype Transformation: Constraint Handling The previous section described the generation of the initial DA power level profiles, aFRR capacity level profiles, and aFRR energy price profiles. These profiles are generated independently in the first place. Nevertheless, the encoding itself already handles some constraints, such as minimum runtimes or the discretization of power levels. The handling of further constraints not already handled via the encoding is discussed in the following. To begin with, we give a focused overview of different methods to handle constraints in genetic algorithms. This overview sets the basis for a profound discussion of options for constraint handling in the given problem. 7.4.1 Discussion of Approaches for Constraint Handling Constraint-handling methods in genetic algorithms can be separated into two main classes: restrictive and tolerant methods. The first class represents restrictive methods that conduct an optimization on an unrestricted search space, but introduce measures to prevent the generation of invalid solution candidates [Wei15]: • Crib death: Invalid individuals are deleted directly after their generation. This approach works well, given constraints with a simple structure. However, it may not be well suited in the case of rugged solution spaces. In order to reach areas of the solution space that are constrained in a complex way, allowing for invalid parents may be beneficial. • Genetic repair: Invalid individuals are repaired to satisfy the constraints. Con- sequently, fewer individuals have to be created as in the case of the crib death. However, depending on the problem, it may be challenging to design a suitable repair algorithm. Genetic repair can be seen as a particular case of adding a local search to the genetic algorithm. • Method of valid individuals: Invalid individuals are avoided by design, which can be reached by two measures. Firstly, the initial population has to be popu- lated with valid individuals only. Secondly, the mutation and crossover operators must be designed to always result in valid individuals. However, meeting these requirements may be very challenging. 176 7.4 Genotype-Phenotype Transformation: Constraint Handling The second class of constraint handling methods represents tolerant methods. They allow for invalid solution candidates in the population that are, however, discriminated against other solution candidates in the course of the simulated evolution [Wei15]: • Legal parent selections: Invalid individuals are strongly disadvantaged by choos- ing only valid individuals (or individuals with low constraints violation) as parents. This method may suit well for problems with high difficulty in satisfying the constraints, such as fulfillment problems. • Legal replacement: Legal replacement is intended to work with (steady-state) algorithms that put individuals generated in a new generation back into the parent population. This method disadvantages invalid individuals by considering the constraint violation in deciding which individual to replace. Individuals with a high degree of constraint violation are preferably replaced. This method can be seen as universally suitable for problems with limited information about constraint characteristics. • Adaptive mutation: This method dynamically adjusts the mutation operator to generate valid individuals predominantly. In summary, the method divides the search space into multiple parcels. Individuals in each parcel are classified as valid or invalid. Depending on the ratio of valid and invalid individuals, a parcel is classified as unknown, invalid, valid, or half-valid. The mutation in unknown, valid, and half-valid parcels is adapted so that individuals stay within the parcel as much as possible. The mutation in invalid parcels is adapted such that individuals preferably jump into a valid parcel. This method may be well suited for problems without knowledge about valid areas. • Legal decoding: Legal decoding is a tolerant variant of genetic repair. It also requires a repair algorithm to convert an invalid to a valid individual. However, in legal decoding, the repair algorithm is used only for evaluating individuals, and the genotype is not adjusted. Furthermore, in contrast to genetic repair, the decoder in legal decoding should be deterministic such that individuals with small modifications in future generations are repaired equally, resulting in similar phenotypes. • Penalty function: Penalty functions are the most popular constraint-handling method. Penalty functions allow invalid individuals to exist in the population. However, they penalize infeasible solutions by reducing their fitness values in proportion to the degree of constraint violation. Two approaches for fitness calcu- lation can be separated. Firstly, the violation of constraints may make it impossible 177 Chapter 7 Design and Implementation of a Genetic Algorithm to calculate the fitness. Then, a fitness value can be determined independently of the normal fitness calculation. Secondly, using the normal fitness function may be possible despite the constraint violations. Then, the result of the penalty function can be added to the original fitness. In parameterizing the penalty function, the degree to which artificial fitness values falsify the resulting fitness should be taken care of. Out of the methods for handling constraints in genetic algorithms discussed above, we use the concepts of genetic repair, legal decoding, and penalty functions. In the following Sections 7.4.2 to 7.4.4, we present why we chose these concepts and how we finally implemented them for handling the constraints of the problem at hand. 7.4.2 C1: Genetic Profile Repair According to Power Restrictions In this step, we handle the constraint that the DA power and the related aFRR capac- ity must not exceed a device’s maximum possible power generation or consumption (see Equations 6.13 and 6.14). In the previous sections, the DA power level profiles (granularity: one hour) and the aFRR capacity level profiles (granularity: four hours) are generated independently in the first place. The maximum possible offered aFRR capacity depends on the committed DA spot market schedule and the device’s minimum and maximum power restriction. Consequently, if a solution candidate violates these power constraints (e.g., 3/4 𝑝 el for day-ahead charging + 1/2 𝑝el for negative aFRR > 𝑝 el), we repair the power values of these invalid solutions to valid power pairs. We decided to do this by adjusting the power level determined by the DA power profile to the maximum technically possible power level. The correction of a device’s DA power level profile based on its aFRR capacity level profiles for negative and positive aFRR is calculated as follows (with 𝜆𝑑 referring to the maximum and 𝜆𝑑 to the minimum possible power level): ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ 𝜆DA 𝑑,𝑡 = ⎧ {{ ⎨ {{ ⎩ 𝜆𝑑 − Δ𝜆aFRR − 𝑑,𝑡 if 𝜆DA 𝑑,𝑡 + Δ𝜆aFRR − 𝑑,𝑡 > 𝜆𝑑 𝜆𝑑 − Δ𝜆aFRR + 𝑑,𝑡 if 𝜆DA 𝑑,𝑡 + Δ𝜆aFRR + 𝑑,𝑡 < 𝜆𝑑 𝜆DA 𝑑,𝑡 otherwise (7.3) Given the above example, the DA power would be corrected to 1/2 𝑝el. In Equation 7.3, we can recognize that at maximum, one of the three conditional clauses evaluates to true; this is the case as we limited the capacity available for negative and positive aFRR to one-half of the technically available power band (in Section 7.3.3). 178 7.4 Genotype-Phenotype Transformation: Constraint Handling We chose to adjust the DA power level profile instead of the aFRR capacity level profile due to the computational complexity: Adjusting DA power level profiles is computationally easier than adjusting aFRR capacity level profiles. The latter cover four hours, introducing interdependencies to neighboring time slots, while DA power level profiles only cover one hour. Therefore, the presented repair comes along with relatively low overhead. We chose the genetic repair, which adjusts the genotypic bit string according to the repaired power level, which can be seen as a particular case of adding a local search to the genetic algorithm. We decided not to use crib death due to the relatively high share of repaired solution candidates and to allow for a more directed rather than random search. 7.4.3 C2: Legal Decoding Concerning aFRR Product Slot Duration In this step, we handle the constraint that some devices are only controllable in a limited power band as long as they are in state 𝑠𝑑,𝑡 = 1 (on), which is represented by a power level 𝜆 > 0. This device characteristic is visualized in Figure 4.3 (for the example of the CHP). This step only addresses devices that need to be in the state “on” to be controllable. For example, this applies to the CHP (change from 𝜆 = 0 to 𝜆 = 1 is not possible within the minimum runtime 𝜔 = 1 h) but not to the battery storage system (change from 𝜆 = 0 to 𝜆 = 1 is possible without a minimum runtime). Consequently, for these devices, aFRR provisioning is only possible if the device is in the state “on” in each of the four hours of the aFRR product slot. Therefore, we use the mechanism of legal decoding to adjust the genotype interpretation in the genotype-phenotype transformation as described in Algorithm 7.1. Suppose, according to the DA power level profile, a device is not turned on in all four hours of an aFRR product slot. In that case, the algorithm decodes the aFRR capacity level profile such that it does not provide aFRR capacity in any of the four hours of the related aFRR product slot. We decided to use legal decoding, i. e., to adjust the phenotype in a deterministic way without changing the genotype. Legal decoding allows keeping respective invalid solution candidates in the population as they may have a high chance of evolving to valid solution candidates in subsequent generations due to the limited number of involved genotypic bits. 7.4.4 C3: Penalty Function for SOC Constraints In the two previous sections, we explained how to use genetic repair to adjust the DA power level profile (C1) and legal decoding for adjusting the interpretation of the aFRR capacity level profile (C2). Yet, constraints guaranteeing that SOCs are never violated 179 Chapter 7 Design and Implementation of a Genetic Algorithm Algorithm 7.1 Adjustment of a device’s aFRR capacity level profile: Do not offer aFRR capacity in aFRR product slots in which the device is not “on” in all four hours. Inputs: 1. 𝑠DA 𝑑,𝑡: A DA device state profile of a device 𝑑 for all hours 𝑡 ∈ {0, 1, … , 23}, based on the initial part of the genotype-phenotype transformation as depicted in Table 7.2. 2. Δ𝜆aFRR − 𝑑,𝑡 , Δ𝜆aFRR + 𝑑,𝑡 : Negative and positive aFRR capacity level profiles of a device 𝑑 for all hours 𝑡 ∈ {0, 1, … , 23}, based on the initial part of the genotype-phenotype transformation as depicted in Table 7.3. Steps: for each four-hour slot 𝑘 in {0, 4, 8, … , 20} do 𝑑𝑒𝑣𝑖𝑐𝑒𝑂𝑓 𝑓 𝐼𝑛𝐴𝑡𝐿𝑒𝑎𝑠𝑡𝑂𝑛𝑒𝑆𝑙𝑜𝑡 ← false for each one-hour slot 𝑡 in {𝑘, 𝑘 + 1, 𝑘 + 2, 𝑘 + 3} do if 𝜆DA 𝑑,𝑡 = 0 then 𝑑𝑒𝑣𝑖𝑐𝑒𝑂𝑓 𝑓 𝐼𝑛𝐴𝑡𝐿𝑒𝑎𝑠𝑡𝑂𝑛𝑒𝑆𝑙𝑜𝑡 ← true break end if end for if 𝑑𝑒𝑣𝑖𝑐𝑒𝑂𝑓 𝑓 𝐼𝑛𝐴𝑡𝐿𝑒𝑎𝑠𝑡𝑂𝑛𝑒𝑆𝑙𝑜𝑡 == true then for each one-hour slot 𝑡 in {𝑘, 𝑘 + 1, 𝑘 + 2, 𝑘 + 3} do Δ𝜆aFRR − 𝑑,𝑡 ← 0 Δ𝜆aFRR + 𝑑,𝑡 ← 0 end for end if end for Outputs: Δ𝜆aFRR − 𝑑,𝑡 , Δ𝜆aFRR + 𝑑,𝑡 : The updated negative and positive aFRR capacity level profile of device 𝑑 for all hours 𝑡 ∈ {0, 1, … , 23}, which is set to 0 for all hours within an aFRR product slot if the device is off for at least one of the four hours according to 𝜆DA 𝑑,𝑡. and that aFRR can always be provided, even in the two extreme activation cases (see Equations 6.16 and 6.17), have not been considered. We use a penalty function to handle the 𝑆𝑂𝐶 and 𝑆𝑂𝐶 constraints in the extreme activation cases (which also covers the expected activation case). The penalty function devalues solution candidates that are not capable of realizing the expected schedule or that cannot guarantee the provision of aFRR capacity over the whole four-hour aFRR product slot. We quantify the penalty for solution candidates whose SOC potentially (in case of extreme aFRR activations) exceeds 𝑆𝑂𝐶𝑑 or falls below 𝑆𝑂𝐶𝑑. Therefore, in the first step, we calculate the theoretical hourly excess SOC points above 𝑆𝑂𝐶, which we denote Δ𝑆𝑂𝐶excess 𝑑,𝑡 , and the theoretically hourly shortage SOC points below 𝑆𝑂𝐶, which we 180 7.4 Genotype-Phenotype Transformation: Constraint Handling denote as Δ𝑆𝑂𝐶shortage 𝑑,𝑡 : ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ Δ𝑆𝑂𝐶excess 𝑑,𝑡 = ⎧{ ⎨{⎩ 𝑆𝑂𝐶maxUpAct 𝑑,𝑡 − 𝑆𝑂𝐶𝑑 if 𝑆𝑂𝐶maxUpAct 𝑑,𝑡 > 𝑆𝑂𝐶𝑑 0 otherwise (7.4) ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23} ∶ Δ𝑆𝑂𝐶shortage 𝑑,𝑡 = ⎧{ ⎨{⎩ 𝑆𝑂𝐶𝑑 − 𝑆𝑂𝐶maxDownAct 𝑑,𝑡 if 𝑆𝑂𝐶maxDownAct 𝑑,𝑡 < 𝑆𝑂𝐶𝑑 0 otherwise (7.5) where 𝑆𝑂𝐶maxUpAct 𝑑,𝑡 and 𝑆𝑂𝐶maxDownAct 𝑑,𝑡 represent the theoretical SOC in the case of maximum upwards and downwards activation based on the extreme aFRR activation energy deltas (see Section 6.2.3.2). For each evaluated solution candidate, these extreme energy deltas are calculated using a simulation based on the DA power level profiles and the aFRR capacity level profiles (see Equations 6.18 and 6.19). Afterwards, we minimize the fitness of solution candidates that potentially violate the SOC band, i. e., where Δ𝑆𝑂𝐶excess 𝑑,𝑡 > 0 or Δ𝑆𝑂𝐶shortage 𝑑,𝑡 > 0, by defining penalty costs that are added to the cost function. In order to prioritize the penalty costs accordingly, we define them as the result of multiplying the hourly excess or shortage SOC points with a weight 𝑤penalty: 𝑐penalty 𝑑 = 𝑇 ∑ 𝑡=0 (Δ𝑆𝑂𝐶excess 𝑑,𝑡 + Δ𝑆𝑂𝐶shortage 𝑑,𝑡 ) ⋅ 𝑤penalty (7.6) This way, the penalty for an individual solution candidate increases with the degree of possible SOC band violations: the higher the constraint violation, the higher the penalty costs. We decided to use a penalty function instead of a repair algorithm due to the resulting computational effort of repairing a solution candidate (composed of DA power, aFRR capacity, and aFRR energy price profiles for two different aFRR directions). Considering penalty costs in the fitness function, the evolution simulated by the genetic algorithm devalues solution candidates in invalid areas of the solution landscape. 181 Chapter 7 Design and Implementation of a Genetic Algorithm 7.5 Genotype-Phenotype Transformation: Fitness Evaluation Above, we showed how profiles are generated for DA power levels (P1), aFRR capacity levels (P2), and aFRR energy prices (P3). Furthermore, we showed how they are modified to handle constraints regarding power restrictions (C1), aFRR product slot durations (C2), and SOC limits (C3). The following two steps convert these profiles to expected energy delta profiles (step F1), which are finally used to calculate the fitness of solution candidates (step F2). 7.5.1 F1: Calculation of Expected Energy Delta Profiles In this step, we use the device-specific profiles introduced in the previous sections (DA power level profiles, aFRR capacity level profiles, and aFRR energy price profiles) to calculate each device’s expected hourly energy delta. We calculate DA energy delta profiles, aFRR − energy delta profiles, and aFRR + energy delta profiles. These three profiles are generated for each energy form 𝜉 ∈ {el, heat, cold, gas} to which a device is linked. This step relies on the insights on the aFRR activation behavior gained in Section 5.2. The expected aFRR activation share is estimated using the functions 𝑓 aFRR + 𝑡 (𝜋aFRR + 𝑑,𝑡 ) and 𝑓 aFRR − 𝑡 (𝜋aFRR − 𝑑,𝑡 ). As explained in Section 6.2.3.1, we assume that the expected aFRR activation share (based on the analyzed yearly activation share) is equally distributed over the single one-hour time slots. It is worth mentioning that the energy deltas represented via the aFRR energy delta profiles are only expected. The finally realized energy deltas based on the actual aFRR activation may differ (see Section 6.3). In contrast, the energy deltas represented via the DA energy delta profiles are not accompanied by external activation uncertainty. As visualized in Figure 7.2, the DA energy delta profiles (Δ𝑒𝜉 ,DA 𝑑,𝑡 ) and the aFRR energy delta profiles (Δ𝑒𝜉 ,aFRR − 𝑑,𝑡 , Δ𝑒𝜉 ,aFRR + 𝑑,𝑡 ), can be calculated as follows. The finally resulting expected energy delta is represented by Δ𝑒𝜉 ,exp 𝑑,𝑡 . All profiles are specific to the device 𝑑 182 7.5 Genotype-Phenotype Transformation: Fitness Evaluation and energy form 𝜉 ∈ {el, heat, cold, gas}, ∀𝑑 ∈ 𝔻, 𝑡 ∈ {0, 1, … , 23}: Δ𝑒𝜉 ,DA 𝑑,𝑡 = 𝑝𝜉 𝑑(𝜆DA 𝑑,𝑡) ⋅ Δ𝑡, (7.7) Δ𝑒𝜉 ,aFRR − 𝑑,𝑡 = (𝑝𝜉 𝑑(𝜆DA 𝑑,𝑡 + Δ𝜆aFRR− 𝑑,𝑡 ) − 𝑝𝜉 𝑑(𝜆DA 𝑑,𝑡)) ⋅ Δ𝑡 ⋅ 𝑓 aFRR − 𝑡 (𝜋energy,aFRR − 𝑑,𝑡 ), (7.8) Δ𝑒𝜉 ,aFRR + 𝑑,𝑡 = (𝑝𝜉 𝑑(𝜆DA 𝑑,𝑡 + Δ𝜆aFRR+ 𝑑,𝑡 ) − 𝑝𝜉 𝑑(𝜆DA 𝑑,𝑡)) ⋅ Δ𝑡 ⋅ 𝑓 aFRR + 𝑡 (𝜋energy,aFRR + 𝑑,𝑡 ), (7.9) Δ𝑒𝜉 ,exp 𝑑,𝑡 = Δ𝑒𝜉 ,DA 𝑑,𝑡 + Δ𝑒𝜉 ,aFRR − 𝑑,𝑡 + Δ𝑒𝜉 ,aFRR + 𝑑,𝑡 (7.10) These energy deltas serve as input to the fitness function presented in the next step F2. Relation Between Devices and Storages Device configurations where multiple devices are connected to one storage and are represented by one device genotype can be treated as a particular case, as presented in Section 7.3.1. We showed that the condensing boiler is a special case in the considered scenario. Divergent to the energy delta calculation above, we derive two profiles for the condensing boiler based on the CHP plant’s genotype: a DA heat energy delta profile and a DA gas energy delta profile. We use the CHP plant’s expected hourly heat supply Δ𝑒heat,exp chp,𝑡 as calculated above to derive the condensing boiler’s heat demand within the genotype-phenotype transformation: If on the basis of the CHP plant’s genotype, the sum of energy contained in the related thermal heat storage (𝑒heat,exp chp,𝑡 ) and the CHP plant’s expected heat delta (Δ𝑒heat,exp chp,𝑡 ) minus the facility’s heat demand (𝑝heat demand,𝑡 ⋅ 1 h) results in a SOC below 𝑆𝑂𝐶, the condensing boiler is used to cover the lacking heat supply (Δ𝑒heat,exp condBoiler,𝑡) for the corresponding time step 𝑡. Then, the condensing boiler’s day-ahead expected gas demand can be calculated as follows (based on the modeling of the condensing boiler in Section 4.4.5): ∀𝑡 ∈ {0, 1, … , 𝑇} ∶ Δ𝑒gas,DA condBoiler,𝑡 = Δ𝑒heat,exp condBoiler,𝑡 𝜂th condBoiler (7.11) In this particular case, the other profiles introduced in the previous sections are irrelevant, as the condensing boiler is only associated with the energy forms heat and gas. 183 Chapter 7 Design and Implementation of a Genetic Algorithm 7.5.2 F2: Fitness Function The genotype-phenotype mapping separates the overall bit string into different problem parts and converts them to profiles. These profiles serve as the basis for the market bids. The expected energy costs of a solution candidate can be calculated based on the derived expected energy delta profiles (as calculated in step F1). In the terminology of genetic algorithms, the classical objective is increasing the fitness of individuals. In our scenario, lower costs represent higher fitness. Consequently, we define fitness as the negation of the expected energy costs. The objective function depicted in Equation 6.1 allows calculating a solution candi- date’s overall expected energy costs. For a better understanding, Table 7.5 illustrates the single parts of the genetic algorithm’s cost function structured by the previously determined profiles that (indirectly) represent the decision variables. Inputs to the fitness function are shown in the first two columns. The first column shows the decision variables optimized by the genetic algorithm, and the second column shows the related exogenous inputs required for calculating the resulting cost components. The last four columns show the outputs of the fitness function based on the given profiles. The first of them shows the calculation of costs regarding the DA spot and the aFRR balancing market. The second shows the calculation of grid fees. It has to be noted that the sum of all grid fee components within a time slot cannot turn negative (see Equation 6.6). The third column shows the calculation of gas costs. The last column shows the calculation of the penalty costs. Finally, the sum of the cost components represents a solution’s overall expected energy costs. Additional cost components can be added to the fitness function without fundamental changes to the genetic algorithm’s overall problem structure or complexity. For example, cost components may be introduced to cover power-peak dependent grid fees, costs due to additional wear introduced through increased deviations from device-optimal operating states, or investment costs. For example, suppose a battery storage system can perform a certain number of charging cycles over its lifespan. In that case, this information can be utilized to attribute investment costs to a charging cycle. 184 7.5 Genotype-Phenotype Transformation: Fitness EvaluationTable7.5:FitnessfunctioninputandoutputstructuredbytheGA-optimizedprofiles.Inputtofitnessfunction:ProfilesOutputfromfitnessfunction:CostsOptimizedprofilesPredictionsMarketcostsGridfeesGascostsPenaltycosts DAscheduleDApowerlevelprofiles(↪24powerlevelsperdeviceparticipatingintheDAscheduling)Uncontrollablefacilitydemand(↪24powervalues)∑24𝑡=1((𝑝eldemand,𝑡⋅Δt+∑𝑑∈𝔻Δ𝑒el,DA𝑑,𝑡)⋅𝜋DA𝑡)∑24𝑡=1((𝑝eldemand,𝑡⋅Δt+∑𝑑∈𝔻Δ𝑒el,DA𝑑,𝑡)⋅𝜋gridFees𝑡)∑24𝑡=1∑𝑑∈𝔻(Δ𝑒gas,DA𝑑,𝑡⋅𝜋gas)EnergypricesforDAmarket(↪24energyprices) NegativeaFRRaFRR–capacitylevelprofiles(↪6powerleveldeltasperdeviceprovidingaFRR–)MappingofaFRR–energypricestotheexpectedaFRR–activationshares∑24𝑡=1∑𝑑∈𝔻(Δ𝑒el,aFRR−𝑑,𝑡⋅𝜋aFRR−,energy𝑑,𝑡+𝑝el,aFRR−𝑑,𝑡⋅𝜋aFRR−,capacity𝑑,𝑡)∑24𝑡=1∑𝑑∈𝔻(Δ𝑒el,aFRR−𝑑,𝑡⋅𝜋gridFees)∑24𝑡=1∑𝑑∈𝔻(Δ𝑒gas,aFRR−𝑑,𝑡⋅𝜋gas)∑𝑑∈𝔻𝑐penalty𝑑aFRR–energypriceprofiles(↪6energypricesperdeviceprovidingaFRR–) PositiveaFRRaFRR+capacitylevelprofiles(↪6powerleveldeltasperdeviceprovidingaFRR+)MappingofaFRR+energypricestotheexpectedaFRR+activationshares∑24𝑡=1∑𝑑∈𝔻(Δ𝑒el,aFRR+𝑑,𝑡⋅𝜋aFRR+,energy𝑑,𝑡+𝑝el,aFRR+𝑑,𝑡⋅𝜋aFRR+,capacity𝑑,𝑡)∑24𝑡=1∑𝑑∈𝔻(Δ𝑒el,aFRR+𝑑,𝑡⋅𝜋gridFees)∑24𝑡=1∑𝑑∈𝔻(Δ𝑒gas,aFRR+𝑑,𝑡⋅𝜋gas)aFRR+energypriceprofiles(↪6energypricesperdeviceprovidingaFRR+)Overallexpectedcosts=∑ofthecostcomponentsabove 185 Chapter 7 Design and Implementation of a Genetic Algorithm 7.5.3 Generation of DA Market and aFRR Market Bids After the genetic optimization cycle is terminated, the solution candidate with the highest fitness is converted into the final DA spot market and aFRR balancing market bids. These bids can be submitted directly to the markets or indirectly via a third-party intermediary that acts as an aggregator and abstracts market access barriers. In Section 4.1.3, we presented the general format of the aggregated one-hour DA spot market bids (ℬ DA 𝑡 ) and the device-specific four-hour aFRR balancing market bids (ℬ aFRR − 𝑑,𝑡 and ℬ aFRR + 𝑑,𝑡 ). Consequently, the daily optimization submits tuples in the following form to the market: ℬ DA 𝑡 = (𝑝el,DA 𝑡 , 𝜋DA 𝑡 ) (7.12) ℬ aFRR − 𝑑,𝑡 = (𝑝 el,aFRR − 𝑑,𝑡 , 𝜋aFRR −,energy 𝑑,𝑡 , 𝜋aFRR −,capacity 𝑡 ) (7.13) ℬ aFRR + 𝑑,𝑡 = (𝑝el,aFRR + 𝑑,𝑡 , 𝜋aFRR +,energy 𝑑,𝑡 , 𝜋aFRR +,capacity 𝑡 ) (7.14) In Equation 7.12, 𝑡 represents a one-hour slot, and in Equations 7.13 and 7.14 it represents a four-hour slot, as visualized in Figure 6.1. We submit none or one DA spot market bid per one-hour product slot. The energy price 𝜋DA 𝑡 is set to the predicted energy price (see Section 4.2, assumption ADA1). The bid’s power 𝑝el,DA 𝑡 is set to the sum of the facility’s uncontrollable electric power demand plus the aggregated power based on the DA power level profiles of all optimized devices 𝑑 ∈ 𝔻. We submit none or one aFRR market bid per aFRR direction and four-hour product to the aFRR market. For each device, the bid’s aFRR capacity price 𝜋aFRR −,capacity 𝑑,𝑡 or 𝜋aFRR +,capacity 𝑑,𝑡 is set to the predicted aFRR capacity price (see Section 4.3.1, assumption AaFRR6). The bid’s aFRR capacity 𝑝 el,aFRR − 𝑑,𝑡 or 𝑝 el,aFRR + 𝑑,𝑡 is set based on of the device’s aFRR capacity level profile. In parallel, the bid’s aFRR energy price 𝑝el,aFRR − 𝑑,𝑡 or 𝑝 el,aFRR+ 𝑑,𝑡 is set based on the device’s aFRR energy price profile. 7.6 Problem-specific Crossover Operator In contrast to the mutation operator, which is primarily intended to bring randomness and variation into the population, the crossover operator is intended to mix parts of solution candidates that are characterized by a high fitness. We already showed that the typical way of implementing the mutation is by flipping bits and explained that we chose the 𝑛-point crossover (in Section 7.2.3). Unlike the mutation operator, the crossover operator should maintain the selected characteristics of the corresponding individuals. 186 7.6 Problem-specific Crossover Operator As visualized in Figure 7.2, the overall bit string consists of multiple interdependent problem parts: aFRR capacity level profiles relate to DA power level profiles, and aFRR energy price profiles relate to aFRR capacity level profiles. Consequently, a 𝑛-point crossover cutting the whole bit string (composed of multiple problem parts) at random positions would remove the interdependency between the different profiles. Therefore, we implemented a problem-specific crossover. It considers knowledge about the problem structure and allows for keeping the interdependencies between the different problem parts. Figure 7.3 visualizes the concept of the proposed crossover operator: Figure 7.3a shows the profiles of two-parent solution candidates, and Figure 7.3b shows the resulting profiles of the two offspring solution candidates. As all genotypic problem parts represent profiles over time, the crossover takes two randomly chosen times 𝑖, 𝑗 ∈ {4, 8, 12, … , 20} and cuts each schedule before the respective hours 𝑖 and 𝑗. The crossover points are chosen as multiples of four hours as this is the aFRR product time slot. This way, aFRR capacities (defined by the aFRR capacity level profiles) and aFRR energy prices (defined by the aFRR energy price profiles) are not divided, and the relation to the DA power schedule (defined by the DA power level profile) is maintained. Based on the two randomly chosen crossover points 𝑖 and 𝑗, the offspring individuals are generated as visualized by inheriting parts from each of the two parents in an alternating way. After a detailed explanation of the genetic algorithm, we parameterize and evaluate the optimization in the upcoming Chapter 8. 187 Chapter 7 Design and Implementation of a Genetic Algorithm Negative aFRR t Positive aFRR Positive aFRR t Negative aFRR tt λ Δλ EUR/kWh EUR/kWh 011110111 011110111 011110111 011110111 011110111Parent 1 DA power level profile (λ per 1 h) aFRR capacity level profile (Δλ per 4 h) aFRR energy price profile (EUR/kWh per 4 h) t Δλ Parent 2 Negative aFRR t Positive aFRR Positive aFRR t Negative aFRR tt λ Δλ EUR/kWh EUR/kWh 011110111 011110111 011110111 011110111 011110111 t Δλ Problem part for device d (in generation n) (a) Genotype and phenotype of the parents before the crossover Negative aFRR t Positive aFRR Positive aFRR t Negative aFRR tt λ Δλ EUR/kWh EUR/kWh 011110111 011110111 011110111 011110111 011110111Offspring 1 t Δλ Offspring 2 Negative aFRR t Positive aFRR Positive aFRR t Negative aFRR tt λ Δλ EUR/kWh EUR/kWh 011110111 011110111 011110111 011110111 011110111 t Δλ DA power level profile (λ per 1 h) aFRR capacity level profile (Δλ per 4 h) aFRR energy price profile (EUR/kWh per 4 h) Problem part for device d (in generation n+1) (b) Genotype and phenotype of the offspring after the crossover Figure 7.3: Problem-specific n-point crossover that maintains interdependencies between related profiles: each dedicated profile of two solutions candidates is cut at the two identical randomly chosen hours that define the positions at which the respective profiles are mixed in an alternating way. 188 CHAPTER 8 Evaluation and Assessment of the Optimization Potential In this chapter, we evaluate the proposed optimization that utilizes energetic on-site prosumer flexibility incentivized by the DA spot and aFRR balancing market. The evaluation is based on the implemented simulation of the grid and facility side entities (presented in Chapter 4), the analyzed aFRR activation uncertainties (presented in Chapter 5), the formulated optimization problem for prosumer flexibilization (presented in Chapter 6), and the proposed and implemented genetic algorithm for solving it (presented in Chapter 7). We begin the chapter with an overview of the simulation flow and the parametrization of the defined models and the genetic algorithm, including corresponding data sources. The subsequent assessment of the optimization potential focuses on four major aspects. At this, we concentrate on the battery storage (as a generic representation of a flexibility buffer) and the CHP plant with the condensing boiler (as an example for coupling the energy forms electricity, heat, and gas). The four major aspects are as follows. Firstly, we provide a qualitative discussion of resulting device schedules and market bids, and identify optimization patterns. Secondly, after understanding the optimization and the behind trade-offs, we provide a quantitative discussion of the realized cost savings. In doing so, we examine how the different cost components contribute to the overall cost-saving potential. Thirdly, we analyze the impact of the device dimensioning on the optimization potential, hence giving insights into the scalability of the economic benefits. Fourthly, we conclude the evaluation with a sensitivity analysis that sheds light on the optimization potential in future DA spot and aFRR balancing market scenarios. The investigated market scenarios are motivated by the highly dynamic market environment and changing competition due to new actors entering the market. 189 Chapter 8 Evaluation and Assessment of the Optimization Potential 8.1 Simulation Flow The simulation flow and the integration of the optimization are presented in Figure 8.1. We simulate a whole year in one-minute granularity. This covers the simulation of the devices and market side, including the activation of aFRR bids as presented in Section 4.3. Each day, in the first simulation step at 0:00 h, we trigger and execute the optimization (see assumptions ADA4 and AaFRR3 in Sections 4.2 and 4.3.1). The resulting DA spot and aFRR balancing market bids are logged in for the simulation of the upcoming day. In an operational optimization, the bids would be submitted to the DA spot and aFRR balancing market (or an intermediary aggregator). 1 year (day by day) 01/01 t (days) 31/12 … day by day 1 day (minute by minute) Device n Device 2 Device 1 (example associated with three energy forms) Power t (minutes) Schedules Electric Heat Gas Cold Each minute of day: Simulation of devices and aFRR activations a) Check for activation of submitted aFRR bids according to aFRR demand b) Potentially adjust schedules according to the offered aFRR capacity c) Execute the potentially adjusted, alternatively the expected, schedules Minute 0:00 h: Optimization and submission of market bids aFRR+ activation aFRR– activation 0:00 h 23:59 h Figure 8.1: Simulation flow and the integration of the optimization. The assumptions for the simulation and optimization have already been presented in Sections 4.2 and 4.3. We showed that, in particular, the lead time between trading and 190 8.2 Parameter Definition & Data Sources provisioning is a simplifying assumption (see also Figure 2.2). The minute-based aFRR simulation checks whether submitted aFRR bids are activated. In the case of activation of an aFRR bid, the requested aFRR capacity is provided by adjusting the corresponding device schedule(s). Depending on the device, an aFRR activation may involve further energy forms than electricity (i. e., heat, cold, and gas). As visualized in Figure 8.1, all profiles of a device must be adjusted according to the aFRR activation. For example, if a CHP plant’s electric power level is reduced, it consumes less gas and generates less heat. Following this procedure, aFRR activations may result in deviation of the day-ahead expected from the finally activated device schedule. In the evaluation scenarios presented below, we simulate a whole year. The daily optimizations are based on the devices’ simulated SOCs based on the realized device schedules. The final uncontrollable facility demands are assumed to be perfectly pre- dicted (see Section 4.4.1). We do not quantitatively investigate discrepancies between the predicted and actual final facility demands. Instead, for a qualitative discussion of uncertainties, we refer to Section 6.3. For quantifying the financial optimization potential, we use historical market data. We investigate how the presented optimization would have behaved in the past if it had been executed. Using historical data for evaluating optimization potentials is a common strategy referred to as backtesting [Sch18]. Following this approach, we simulate an operational prosumer optimization based on the replication of device and market interfaces found in practice, which among others, involves the reaction to aFRR activation signals (see Section 4.1). This distinguishes this work from more abstract potential analyses found in the literature. 8.2 Parameter Definition & Data Sources In the following, we parametrize device models, facility demands, and the market and- grid side models, which leads to the definition of the investigated evaluation scenarios. 8.2.1 Flexible Facility Devices Devices commonly found in commercial facilities are modeled in Section 4.4. We showed that the exemplary modeled devices cover a wide range of energy forms (see Table 4.1). In the evaluation, we focus on the battery storage system (which can be considered as a generic representation of a flexibility buffer that is constrained by a minimum and maximum SOC) and the CHP plant (which is a device coupling multiple energy forms). As commonly found in practice, we assume the CHP plant to be operated in combination 191 Chapter 8 Evaluation and Assessment of the Optimization Potential with a condensing boiler. Consequently, in the evaluation setup, the heat energy storage is shared by the CHP plant and the condensing boiler. After the introduction of the device models in Section 4.4, we now present their parametrization for the evaluation in Table 8.1. Table 8.1: Default configuration of the device models in the baseline scenario. Parameter Definition Battery storage system 𝐶 1 000 kWh 𝑝 200 kW 𝑝 −200 kW 𝑛 3 steps/direction 𝜂(𝜆) {−3, −2, −1, +1, +2 + 3} ↦ 0.95 Heat energy storage 𝑉 40 000 L 𝑇 90 °C 𝑇 50 °C 𝜌 𝜌water = 998 kg/m3 𝑐 𝑐water = 4 182 J/(kgK) CHP plant 𝜔 60 min 𝑝gas 1 000 kWgas 𝑝gas 0 kWgas 𝑛 8 steps 𝜂el(𝜆) {1, 2, 3, 4, 5, 6, 7} ↦ 0.36 𝜂th(𝜆) {1, 2, 3, 4, 5, 6, 7} ↦ 0.54 Condensing boiler 𝑝gas 2 474 kW 𝜂th 0.9 The choice of parameters is reasoned as follows: • Battery storage system: The power-to-capacity ratio is chosen based on common values for battery storage systems [Fig+20]. It also represents typical power-to- capacity ratios for AC-charged electric vehicle batteries. The maximum charge and discharge power and the capacity are chosen to represent large industrial battery storage systems [Fig+20]. The charge and discharge efficiency 𝜂(𝜆) is presented as one-way efficiency and is based on a literature review [Luo+15; Fer+13]. The 192 8.2 Parameter Definition & Data Sources discretization of the power level steps results from our modeling, and we decided to distinguish three power levels for each direction, charging and discharging. • Heat energy storage: We define the thermal energy storage volume following traditional sizing guidelines based on the below chosen CHP plant. Given the chosen temperature range of 40 K, this represents a thermal storage potential of 1 856 kWhheat (see Section 4.4.3.1 for an explanation of the calculation). The physical constants are based on standard literature [HMS17]. • CHP plant: We define a gas-driven CHP plant with a constant power-to-heat- ratio (i. e., constant electric and thermal efficiencies independent of the power level). The relation between gas consumption and electric and thermal generation is derived from a real CHP plant (Viessmann Compact CHP unit Vitobloc 200, EM-238/363). It is in line with values from the literature [ASU15]. We set the minimum gas power 𝑝gas = 0 kW, which means the CHP plant can reduce its gas power down to zero also within a time slot of 𝜔 = 60 min. This is a simplifying assumption that simplifies the qualitative schedule analysis. The discretization of the power level steps results from our modeling, and we decided to distinguish eight power levels. The CHP plant sizing is based on the conventional sizing recommendation, according to which CHP plants should run about 6 000 h per year. We used the load duration curve to determine the corresponding CHP plant size based on the facility demands (presented in Section 8.2.2). In the case of a heat-driven operation and the assumed power-to-heat ratio, a runtime of 6 000 h/a is reached with a CHP plant characterized by 𝑝 gas = 322 kW and in case of an electricity-driven operation by a CHP plant with 𝑝 gas = 1 294 kW. We define 𝑝gas = 1 000 kWh and analyze the impact of the CHP plant sizing in Section 8.6.2. • Condensing boiler: The condensing boiler’s efficiency is based on average ef- ficiency values from literature [SB18]. It is dimensioned to be able to always satisfy the facility’s maximum heat energy demand 𝑝 heat demand,𝑡 (as presented in the upcoming Section 8.2.2). It is worth mentioning that the large number of interlinked decision variables and parameters relevant for the DA spot and aFRR balancing market optimization makes the optimization results very parameter-sensitive. Consequently, we focus on the core contribution of this thesis (the simultaneous DA scheduling and aFRR provisioning) and do not further consider part-load dependent efficiencies in the evaluation. However, it is notable that we considered part-load dependent efficiencies in both the device modeling introduced in Chapter 4 and the optimization algorithm proposed in Chapter 7. 193 Chapter 8 Evaluation and Assessment of the Optimization Potential 8.2.2 Facility Demands The facility’s electricity demand 𝑝el demand,𝑡 and heat demand 𝑝heat demand,𝑡 (see Section 4.4.1) are based on measured one-hour demands from an exemplary office building complex in Germany [Fac09]. Both demands are scaled to an electricity demand of 5 GWh/a. Figures 8.2a and 8.2b visualize the final uncontrollable electricity and heat energy demands over the considered exemplary year. It can be seen that the final uncontrollable electricity demand has a similar pattern around the year. The final uncontrollable heat energy demand results from space and process heating. Consequently, it can be recognized that it is significantly higher in winter months than in summer months. Key characteristics of the energy demand are summarized in Table 8.2. (a) Electric energy demand (b) Heat energy demand Figure 8.2: Uncontrollable electric and heat energy demands used in the evaluation in one-hour granularity; based on measurements from a office building complex in Germany [Fac09]. 8.2.3 Market and Grid-Side Characteristics The modeling of the DA spot market (see Section 4.2) and the aFRR balancing market including the simulation of aFRR bid activations (see Section 4.3.2) has already been 194 8.2 Parameter Definition & Data Sources Table 8.2: Characteristics of the hourly energy demands used in the evaluation. Electricity demand (kWh) Heat demand (kWh) Minimum 342.5 0.0 Maximum 1 121.4 2 226.0 Mean 570.8 514.8 in winter (01/12 – 29/02) 537.0 1 085.3 in spring (01/03 – 31/05) 563.2 418.9 in summer (01/06 – 31/08) 624.7 120.0 in autumn (01/09 – 30/11) 557.2 446.1 Standard deviation over whole year 149.1 445.8 Total yearly demand 5 000.0 MWh 4 509.3 MWh presented. Table 8.3 summarizes the introduced parameters representing the grid and market side and presents the corresponding data sources used in the evaluation. Reflecting realistic conditions, we define the energy-related surcharges for grid fees and further taxes as well as the gas energy price as constant over the year (see Section 6.1.2). We do not consider the EEG reallocation charge in the energy-related surcharges as this parameter is subject to changes based on relatively short-term political decisions. As of today, depending on the year of commissioning and the number of utilization hours, CHP plants are subject to the EEG reallocation charge. However, depending on the applicable regulatory scheme, CHP plants may only be charged a percentage of the EEG reallocation charge. Consequently, focusing on the relevant contributions, we assume a fixed energy-related surcharge for grid fees and further taxes (𝜋gridFees) that is attributed to each kilowatt-hour the facility consumed from the grid. To properly account for potential interdependencies between DA spot and aFRR balancing market conditions, we chose market data from a year for which we had all data available (year 2016). The minute-based simulation of aFRR activations is based on the data consolidation presented in Section 4.3.2. The expected activation share used as input to the optimization is assumed to be constant over the whole year. We limit the set of aFRR energy prices that are considered as decision variables by the optimization to realistic aFRR energy prices. Therefore, we define the set of possible aFRR energy prices for negative and positive aFRR as follows (EUR/MWh): ℿaFRR − = {−40, −20, 0, 20, 40, 60, 80, 100} (8.1) ℿaFRR + = {−40, −20, 0, 20, 40, 60, 80, 100} (8.2) 195 Chapter 8 Evaluation and Assessment of the Optimization Potential Table 8.3: Evaluation parameters for the DA spot and aFRR balancing markets. Parameter Granularity Parametrization / data source DA spot market prices 𝜋DA 𝑡 hourly Historic EPEX DA auction prices, year 2016 [EPE20a] (see Figures 8.3a and 8.21b) Expected hourly aFRR activation share 𝑓 aFRR+/−(𝜋aFRR+/−,energy 𝑡 ) yearly Historic aFRR bids [Deu20h] and historic aFRR demand, year 2016 [Deu20g] Marginal aFRR energy price ̂𝜋aFRR +/−,energy 𝑡 minutely Combination of historic aFRR bids [Deu20h] and historic aFRR demand [Deu20g], year 2016 Marginal aFRR capacity prices ̂𝜋aFRR +/−,capacity 𝑡 hourly Historic aFRR capacity prices, year 2016 [Deu20h] (see Figure 8.3b) Grid fees and related surcharges 𝜋gridFees constant Historic price for target group, year 2020 [Bun21]: 10.32 Ct/kWh; Gas energy price 𝜋gas constant Average historic price for target group, year 2020 [Bun21]: 4.56 Ct/kWh This selection covers the relevant range of expected percentage activation shares (as visualized in Figure 5.2a). We choose eight prices represented by three bits in the genetic algorithm (see Section 7.3.4). We did not choose a higher granularity as a more fine-granular differentiation of activation shares is not expected to result in further benefits (see Figure 5.3) Figure 8.3a provides insights into the DA spot market energy prices of the exemplary considered year. Due to potential interdependencies between the DA spot and the aFRR balancing market, the same time frame was chosen. In the considered year, the DA spot market price was characterized by an average of 28.98 EUR/MWh, a minimum of −130.09 EUR/MWh, a maximum of 104.96 EUR/MWh, and a standard deviation of 12.48 EUR/MWh. A closer look at the distribution of the DA spot market energy prices over the considered year in presented in Figure 8.21b. Figure 8.3b provides insights into the aFRR balancing market capacity prices of the exemplary considered year. It is worth noting that the used aFRR capacity prices (from year 2016) are based on weekly tendering periods as well as peak tariff (HT) and off-peak tariff (NT) products. In order to fit the available market data to the assumed and, in the meanwhile, available market design with daily tendering periods and four-hour product slots, we linearly scaled down the historical aFRR capacity prices (as described in Section 4.3.1 in assumption AaFRR6). The energy-based grid fees and related surcharges chosen in Table 8.3 are common for facilities with less than 2,500 annual utilization hours. In this context, it is worth noting 196 8.2 Parameter Definition & Data Sources that the facility’s uncontrollable electricity demand presented in Figure 8.2a is subject to (seasonal) adjustments depending on the CHP plant operation. Capacity-based grid fees are not in the focus of the evaluation. However, in the case of annual utilization hours above 2 500 h, they provide financial incentives for peak load reductions (see also discussion in Section 3.1.1). (a) DA spot market energy prices (data: [EPE20a]) (b) aFRR balancing market capacity prices (data: [Deu20h]) Figure 8.3: Overview of the prices used in the evaluation in one-hour granularity. 8.2.4 Investigated Scenarios Based on the above parameter definitions, we define different scenarios. An unoptimized baseline scenario sets the reference for the cost saving potential. The baseline is compared to different optimized scenarios. In the course of the evaluation, we distinguish the following three types of optimized scenarios: 1. EPEX-only optimized: The optimization is only incentivized by the EPEX DA spot market. 197 Chapter 8 Evaluation and Assessment of the Optimization Potential 2. Combined EPEX+aFRR optimized, expected: The optimization is simultaneously incentivized by the EPEX DA spot market and the aFRR balancing market. The results are represented as expected by the optimization. 3. Combined EPEX+aFRR optimized, realized: The optimization is simultaneously incentivized by the EPEX DA spot market and the aFRR balancing market. The results are represented as realized after the one-minute simulation of aFRR bid activations. This requires a transformation from expected EPEX+aFRR schedules to realized EPEX+aFRR schedules (as explained in Section 8.1). Orthogonal to the combined EPEX+aFRR optimizations, we distinguish two regula- tory schemes regarding energy-related surcharges for the facility’s increased electricity consumption in the case of negative aFRR activation (for a further discussion of the regulatory schemes, please refer to Section 6.1.2): a. Energy-related surcharges for negative aFRR energy: Electric energy consumed via negative aFRR activation is subject to energy-related surcharges for grid fees and further energy-related price components. b. No energy-related surcharges for negative aFRR energy: Electric energy con- sumed via negative aFRR activation is not subject to energy-related grid fees and further energy-related price components. In the following evaluation, we compare the results of the different optimized scenarios to the unoptimized baseline scenario. In the unoptimized baseline scenario, we consider the facility’s uncontrollable electric and heat energy demand (𝑝el demand,𝑡 and 𝑝heat demand,𝑡) as well as the CHP plant (𝑑chp) and the condensing boiler (𝑑condBoiler) with a corresponding heat buffer (𝑑thBuffer,heat) to satisfy these demands. No battery storage is used in the unoptimized baseline scenario. For the operation of the CHP plant and the condensing boiler in the unoptimized base- line scenario, we define a naive predictive optimization. It guarantees the satisfaction of the facility’s heat energy demand as follows: The CHP plant checks hour by hour whether the associated heat buffer is expected to fall below the minimum temperature in the upcoming hour. Therefore, it uses the (perfect) thermal demand prediction for the upcoming hour. If the minimum temperature is expected to be undercut within the upcoming hour 𝑡, the CHP plant is turned on to the highest power level, i. e., 𝜆chp,𝑡 = 𝜆chp. If the generated thermal heat energy is not enough to satisfy the heat energy demand, the condensing boiler is additionally used to satisfy the lacking demand that is required to reach the minimum storage temperature 𝑇heat. The unoptimized baseline scenario does neither consider potential cost savings through time-variable DA spot market prices 198 8.3 Parametrization of Genetic Operators nor potential cost savings through aFRR provisioning. The cost savings in the upcoming sections are compared to this naive baseline scenario. As the facility’s absolute energy costs depend on the overall uncontrollable facility demands, the evaluation focuses on the cost difference compared to the baseline scenario. 8.3 Parametrization of Genetic Operators In this section, we present the parametrization of the implemented genetic algorithm. We start with insights into the implementation (in Section 8.3.1), followed by the choice of crossover and mutation probabilities (in Section 8.3.2), and end with an analysis of the convergence of the optimization (in Section 8.3.3). 8.3.1 Implementation Details We implemented the genetic algorithm using the “Java-based framework for multi- objective optimization with metaheuristics (jMetal)” [DN11; NDV15]. The parametriza- tion of the genetic algorithm’s building blocks and parameters (as presented in Sec- tion 7.2) is summarized in Table 8.4. The problem-specific crossover operator (as presented in Section 7.6) is implemented in two different versions. For the combined EPEX+aFRR optimization, the crossover time points are aligned to the aFRR product time slots, i. e., considering intervals in multiples of four hours. For the EPEX-only optimization, the crossover time points are aligned to the DA spot market product time slots, i. e., considering intervals in multiples of one hour. 199 Chapter 8 Evaluation and Assessment of the Optimization Potential Table 8.4: Implementation details of the genetic algorithm. Parameter Implementation Core algorithm GenerationalGeneticAlgorithm1 Selection BinaryTournamentSelection2 Mutation BitFlipMutation3 Crossover TimeBasedTwoPointCrossoverEpexReserve and TimeBasedTwoPointCrossoverEpex, as presented in Section 7.6 Solution encoding BinarySolution4 Fitness function EpexReserveFitnessFunction, as presented in Table 7.5 Population size 50 (common literature value [Has+19]) Mutation probability as evaluated in Section 8.3.2 Crossover probability as evaluated in Section 8.3.2 Maximum evaluations as evaluated in Section 8.3.3 Corresponding jMetal packages: 1 org.uma.jmetal.algorithm.singleobjective.geneticalgorithm 2 org.uma.jmetal.operator.impl.selection.BinaryTournamentSelection 3 org.uma.jmetal.solution 4 org.uma.jmetal.solution 8.3.2 Crossover and Mutation Probabilities Figure 8.4 visualizes the impact of different crossover and mutation probabilities on the fitness of the best solution candidate. Figure 8.4a represents the EPEX-only optimization and Figure 8.4b the combined EPEX+aFRR optimization. Each data point represents the cost savings of a full one-year optimization for different mutation probabilities in the range 0.004–0.020 (Δ = 0.002) and different crossover probabilities in the range 0.0–1.0 (Δ = 0.1). Due to the difference in the bit string length for the EPEX-only and the combined EPEX+aFRR optimization, we investigated the two cases separately. Table 8.5 provides an overview of the number of bits. It can be seen that, in the considered configuration, the EPEX-only optimization is represented by 𝑛 = 72 bits and the combined EPEX+aFRR optimization by 𝑛 = 132 bits. 200 8.3 Parametrization of Genetic Operators 0 0.2 0.4 0.6 0.8 1 5,100 5,200 5,300 5,400 5,500 5,600 5,700Cost savings (EUR) Mutation probability (a) EPEX-only optimization 0 0.2 0.4 0.6 0.8 1 8,000 9,000 10,000 11,000 12,000 13,000 14,000Cost savings (EUR) Mutation probability (b) Combined EPEX+aFRR optimization Figure 8.4: Parametrization of crossover and mutation probability: fitness of best solution candidate after 10 000 evaluations; example of CHP plant. Table 8.5: Parametrization of the bit string length for the considered devices. Optimized profiles Bits per device EPEX-only opt. EPEX+aFRR opt. DA power level profile 24 ⋅ 3 24 ⋅ 3 aFRR − capacity level profile 0 6 ⋅ 2 aFRR + capacity level profile 0 6 ⋅ 2 aFRR − energy price profile 0 6 ⋅ 3 aFRR + energy price profile 0 6 ⋅ 3 Total 72 bits 132 bits 1 / total number of bits 0.013 88 0.007 58 A common recommendation is setting the mutation probability to 1/𝑛, with 𝑛 rep- resenting the bit string length [Wei15]. In Figure 8.4, we visualized the surrounding probability areas. After a comprehensive analysis of the promising probability areas, we decided to use the following probabilities in the evaluation runs. For both optimization scenarios, we use the crossover probability of 0.9. For the EPEX-only optimization, we use the mutation probability of 0.011 (comparison: 1/𝑛 = 0.013 88) and for the EPEX+aFRR optimization we use the mutation probability of 0.009 (comparison: 1/𝑛 = 0.007 58). While optimum crossover and mutation probabilities are specific to the 201 Chapter 8 Evaluation and Assessment of the Optimization Potential problem, the identified values are in line with experiences reported in the literature [Has+19]. 8.3.3 Convergence of the Optimization Figure 8.5 visualizes the fitness of the solution candidate with the highest fitness, i. e. the highest cost savings, after different numbers of evaluations. Figure 8.5a represents the EPEX-only optimization and Figure 8.5b the combined EPEX+aFRR optimization. Each data point represents the average of ten one-month optimization runs based on a population size of 50. Both scenarios point out that the fitness improvement between two generations is relatively high in the first generations and then slowly decreasing in the following, until ending in stagnation once a certain number of evaluations is reached. 0 € 50 € 100 € 150 € 200 € 250 € 300 € 0 10,000 20,000 30,000 40,000 50,000Cost savings Number of evaluations Average of 10 monthly optimization runs (with indicators representing ± 2 standard deviations) (a) EPEX-only optimization -400 € -200 € 0 € 200 € 400 € 600 € 800 € 1,000 € 0 10,000 20,000 30,000 40,000 50,000Cost savings Number of evaluations Average of 10 monthly optimization runs (with indicators representing ± 2 standard deviations) (b) Combined EPEX+aFRR optimization Figure 8.5: Analysis of the impact of the number of evaluations on the solution quality; example of battery storage system. Comparing the EPEX-only and the combined EPEX+aFRR optimization, it is observable that the EPEX-only optimization converges faster. Furthermore, it can be seen that the standard deviation of the ten optimization runs is significantly lower in the case of the EPEX-only optimization. In addition, it can be seen that the combined EPEX+aFRR optimization results in a cost increase compared to the unoptimized baseline reference scenario in the case of a small number of only 1 000 evaluations. These differences between the EPEX-only and the combined EPEX+aFRR optimization can be explained 202 8.4 Qualitative Discussion of Optimized Schedules & Identification of Patterns by the larger search space of the latter. Based on these findings, we decided to stop the optimization runs after 35 000 evaluations in both optimization scenarios. After this point, only very slight fitness improvements can be recognized. On this basis, the time required for the daily optimizations and the minute-by-minute simulation of aFRR activations over one year lies in the area of a few minutes using an up-to-date personal computer. However, it can be seen that, depending on time and resource requirements, the number of evaluations could be decreased, in particular for the EPEX-only optimization. In this qualitative discussion we only look at the predominant regulatory scheme of energy-related (grid fee) surcharges for the increased consumption resulting from negative aFRR activation. 8.4 Qualitative Discussion of Optimized Schedules & Identification of Patterns We start the discussion of the optimization potentials with a qualitative analysis of selected schedules, which allows for identifying recurring optimization patterns. Then, in the upcoming Section 8.5, we provide a quantitative analysis of the realized cost savings and different cost components. For a better understanding, the charts presented in the following show the EPEX power schedules, the expected and realized aFRR − power schedules, and the expected and realized aFRR+ power schedules separately. Regarding a device’s final power level, it is essential to understand that the power values of the expected and realized aFRR schedules have to be seen relative to the power values of the related EPEX schedule. Consequently, for a given point in time in the presented charts, the sum of the three power schedules (DA power + aFRR− power + aFRR + power) results in the overall power demand or supply of the respective device. As constraint handling using a penalty function (as presented in Section 7.4.4) is a soft constraint handling technique for which no formal guarantee is provided, it is worth mentioning that the SOC constraints have been ensured in all final solution candidates. 8.4.1 Battery Storage System In this section, we analyze schedules resulting from the EPEX-only optimization and the combined EPEX+aFRR optimization. This allows us to provide a summary of identified optimization patterns. 203 Chapter 8 Evaluation and Assessment of the Optimization Potential It is important to understand that the considered prosumer scenario assumes that the flexible devices are placed on-site behind the facility’s meter. Therefore, charging the battery results in grid fees (through an increased facility demand), and discharg- ing results in reduced grid fees (through a decreased facility demand) as long as the discharging reduces the facility’s electricity demand (see also Section 4.2, assumption ADA2). EPEX-only Optimization Given the cost minimization objective function, the EPEX- only optimization of the battery storage is exposed to the following situation: Due to the charge and discharge efficiency 𝜂battery, it is beneficial to charge one kilowatt-hour for a price of 𝜋DA 𝑡 if the energy available after subtracting the energy losses can later be sold at a higher price, i. e., a price above 𝜋DA 𝑡 /(𝜂battery(𝜆charge) ⋅ 𝜂battery(𝜆discharge)). (a) Schedule (b) Resulting SOC Figure 8.6: EPEX-only optimized battery storage system: six exemplary one-day charging schedules and the resulting SOC. Figure 8.6a shows the optimized battery schedule based on the EPEX prices, and Figure 8.6b shows the corresponding SOC curve. It can be seen that the battery is charged in price valleys and discharged in price peaks. It also can be seen that less 204 8.4 Qualitative Discussion of Optimized Schedules & Identification of Patterns energy is discharged than charged due to the charging inefficiencies that result in a loss of energy. In Section 6.2.1.2, we explained that we assign a monetary value to the energy contained in the storage in the last time step of the optimization period to account for the potential shift of energy from day 𝑡 to day 𝑡 + 1. We rate the energy contained in the battery storage at the end of optimization period with a value of 2.1 + 𝜋gridFees Ct kWh . In the fitness function, this resulting monetary value is subtracted from the expected costs of a solution candidate. We chose this value based on an analysis of the average DA spot market price level (as presented in Figure 2.4 for the year 2019) and as 2.0 Ct kWh is one of the discretized aFRR energy prices (as presented in Equations 8.1 and 8.2). We found that, on average, energy procured for 2.1 + 𝜋gridFees Ct kWh in day 𝑡, is likely to reduce the costs for the upcoming day 𝑡 + 1 by at least this amount, thus increasing the overall cost saving. It can be recognized that the optimization favors a low SOC at the end of the opti- mization period in the case of high prices towards the end of the day. In contrast, in the case of low prices towards the end of the day, it can be seen that cheap energy is charged for the upcoming day. As discussed in Section 6.2.1.2, an alternative option for determining a target SOC for the end of an optimization period would be using a rolling optimization horizon that additionally considers the day after the actual optimization period in the scheduling. Combined EPEX+aFRR Optimization The simultaneous EPEX+aFRR optimization has to weigh up between two multiple incentives. On the one side, the overall costs of a schedule can benefit from aFRR capacity based revenues and aFRR energy based revenues. However, on the other side, aFRR bids introduce limitations for the usable SOC band for the DA spot market based scheduling (due to the uncertainty regarding the aFRR activation, as presented in Section 6.2.3.2). In the following, we discuss the schedules of two exemplary days. The first day shown in Figure 8.7 is characterized by a DA spot market price valley followed by a price peak, both in the second half of the day. The second day shown in Figure 8.8 is characterized by a DA spot market price valley followed by a price peak, both in the first half of the day. In both figures, we present the schedules expected at the time of optimization (in sub figure a), the schedules realized after the minute-based activation of the submitted aFRR bids (in sub figure b), and the corresponding expected and realized SOC (in sub figure c). We see that aFRR is offered on both days, predominantly in the last aFRR slots within the optimization period. aFRR bids towards the end of the day are a pattern that can be realized over the whole year. This can be explained by the SOC band limitations 205 Chapter 8 Evaluation and Assessment of the Optimization Potential (a) Expected schedule (b) Activated schedule (c) Resulting SOC Figure 8.7: Combined EPEX+aFRR optimized battery storage system: exemplary one-day charging schedule with neg. and pos. aFRR bids. resulting from aFRR bids. The optimization makes this decision as the corresponding activation uncertainty limits the usable flexibility band: The earlier the product slot for which an aFRR bid is made, the more restricted the following SOC band that is available for the EPEX-based scheduling. This effect was also visualized in Figure 6.2. Consequently, offering aFRR at the end of the one-day optimization periods allows for better exploitation of EPEX-incentivized charging and discharging in early time steps. 206 8.4 Qualitative Discussion of Optimized Schedules & Identification of Patterns (a) Expected schedule (b) Activated schedule (c) Resulting SOC Figure 8.8: Combined EPEX+aFRR optimized battery storage system: exemplary one-day charging schedule with only neg. aFRR bids. On both exemplary days, we recognize that the optimization results in different end SOCs for the end of the daily optimization periods. In Figure 8.7, it can be seen that the optimization results in a relatively high end SOC of about 60 % due to the price valley around 15:00 h, which incentivized charging the battery. Given the relatively high end SOC, it is possible to offer schedule deviations into both directions and, consequently, both negative and positive aFRR is offered. In contrast, in Figure 8.8, the optimization 207 Chapter 8 Evaluation and Assessment of the Optimization Potential results in a relatively low end SOC of about 20 %. It can be seen that the energy charged in the first price valley around 3:00 h is monetized by discharging during the directly following price peak around 9:00 h. As there is no notable DA spot market price valley in the second half of the day1, the optimization results in a relatively low SOC for the end of the day, consequently allowing to benefit from negative aFRR provision. On this exemplary day, positive aFRR is not offered as it would require a higher SOC at the end of the optimization period, which the optimization decided to be not worth striving for, given the competing DA spot market incentives. Overall, it can be seen that the optimization substitutes energy procurement via the DA spot market by offering negative aFRR with an energy price below the average spot market price level. Analogously, it can be recognized that positive aFRR is offered when it is beneficial compared to a discharging incentivized by DA spot market prices. Furthermore, it can be seen how the optimization keeps a SOC buffer for handling the potential extreme aFRR activation cases. The practical implications of the analysis presented in Section 5.3 can be recognized when comparing the expected and activated schedules as well as their resulting SOCs. The discussion of these exemplary schedules clarifies the trade-offs handled by the optimization. We see how the optimization weighs up between a variety of potential decisions, simultaneously incentivized by DA spot market prices, aFRR capacity prices, aFRR energy prices, different aFRR directions, and related activation probabilities, while considering the device constraints. Patterns Recognized in the Optimization Analyzing the cost-optimized schedules reveals the following patterns: • aFRR is primarily offered in late aFRR product time slots within the optimiza- tion period: Analyzing device schedules reveals that aFRR is mostly offered in the last one to three aFRR product slots, depending on the course of DA spot market prices over the day. As discussed above, this can be well explained by the fact that providing aFRR capacity limits the freedom for DA scheduling in all time steps after aFRR provisioning. Therefore, aFRR provision significantly limits the potential to benefit from EPEX DA price fluctuations. This is presented in Figure 6.2: For example, when providing 200 kW of negative aFRR with an empty battery with SOC = 0 %, the aFRR-induced energy delta at the end of a four-hour aFRR slot can be 0 kWh (i. e., SOC = 0 %) or 800 kWh (i. e., SOC = 80 %). Therefore, at the end of the four-hour aFRR slot, only a SOC range of 20 % points remains available 1Note that the optimization considers charging and discharging inefficiencies. 208 8.4 Qualitative Discussion of Optimized Schedules & Identification of Patterns for other scheduling incentives. Consequently, the relation between power and storage capacity is a determining factor for the cost saving. • DA spot market price valleys in the second half of the optimization period tend to result in positive aFRR bids: Low spot market prices at the end of the optimization period tend to result in relatively high end SOCs, as the battery storage is charged in times of low prices. Consequently, due to the available flexibility to decrease the SOC, the pattern can be recognized that the optimization benefits from capacity and energy related aFRR revenues by providing positive aFRR. The exact aFRR bids depend on the course of the spot market prices. Depending on the end SOC, positive and negative aFRR can be recognized to be offered simultaneously. • DA spot market price peaks in the second half of the optimization period tend to result in negative aFRR bids: Analogously, high spot market prices at the end of the optimization period tend to result in relatively low end SOCs, as the battery storage is discharged in times of high prices. Consequently, due to the available flexibility to increase the SOC, the pattern can be recognized that the optimization benefits from capacity and energy related aFRR evenues by providing negative aFRR. • Regulation regarding grid fees and energy-related surcharges in case of neg- ative aFRR activation is crucial for the optimum energy price of negative aFRR bids: If no energy-related surcharges arise for the increased consumption based on negative aFRR activations, charging via aFRR activations is significantly cheaper than charging via DA spot market prices. Then, the optimization sub- stitutes charging via the DA spot market by charging via negative aFRR energy. The optimization enforces this by bidding low, i. e., negative aFRR energy prices for negative aFRR. This represents paying for negative aFRR activations, which however, due to the savings of energy-related grid fees and surcharges is cheaper than DA spot market procurement. • Attributing a monetary value to the SOC at the end of the optimization period is crucial for benefiting from negative aFRR energy: We introduced the strategy to attribute a monetary value to the energy in the battery storage at the end of the optimization period (in Section 6.2.1.2). This allows the shifting of cheap energy from one day to the other. As a consequence, it can be recognized that the optimization steers the energy price of negative aFRR bids such that negative aFRR activations substitute DA spot market procurement. However, it is crucial 209 Chapter 8 Evaluation and Assessment of the Optimization Potential to attribute a monetary value to the energy contained in the storage at the end of the optimization period. Otherwise, as aFRR bids are preferably made in the last aFRR time slots within a day (see above), they are submitted with high aFRR energy prices, as no benefit can be realized in the optimization period under consideration. In contrast, when attributing a monetary value to the SOC at the end of the optimization period, the optimization is able to achieve higher cost savings by intentionally charging via negative aFRR activations, instead of only benefiting from the aFRR capacity price based revenues. • Most days are characterized by at least a partial charge-discharge cycle, also in case of aFRR provisioning: In tendency, DA spot market prices are low at night (low demand) and around noon (high PV supply), and high in the morning and evening hours (as shown in Figure 2.4). As a result, in tendency, the time periods characterized by relatively low prices around 4:00 h and 15:00 h are used for spot market incentivized charging. In contrast, discharging can be recognized in the relatively expensive morning and evening hours around 9:00 h and around 19:00 h. As aFRR bids are primarily made for the late aFRR product time slots within an optimization period (see above), aFRR provisioning still keeps flexibility and realizes spot market based scheduling. This qualitative discussion of the optimization results is supplemented by the quanti- tative analysis of the realized cost savings in the upcoming Section 8.5. 8.4.2 CHP Plant In this section, we analyze the optimized CHP plant schedules. Again, we discuss the EPEX-only and the combined EPEX+aFRR optimization, and in the end, we sum up identified optimization patterns. EPEX-only Optimization In Figure 8.9, we see EPEX-only optimized CHP plant sched- ules of four exemplary summer days that are characterized by a low heat demand. Figure 8.9a shows the EPEX-only optimized CHP plant and Figure 8.9b the tempera- ture of the related heat storage, which represents the SOC2. It can be seen that the optimization successfully shifts the CHP plant runtime into DA spot market price peaks. The optimization chooses this as it allows substituting energy procurement via the DA spot market with cheaper on-site generation via the CHP plant. Furthermore, we can 2Note that we defined the lower temperature bound 𝑇 = 50 °C (representing a SOC of 0 %) and the higher temperature bound 𝑇 = 90 °C (representing a SOC of 100 %) in Section 8.2.1. 210 8.4 Qualitative Discussion of Optimized Schedules & Identification of Patterns (a) EPEX-only optimized schedule (b) Resulting SOC (represented by the heat buffer’s temperature) Figure 8.9: EPEX-only optimized CHP plant schedules: four exemplary summer days. recognize that the optimization, in tendency, decides to operate the CHP plant at a high power level (note the allowed temperature range 40–90 °C of the thermal buffer). Figure 8.9b shows, as expected, that the SOC (represented by the heat storage’s temperature) increases in times when the CHP plant is operated. In contrast, the facility’s endogenously given heat demand results in a reduction of the SOC. In the visualized days, the thermal buffer’s SOC at the end of each optimization period, i. e. the end of the day, is close to the maximum allowed SOC. This can be explained by the fact that one-site CHP-generated electricity is mostly cheaper as soon as the heat is required. This counts for the vast majority of price situations at the DA spot market. To better understand the related price levels, we summarized the relevant device parameters and related costs in Table A.1. Combined EPEX+aFRR Optimization Analogously, Figure 8.10 shows the combined EPEX+aFRR optimized CHP plant schedules and the resulting SOC of the same four ex- emplary summer days (that are characterized by a low heat demand). When comparing these schedules with the EPEX-only optimized schedules (presented in Figure 8.9), it 211 Chapter 8 Evaluation and Assessment of the Optimization Potential (a) Combined EPEX+aFRR optimized schedule (b) Resulting SOC (represented by the heat buffer’s temperature) Figure 8.10: Combined EPEX+aFRR optimized CHP plant: four exemplary summer days. can be recognized that the CHP plant is operated in DA spot market price peaks, too. However, it can be recognized that the CHP plant operates at lower power levels and for a longer time. This means that DA spot market price peaks cannot be utilized as advantageously as in the case of the EPEX-only optimization, hence resulting in higher DA spot market procurement costs for the facility. However, operating the CHP plant at a lower power allows for offering negative aFRR and hence benefiting from aFRR capacity price and aFRR energy price based revenues. It can be seen that negative aFRR is offered, which comes along with lower SOC bound requirements as the heat generation can always be substituted by the condensing boiler. Furthermore, it can be seen that the optimization ends the optimization periods with relatively high SOCs, too, as it allows for lowering the EPEX energy procurement costs. In the considered four days, the optimization does not submit positive aFRR bids. The optimization’s expectation to lower the CHP plant’s power level through negative aFRR activation can also be recognized in the expected gas schedule. In Figure 8.10b, we see the SOC expected during the optimization and the SOC realized after the simulation of aFRR bid activations. The impact of discrepancies 212 8.4 Qualitative Discussion of Optimized Schedules & Identification of Patterns between expected and realized aFRR activations on the SOC can be recognized: In some time slots in which aFRR is offered, the expected and realized SOC drift apart slightly. Furthermore, it can be seen that each day at 0:00 h, the expected SOC is set to the real SOC. This is the time when the daily optimization is executed using the simulated real-time SOC. Patterns Recognized in the Optimization In Figure 8.11, we provide insights into the EPEX+aFRR optimized schedules over the whole year considered. Figure 8.11a shows the EPEX DA spot market power, the negative and positive aFRR power, and the gas power for the CHP plant. Figure 8.11b shows the related expected SOC as well as the realized SOC after the simulation of aFRR bid activations. (a) CHP plant schedules (b) Resulting SOC Figure 8.11: Seasonal behavior of the EPEX+aFRR optimized CHP plant schedules. 213 Chapter 8 Evaluation and Assessment of the Optimization Potential In summary, the optimization reveals the following patterns: • The SOC is optimized to a low level in winter times and a high level in summer times: This can be explained by the fact that, in winter, the CHP plant’s heat generation will be directly consumed by the heat demand. There is no incentive for the condensing boiler to generate more heat than required. In summer, the CHP plant’s utilization and the resulting cost savings can be increased by utilizing the buffer storage. • Negative aFRR is offered around the year: If the CHP plant is operated at a power level that can technically be decreased, negative aFRR can be offered as the condensing boiler can substitute the reduced heat generation. Consequently, if it is economically meaningful, the optimization decides to offer negative aFRR. • Positive aFRR is offered in times characterized by low EPEX spot market prices and high heat demands: This can be recognized around the year. If EPEX DA spot market prices are low, the benefit of substituting DA procurement via the CHP plant is lower, too. Consequently, if there is enough heat demand or safety buffer available, the optimization can decide to offer the capacity to turn on the CHP plant as positive aFRR. • Positive aFRR is offered in times characterized by relatively high positive aFRR capacity prices: In the exemplarily presented year presented in Figure 8.11a, positive aFRR was in particular offered between April and July. This can be explained by the relatively high marginal aFRR capacity prices in this time frame, as visualized in Figure 8.3b. The impact of the aFRR price level on the overall cost saving potential is further analyzed in Section 8.7.1. • No positive aFRR is offered in times characterized by a low heat demand: This can be explained by the fact that the heat generated in the extreme aFRR activation case, i. e. the continuous generation over four hours, has to be either used or buffered. Otherwise, positive aFRR provision is not possible. In this context, it is worth mentioning that aFRR activations should not result in the waste of energy, which to a certain degree is already requested by today’s prequalification requirements [Deu20e]. • The thermal buffer is a limiting factor for the CHP plant’s utilization rate: The CHP plant’s utilization is significantly reduced in summer times even if the operation of the CHP plant would be economically cheaper after weighing up all cost components (see also Table A.1). In the case of lacking heat demand, the size of the thermal energy storage is a limiting factor for the maximum utilization rate. 214 8.5 Quantitative Analysis of Realized Cost Savings • In case of low heat demand, the EPEX-only optimization tends to result in high power levels over a short time period, while the combined EPEX+aFRR optimization results in lower power levels over a longer time period: This effect can be well recognized when comparing the exemplary schedules presented in Figures 8.9a and 8.10a. As reasoned above, this can be explained by the aFRR product slot size. Due to four-hour aFRR product slots, aFRR capacity can only be offered over time periods that are a multiple of four hours. Consequently, decreasing the power level and running over a longer time period increases the chance to potentially offer aFRR. Again, this qualitative discussion of the optimization results is supplemented by the quantitative analysis of the realized cost savings in the upcoming Section 8.5. 8.5 Quantitative Analysis of Realized Cost Savings In this section, we quantify and discuss the realized cost savings. We show how the cost savings can be attributed to different cost components and discuss trade-offs made by the optimization. This allows for a profound understanding of the optimization’s manifold parameter-sensitive decisions. 8.5.1 Battery Storage System In the following, we quantify the cost-saving potential resulting from the EPEX-only and the combined EPEX+aFRR optimization. EPEX-only Optimization We start with a closer look at Figure 8.12 that represents the results of the EPEX-only optimization (compared to the baseline scenario without battery storage system). We can recognize that the EPEX-only optimization reduces the facility’s day-ahead procurement costs while at the same time increasing the grid fees, in the end resulting in cost savings. The increased grid fees result from the inefficiency coming along with charging and discharging, which increase the total amount of consumed energy compared to the baseline scenario. The EPEX-only optimization on average results in an increased energy consumption of 63.93 kWh/d. This fits to the fact that the optimization, on average, results in less than one full charge-discharge cycle (i. e., charging from minimum to maximum and back to minimum SOC) per day. 215 Chapter 8 Evaluation and Assessment of the Optimization Potential Figure 8.12: Composition of cost savings of the optimized battery storage system: EPEX-only optimization vs. baseline Combined EPEX+aFRR Optimization (surcharges for neg. aFRR energy) In Fig- ure 8.13 we look at the combined EPEX+aFRR optimization results, given the regulatory scheme of energy-related surcharges for increased consumption through negative aFRR activation. Figure 8.13a represents the result as assumed by the optimization (compared to the baseline operation), i. e., prior to the aFRR simulation. It can be seen that the EPEX DA spot market cost savings are further increased when additionally providing aFRR. This can be explained by the fact that the provision of negative aFRR results in additionally charged energy, hence reducing DA spot market procurement. The aFRR − energy savings of 0 EUR indicate aFRR − energy prices of 0 EUR/MWh, which means that the optimization enforced charging energy for free, plus grid fee related surcharges.3. This allows benefiting from aFRR − capacity based revenues and the discharging in times of high EPEX prices. In the qualitative discussion, we showed how the required aFRR guarantee limits the remaining flexibility. Additionally, it can be observed that aFRR + was provided. Providing aFRR + is beneficial when corresponding earnings compensate both the alternative discharging that would lower DA spot market costs and the reduced cost saving potential caused by holding back the required flexibility for potential aFRR ac- tivations. In total, the expected cost savings in the combined EPEX+aFRR optimization, compared to the EPEX-only optimization, are increased by a factor of 2.14. Figure 8.13b represents the results of the combined EPEX+aFRR optimization after the minute-based simulation of the activation of submitted aFRR bids (compared to the baseline operation). It can be seen that the realized aFRR+ energy revenues are lower compared to the expected aFRR+ energy revenues (in Figure 8.13a). This means less than expected aFRR+ was activated. In the case of aFRR − no difference can be recognized. In turn, the grid fees are higher and the overall cost savings are lower than expected. The discrepancy between the expected and realized aFRR energy revenues results from wrong aFRR activation share estimations as represented by the aFRR activation 3Note the discretization of the aFRR energy prices as presented in Section 8.2.3 216 8.5 Quantitative Analysis of Realized Cost Savings share function 𝑓 aFRR +/−(). Positive aFRR represents discharging the battery and hence decreasing the facility’s load. Consequently, when the facility’s load is decreased less often than expected, more grid fees have to be paid for the energy consumed from the public grid. It can be seen that the realized total cost saving, in contrast to the expected, is 5.23 % lower. Compared to the EPEX-only optimization, the cost savings of the realized combined EPEX+aFRR optimization are increased by a factor of 2.02. (a) Combined EPEX+aFRR optimization (expected) vs. baseline (b) Combined EPEX+aFRR optimization (realized) vs. baseline Figure 8.13: Composition of cost savings of the optimized battery storage system (regulatory scheme: surcharges for neg. aFRR energy). Combined EPEX+aFRR Optimization (no surcharges for neg. aFRR energy) Analogously, Figure 8.14 presents the results given the regulatory scheme of energy- related surcharges for increased consumption through negative aFRR activation. Fig- ure 8.14a shows the results as expected by the optimization. It can be seen that in this regulatory scheme, significantly more negative aFRR energy is provided at a negative aFRR − price. For the facility operator, negative aFRR − prices result in costs in the case of aFRR− activation (payment direction BSP to TSO). However, as grid fees are omitted for aFRR− energy, this was identified by the optimization to be cheaper. In contrast, it can be seen that aFRR + is only provided to a very limited extent, which can be explained by the restrictions introduced through aFRR bids. In this regulatory scheme, there is a 217 Chapter 8 Evaluation and Assessment of the Optimization Potential very high incentive for consumption of aFRR −. Therefore, holding back a SOC buffer for potential aFRR + activation is a limiting factor. From Figure 8.14b we can deduce that less aFRR + and more aFRR − was activated than expected, due to wrong activation estimations via the aFRR activation share function 𝑓 aFRR +/− 𝑡 (). In the end, more energy than expected had to be consumed from the public grid. This explains the slight increase of the grid fee costs (compared to Figure 8.14a). The realized total cost savings, in contrast to the expected total cost savings, are 0.69 % lower, which can be attributed to the discrepancy between the expected and realized aFRR activation. Finally, it can be stated that the regulatory scheme has a large impact on the cost savings. In this regulatory scheme, the realized cost savings of the combined EPEX+aFRR optimization outperform the EPEX-only optimization by a factor of 6.25. (a) Combined EPEX+aFRR optimization (expected) vs. baseline (b) Combined EPEX+aFRR optimization (realized) vs. baseline Figure 8.14: Composition of cost savings of the optimized battery storage system (regulatory scheme: no surcharges for neg. aFRR energy). Comparison with Frequency Containment Reserve Finally, it is worth making a comparison with FCR provisioning. In 2015, the German TSOs published dedicated prequalification requirements that allow battery storage systems to participate in the FCR market [Deu15a]. Since then, FCR provisioning via battery storage systems has gained 218 8.5 Quantitative Analysis of Realized Cost Savings interest in research and practice [Gre+17]. Comparing the remuneration of aFRR and FCR provisioning, it has to be noted that FCR provisioning is remunerated at higher prices. Assuming FCR price levels in the order of 300 EUR/MW/d [Deu20h], a battery storage system continuously providing 200 kW FCR will earn about 21 900 EUR/a, which is above the presented aFRR cost saving potential in both regulatory schemes. However, depending on the use case, FCR provisioning may technically be less suitable than aFRR provisioning, e. g., in the case of electric vehicle pools equipped with unidirectional charging infrastructure. 8.5.2 CHP Plant Analogously to the discussion of the cost savings resulting from the battery optimization, we now discuss the cost savings resulting from the optimization of the CHP plant and condensing boiler. For the combined EPEX+aFRR optimization, we again distinguish the two regulatory schemes: with and without energy-based surcharges for increases consumption through negative aFRR energy. Regarding aFRR we concentrate on the cost savings realized after the simulation of the aFRR bid activation (in contrast to the cost savings expected by the optimization). Figure 8.15 shows the composition of the cost savings for the CHP plant optimization in different scenarios that are discussed below. EPEX-only Optimization In Figure 8.15a we can recognize that the EPEX based optimization reduces the facility’s day-ahead procurement costs as the optimization schedules the CHP to time slots with high EPEX prices such that less expensive energy has to be procured via the EPEX DA spot market (compared to the unoptimized baseline scenario). Further it is notable that the CHP plant operation results in higher gas costs. This can be explained by a higher utilization of the CHP plant. As a fixed uncontrollable heat demand of the facility has to be satisfied, the gas consumption of the condensing boiler is reduced accordingly (note that the CHP plant and the condensing boiler are characterized by different efficiency values). The grid fees are reduced due to the higher electric output of the CHP, which reduces the delivery of EPEX DA spot market procured electricity via the public grid. Combined EPEX+aFRR Optimization (surcharges for neg. aFRR energy) Fig- ure 8.15b represents the results of the combined EPEX+aFRR optimization, after the minute-based simulation of the aFRR bid activation, compared to the baseline operation. This chart considers the regulatory scheme in which energy-related surcharges have to 219 Chapter 8 Evaluation and Assessment of the Optimization Potential (a) EPEX-only optimization vs. baseline (b) Combined EPEX+aFRR optimization (realized) vs. baseline (regulatory scheme: surcharges for neg. aFRR energy) (c) Combined EPEX+aFRR optimization (realized) vs. baseline (regulatory scheme: no surcharges for neg. aFRR energy) Figure 8.15: Composition of the cost savings of the flexibilized CHP plant operation. be paid for negative aFRR activation. The overall cost savings are increased by a factor of 2.02, compared to the EPEX-only optimization. It can be observed that the EPEX spot market procurement costs are lower than in the EPEX-only optimization. However, this enables the optimization to realize further cost savings through aFRR − and aFRR + revenues. The largest cost savings can be attributed to aFRR− capacity revenues. This is due to the fact that in case of negative aFRR (i. e., decreasing the CHP’s power level), the heat generation can be substituted by the condensing boiler. Having the condensing boiler as backup is beneficial because of the required SOC guarantees (see Figure 6.2). Whether the provision of aFRR − this profitable depends on the expected aFRR − capacity 220 8.5 Quantitative Analysis of Realized Cost Savings price, the DA spot market price, and the actual heat demand. Furthermore, it can be recognized that aFRR + is offered (i. e., increasing the CHP’s power level). In order to benefit from aFRR+ capacity revenues, in contrast to the pure EPEX-optimization, the combined EPEX+aFRR optimization in tendency results in lower power levels such that the CHP plant is flexible enough that its power level can be increased. Due to the adjusted runtimes of the CHP plant, its gas costs are lowered, compared to the baseline operation. Consequently, as a fixed endogenous heat energy demand has to be satisfied, a cost increase of the gas costs for the condensing boiler is observable. Combined EPEX+aFRR Optimization (no surcharges for neg. aFRR energy) Analogously, Figure 8.15c shows the optimization results for the regulatory scheme in which negative aFRR energy is not charged with energy-related surcharges. This regulatory scheme results in the fact that aFRR − is offered at low aFRR − energy prices, hence steering towards aFRR − activations (see Figure 5.2a). The fact that aFRR − is offered at negative aFRR energy prices results in aFRR − payments from the BSP to the TSOs, which can be recognized in the significantly increased aFRR − energy based costs. Through the negative aFRR activations, the CHP plant’s gas consumption (and its heat and electricity generation) is significantly decreased, which is reflected in the CHP plant’s gas costs. As a fixed exogenous heat demand has to be satisfied, the condensing boiler’s gas costs are in turn increased in order to cover the CHP plant’s reduced heat output. Furthermore, it can be recognized that, the savings at the EPEX DA spot market are significantly higher than in the alternative regulatory scheme with no energy-based surcharges for negative aFRR energy (as shown in Figure 8.15b). This can be explained by the increased share of negative aFRR activations. Negative aFRR reduces the CHP plant’s gas consumption and the related electric and thermal output. In consequence, as the EPEX DA spot market schedules are fixed (i. e., the corresponding energy is consumed as procured), the facility’s load at the grid connection point increases and more energy is consumed from the public grid (i. e., negative aFRR is provided). This energy is remunerated or in the case of negative aFRR− energy prices paid for via the aFRR − energy price. As in this scenario significantly more negative aFRR energy is provided, this results in the fact that less energy has to be procured via the DA spot market. This is consequently reflected in the grid fees. Furthermore, due to the strong incentive to offer aFRR −, the provision of aFRR+ is reduced. Finally, the total realized cost savings are increased by a factor of 3.59, compared to the results in case of the alternative regulatory with energy-related surcharges and grid fees for negative aFRR energy. This illustrates the high impact of the regulatory scheme on the overall cost saving. 221 Chapter 8 Evaluation and Assessment of the Optimization Potential 8.6 Impact of Device Dimensioning In this section, we discuss the impact of the device dimensioning on the cost saving potential. We define four scenarios for each: the battery storage system, the CHP plant, and the heat buffer. We compare both the EPEX-only and the realized EPEX+aFRR optimization results (i. e., after the activation of aFRR bids through the aFRR simulation) to the baseline scenario. By analyzing these scenarios regarding the impact on different cost components, we show how the sizing of devices contributes to improving the DA spot and aFRR balancing market optimization results. In the following discussion, we distinguish the two regulatory schemes with and without energy-related surcharges for negative aFRR energy. Each chart distinguishes the EPEX-only and the combined EPEX+aFRR optimization as realized after the aFRR activation. In order to cover a wide range of device sizes, we increase the device sizes exponentially by a factor of 2. For approximate reference, the charts show an exponential trend line for the cost savings. 8.6.1 Battery Storage System Figure 8.16 presents the optimization results for four different sizes of the battery storage system. R² = 1 R² = 1 0 € 5,000 € 10,000 € 15,000 € 20,000 € 25,000 € 30,000 € 35,000 € 50 kW 250 kWh 100 kW 500 kWh 200 kW 1000 kWh 400 kW 2000 kWhCost savings Battery size EPEX EPEX+aFRR (a) Regulation: surcharges for neg. aFRR energy R² = 1 R² = 0.9996 0 € 5,000 € 10,000 € 15,000 € 20,000 € 25,000 € 30,000 € 35,000 € 50 kW 250 kWh 100 kW 500 kWh 200 kW 1000 kWh 400 kW 2000 kWhCost savings Battery size EPEX EPEX+aFRR (b) Regulation: no surcharges for neg. aFRR energy Figure 8.16: Impact of battery storage system sizing on the cost savings. In Figure 8.16a, a linear correlation of the cost savings with the battery sizing can be observed (note the exponential x-axis and the linear y-axis). Given the constant 222 8.6 Impact of Device Dimensioning power-to-capacity ratio of the battery storage, this can be explained by the optimum schedule, which is independent of the battery sizing. The optimum schedule only differs in the power level. For example, given a different battery size, instead of charging 50 kW over one hour, 100 kW are charged over one hour, resulting in the same percentual SOC increase. No difference can be recognized in the two charts for the EPEX-only optimization, as the regulation regarding surcharges for negative aFRR has no effect in this case. Figure 8.16b shows that the absolute cost savings in the combined EPEX+aFRR optimization are higher, compared to Figure 8.16a. For the same reasons stated above, a correlation between cost savings and battery sizing can be observed based on the battery size. In general, slight cost savings differences between multiple optimization runs are possible due to the non-deterministic nature of the genetic algorithm and due to the realistically simulated aFRR activation (which potentially can lead to differences between solutions with the same expected costs). 8.6.2 CHP Plant Figure 8.17 presents the optimization results for four different CHP plant sizes. We define the CHP plant sizes based on the CHP plant’s gas demand. We then scale the electricity and heat supply linearly using the power-to-heat ratio defined in the baseline scenario in Table 8.1. R² = 0.9329 R² = 0.973 0 € 5,000 € 10,000 € 15,000 € 20,000 € 25,000 € 30,000 € 35,000 € 40,000 € 45,000 € 50,000 € 125 kW_gas 250 kW_gas 500 kW_gas 1000 kW_gasCost savings CHP plant size EPEX EPEX+aFRR (a) Regulation: surcharges for neg. aFRR energy R² = 0.9329 R² = 0.9932 0 € 5,000 € 10,000 € 15,000 € 20,000 € 25,000 € 30,000 € 35,000 € 40,000 € 45,000 € 50,000 € 125 kW_gas 250 kW_gas 500 kW_gas 1000 kW_gasCost savings CHP plant size EPEX EPEX+aFRR (b) Regulation: no surcharges for neg. aFRR energy Figure 8.17: Impact of CHP plant sizing on the optimized cost savings. 223 Chapter 8 Evaluation and Assessment of the Optimization Potential In Figure 8.17a, it can be seen that an increasing CHP plant size in tendency results in higher cost savings in both optimization scenarios. However, a linear relationship cannot be recognized. The higher cost savings coming along with higher CHP plant sizes can be explained by the increased capability to run the CHP plant in expensive DA spot market time slots (in the EPEX-only optimization scenario) and to additionally benefit from higher aFRR capacity and aFRR energy related revenues (in the combined EPEX+aFRR optimization scenario). It has to be noted that we compare the cost savings versus the baseline scenario with the naive CHP plant operation strategy, which already results in higher cost savings in case of higher CHP plant sizes. The smaller the CHP plant is dimensioned, the more the CHP plant will run to satisfy the heat energy demand. Consequently, the smaller the CHP plant size, the better are the potential cost savings already utilized in the baseline scenario. The cost saving potential can be seen stagnating with an increasing CHP plant size. This stagnation can be explained by the fact that only a limited heat energy demand has to be satisfied, and once a certain CHP plant size is reached, the CHP plant cannot be operated longer (see also the discussion below in Section 8.6.3). This can be recognized in the EPEX-only optimization, which shifts the CHP plant runtimes into EPEX DA market price peaks, and to a lower extent also in the combined EPEX+aFRR optimization, which in addition to the generated energy can also benefit from higher capacities. In Figure 8.17b the effect of the regulatory scheme that does not attribute energy- related surcharges to negative aFRR energy can be recognized. It can be recognized that the absolute cost savings are higher as, in this regulatory scheme, the activation of negative aFRR bids allows substituting energy-related grid fees. In the considered facility setup, restrictions regarding the lower SOC bound in the case of negative aFRR provisioning are relaxed by the condensing boiler, which can substitute the CHP plant’s heat supply. Analogous to Figure 8.17a, it can be recognized that, due to the limited heat energy demand, the realizable cost savings stagnate with an increasing CHP plant size in both the EPEX-only and the EPEX+aFRR optimization. Once a certain CHP plant size is reached, the CHP plant cannot run longer as the heat supply cannot be used on-site by the facility. In the EPEX-only optimization, this point is reached earlier as the combined EPEX+aFRR optimization can additionally benefit from higher capacities. 8.6.3 Thermal Energy Storage Figure 8.18 presents the optimization results for different sizes of the thermal energy storage. In the EPEX optimization scenario, it can be seen that an increase in the buffer size leads to higher cost savings, which however stagnate. This stagnation can be explained by the limited heat energy demand. In Table 8.2, we showed that 224 8.7 Impact of Market Development in Future Scenarios R² = 0.8865 R² = 0.9999 0 € 5,000 € 10,000 € 15,000 € 20,000 € 25,000 € 30,000 € 35,000 € 40,000 € 45,000 € 50,000 € 10,000 L 20,000 L 40,000 L 80,000 LCost savings Heat buffer size EPEX EPEX+aFRR (a) Regulation: surcharges for neg. aFRR energy R² = 0.8867 R² = 0.9615 0 € 5,000 € 10,000 € 15,000 € 20,000 € 25,000 € 30,000 € 35,000 € 40,000 € 45,000 € 50,000 € 10,000 L 20,000 L 40,000 L 80,000 LCost savings Heat buffer size EPEX EPEX+aFRR (b) Regulation: no surcharges for neg. aFRR energy Figure 8.18: Impact of thermal energy storage sizing on the optimized cost savings. the hourly average heat energy demand over the whole year is 514.8 kWh. Given a thermal energy storage with a volume of 80 000 L and the assumed temperature delta of Δ𝑇 = 40 K, the thermal energy storage can buffer 3 712 kWhth of heat energy (as derived in Section 4.4.3.1). Consequently, a larger thermal energy storage in the EPEX-only optimization is still limited by the heat demand (discharging the heat storage), which explains the trend to stagnation of the increased cost savings. In contrast, in the combined EPEX+aFRR optimization presented in Figure 8.18a, the increase in the cost saving potential can be explained by the larger thermal energy storage, which brings a higher potential to provide positive aFRR capacity by offering to ramp up the CHP plant and, hence, to benefit from aFRR capacity prices. In Figure 8.18b, a trend to stagnation of the cost savings (coming along with higher thermal energy storage sizes) can be recognized in the EPEX+aFRR optimization scenario. An explanation of this observation is that the major cost savings source in this scenario is negative aFRR activation (as discussed in the context of Figure 8.15c), which is limited by the facility’s heat demand. 8.7 Impact of Market Development in Future Scenarios This section defines potential future scenarios regarding the DA spot and aFRR balancing market. For the aFRR balancing market, we analyze the impact of adjusted aFRR capacity and aFRR energy price levels. For the DA spot market, we analyze the impact of the spot market price fluctuation. The impact is discussed concerning the optimization potential 225 Chapter 8 Evaluation and Assessment of the Optimization Potential of the battery storage system and the CHP plant. We compare both the EPEX-only and the realized EPEX+aFRR optimization results (i. e., after the activation of aFRR bids through the aFRR simulation) to the baseline scenario. 8.7.1 aFRR Capacity Price Levels Due to the dynamic developments in the context of balancing markets, we evaluate the impact of different aFRR capacity price levels on the optimization potential. Scenario Definition In Section 2.4.4.3 we presented recent developments of the balancing market, and in Table 5.1 we highlighted factors influencing the demand and supply of balancing power. On the one side, the balancing market opening will likely attract new BSPs and thus increase the balancing power offered. On the other side, handling the fluctuation and intermittency introduced by renewable energy sources will likely increase the needed balancing power. Consequently, we investigate three scenarios representing low, medium, and high aFRR capacity prices to give insights into the effects of potential market developments. The scenarios are derived from historical aFRR capacity prices using a fluctuation factor 𝐹 as presented in Equation 8.3. The medium aFRR capacity price level represents the actual aFRR capacity prices from the year 2016 (𝐹 = 1.0). For the low aFRR capacity price level scenario we define 𝐹 = 0.5, and for the high aFRR capacity price level scenario we define 𝐹 = 2.0: ∀𝑡 ∈ {0, 1, 2, … } ∶ 𝜋aFRR +/−,capacity,adjusted 𝑡 = 𝐹 ⋅ 𝜋aFRR +/−,capacity 𝑡 (8.3) An overview of the resulting aFRR capacity prices over the considered year is presented in Figure 8.19. Relying on historical market data, it is worth noting that the shown aFRR capacity prices are based on weekly tendering periods as well as peak (HT) and off-peak (NT) products. To adjust for the assumed and nowadays available market design with four-hour product slots, we linearly scaled down the historical aFRR capacity prices as described in Section 4.3.1 (in assumption AaFRR6). Please refer to Figure 8.3b for the resulting hourly aFRR capacity prices. It is worth noting that, in contrast to the aFRR capacity price scenarios, the DA spot market price scenarios presented later in Section 8.7.2 are defined differently. In order to reflect an increasing share of renewable energy sources, we let the DA spot market price fluctuate around the average spot market price level. In contrast, the development of the competition in the aFRR market is driven by the future aFRR demands and potentially 226 8.7 Impact of Market Development in Future Scenarios 0 1,000 2,000 3,000 4,000 5,000 6,000 7,000 1 6 11 16 21 26 31 36 41 46 51EUR per MW and product Week pos/main pos/sub neg/main neg/sub (a) Low aFRR capacity prices (𝐹 = 0.5) 0 1,000 2,000 3,000 4,000 5,000 6,000 7,000 1 6 11 16 21 26 31 36 41 46 51EUR per MW and product Week pos/main pos/sub neg/main neg/sub (b) Medium aFRR capacity prices (𝐹 = 1.0) 0 1,000 2,000 3,000 4,000 5,000 6,000 7,000 1 6 11 16 21 26 31 36 41 46 51EUR per MW and product Week pos/main pos/sub neg/main neg/sub (c) High aFRR capacity prices (𝐹 = 2.0) Figure 8.19: aFRR capacity price level scenarios based on marginal aFRR capacity prices from year 2016 (𝐹 = 1.0). new actors participating in the market (see discussion in Section 5.1.3). These changes will mainly decrease or increase the absolute aFRR capacity price level rather than its fluctuation. Implications of aFRR Capacity Prices The cost savings realized by dedicated optimization runs based on the presented aFRR capacity price levels are shown in Figure 8.20. 0 € 2,000 € 4,000 € 6,000 € 8,000 € 10,000 € 12,000 € 14,000 € 16,000 € 18,000 € 20,000 € F = 0.5 F = 1.0 F = 2.0Cost savings aFRR capacity price level EPEX EPEX+aFRR (a) Battery storage system optimization vs. baseline 0 € 2,000 € 4,000 € 6,000 € 8,000 € 10,000 € 12,000 € 14,000 € 16,000 € 18,000 € 20,000 € F = 0.5 F = 1.0 F = 2.0Cost savings aFRR capacity price level EPEX EPEX+aFRR (b) CHP plant optimization vs. baseline Figure 8.20: Impact of aFRR capacity price levels on the optimized cost savings. 227 Chapter 8 Evaluation and Assessment of the Optimization Potential As expected, the defined aFRR capacity price levels do not impact the EPEX-only optimization. It can be seen that the absolute impact of the aFRR capacity price is significantly higher in the case of the CHP plant optimization. The CHP plant can benefit more from high aFRR capacity prices than the battery storage. This is due to the corresponding heat buffer’s less restricted lower SOC bound as heat generation can be substituted with the condensing boiler. As negative aFRR revenues make up a large share of the cost savings in the optimized CHP plant operation (see Figure 8.15), the CHP plant’s optimization potential in the combined EPEX+aFRR optimization correlates with the aFRR capacity price level to a high degree. In contrast, the battery storage’s flexibility is more restricted due to the required aFRR guarantees (presented in Figure 6.2). Consequently, as aFRR is only offered in late aFRR product slots within the daily optimization period, the impact of aFRR capacity price levels on the battery storage is not as high as in the case of the CHP plant. Summarizing, it can be stated that the CHP plant benefits better from high aFRR capacity price levels than the battery storage. Vice versa, lower aFRR capacity prices have a higher negative impact on the cost saving potential of EPEX+aFRR optimized CHP plants. 8.7.2 DA Spot Market Price Fluctuation We define different day-ahead spot market price scenarios to understand the impact of energy price fluctuations on the optimization result. Scenario Definition Generally, a flat merit order curve supports a low price fluctuation, and a steep merit order curve supports a high price fluctuation. Consequently, the introduction of CO2 prices may result in a higher price fluctuation by increasing the price distance between (cheap) renewable energy sources and (expensive) coal or gas driven power plants [Böi+18]. On the other hand, increased flexibility on the demand side tends to lower price fluctuation. In order to get a better understanding of the robustness of the presented cost savings concerning spot market price fluctuations, we define the following three scenarios. Based on historical EPEX DA prices, we let the EPEX DA prices fluctuate around the average using a factor 𝐹 as follows (where 𝜋DA,avg represents the average price of the original year): ∀𝑡 ∈ {0, 1, 2, … } ∶ 𝜋DA,adjusted 𝑡 = 𝜋DA,avg + (𝜋DA 𝑡 − 𝜋DA,avg) ⋅ 𝐹 (8.4) 228 8.7 Impact of Market Development in Future Scenarios (a) Low DA spot market price fluctuation (𝐹 = 0.5) (b) Medium DA spot market price fluctuation (𝐹 = 1.0) (c) High DA spot market price fluctuation (𝐹 = 2.0) Figure 8.21: DA spot market price fluctuation scenarios: distribution of hourly DA energy prices over one year. This way, we investigate the optimization potential concerning three scenarios. The resulting distribution of the day-ahead energy prices in the three considered scenarios is presented in Figure 8.21. The original EPEX day-ahead auction price fluctuation from the year 2016 [EPE20a] defines the medium scenario (𝐹 = 1.0, Figure 8.21b). In addition, we define a scenario with a lower (𝐹 = 0.5, Figure 8.21a) and a higher (𝐹 = 2.0, Figure 8.21c) price fluctuation. Implications of DA Spot Market Prices Figure 8.22 quantifies the impact of the price fluctuation on the optimization results in the two scenarios with the battery storage system and the CHP plant. It can be seen that a higher price fluctuation increases the cost savings in all scenarios. In the case of battery storage, the relative benefits of an increased price fluctuation are higher. In the case of the CHP plant, an increased price fluctuation increases the benefit of substituting external electricity procurement with on-site generation. Figures 8.13 (battery) and 8.15 (CHP plant) show the composition of cost savings in the baseline scenario with fluctuation factor 𝐹 = 1.0. Relatively seen, it can be recognized that the battery storage can utilize the DA spot market price fluctuation better. However, the total cost savings are higher in the investigated CHP plant scenarios. This can be attributed to the fact that the battery storage optimization can actively decide to discharge energy (EPEX and/or aFRR incentivized), while the heat energy charged into the heat buffer by the CHP plant cannot be discharged by active decisions. Instead, heat energy is removed from the thermal energy storage through the exogenously given heat energy demand, which remains equal independent of the price fluctuation. 229 Chapter 8 Evaluation and Assessment of the Optimization Potential 0 € 2,000 € 4,000 € 6,000 € 8,000 € 10,000 € 12,000 € 14,000 € 16,000 € F = 0.5 F = 1.0 F = 2.0Cost savings DA spot market price fluctuation EPEX EPEX+aFRR (a) Battery storage system optimization vs. baseline 0 € 2,000 € 4,000 € 6,000 € 8,000 € 10,000 € 12,000 € 14,000 € 16,000 € F = 0.5 F = 1.0 F = 2.0Cost savings DA spot market price fluctuation EPEX EPEX+aFRR (b) CHP plant optimization vs. baseline Figure 8.22: Impact of DA spot market price fluctuation on the optimized cost savings. 8.8 Concluding Remarks The qualitative discussion of the optimized schedules and the quantitative analysis of the cost savings showed that the optimization results (and the composition of cost savings) are susceptible to multiple highly interdependent parameters. The high sensitivity of the results to parameter adjustments makes it very hard to quantify the financial potential in future scenarios. This is aggravated by the changing market environment with balancing markets that are opening up for new actors (see Sections 2.4.4.2 and 5.1.3), intraday spot markets that are experiencing an increase in trading volume [Rom+19], and the European market harmonization, e. g., in context of the PICASSO platform [Eur20a]. Due to these substantial, ongoing market advancements, detailed monetary potential quantifications can be expected to have a rather short-term validity. Instead, the presented overall optimization approach and the revealing of patterns, parameter sensitivities, and orders of magnitudes are expected to have a higher impact and longer-term validity. 230 CHAPTER 9 Conclusion This concluding chapter summarizes the presented work, draws a conclusion, and presents the consequences of the elaborated results. This makes it possible to outline further research directions and to provide a broader outlook on the future provision of electric flexibility in an increasingly digitalized energy system. 9.1 Summary of Results In Chapter 1 we presented the idea of a Facility Energy Management System (FEMS) that locally coordinates on-site energy consumption and generation. After discussing multiple options for monetization of electric flexibility. We focused on the research gap of a simultaneous DA spot and aFRR balancing market driven flexibilization of devices located on the traditional demand side. We showed how energetic flexibility regarding time and power can be used to optimize the procurement of electric energy on (day-ahead) spot markets while at the same time offering the potential for remunerated short-term schedule adjustments to the (aFRR) balancing market. This comes with two advantages: On the one side, facility operators can reduce energy costs. On the other side, grid operators can benefit from additional system services to ensure grid stability. Overall, this thesis delivers a comprehensive picture of prosumer flexibilization. In particular, three significant contributions can be recognized. The first is an efficient (genetic) algorithm that utilizes electric flexibility on the prosumer side. The algorithm generates device schedules and market bids that inherently consider the requirements of the consumer side. This is achieved by realistically taking into account uncertain aFRR activations, catch-up effects to be expected due to aFRR activations, device-specific flexibility limits, and on-site demands that have to be satisfied. The second contribution is a simulation and analysis of aFRR activations based on the German aFRR market using publicly available data. Based on the first two contributions, the third contribution is an assessment of the flexibilization potential from a prosumer’s point of view in the 231 Chapter 9 Conclusion currently given, but also in possible future scenarios. We identified that especially the value stacking by managing the trade-off between the two simultaneously incentivizing markets, in combination with managing catch-up effects of demand-side BSPs, has not been addressed and solved by prior work. In the following, we recapitulate the research questions RQ1–5, which we defined in the motivational Chapter 1 and provide a summary of the answers developed in this thesis. RQ1: System environment and information processing What are information-processing system entities, communication links, character- istics of information flows, and uncertainties that have to be managed by a FEMS that utilizes electric flexibility in consumption and generation for participating in spot and balancing markets? The first question was answered in Chapters 2 and 4. In Chapter 2, we provided detailed insights into the environment of a prosumer EMS and presented a detailed overview of flexibility markets. We demonstrated that spot and balancing markets are places where flexibility regarding time and power of electricity consumption and generation can be converted into monetary profit. We examined and explained the trend towards more short-term and more small-scale usage of flexibility. Communication links and information flows in the context of a FEMS were presented in Chapter 4. Given the identified research gap, we focused on the interface to DA spot and the aFRR balancing markets. We showed that flexibility can be offered directly in these markets or through intermediary third-party aggregators that may offer divergent product characteristics. Uncertainties related to the proposed optimization were presented in Chapter 7. There, we identified sources of uncertainty and showed that deviations from predicted demands and expected aFRR activations can be compensated via intraday schedule adjustments, e. g., based on intraday spot markets. RQ2: Modeling and simulation in the prosumer context How can grid and facility side system entities in the context of a spot- and balancing- market driven FEMS be modeled such that the flexibility potential can be assessed by simulation? After presenting fundamentals of power systems and flexibility markets in Chapter 2, selected entities in the context of a grid-responsive FEMS were modeled in Chapter 4. Regarding the prosumer side, we focused on flexible devices that are characterized by electric or thermal flexibility buffers constrained by minimum and maximum possible states of charges. The modeling of exemplary devices in Chapter 4 is based on technical possibilities found in practice and physical properties, e. g., regarding energy conversion. 232 9.1 Summary of Results We intentionally chose a set of devices that covers a broad range of energy forms, namely electricity, heat, cold, and gas (see Table 4.1), and explained the role of non-linearities caused by part-load operation or temperature differences. The devices are modeled via power levels that can be switched at different time intervals. We showed how the power level of a device is interlinked to one or more energy forms and explained how related efficiency values result in non-linearities. In Chapter 6, we collect the relevant characteristics with respect to the proposed optimization algorithm, which we presented in Chapter 7. The modeling of the grid and market side was presented in Chapter 4. There, the DA spot market is modeled using a price forward curve, which could also be provided by an intermediary electricity supplier. The modeling of activations of aFRR market bids is based on publicly available data in the form of anonymous aFRR bids and the TSO’s overall aFRR power demand. This way, we were able to simulate historical conditions at the aFRR balancing market and to quantify potentials by virtually placing simulated prosumers with optimized devices into past merit order lists. RQ3: Analysis of aFRR balancing power activations How are aFRR activations characterized, and to what extent can these characteristics be used as input for an optimization that enables balancing power provision via alternative BSPs on the demand side? Using the aFRR market modeling presented in Chapter 4, we were able to merge historical aFRR bid data with the historical aFRR power demand of the TSO’s Grid Control Cooperation. In Chapter 5 we presented results of an ex-post analysis of aFRR activation characteristics. We showed that in cases of aFRR and mFRR, the energy price of a balancing market bid determines the position in the merit order list and thus the activation probability. Taking a prosumer’s perspective, we analyzed the aFRR activation uncertainty for given aFRR energy prices and quantified the activation uncertainty. We showed that the activation uncertainty in terms of a shorter or longer aFRR activation is higher the closer a bid is positioned at the beginning of the merit order list. An analysis of the development over several years showed that aFRR energy prices decreased continuously from the TSOs’ point of view, which we attribute to the market opening and entry of new market actors. We presented how these market insights, which were not yet understood per the existing literature, can be used for optimizing aFRR bids of prosumers. Furthermore, we showed how prosumers differ from traditional BSPs on the supply side and how they must consider catch-up effects for ensuring the satisfaction of local demands in addition to aFRR activation and opportunity costs. In the optimization problem formulated in Chapter 6, we used the insights regarding aFRR activations in the form of a function that maps aFRR energy prices to a statistically expected aFRR activation share per (one-hour) time slot. In Chapter 8, we were able to show that this 233 Chapter 9 Conclusion is a viable approach for balancing power provision via alternative BSPs on the demand side, despite the high aFRR activation uncertainty. RQ4: Optimization for value stacking of flexibility and market bids How does an efficient algorithm have to look like that utilizes electric flexibility on the demand side by simultaneously considering both the day-ahead spot and the aFRR balancing market—and what are appropriate inputs? The optimization problem presented in Chapter 6 was solved using the genetic algorithm proposed in Chapter 7. A genetic algorithm was chosen both to be easily adaptable to further prosumer incentives and to natively deal with non-linearity in the objective function and constraints. In Chapter 7, we presented design options for implementing genetic algorithms and, based on this, proposed a genetic algorithm that generates DA power level profiles, aFRR capacity level profiles, and aFRR energy price profiles. We showed how these profiles can be merged to expected device schedules and converted to market bids, considering the constraints introduced in Chapter 6. Since prosumers may likely seek to add other cost components to support further prosumer incentives, the simulative nature of the genetic algorithm brings with the advantage that it can easily be extended without changes to the overall problem structure. Targeting cost savings by bidding to the DA spot market and the aFRR balancing market, in particular the following three inputs turned out to be relevant for the optimization: Firstly, the algorithm uses a price-forward curve to represent the predicted DA spot market prices. Secondly, it uses a forecast of aFRR capacity prices that is good enough for acceptance into the pool of aFRR BSPs. Thirdly, we showed how expectations regarding the aFRR activation are crucial for the aFRR revenues and, due to catch-up effects of demand-side BSPs, for keeping the balancing group balanced. Therefore, based on the answer to RQ3, the algorithm uses a function that maps a negative or positive aFRR bid’s energy price into the hourly expected aFRR activation share of the bid. RQ5: Benefits of value stacking prosumer flexibilities What is the monetary effect for flexibility owners of utilizing electric flexibility by value stacking the day-ahead spot and aFRR balancing market options? By implementing the genetic algorithm and the simulation of aFRR bid activations and devices, we were able to quantify the optimization potential in Chapter 8. We focused on a battery energy storage system, as it can be seen as representative of a generic flexibility, as well as a CHP plant and a condensing boiler, as they serve as exemplary devices for coupling multiple energy forms (electricity, heat, and gas). In the evaluation, we distinguished a pure day-ahead (EPEX) spot market optimization and a combined day-ahead EPEX and aFRR optimization. Due to the uncertainty regarding 234 9.2 Outlook and Further Research Directions aFRR activations, we further distinguished optimization results as expected by the optimization vs. optimization results as finally realized after the simulation of the minute-based aFRR activation. We differentiated two regulatory schemes: including and excluding energy-based surcharges (for grid fees and further static cost components) for additionally consumed energy in case of aFRR-induced increases of the facility load. We showed that the combined optimization simultaneously incentivized by the DA spot and aFRR balancing market could achieve cost savings that outperformed the pure DA spot market driven price optimization by more than a factor of 2 for both the battery storage system and the CHP plant. Despite the high uncertainty regarding the activation of submitted aFRR bids, the costs expected in the optimization and the costs actually realized after the simulation of aFRR activation did not differ significantly. We explained how this can be attributed to the compensation of shorter and longer aFRR activations and fixed aFRR capacity price based revenues. Finally, we showed that the regulatory scheme regarding energy-based surcharges for energy consumed during negative aFRR activation is crucial for the height of the realizable cost savings. The absence of such surcharges for negative aFRR energy causes the optimization to steer towards negative aFRR activations. Compared to the predominant regulatory scheme in which additional energy consumed via negative aFRR activation is subject to energy-related surcharges, this leads to a further increase of the cost savings by more than a factor of 3, depending on the scenario. 9.2 Outlook and Further Research Directions This thesis focused on the research gap of a multi-use optimization that utilizes flexibility simultaneously incentivized by the DA spot and the aFRR balancing markets. Based on the presented results, we would like to point in three major research directions: • Consideration of intraday spot market options: We showed that the uncertainty regarding aFRR activations, in combination with the required aFRR guarantees, is a strongly limiting factor in monetary rewarding aFRR provisioning on the demand side. Consequently, one major extension to the work presented in this thesis is the integration of intraday spot market trading options. At the intraday spot market, in case of unexpected aFRR activations, deviations from the planned state of charge can be managed, i. e., lacking energy can be bought and surplus energy can be sold, with a lead time of down to five minutes (when trading within a TSO control area in Germany). Assuming a sufficient intraday spot market liquidity, this allows lowering the aFRR guarantees presented in Figure 6.2. The increasing liquidity of intraday spot markets and the introduction of the German intraday aFRR balancing 235 Chapter 9 Conclusion energy market in 2020, which now allows placing aFRR bids intraday, contribute to such developments. Considering intraday trading options at both the spot and balancing market will further increase the potential for prosumers with limited flexibility as intraday decisions allow to lower the required SOC band guarantees significantly. • Value-stacking given further flexibilization incentives: We presented a variety of options for monetizing flexibility and demonstrated how a prosumer EMS allows benefiting from simultaneous reaction to different load-shifting incentives. Due to a dynamic system environment that is subject to fundamental changes, the proposed optimization is designed to be easily enriched with cost components and constraints representing further flexibilization incentives. For example, the optimization could additionally weigh up between different balancing market segments or local incentives, such as decreased grid fees through peak load reduction. Furthermore, changing regulations may bring new options for value creation, e. g., regarding incentives from DSOs or dynamic grid fees. The simulation-based fitness calculation in the context of the genetic algorithm supports corresponding extensions without changing the overall problem structure. The optimization of self-consumption is already inherently supported by the proposed optimization. In the end, assessing and comparing different options for flexibility owners requires a holistic and harmonized view. In this context, unified and comparable prosumer scenarios would be beneficial. • Aggregation of prosumer bids: We assumed to participate in the markets inde- pendent of trading amounts or capacity intervals. However, as presented, this is a simplifying assumption as access to spot and balancing markets comes along with specific requirements on the bids. Taking the perspective of an aggregator that directly participates in the markets, a crucial question is, how market-compliant bids based on small-scale flexibility can be aggregated with respect to trading amounts and capacity. In particular, when a larger aggregation of potentially het- erogeneous and complementing devices is given, interesting synergies may arise due to newly emerging flexibility characteristics. Related effects seem interesting to analyze. In conclusion of this thesis, it is worth to again shed light on further possibilities to monetize flexibility in a prosumer’s electric load. After discussing various flexibilization options in the Chapters 2 and 3, the focus of this thesis was put on providing clarity about the potential and the technical feasibility of jointly considering the DA spot and the aFRR balancing markets at the same time. Despite this focus, we showed that further incentives 236 9.2 Outlook and Further Research Directions for prosumer optimizations are evident. Given the controllability of flexible devices via a prosumer EMS, from the point of view of a prosumer, it makes sense to firstly focus on low-hanging fruits that enable considerable monetary benefits with only relatively moderate implementation and communication effort. Such relatively easy-to-implement optimizations address the self-consumption of locally provided energy or the reduction of power peaks. Concerning economic benefits for prosumers, these flexibilization incentives serve as a good starting point. In further steps, the established digitalization can then be enriched according to new developments fostering the prosumers’ active participation in the grid operation. In particular, three major developments can be expected to boost the grid-serving and market-oriented provision of prosumer flexibility: Firstly, the increasing availability of smart metering systems serves as a fundamental basis for monitoring and billing demand response measures. In particular, smart metering systems equipped with an additional communication channel have the potential to serve as an enabler for efficiently communicating external load-shifting incentives in a standardized manner. Secondly, the necessary interfaces to control flexible devices are increasingly available and adopted through standardization, e. g., in the context of EEBus or ISO 15118. Thirdly, flexibility markets and power grid system services are subject to ongoing fundamental changes to manage the increasing fluctuation of the increasing share of renewable energy sources. This results in a clear trend towards active prosumer participation and more small-scale as well as short-term markets and grid services. Consequently, it can be assumed that the increasing availability of technical control options will raise the interest in multi- use of flexibility as flexible prosumers may want to respond to different flexibilization incentives to achieve maximum profit. On this path, new research questions will arise on the one hand concerning prosumer optimizations and interfaces, and on the other hand concerning the overall system design and regulatory framework. A look into the future indicates that the developments described are likely to perma- nently change the way energy is traded and balanced: The trend to more short-term and more small-scale provision of flexibility can already be clearly recognized. In context of the continuing digitalization, the presented results serve as one building block that will enable previously passive energy consumers to actively participate in energy markets and system services, hence contributing to a reliable, economical, and sustainable renewable energy system. 237 APPENDIX A Appendix A.1 Preliminary Work The content presented in this thesis is partially based on work that has been previously published by the author. In the following, peer-reviewed contributions from the author to scientific conferences and journals are presented. Each section in which previously published work is presented is preceded by a declaration that states its source of origin. Relevant publications by the author can be thematically separated into two major categories. The first category of publications focuses on the design of optimization algorithms for utilizing electric flexibility as well as the quantification of the related potentials. In sum, these publications provide a broad set of prosumer optimizations and related potential analyses for different spot and balancing market segments: • Demand Side Management in Smart Buildings by Intelligent Scheduling of Heat Pumps – Manuel Lösch, Dominik Hufnagel, Sebastian Steuer, Tillmann Faßnacht, and Hartmut Schmeck – in Proceedings of the International Conference on Intelligent Energy and Power Systems (IEPS), IEEE, 2014 [Lös+14] This publication presents a genetic algorithm for scheduling of heat pumps together with further devices in buildings, incentivized by cheaper self consumption of local photovoltaic power and a day-ahead price forward curve. This thesis benefits from the insights regarding the genetic algorithm, although it addresses a different scenario and proposes a different encoding. • Simulation Study of a Heuristic Predictive Optimization Scheme for Grid- Reactive Heat Pump Operation – Tillman Faßnacht, Manuel Lösch, and Andreas Wagner – in Proceedings of the REHVA Annual Conference on Advanced HVAC and Natural Gas Technologies, 2015 [FLW15] This publication presents a heuristic for the flexibilized operation of a real heat pump system with a two-level hot water storage for both heating and hot water 239 Appendix A Appendix supply. A detailed sensitivity analysis is provided regarding the impact of the quality of required forecasts. In this thesis, a simplified model of the thermal energy storage is used focusing on one temperature zone, and the gained insights regarding the uncertainty are used in the uncertainty discussion. • Optimizing Bidding Strategies for the German Secondary Control Reserve Market: The Impact of Energy Prices – Manuel Lösch, Sandeep Nainappagari, Julian Rominger, and Hartmut Schmeck – in Proceedings of the 15th International Conference on the European Energy Market (EEM), IEEE, 2018 [Lös+18] This publication analyses the relation between energy prices for automatic Fre- quency Restoration Reserve and related balancing power activations, motivated by the goal to optimize the energy price of balancing power bids of flexible consumers and generators. The analysis of aFRR activations is revisited in Chapter 5 for which this paper builds the basis. • Utilization of Local Flexibility for Charge Management of a Battery Energy Storage System Providing Frequency Containment Reserve – Julian Rominger, Patrick Ludwig Fabian Kern, Manuel Lösch, and Hartmut Schmeck – in Proceedings of the 12th International Renewable Energy Storage Conference (IRES), Elsevier, 2018 [Rom+18] This publication proposes an optimization that improves the charge management of a battery energy storage system providing Frequency Containment Reserve. It is motivated by a 7 MW battery storage system located at an industrial site together with further electric on-site flexibility. In this thesis, the insights regarding FCR provisioning support the decision regarding the focus on aFRR balancing services which we made due to limited speed of reaction of a large share of common facility devices. • Analysis of the German Continuous Intraday Market and the Revenue Potential for Flexibility Options – Julian Rominger, Manuel Lösch, Sebastian Steuer, Katrin Köper, and Hartmut Schmeck – in Prooceeding of the 16th International Conference on the European Energy Market (EEM), IEEE, 2019 [Rom+19] This publication proposes an optimization for a continuous asset-backed trading at the continuous intraday spot market and analysis the monetary potential. The evaluation is based on historic trades and simulated batteries as, e. g., found in electric vehicles. In this thesis, the gained quantitative insights into intraday spot market characteristics support the qualitative discussion of the options for handling catch-up effects in Chapter 5. 240 A.1 Preliminary Work The second category of publications focuses on the implementation of energy manage- ment systems. This work bridges the gap between prosumer optimizations as introduced in the publications above and the actual control of devices via communication architec- tures and protocols: • Building Energy Management in the FZI House of Living Labs – Birger Becker, Fabian Kern, Manuel Lösch, Ingo Mauser, and Hartmut Schmeck – in Energy Informatics, Lecture Notes in Computer Science, Springer, 2015 [Bec+15] This paper presents the EMS developed for the FZI House of Living Labs which is characterized by a heterogeneous device landscape. The presented EMS sets the technical foundation for prosumer flexibilization incentivized by different optimization goals. In this thesis, insights regarding interfaces and capabilities of devices and protocols are used for the realistic modeling in Chapter 4. • Smart Meter Gateways: Options for a BSI-Compliant Integration of Energy Management Systems – Kevin Förderer*, Manuel Lösch*, Ralf Növer, Marilen Ronczka, and Hartmut Schmeck – in Applied Sciences, Special Issue State-of-the-Art of Smart Metering in Electricity Grids, MDPI, 2019 [För+19] This paper discusses architectural options for the communicative integration of energy management systems into the German smart metering and control archi- tecture with Smart Meter Gateways (SMGWs). With respect to this thesis, the publication shows how the required communication between the proposed facility EMS and the grid and market side can be implemented using a standardized communication infrastructure. • State-of-the-Art Integration of Decentralized Energy Management Systems into the German Smart Meter Gateway Infrastructure – Nils Kroener*, Kevin Förderer*, Manuel Lösch*, and Hartmut Schmeck – in Applied Sciences, MDPI, 2020 [Kro+20] This paper presents an SMGW-based prototype implementation of a control archi- tecture for a decentralized prosumer optimization that enables the flexibilization of devices on basis of the Smart Grid Traffic Light Concept. It can be seen as ex- tension to the theoretical discussion presented in the above publication [För+19], focusing on the control of electric vehicle charging processes. Regarding this thesis, the implementation of the presented Smart Grid Traffic Light Concept could be enriched with respect to the aFRR prosumer optimization presented in this thesis in order to reconcile TSO, DSO, and supplier incentives. *These authors contributed equally as stated in the respective publication. 241 Appendix A Appendix Further peer-reviewed publications by the author are not directly related to the work presented in this thesis and partly address prior research on Cloud Computing platforms [KLK14; KL14; LK13; Stü+20]. A.2 Price Levels in Context of the CHP Plant Operation Table A.1 summarizes price levels in the context of the flexibilization of the CHP plant operation, as used in the evaluation. Table A.1: Price levels in the context of the CHP plant optimization. CHP plant operation Alternative to CHP plant operation Costs for 1 kWh electricity 𝑐1 kWhel,chp = 𝑒el chp / 𝜂el chp ⋅ 𝜋gas = 1.00 kWh / 0.36 ⋅ 4.56 Ct kWh = 12.67 Ct Public grid: 𝑐1 kWhel,grid = 𝑒el grid ⋅ 𝜋gridFees + 𝑒el grid ⋅ 𝜋DA = 10.32 Ct + 𝜋DA 𝑡 Ct Associated heat generation 𝑒 heat chp = 𝑒el chp / 𝜂el chp ⋅ 𝜂heat chp = 1.00 kWh / 0.36 ⋅ 0.54 = 1.50 kWhheat Condensing boiler: 𝑐1.5 kWhheat,condBoiler = 𝑒heat condBoiler / 𝜂heat condBoiler ⋅ 𝜋gas = 1.50 kWh / 0.90 ⋅ 4.56 Ct kWh = 7.60 Ct Total costs 1.00 kWhel + 1.50 kWhheat cost 12.67 Ct 1.00 kWhel costs 10.32 Ct + 𝜋DA 𝑡 Ct 1.50 kWhheat costs 7.60 Ct 242 Bibliography [50H+16] 50Hertz Transmission, Amprion, Tennet TSO, TransnetBW, BDEW, BBE, Bitkom, bne, dena, GEODE, and VKU. Branchenleitfaden: Regelleistungser- bringung durch Drittpartei-Aggregatoren gem § 26a StromNZV. 2016. [AAK17] R. Anand, D. Aggarwal, and V. Kumar. “A comparative analysis of opti- mization solvers.” In: Journal of Statistics and Management Systems 20.4 (2017). doi: 10.1080/09720510.2017.1395182. [Ago19] Agora Energiewende. Der Spotmarktpreis als Index für eine dynamische EEG- Umlage: Vorschlag für eine verbesserte Integration Erneuerbarer Energien durch Flexibilisierung der Nachfrage. 2019. [Agr+14] A.-C. Agricola, H. Seidl, S. Mischinger, C. Rehtanz, M. Greve, U. Häger, D. Hilbrich, S. Kippelt, A. Kubis, V. Liebenau, et al. dena-Studie Systemdi- enstleistungen 2030: Sicherheit und Zuverlässigkeit einer Stromversorgung mit hohem Anteil erneuerbarer Energien. Publikation der dena (Deutsche Energie-Agentur). 2014. [AHP12] A. Arteconi, N. Hewitt, and F. Polonara. “State of the art of thermal storage for demand-side management.” In: Applied Energy 93 (2012). doi: 10. 1016/j.apenergy.2011.12.045. [Alb18] K.-J. Albers, ed. Recknagel – Taschenbuch für Heizung und Klimatech- nik 2019/2020. Vol. 79. Deutscher Industrieverlag, 2018. isbn: 978- 3961430789. [All14] F. Allerding. Organic Smart Home – Energiemanagement für Intelligente Gebäude. Karlsruher Institut für Technologie, 2014. isbn: 9783731501817. [Alo+19] S. Alonso, A. Morán, M. Á. Prada, P. Reguera, J. J. Fuertes, and M. Domínguez. “A Data-Driven Approach for Enhancing the Efficiency in Chiller Plants: A Hospital Case Study.” In: Energies 12.5 (2019). doi: 10.3390/en12050827. [AM13] M. A. Anuradha and A. Massoud. Smart Grid Research: Control Systems - IEEE Vision for Smart Grid Control: 2030 and Beyond. 2013. doi: 10.1109/ IEEESTD.2013.6648362. 243 Bibliography [Arb20] Arbeitsgemeinschaft Energiebilanzen e. V. (AGEB). Anwendungsbilanzen zur Energiebilanz Deutschland: Endenergieverbrauch nach Energieträgern und Anwendungszwecken. 2020. [ASH15] A.-C. Agricola, H. Seidl, and R. Heuke. Regelleistungserbringung aus dezen- tralen Energieanlagen: Analyse des weiteren Handlungsbedarfs der dena- Plattform Systemdienstleistungen. Publikation der dena (Deutsche Energie- Agentur). 2015. [ASU14] ASUE Arbeitsgemeinschaft für sparsamen und umweltfreundlichen En- ergieverbrauch e.V. BHKW-Kenndaten 2014/2015: Module, Anbieter, Kosten. 2014. [ASU15] ASUE Arbeitsgemeinschaft für sparsamen und umweltfreundlichen En- ergieverbrauch e.V. BHKW-Fibel. 2015. [Bäc96] T. Bäck. Evolutionary Algorithms in Theory and Practice. Evolution Strategies, Evolutionary Programming, Genetic Algorithms. 1996. doi: 10.1093/oso/ 9780195099713.001.0001. [Bal+17] S. Baldi, T. L. Quang, O. Holub, and P. Endel. “Real-time monitoring energy efficiency and performance degradation of condensing boilers.” In: Energy Conversion and Management 136 (2017). doi: 10.1016/j.enconman.2017. 01.016. [BB18] S. M. Braun and C. Brunner. “Price Sensitivity of Hourly Day-ahead and Quarter-hourly Intraday Auctions in Germany.” In: Zeitschrift für En- ergiewirtschaft 42.3 (2018). doi: 10.1007/s12398-018-0228-0. [BBV04] S. Boyd, S. P. Boyd, and L. Vandenberghe. Convex optimization. Cambridge university press, 2004. doi: 10.1017/cbo9780511804441. [BDE15] BDEW German Association of Energy and Water Industries. Smart Grid Traffic Light Concept: Design of the amber phase (discussion paper). 2015. [BDE20a] BDEW Bundesverband der Energie- und Wasserwirtschaft e.V. BDEW- Branchenlösung Redispatch 2.0: Datenaustausch-, Bilanzierungs-und Abrech- nungsprozesse. 2020. [BDE20b] BDEW Bundesverband der Energie- und Wasserwirtschaft e.V. Redispatch in Deutschland: Auswertung der Transparenzdaten April 2013 bis einschließlich März 2020. 2020. 244 Bibliography [Bec+15] B. Becker, F. Kern, M. Lösch, I. Mauser, and H. Schmeck. “Building Energy Management in the FZI House of Living Labs.” In: Energy Informatics. Lecture Notes in Computer Science (LNCS). Springer, 2015. doi: 10.1007/ 978-3-319-25876-8_9. [Bel52] R. Bellman. “On the Theory of Dynamic Programming.” In: Proceed- ings of the National Academy of Sciences of the United States of America 38.16589166 (1952). doi: 10.1073/pnas.38.8.716. [Bel66] R. Bellman. “Dynamic Programming.” In: Science 153.3731 (July 1966). doi: 10.1126/science.153.3731.34. [Bel84] R. E. Bellman. Eye of the Hurricane: An Autobiography. 1984. doi: 10.1142/ 0076. [Ben+16] G. Benetti, D. Caprino, M. L. Della Vedova, and T. Facchinetti. “Electric load management approaches for peak load reduction: A systematic literature review and state of the art.” In: Sustainable Cities and Society 20 (2016). doi: 10.1016/j.scs.2015.05.002. [BEN09] A. Ben-Tal, L. El Ghaoui, and A. Nemirovski. Robust optimization. Vol. 28. Princeton University Press, 2009. doi: 10.1515/9781400831050. [Bie+14] B. Biegel, M. Westenholz, L. H. Hansen, J. Stoustrup, P. Andersen, and S. Harbo. “Integration of flexible consumers in the ancillary service markets.” In: Energy 67 (2014). doi: 10.1016/j.energy.2014.01.073. [BK00] G. Brunekreeft and K. Keller. “The electricity supply industry in Germany: market power or power of the market?” In: Utilities Policy 9.1 (2000). doi: 10.1016/S0957-1787(01)00002-9. [BM14] R. J. Bessa and M. A. Matos. “Optimization models for an EV aggrega- tor selling secondary reserve in the electricity market.” In: Electric Power Systems Research 106 (2014). doi: 10.1016/j.epsr.2013.08.006. [Böi+18] F. Böing, A. Regett, C. Kranner, C. Pellinger, S. Fattler, and J. Conrad. CO2-Preis vs. Kohleausstieg: Eine Diskussionsgrundlage zur klimapolitischen Debatte. 2018. [Bon99] E. Bonabeau. Swarm intelligence: from natural to artificial isystems. New York: Oxford University Press, 1999. isbn: 9780195131598. 245 Bibliography [BP17] J. Baumhögger and C. Perret. “Großhandelsmärkte für Strom und Gas.” In: Industrielle Energiestrategie: Praxishandbuch für Entscheider des produzieren- den Gewerbes. Ed. by F. J. Matzen and R. Tesch. Wiesbaden: Springer Fachmedien Wiesbaden, 2017. isbn: 978-3-658-07606-1. doi: 10.1007/ 978-3-658-07606-1_5. [BR03] C. Blum and A. Roli. “Metaheuristics in combinatorial optimization.” In: ACM Computing Surveys 35.3 (2003). doi: 10.1145/937503.937505. [Bra+19] F. Braeuer, J. Rominger, R. McKenna, and W. Fichtner. “Battery storage systems: An economic model-based analysis of parallel revenue streams and general implications for industry.” In: Applied Energy 239 (Apr. 2019). doi: 10.1016/j.apenergy.2019.01.050. [Bro+18] T. Brown, D. Schlachtberger, A. Kies, S. Schramm, and M. Greiner. “Syner- gies of sector coupling and transmission reinforcement in a cost-optimised, highly renewable European energy system.” In: Energy 160 (2018). doi: 10.1016/j.energy.2018.06.222. [Bun10] Bundesregierung Deutschland. Energiekonzept für eine umweltschonende, zuverlässige und bezahlbare Energieversorgung. 2010. [Bun11] Bundesgesetzblatt. Dreizehntes Gesetz zur Änderung des Atomgesetzes. 2011. [Bun12a] Bundesgesetzblatt. Verordnung zur Gewährleistung der technischen Sicher- heit und Systemstabilität des Elektrizitätsversorgungsnetzes (Systemstabil- itätsverordnung - SysStabV). 2012. [Bun12b] Bundesnetzegentur. Az. BK4-12-1656: Beschluss in dem Verwaltungsver- fahren nach § 29 Abs. 1 EnWG in Verbindung mit § 30 Abs. 2 Nr. 7 StromNEV hinsichtlich der Festlegung zur sachgerechten Ermittlung individueller Entgelte nach § 19 Abs. 2 S. 1 StromNEV. 2012. [Bun13] Bundesamt für Sicherheit in der Informationstechnik. Technische Richtlinie BSI TR-03109-1: Anforderungen an die Interoperabilität der Kommunika- tionseinheit eines intelligenten Messsystems. 2013. [Bun14] Bundesministerium für Wirtschaft und Energie (BMWi). Ein Strom- markt für die Energiewende: Diskussionspapier des Bundesministeriums für Wirtschaft und Energie (Grünbuch). 2014. [Bun15a] Bundesministerium für Wirtschaft und Energie (BMWi). Ein Strommarkt für die Energiewende: Ergebnispapier des Bundesministeriums für Wirtschaft und Energie (Weissbuch). 2015. [Bun15b] Bundesnetzagentur. Bericht Netzentgeltsystematik Elektrizität. 2015. 246 Bibliography [Bun16] Bundesnetzagentur. Bedarfsermittlung 2019–2030: Bestätigung des Netzen- twicklungsplans Strom für das Zieljahr 2030. 2016. [Bun17a] Bundesnetzagentur. Az. BK6-15-158: Beschluss in dem Verwaltungsverfahren zur Festlegung von Ausschreibungsbedingungen und Veröffentlichungspflichten für Sekundärregelung. 2017. [Bun17b] Bundesnetzagentur. Az. BK6-15-159: Beschluss in dem Verwaltungsverfahren zur Festlegung von Ausschreibungsbedingungen und Veröffentlichungspflichten für Minutenreserve. 2017. [Bun17c] Bundesnetzagentur. Az. BK6-18-004-RAM: Beschluss in dem Verwaltungsver- fahren zur Genehmigung des Vorschlags der deutschen regelzonenverant- wortlichen Übertragungsnetzbetreiber (ÜNB) für die Modalitäten für Regelre- serveanbieter. 2017. [Bun17d] Bundesnetzagentur. Az. BK6-18-019: Beschluss in dem Verwaltungsverfahren zur Änderung des in der Festlegung von Ausschreibungsbedingungen und Veröffentlichungspflichten für Sekundärregelung vom 13.06.2017, Az. BK6- 15-158, [...] geregelten Zuschlagsmechanismus. 2017. [Bun17e] Bundesnetzegentur. Az. BK6-17-046: Beschluss in dem Verwaltungsverfahren zur Festlegung zur Regelung der Erbringung von Sekundärregelleistung und Minutenreserve durch Letztverbraucher in Stromlieferverträgen. 2017. [Bun20a] Bundesministerium für Wirtschaft und Energie (BMWi). Time series for the development of renewable energy sources in Germany, based on statistical data from the Working Group on Renewable Energy-Statistics (AGEE-Stat). 2020. [Bun20b] Bundesnetzagentur. Az. BK6-19-552: Beschluss in dem Verwaltungsver- fahren wegen Genehmigung des Vorschlags der regelzonenverantwortlichen deutschen Übertragungsnetzbetreiber zur Börsenpreiskopplung des regelzo- nenübergreifenden einheitlichen Bilanzausgleichsenergiepreises. 2020. [Bun20c] Bundesnetzagentur. Monitoringbericht 2019. 2020. [Bun21] Bundesnetzagentur. Monitoringbericht 2020. 2021. [Bur+17] A. Burgio, G. Brusco, D. Menniti, A. Pinnarelli, N. Sorrentino, and P. Vizza. “Economic evaluation in using storage to reduce imbalance costs of renew- able sources power plants.” In: 2017 14th International Conference on the European Energy Market (EEM). 2017. doi: 10.1109/EEM.2017.7981982. 247 Bibliography [CEN13] CEN-CENELEC-ETSI Smart Grid Coordination Group. SG- CG/M490/Methodology & New Applications: Annex B - Concepts, Elements and Tools for the Smart Grid Methodology. Tech. rep. 2013. [CF18] Consentec GmbH and Fraunhofer-Institut für System-und Innovations- forschung ISI. “Optionen zur Weiterentwicklung der Netzentgeltsystem- atik für eine sichere, umweltgerechte und kosteneffiziente Energiewende (Studie im Auftrag des Bundesministeriums für Wirtschaftund Energie.” In: (2018). [ČLM13] M. Črepinšek, S.-H. Liu, and M. Mernik. “Exploration and Exploitation in Evolutionary Algorithms: A Survey.” In: ACM Comput. Surv. 45.3 (July 2013). doi: 10.1145/2480741.2480752. [CM16] M. Choobineh and S. Mohagheghi. “Optimal Energy Management in an Industrial Plant Using On-Site Generation and Demand Scheduling.” In: IEEE Transactions on Industry Applications 52.3 (2016). doi: 10.1109/TIA. 2015.2511094. [Con+19] M. Contu, F. Allella, E. M. Carlini, S. Montone, A. Pascucci, L. Michi, and G. Pecoraro. “The European Electricity Balancing Platforms and the Imbalance Netting Process: Terna’s participation in the International Grid Control Cooperation.” In: 2019 AEIT International Annual Conference (AEIT). IEEE. 2019. doi: 10.23919/aeit.2019.8893343. [Con08] Consentec GmbH. “Gutachten zur Höhe des Regelenergiebedarfs.” In: (2008). [Con14] Consentec GmbH. “Beschreibung von Regelleistungskonzepten und Regelleistungsmarkt (Studie im Auftrag der deutschen Übertragungsnetz- betreiber).” In: (2014). [Con20] Consentec GmbH. “Netzentgeltreform: Netzentgelte verbraucherfreundlich gestalten (Gutachten für Verbraucherzentrale Bundesverband (vzbv).” In: (2020). [Cor+09] T. H. ( C. Cormen, C. E. ( Leiserson, R. L. ( Rivest, and C. ( U. Stein. Intro- duction to Algorithms. MIT Press, July 2009. 1320 pp. isbn: 0262033844. [Cor+20] C. Corinaldesi, D. Schwabeneder, G. Lettner, and H. Auer. “A rolling horizon approach for real-time trading and portfolio optimization of end-user flexibilities.” In: Sustainable Energy, Grids and Networks 24 (2020). doi: 10.1016/j.segan.2020.100392. [Dan02] G. B. Dantzig. “Linear Programming.” In: Operations Research 50.1 (2002). 248 Bibliography [DBS11] D. Dzung, I. Berganza, and A. Sendin. “Evolution of powerline communica- tions for smart distribution: From ripple control to OFDM.” In: 2011 IEEE International Symposium on Power Line Communications and Its Applications. 2011. doi: 10.1109/ISPLC.2011.5764444. [Deu12] Deutsches Institut für Normung. DIN EN 60038: CENELEC standard voltages (IEC 60038:2009, modified). 2012. [Deu13] Deutsche Energie-Agentur (dena). dena Ergebnispapier: Die Entwicklung der Märkte für Flexibilität in der Stromversorgung. 2013. [Deu15a] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Anforderungen an die Speicherkapazität bei Batterien für die Primärregelleistung. 2015. [Deu15b] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Gemeinsame Stellungnahme der Übertragungsnet- zbetreiber zum Weißbuch ”Ein Strommarkt für die Energiewende”. 2015. [Deu16] Deutsche Energie-Agentur (dena). Diskussionspapier: Die Bedeutung von Nachholeffekten bei der Regelleistungserbringung durch flexible Lasten (De- mand Side Management). 2016. [Deu18a] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). FAQ Regelleistung. 2018. [Deu18b] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Konsultationsbericht für die Modalitäten für Regelreserveanbieter gemäß Artikel 18 Abs. 5 der Verordnung (EU) 2017/2195 der Kommission vom 23. November 2017 zur Festlegung einer Leitlinie über den Systemausgleich im Elektrizitätsversorgungssystem. 2018. [Deu18c] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Stellungnahmen zu den Modalitäten für Regel- reserveanbieter gemäß Artikel 18.5 der Verordnung (EU) 2017/2195 der Kommission vom 23. November 2017 zur Festlegung einer Leitlinie über den Systemausgleich im Elektrizitätsversorgungssystem. 2018. [Deu19a] Deutsche Energie-Agentur (dena). Regulatorischer Handlungsbedarf zur Erschließung und Nutzung netzdienlicher Flexibilität. 2019. [Deu19b] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Präqualifizierte Anbieter je Regelenergieart. 2019. 249 Bibliography [Deu19c] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Rahmenvertragüber die Vergabe von Aufträgen zur Erbringung der Regelenergieart Primärregelleistung. 2019. [Deu19d] Deutscher Bundestag. “Unterrichtung durch die Bundesregierung: 7. Sektorgutachten Energie der Monopolkommission gemäß § 62 des En- ergiewirtschaftsgesetzes – Wettbewerb mit neuer Energie.” In: Drucksache 19/13440 (2019). [Deu20a] Deutsche Börse AG. Marktmodell für den Handelsplatz Xetra: T7 Release 8.1. 2020. [Deu20b] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Berechnung des regelzonenübergreifenden ein- heitlichen Bilanzausgleichsenergiepreises (reBAP): Modellbeschreibung. 2020. [Deu20c] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Information zum Netzregelverbund und der in- ternationalen Weiterentwicklung. 2020. [Deu20d] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Netzregelverbund. 2020. [Deu20e] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Präqualifikationsverfahren für Regelreserveanbi- eter (FCR, aFRR, mFRR) in Deutschland (“PQ-Bedingungen”). 2020. [Deu20f] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Präqualifizierte Leistung in Deutschland. 2020. [Deu20g] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Regelleistung.net - Daten zur Regelenergie. 2020. [Deu20h] Deutsche Übertragungsnetzbetreiber (50Hertz Transmission, Amprion, Tennet TSO, TransnetBW). Regelleistung.net - Datencenter: Ausschreibungs- daten. 2020. [Deu20i] Deutscher Bundestag. Gesetzentwurf der Bundesregierung: Entwurf eines Gesetzes zur Reduzierung und zur Beendigung der Kohleverstromung und zur Änderung weiterer Gesetze (Kohleausstiegsgesetz). 2020. [DN11] J. J. Durillo and A. J. Nebro. “jMetal: A Java framework for multi-objective optimization.” In: Advances in Engineering Software 42.10 (2011). doi: 10.1016/j.advengsoft.2011.05.014. [Dor04] M. Dorigo. Ant colony optimization. Cambridge, Mass: MIT Press, 2004. isbn: 9780262042192. 250 Bibliography [DPV06] S. Dasgupta, C. Papadimitriou, and U. Vazirani. Algorithms. 2006. 336 pp. isbn: 0073523402. [Ehr05] M. Ehrgott. Multicriteria Optimization. Lecture notes in economics and mathematical systems. Springer, 2005. isbn: 9783540213987. doi: 10. 1007/978-0-387-95865-1_8. [EMK11] E. Ela, M. Milligan, and B. Kirby. “Operating Reserves and Variable Gener- ation.” In: Technical Report, National Renewable Energy Laboratory (2011). doi: 10.2172/1023095. [Ene+20] D. Enescu, G. Chicco, R. Porumb, and G. Seritan. “Thermal Energy Storage for Grid Applications: Current Status and Emerging Trends.” In: Energies 13.2 (2020). doi: 10.3390/en13020340. [Ene20] Energy Brainpool GmbH & Co. KG. Spotpreisprognose: Day-Ahead-Markt Deutschland, Österreich, Frankreich, Italien und Schweiz. 2020. [Eng+19] S. Englberger, H. Hesse, N. Hanselmann, and A. Jossen. “SimSES Multi- Use: A simulation tool for multiple storage system applications.” In: 16th International Conference on the European Energy Market (EEM). 2019. doi: 10.1109/EEM.2019.8916568. [ENT09] ENTSO-E Operations Handbook Team. “ENTSO-E Continental Europe Operation Handbook.” In: 2009. Chap. Policy 1: Load-Frequency Control and Performance. [ENT17] ENTSO-E Operations Handbook Team. “ENTSO-E Operation Handbook.” In: 2017. Chap. Operation Handbook Policy 5: Emergency Operations. [EPC18] E. Espe, V. Potdar, and E. Chang. “Prosumer Communities and Relationships in Smart Grids: A Literature Review, Evolution and Future Directions.” In: Energies 11.10 (Sept. 2018). doi: 10.3390/en11102528. [EPE20a] EPEX SPOT SE. Market Data for the German Day-ahead Auction. 2020. [EPE20b] EPEX SPOT SE. Market Data for the German Intraday Auction. 2020. [Ern13] Ernst & Young. Kosten-Nutzen-Analyse für einen flächendeckenden Einsatz intelligenter Zähler (Studie im Auftrag des Bundesministeriums für Wirtschaft und Energie). 2013. [ES01] Eberhart and Y. Shi. “Particle swarm optimization: developments, applica- tions and resources.” In: Proceedings of the 2001 Congress on Evolutionary Computation (IEEE Cat. No.01TH8546). Vol. 1. 2001. doi: 10.1109/CEC. 2001.934374. 251 Bibliography [ES15] A. Eiben and J. Smith. Introduction to Evolutionary Computing. Springer Berlin Heidelberg, 2015. doi: 10.1007/978-3-662-44874-8. [ES98] A. E. Eiben and C. A. Schippers. “On Evolutionary Exploration and Ex- ploitation.” In: Fundamenta Informaticae 35.1-4 (1998). doi: 10.3233/FI- 1998-35123403. [Eur09] C. European Parliament. Directive 2009/72/EC of the European Parliament and of the Council: Common Rules for the Internal Market in Electricity and Repealing Directive 2003/54/EC. 2009. [Eur14a] European Commission. A policy framework for climate and energy in the period from 2020 to 2030. 2014. [Eur14b] European Commission. Benchmarking smart metering deployment in the EU-27 with a focus on electricity (Report from the Commission). 2014. [Eur14c] European Commission. Country fiches for electricity smart metering (Com- mission staff working document). 2014. [Eur17] European Commission. Commission Regulation (EU) 2017/2195 on estab- lishing a guideline on electricity balancing. 2017. [Eur18a] European Commission. 2030 climate & energy framework. 2018. [Eur18b] European Network of Transmission System Operators for Electricity (ENTSO-E). Electricity Balancing in Europe: European Electricity Balancing Guideline. 2018. [Eur18c] European Network of Transmission System Operators for Electricity (ENTSO-E). Explanatory Document to All TSOs’ proposal for the implementa- tion framework for a European platform for the exchange of balancing energy from frequency restoration reserves with automatic activation in accordance with Article 21 of Commission Regulation (EU) 2017/2195 of 23 November 2017 establishing a guideline on electricity balancing. 2018. [Eur20a] European Network of Transmission System Operators for Electricity. ENTSO- E Balancing Report 2020. 2020. [Eur20b] European Network of Transmission System Operators for Electricity (ENTSO-E). ENTSO-E Balancing Report. 2020. [Eur20c] European Power Exchange. EPEX SPOT Market Rules: EPEX SPOT Opera- tional Rules. 2020. [Eur21a] European Commission – Energy Directorate-General, Unit B5 “Innovation, research, digitalisation, competitiveness”. Economies of Energy Communities: Review of electricity tariffs and business models. 2021. 252 Bibliography [Eur21b] European Network of Transmission System Operators for Electricity (ENTSO-E). Platform for the International Coordination of Automated Fre- quency Restoration and Stable System Operation (PICASSO). 2021. [Eur96] C. European Parliament. Directive 96/92/EC of the European Parliament and of the Council of 19 December 1996 concerning common rules for the internal market in electricity. 1996. [EW19] H. M. Esther Mengelkamp Bent Richter and C. Weinhardt. “Value and Regulation of Local Electricity Markets.” In: Abstracts from the 8th DACH Conference on Energy Informatics (2019). doi: 10.1186/s42162-019-0098- 7. [Fac09] Fachgebiet Bauphysik & Technischer Ausbau (fbta) am Karlsruher Institut für Technologie. Referenzgebäude auf Basis des TEK-Lastgangstool, entwickelt im Rahmen des BMWi-geförderten Projekts Teilenergiekennwerte. 2009. [Far10] H. Farhangi. “The path of the smart grid.” In: IEEE Power and Energy Magazine 8.1 (2010). doi: 10.1109/mpe.2009.934876. [Fer+13] H. L. Ferreira, R. Garde, G. Fulli, W. Kling, and J. P. Lopes. “Characterisation of electrical energy storage technologies.” In: Energy 53 (2013). doi: 10. 1016/j.energy.2013.02.037. [Fig+20] J. Figgener, P. Stenzel, K.-P. Kairies, J. Linßen, D. Haberschusz, O. Wessels, G. Angenendt, M. Robinius, D. Stolten, and D. U. Sauer. “The development of stationary battery storage systems in Germany - A market review.” In: Journal of Energy Storage 29 (2020). doi: 10.1016/j.est.2019.101153. [Fla+21] F. Flatter, S. Mohammadi, W. Wellssow, A. Schinke-Nendza, G. Blumberg, C. Weber, S. Rasti, P. Schegner, B. Uhlemeyer, M. Zdrallek, U. Spanel, and J. Dickert. “ZellNetz2050 – Structure, Planning and Operation of a Cellular Energy System in 2050.” In: ETG Congress 2021. 2021. [FLW15] T. Fassnacht, M. Lösch, and A. Wagner. “Simulation Study of a Heuristic Pre- dictive Optimization Scheme for Grid-Reactive Heat Pump Operation.” In: Proceedings of the REHVA Annual Conference ”Advanced HVAC and Natural Gas Technologies”. 2015. doi: 10.7250/rehvaconf.2015.019. [FM20] R. Fachrizal and J. Munkhammar. Improved Photovoltaic Self-Consumption in Residential Buildings with Distributed and Centralized Smart Charging of Electric Vehicles. 2020. doi: 10.3390/en13051153. 253 Bibliography [För+19] K. Förderer, M. Lösch, R. Növer, M. Ronczka, and H. Schmeck. “Smart Meter Gateways: Options for a BSI-Compliant Integration of Energy Management Systems.” In: Applied Sciences, Special Issue State-of-the-Art of Smart Meter- ing in Electricity Grids, MDPI 9 (2019). doi: 10.3390/app9081634. [For09a] Forum Netztechnik/Netzbetrieb im VDE (FNN). “Anhang D2, Teil 1: Un- terlagen zur Präqualifikation von Anbietern zur Erbringung von Sekundär- regelleistung für die ÜNB (Präqualifikationsunterlagen).” In: Transmission- Code 2007. 2009. [For09b] Forum Netztechnik/Netzbetrieb im VDE (FNN). “Anhang D2, Teil 2: An- forderungen für die Umsetzung des SRL-Poolkonzepts zwischen ÜNB und Anbietern (Anbieteranforderungen SRL-Poolkonzept).” In: Transmission- Code 2007. 2009. [Fro16] Frontier Economics, BET. Kosten und Nutzen einer Dynamisierung von Strompreiskomponenten als Mittel zur Flexibilisierung der Nachfrage. 2016. [GB18] C. Grimme and J. Bossek. Einführung in die Optimierung. Springer Fachme- dien Wiesbaden, 2018. doi: 10.1007/978-3-658-21151-6. [GM17] K. Geschermann and A. Moser. “Evaluation of market-based flexibility provision for congestion management in distribution grids.” In: 2017 IEEE Power & Energy Society General Meeting. July 2017. doi: 10.1109/PESGM. 2017.8274215. [Goe+14] C. Goebel, H.-A. Jacobsen, V. del Razo, C. Doblander, J. Rivera, J. Ilg, C. Flath, H. Schmeck, C. Weinhardt, D. Pathmaperuma, H.-J. Appelrath, M. Sonnenschein, S. Lehnhoff, O. Kramer, T. Staake, E. Fleisch, D. Neumann, J. Strüker, K. Erek, R. Zarnekow, H. Ziekow, and J. Lässig. “Energieinformatik.” In: Wirtschaftsinformatik 56.1 (2014). doi: 10.1007/s00287-015-0884-y. [Gou+20] M. Gough, S. F. Santos, M. Javadi, R. Castro, and J. P. S. Catalão. “Prosumer flexibility: A comprehensive state-of-the-art review and scientometric anal- ysis.” In: Energies 13.2710 (2020). doi: 10.3390/en13112710. [Gre+17] D. Greenwood, K. Lim, C. Patsios, P. Lyons, Y. Lim, and P. Taylor. “Frequency response services designed for energy storage.” In: Applied Energy 203 (2017). doi: 10.1016/j.apenergy.2017.06.046. [Gri+21] V. Grimm, G. Orlinskaya, L. Schewe, M. Schmidt, and G. Zöttl. “Optimal design of retailer-prosumer electricity tariffs using bilevel optimization.” In: Omega 102 (2021). doi: 10.1016/j.omega.2020.102327. 254 Bibliography [GS20] P. Goldkamp and J. Schallenberg. “Probleme lösen bevor sie entstehen: Lokale Flexibilitätsmärkte.” In: Realisierung Utility 4.0 Band 1: Praxis der digitalen Energiewirtschaft von den Grundlagen bis zur Verteilung im Smart Grid. Ed. by O. D. Doleski. Wiesbaden: Springer Fachmedien Wiesbaden, 2020. doi: 10.1007/978-3-658-25332-5_38. [GYd15] B. L. Gorissen, İ. Yanıkoğlu, and D. den Hertog. “A practical guide to robust optimization.” In: Omega 53 (2015). doi: 10.1016/j.omega.2014.12.006. [Hak+15] J.-F. Hake, W. Fischer, S. Venghaus, and C. Weckenbrock. “The German Energiewende – History and status quo.” In: 92 (2015). doi: 10.1016/j. energy.2015.04.027. [Ham50] R. W. Hamming. “Error detecting and error correcting codes.” In: The Bell System Technical Journal 29.2 (1950). doi: 10.1002/j.1538-7305.1950. tb00463.x. [Han+17] S. Han, X. Yan, L.-j. Qin, X.-q. Lin, and B. Zeng. “Research on electricity market operation mechanism and its benefit of demand side participation.” In: IOP Conference Series: Earth and Environmental Science 81 (Aug. 2017). doi: 10.1088/1755-1315/81/1/012180. [Has+19] A. Hassanat, K. Almohammadi, E. Alkafaween, E. Abunawas, A. Hammouri, and V. B. S. Prasath. “Choosing Mutation and Crossover Ratios for Genetic Algorithms—A Review with a New Dynamic Approach.” In: Information 10.12 (Dec. 2019). doi: 10.3390/info10120390. [HG15] F. Hall and R. Greeno. Building Services Handbook. Taylor & Francis, 2015. isbn: 9781317617211. [HHL17] X. Huang, S. H. Hong, and Y. Li. “Hour-Ahead Price Based Energy Manage- ment Scheme for Industrial Facilities.” In: IEEE Transactions on Industrial Informatics 13.6 (2017). doi: 10.1109/TII.2017.2711648. [Hir+20] L. Hirth, I. Schlecht, C. Maurer, and B. Tersteegen. Kosten- oder Markt- basiert? Zukünftige Redispatch-Beschaffung in Deutschland (im Auftrag des Bundesministeriums für Wirtschaft und Energie). 2020. [HM18] J. Held and A. Mannsdörfer. “Der weite Begriff der Kundenanlage in § 3 Nr. 24 a EnWG: Garant oder Hemmnis eines wirksamen Wettbewerbs?” In: REE Recht der Erneuerbaren Energien. Bodak, 2018. 255 Bibliography [HM20] A. Hussain and Y. S. Muhammad. “Trade-off between exploration and exploitation with genetic algorithm using a novel selection operator.” In: Complex & Intelligent Systems 6.1 (2020). doi: 10.1007/s40747-019-0102- 7. [HMS17] E. Hering, R. Martin, and M. Stohrer. Taschenbuch der Mathematik und Physik. Springer Berlin Heidelberg, 2017. doi: 10.1007/978-3-662-53419- 9. [HNV17] P. Hörnig, V. Nikogosian, and T. Veith. “Dynamische EEG-Umlage: Ein alternativer Ansatz zur Finanzierung erneuerbarer Energien.” In: En- ergiewirtschaftliche Tagesfragen 67 (2017). [Hol16] F. Holzenkämpfer. “Umgang mit Unsicherheiten beim Anbieten von Regelleistung durch kommerzielle Liegenschaften.” MA thesis. Karlsruher Institut für Technologie, 2016. [Hop+14] J. Hoppmann, J. Volland, T. S. Schmidt, and V. H. Hoffmann. “The economic viability of battery storage for residential solar photovoltaic systems – A review and a simulation model.” In: Renewable and Sustainable Energy Reviews 39 (2014). doi: 10.1016/j.rser.2014.07.068. [HPG18] A. Hirsch, Y. Parag, and J. Guerrero. “Microgrids: A review of technologies, key drivers, and outstanding issues.” In: Renewable and Sustainable Energy Reviews 90 (2018). doi: 10.1016/j.rser.2018.03.040. [HTN18] A. N. M. M. Haque, T. H. Tawab, and P. H. Nguyen. “Dynamic Clustering for Imbalance Management through Local Supply and Demand Balancing.” In: 2018 IEEE Innovative Smart Grid Technologies - Asia (ISGT Asia). 2018. doi: 10.1109/isgt-asia.2018.8467952. [Hu+13] Y.-C. Hu, M.-H. Lin, J. G. Carlsson, D. Ge, J. Shi, and J.-F. Tsai. “A Re- view of Piecewise Linearization Methods.” In: Mathematical Problems in Engineering 2013 (2013). doi: 10.1155/2013/101376. [Huf15] D. Hufnagel. “Evolutionäre Optimierung zum Anbieten von Flexibilitäten am Strom- und Regelleistungsmarkt.” MA thesis. Karlsruher Institut für Technologie, 2015. [HZ13] L. Hirth and I. Ziegenhagen. “Wind, Sonne und Regelleistung.” In: En- ergiewirtschaftliche Tagesfragen 63.10 (2013). [HZ15] L. Hirth and I. Ziegenhagen. “Balancing power and variable renewables: Three links.” In: Renewable & Sustainable Energy Reviews 50 (2015). doi: 10.1016/j.rser.2015.04.180. 256 Bibliography [Int14] Intergovernmental Panel on Climate Change. Climate change 2014: impacts, adaptation, and vulnerability. Part A: global and sectoral aspects. Ed. by C. B. Field, V. R. Barros, D. J. Dokken, K. J. Mach, and M. D. Mastrandrea. Cambridge, United Kingdom and New York, USA: Cambridge University Press, 2014. Chap. Technical Summary. [Int16] International Grid Control Cooperation (IGCC) Expert Group. Stakeholder document for the principles of IGCC. 2016. [ISM17] J. P. Iria, F. J. Soares, and M. A. Matos. “Trading small prosumers flexibility in the day-ahead energy market.” In: 2017 IEEE Power & Energy Society General Meeting. 2017. doi: 10.1109/PESGM.2017.8274488. [JCR08] H. Jiayi, J. Chuanwen, and X. Rong. “A review on distributed energy re- sources and MicroGrid.” In: Renewable and Sustainable Energy Reviews 12.9 (2008). doi: 10.1016/j.rser.2007.06.004. [Jou41] J. P. Joule. “XXXVIII. On the heat evolved by metallic conductors of elec- tricity, and in the cells of a battery during electrolysis.” In: The London, Edinburgh, and Dublin Philosophical Magazine and Journal of Science 19.124 (1841). doi: 10.1080/14786444108650416. [JW13] J. Jargstorf and M. Wickert. “Offer of secondary reserve with a pool of electric vehicles on the German market.” In: Energy Policy 62 (2013). doi: 10.1016/j.enpol.2013.06.088. [JWJ20] X. Jin, Q. Wu, and H. Jia. “Local flexibility markets: Literature review on concepts, models and clearing methods.” In: Applied Energy 261 (2020). doi: 10.1016/j.apenergy.2019.114387. [KE95] J. Kennedy and R. Eberhart. “Particle swarm optimization.” In: Proceedings of ICNN’95 - International Conference on Neural Networks. Vol. 4. 1995. doi: 10.1007/978-1-4899-7687-1_630. [Kel+16] D. Keles, J. Scelle, F. Paraschiv, and W. Fichtner. “Extended forecast methods for day-ahead electricity spot prices applying artificial neural networks.” In: Applied Energy 162 (2016). doi: 10.1016/j.apenergy.2015.09.087. [Ket14] J. C. Ketterer. “The impact of wind power generation on the electricity price in Germany.” In: Energy Economics, Elsevier 44 (2014). doi: 10.1016/ j.eneco.2014.04.003. [KG17] K. Klein and S. Gschwander. “Forschungsbericht BWPLUS: Latentwärme- speicher in netzreaktiven Gebäuden.” In: (2017). 257 Bibliography [KH19] C. Koch and L. Hirth. “Short-term electricity trading for system balancing: An empirical analysis of the role of intraday trading in balancing Ger- many’s electricity system.” In: Renewable and Sustainable Energy Reviews 113 (2019). doi: 10.1016/j.rser.2019.109275. [KHT16] M. Krütli, C. Hablützel, and F. Tillenkamp. “Systeme für die Beurteilung der Energieeffizienz von Klimakälteanlagen.” In: IEFE Energy Papers Nr. 2 (2016). [KJF16] T. Kaschub, P. Jochem, and W. Fichtner. “Solar energy storage in German households: profitability, load changes and flexibility.” In: Energy Policy 98 (2016). doi: 10.1016/j.enpol.2016.09.017. [KL14] R. Krebs and M. Lösch. “Comparison of Request Admission Based Perfor- mance Isolation Approaches in Multi-tenant SaaS Applications.” In: Pro- ceedings of the 4th International Conference on Cloud Computing and Services Science (CLOSER). SciTePress, 2014. doi: 10.5220/0004948804330438. [Kla+18] E. Klaassen, M. van der Laan, H. de Heer, A. van der Veen, and W. van den Reek. Flexibility Value Stacking: Recommended Processes, Rules and Interactions to Enable Value Stacking for Portfolios of Flexible Demand-side Resources. 2018. [Kle14] J. Kleinberg. Algorithm design. Ed. by É. Tardos. First edition, Pearson new international edition. Always learning. Literaturverzeichnis: Seite 805-814. - Literaturangaben. Harlow: Pearson, 2014. II, 823 Seiten. isbn: 9781292023946. [KLK14] R. Krebs, M. Lösch, and S. Kounev. “Platform-as-a-Service Architecture to Provide Performance Isolated Multi-tenant Applications.” In: Proceedings of the 7th International Conference on Cloud Computing (CLOUD). IEEE, 2014. doi: 10.1109/CLOUD.2014.125. [Kot20] K. Kotilainen. “Energy prosumers’ role in the sustainable energy system.” In: Affordable and Clean Energy. Encyclopedia of the UN Sustainable Development Goals; Leal, FW, Azul, A., Brandli, L., Özuyar, P., Wall, T., Eds (2020). doi: 10.1007/978-3-319-95864-4_11. [KP16] A. Knaut and S. Paulus. Hourly price elasticity pattern of electricity demand in the German day-ahead market. Tech. rep. EWI Working Paper, 2016. [Kro+19] J. Kronqvist, D. E. Bernal, A. Lundell, and I. E. Grossmann. “A review and comparison of solvers for convex MINLP.” In: Optimization and Engineering 20.2 (2019). doi: 10.1007/s11081-018-9411-8. 258 Bibliography [Kro+20] N. Kroener, K. Förderer, M. Lösch, and H. Schmeck. “State-of-the-Art Inte- gration of Decentralized Energy Management Systems into the German Smart Meter Gateway Infrastructure.” In: Applied Sciences 10.11 (2020). doi: 10.3390/app10113665. [Kru+15] R. Kruse, C. Borgelt, F. Klawonn, C. Moewes, G. Ruß, and M. Steinbrecher. Computational Intelligence: Eine methodische Einführung in Künstliche Neu- ronale Netze, Evolutionäre Algorithmen, Fuzzy-Systeme und Bayes-Netze. 2015. isbn: 978-3-658-10904-2. doi: 10.1007/978-3-658-10904-2. [KW94] P. Kall and S. W. Wallace. Stochastic Programming. Springer, 1994. doi: 10.2307/2584504. [Lag+20] J. Lago, G. Marcjasz, B. D. Schutter, and R. Weron. “Forecasting day-ahead electricity prices: A review of state-of-the-art algorithms, best practices and an open-access benchmark.” In: Applied Energy (2020). doi: 10.1016/ j.apenergy.2021.116983. [LDD18] J. Lago, F. De Ridder, and B. De Schutter. “Forecasting spot electricity prices: Deep learning approaches and empirical comparison of traditional algorithms.” In: Applied Energy 221 (2018). doi: 10.1016/j.apenergy. 2018.02.069. [LK13] M. Lösch and R. Krebs. “Conceptual Approach for Performance Isolation in Multi-tenant Systems.” In: Proceedings of the 3rd International Conference on Cloud Computing and Services Science (CLOSER). SciTePress, 2013. doi: 10.5220/0004399102970302. [Loo20] M. Loock. “Unlocking the value of digitalization for the European energy transition: A typology of innovative business models.” In: Energy Research & Social Science 69 (Nov. 2020). doi: 10.1016/j.erss.2020.101740. [Lös+14] M. Lösch, D. Hufnagel, S. Steuer, T. Fassnacht, and H. Schmeck. “Demand Side Management in Smart Buildings by Intelligent Scheduling of Heat Pumps.” In: Proceedings of the International Conference on Intelligent Energy and Power Systems (IEPS). IEEE, 2014. doi: 10.1109/ieps.2014.6874181. [Lös+18] M. Lösch, S. Nainappagari, J. Rominger, and H. Schmeck. “Optimizing Bidding Strategies for the German Secondary Control Reserve Market: The Impact of Energy Prices.” In: Proceedings of the 15th International Conference on the European Energy Market (EEM). IEEE, 2018. doi: 10. 1109/eem.2018.8469993. 259 Bibliography [LP17] S. Lavrijssen and A. C. Parra. “Radical Prosumer Innovations in the Elec- tricity Sector and the Impact on Prosumer Regulation.” In: Sustainability 9.7 (July 2017). doi: 10.3390/su9071207. [LT14] G. Liu and K. Tomsovic. “A full demand response model in co-optimized energy and reserve market.” In: Electric Power Systems Research 111 (2014). doi: 10.1016/j.epsr.2014.02.006. [Luo+15] X. Luo, J. Wang, M. Dooner, and J. Clarke. “Overview of current devel- opment in electrical energy storage technologies and the application po- tential in power system operation.” In: Applied Energy 137 (2015). doi: 10.1016/j.apenergy.2014.09.081. [Lut+15] R. Luthander, J. Widén, D. Nilsson, and J. Palm. “Photovoltaic self- consumption in buildings: A review.” In: Applied Energy 142 (2015). doi: 10.1016/j.apenergy.2014.12.028. [LY+84] D. G. Luenberger, Y. Ye, et al. Linear and nonlinear programming. Vol. 2. Springer, 1984. isbn: 978-0-387-74503-9. doi: 10 . 1007 / 978 - 0 - 387 - 74503-9. [Mad60] A. Madansky. “Inequalities for stochastic linear programming problems.” In: Management science 6.2 (1960). doi: 10.1287/mnsc.6.2.197. [Mau+14] I. Mauser, M. Dorscheid, F. Allerding, and H. Schmeck. “Encodings for Evolutionary Algorithms in smart buildings with energy management systems.” In: 2014 IEEE Congress on Evolutionary Computation (CEC). IEEE, 2014. doi: 10.1109/cec.2014.6900633. [Mau+16] I. Mauser, J. Müller, F. Allerding, and H. Schmeck. “Adaptive building energy management with multiple commodities and flexible evolutionary optimization.” In: Renewable Energy 87 (2016). doi: 10.1016/j.renene. 2015.09.003. [Mau+17] I. Mauser, J. Müller, K. Förderer, and H. Schmeck. “Definition, Modeling, and Communication of Flexibility in Smart Buildings and Smart Grid.” In: International ETG Congress 2017. VDE, 2017. isbn: 978-3-8007-4505-0. [Mau17] I. Mauser. Multi-modal Building Energy Management. Karlsruher Institut für Technologie, 2017. [Mer+20] M. Merten, F. Rücker, I. Schoeneberger, and D. U. Sauer. “Automatic fre- quency restoration reserve market prediction: Methodology and compari- son of various approaches.” In: Applied Energy 268 (2020). doi: 10.1016/ j.apenergy.2020.114978. 260 Bibliography [MFN18] J. Märkle-Huß, S. Feuerriegel, and D. Neumann. “Contract durations in the electricity market: Causal impact of 15min trading on the EPEX SPOT market.” In: Energy Economics 69 (2018). doi: 10.1016/j.eneco.2017.11. 019. [Mil+15] C. Milan, M. Stadler, G. Cardoso, and S. Mashayekh. “Modeling of non- linear CHP efficiency curves in distributed energy systems.” In: Applied Energy 148 (2015). doi: 10.1016/j.apenergy.2015.03.053. [Mis+14] R. Missaoui, H. Joumaa, S. Ploix, and S. Bacha. “Managing energy Smart Homes according to energy prices: Analysis of a Building Energy Man- agement System.” In: Energy and Buildings 71 (2014). doi: 10.1016/j. enbuild.2013.12.018. [MM17] N. Martín-Chivelet and D. Montero-Gómez. “Optimizing photovoltaic self- consumption in office buildings.” In: Energy and Buildings 150 (2017). doi: 10.1016/j.enbuild.2017.05.073. [MO18] H. Martin and S. Otterson. “German Intraday Electricity Market Analysis and Modeling Based on the Limit Order Book.” In: 2018 15th International Conference on the European Energy Market (EEM). IEEE, June 2018. doi: 10.1109/eem.2018.8469829. [MZH18] C. Maurer, C. Zimmer, and L. Hirth. Nodale und zonale Strompreissysteme im Vergleich (Bericht für das Bundesministerium für Wirtschaft und Energie). 2018. [NDV15] A. J. Nebro, J. J. Durillo, and M. Vergne. “Redesigning the JMetal Multi- Objective Optimization Framework.” In: Proceedings of the Companion Pub- lication of the 2015 Annual Conference on Genetic and Evolutionary Compu- tation. GECCO Companion ’15. Madrid, Spain: Association for Computing Machinery, 2015. isbn: 9781450334884. doi: 10.1145/2739482.2768462. [Nex19] Next Kraftwerke GmbH. Whitepaper: Optimierung von Fahrplänen. 2019. [Nit+21] F. Nitsch, M. Deissenroth-Uhrig, C. Schimeczek, and V. Bertsch. “Economic evaluation of battery storage systems bidding on day-ahead and automatic frequency restoration reserves markets.” In: Applied Energy 298.117267 (2021). doi: 10.1016/j.apenergy.2021.117267. [NKS15] J. Neugebauer, O. Kramer, and M. Sonnenschein. “Classification Cascades of Overlapping Feature Ensembles for Energy Time Series Data.” In: Data Analytics for Renewable Energy Integration. Ed. by W. L. Woon, Z. Aung, and 261 Bibliography S. Madnick. Springer International Publishing, 2015. doi: 10.1007/978-3- 319-27430-0_6. [OEO18] F. Ocker, K.-M. Ehrhart, and M. Ott. “Bidding strategies in Austrian and German balancing power auctions.” In: WIREs Energy and Environment 7 (2018). doi: 10.1002/wene.303. [OSM19] C. Olk, D. U. Sauer, and M. Merten. “Bidding strategy for a battery storage in the German secondary balancing power market.” In: Journal of Energy Storage 21 (2019). doi: 10.1016/j.est.2019.01.019. [Ozt+13] Y. Ozturk, D. Senthilkumar, S. Kumar, and G. Lee. “An Intelligent Home Energy Management System to Improve Demand Response.” In: IEEE Transactions on Smart Grid 4.2 (2013). doi: 10.1109/TSG.2012.2235088. [Pan20] M. Pantoš. “Market-based congestion management in electric power sys- tems with exploitation of aggregators.” In: International Journal of Electri- cal Power and Energy Systems 121 (2020). doi: 10.1016/j.ijepes.2020. 106101. [Par+15] S. Parhizi, H. Lotfi, A. Khodaei, and S. Bahramirad. “State of the Art in Research on Microgrids: A Review.” In: IEEE Access 3 (2015). doi: 10.1109/ ACCESS.2015.2443119. [PD11] P. Palensky and D. Dietrich. “Demand Side Management: Demand Re- sponse, Intelligent Energy Systems, and Smart Loads.” In: IEEE Transactions on Industrial Informatics 7.3 (2011). doi: 10.1109/tii.2011.2158841. [Pet+13a] M. K. Petersen, K. Edlund, L. H. Hansen, J. Bendtsen, and J. Stoustrup. “A taxonomy for modeling flexibility and a computationally efficient algorithm for dispatch in Smart Grids.” In: American Control Conference. IEEE, 2013. doi: 10.1109/acc.2013.6579991. [Pet+13b] M. K. Petersen, L. H. Hansen, J. Bendtsen, K. Edlund, and J. Stoustrup. “Market integration of Virtual Power Plants.” In: 52nd IEEE Conference on Decision and Control. 2013. doi: 10.1109/CDC.2013.6760227. [PHM21] J. Pedrero, P. Hernández, and Á. Martínez. Economic Evaluation of PV Installations for Self-Consumption in Industrial Parks. 2021. doi: 10.3390/ en14030728. [PPK15] A. Pillay, S. Prabhakar Karthikeyan, and D. P. Kothari. “Congestion manage- ment in power systems - A review.” In: International Journal of Electrical Power and Energy Systems 70 (2015). doi: 10.1016/j.ijepes.2015.01. 022. 262 Bibliography [Pro20] ProCom GmbH. Spot-Preisprognose: Strompreisprognose EPEX SPOT Day- Ahead Auktion (DE/LU Phelix). 2020. [Qua20] V. Quaschning. Erneuerbare Energien und Klimaschutz: Hintergründe – Techniken und Planung – Ökonomie und Ökologie – Energiewende. Carl Hanser Verlag, 2020. isbn: 9783446464155. [Ray+20] M. Rayati, M. Bozorg, A. M. Ranjbar, and R. Cherkaoui. “Balancing man- agement of strategic aggregators using non-cooperative game theory.” In: Electric Power Systems Research 184 (2020). doi: 10.1016/j.epsr.2020. 106297. [Rei+18] A. Reinders, S. Übermasser, W. Van Sark, C. Gercek, W. Schram, U. Obinna, F. Lehfuss, B. Van Mierlo, C. Robledo, and A. Van Wijk. “An Exploration of the Three-Layer Model Including Stakeholders, Markets and Technologies for Assessments of Residential Smart Grids.” In: Applied Sciences 8.12 (2018). doi: 10.3390/app8122363. [Rie+21] T. Riedel, A. Hoeck, S. Steuer, A. Maertz, W. Fichtner, and H. Schmeck. “Comparison of regulatory concepts for the integration of market- and grid-serving flexibility using smart metering systems.” In: ETG Congress 2021. 2021. [Rie17] K. Riedle. “Entwicklungen in der Kraftwerkstechnik für die industrielle Eigenstromerzeugung.” In: Industrielle Energiestrategie: Praxishandbuch für Entscheider des produzierenden Gewerbes. Ed. by F. J. Matzen and R. Tesch. Wiesbaden: Springer Fachmedien Wiesbaden, 2017. isbn: 978-3- 658-07606-1. doi: 10.1007/978-3-658-07606-1_7. [RLS19] J. Rominger, M. Lösch, and H. Schmeck. “Utilization of electric vehicle charging flexibility to lower peak load by controlled charging (G2V and V2G).” In: Proceedings of the IFAC Workshop on Control of Smart Grid and Renewable Energy Systems (CSGRES). 2019. [Rom+18] J. Rominger, P. Ludwig, F. Kern, M. Lösch, and H. Schmeck. “Utilization of Local Flexibility for Charge Management of a Battery Energy Storage System Providing Frequency Containment Reserve.” In: Proceedings of the 12th International Renewable Energy Storage Conference (IRES). Elsevier, 2018. doi: 10.1016/j.egypro.2018.11.035. 263 Bibliography [Rom+19] J. Rominger, M. Lösch, S. Steuer, K. Köper, and H. Schmeck. “Analysis of the German Continuous Intraday Market and the Revenue Potential for Flexibility Options.” In: Prooceeding of the 16th International Conference on the European Energy Market (EEM). IEEE, 2019. doi: 10.1109/eem.2019. 8916566. [San09] P. Sanders. “Algorithm engineering–an attempt at a definition.” In: Efficient algorithms. Springer, 2009. doi: 10.1007/978-3-642-03456-5_22. [SB17] D. Schröder and M. Buss. Intelligente Verfahren: Identifikation und Regelung nichtlinearer Systeme. Springer Berlin Heidelberg, 2017. isbn: 9783662553275. [SB18] H. Satyavada and S. Baldi. “Monitoring energy efficiency of condensing boilers via hybrid first-principle modelling and estimation.” In: Energy 142 (2018). doi: 10.1016/j.energy.2017.09.124. [Sch17] F. Schröter. “Ziele der deutschen Wirtschafts- und Energiepolitik.” In: Indus- trielle Energiestrategie: Praxishandbuch für Entscheider des produzierenden Gewerbes. Ed. by F. J. Matzen and R. Tesch. Wiesbaden: Springer Fachme- dien Wiesbaden, 2017. isbn: 978-3-658-07606-1. doi: 10.1007/978-3- 658-07606-1_1. [Sch18] E. Schumann. “Backtesting.” In: SSRN Electronic Journal (2018). doi: 10.2139/ssrn.3374195. [SFV21] D. de São José, P. Faria, and Z. Vale. “Smart energy community: A systematic review with metanalysis.” In: Energy Strategy Reviews 36 (2021). doi: 10.1016/j.esr.2021.100678. [Shu+16] Z. Shuai, Y. Sun, Z. J. Shen, W. Tian, C. Tu, Y. Li, and X. Yin. “Microgrid stability: Classification and a review.” In: Renewable and Sustainable Energy Reviews 58 (2016). doi: 10.1016/j.rser.2015.12.201. [Sia14] P. Siano. “Demand response and smart grids—A survey.” In: Renewable and sustainable energy reviews 30 (2014). doi: 10.1016/j.rser.2013.10.022. [Šik+19] L. Šikšnys, T. B. Pedersen, M. Aftab, and B. Neupane. “Flexibility Modeling, Management, and Trading in Bottom-up Cellular Energy Systems.” In: Proceedings of the Tenth ACM International Conference on Future Energy Systems. ACM, June 2019. doi: 10.1145/3307772.3328296. [Spa15] S. Spassov. “Simulation of the German Control Reserve Market.” MA thesis. Karlsruhe Institute of Technology, 2015. 264 Bibliography [SS14] M. Sterner and I. Stadler. “Definition und Klassifizierung von Energiespe- ichern.” In: Energiespeicher - Bedarf, Technologien, Integration. Berlin, Hei- delberg: Springer Berlin Heidelberg, 2014. isbn: 978-3-642-37380-0. doi: 10.1007/978-3-642-37380-0_2. [Ste17a] O. Stein. Grundzüge der globalen Optimierung. Springer-Verlag, 2017. doi: 10.1007/978-3-662-62534-7. [Ste17b] O. Stein. Grundzüge der Nichtlinearen Optimierung. Springer-Verlag, 2017. doi: 10.1007/978-3-662-55593-4. [Str08] G. Strbac. “Demand side management: Benefits and challenges.” In: Energy Policy, Elsevier 36 (2008). doi: 10.1016/j.enpol.2008.09.030. [Stü+20] M. Stübs, T. Mueller, K. Bavendiek, M. Lösch, S. Schupp, and H. Federrath. “Provably Privacy-Preserving Distributed Data Aggregation in Smart Grids.” In: Data and Applications Security and Privacy XXXIV. Ed. by A. Singhal and J. Vaidya. Cham: Springer International Publishing, 2020. doi: 10.1007/978- 3-030-49669-2_9. [SW14] S. Spiecker and C. Weber. “The future of the european electricity system and the impact of fluctuating renewable energy - A scenario analysis.” In: Energy Policy, Elsevier 65 (2014). doi: 10.1016/j.enpol.2013.10.032. [TBH09] R. Tamme, T. Bauer, and E. Hahne. “Heat Storage Media.” In: Ullmann’s Encyclopedia of Industrial Chemistry. Wiley‐VCH Verlag, 2009. doi: 10 . 1002/14356007.a12_b30.pub2. [Uni16] United Nations Treaty Collection. Paris Agreement. 2016. [Uni17] United Nations. Kyoto Protocol – Targets for the first commitment period. 2017. [Uni20] United Nations. United Nations Framework Convention on Climate Change – Status of Ratification of the Kyoto Protocol. 2020. [Uni98] United Nations. Kyoto Protocol to the United Nations Framework Conventions on Climate Change. 1998. [UR17] D. Uwer and M. Rademacher. “Energierechtliche Rahmenbedingungen.” In: Industrielle Energiestrategie: Praxishandbuch für Entscheider des produzieren- den Gewerbes. Ed. by F. J. Matzen and R. Tesch. Wiesbaden: Springer Fachmedien Wiesbaden, 2017. isbn: 978-3-658-07606-1. doi: 10.1007/ 978-3-658-07606-1_8. [VB99] VDEW and BTU Cottbus. Repräsentative VDEW- Lastprofile. Tech. rep. 1999. 265 Bibliography [VBM18] J. Villar, R. Bessa, and M. Matos. “Flexibility products and markets: Lit- erature review.” In: Electric Power Systems Research 154 (2018). doi: 10. 1016/j.epsr.2017.09.005. [Ver05] Verband der Netzbetreiber (VDN) beim Verband der Elektrizitätswirtschaft (VDEW). Ergänzende Hinweise zur VDEW-Richtlinie ”Eigenerzeugungsanla- gen am Niederspannungsnetz, 4. Ausgabe 2001”. 2005. [Ver07] Verband der Netzbetreiber (VDN) beim Verband der Elektrizitätswirtschaft (VDEW). TransmissionCode 2007: Netz- und Systemregeln der deutschen Übertragungsnetzbetreiber. 2007. [Vie19] Viessman. Product Booklet “Gas Condensing Technology – Vitocrossal 200, CM2”. 2019. [VMd17] F. M. Vieira, P. S. Moura, and A. T. de Almeida. “Energy storage system for self-consumption of photovoltaic energy in residential zero energy buildings.” In: Renewable Energy 103 (2017). doi: 10.1016/j.renene. 2016.11.048. [Wag17] T. Wagner. “Entwicklung eines Prognosemodells für Sekundärregelleis- tungsabrufe.” MA thesis. Karlsruher Institut für Technologie, 2017. [Wan+13] P. Wang, L. Goel, X. Liu, and F. H. Choo. “Harmonizing AC and DC: A Hybrid AC/DC Future Grid Solution.” In: IEEE Power and Energy Magazine 11.3 (2013). doi: 10.1109/MPE.2013.2245587. [Wan01] S. K. Wang. Handbook of Air Conditioning and Refrigeration. Engineering handbooks. McGraw-Hill Education, 2001. isbn: 9780070681675. [Wei15] K. Weicker. Evolutionäre Algorithmen. Springer Fachmedien Wiesbaden, 2015. doi: 10.1007/978-3-658-09958-9. [Wen+20] J. Weniger, S. Maier, N. Orth, and V. Quaschning. Studie Stromspeicher- Inspektion 2020. 2020. [Wer14] R. Weron. “Electricity price forecasting: A review of the state-of-the-art with a look into the future.” In: International Journal of Forecasting 30.4 (2014). doi: 10.1016/j.ijforecast.2014.08.008. [WGH16] D. Wozabal, C. Graf, and D. Hirschmann. “The effect of intermittent re- newables on the electricity price variance.” In: OR Spectrum, Springer 38 (2016). doi: 10.1007/s00291-015-0395-x. 266 Bibliography [WJF20] Z. Wang, P. Jochem, and W. Fichtner. “A scenario-based stochastic optimiza- tion model for charging scheduling of electric vehicles under uncertainties of vehicle availability and charging demand.” In: Journal of Cleaner Pro- duction 254.119886 (2020). doi: 10.1016/j.jclepro.2019.119886. [Wol14] Wolfgang Suttor. Blockheizkraftwerke: Ein Leitfaden für den Anwender. Ed. by Fraunhofer IRB Verlag. 2014. isbn: 978-3816793038. [Woo+11] C. K. Woo, I. Horowitz, J. Moore, and A. Pacheco. “The impact of wind generation on the electricity spot-market price level and variance: The Texas experience.” In: Energy Policy, Elsevier 39 (2011). doi: 10.1016/j. enpol.2011.03.084. [Wor20] World Economic Forum. Fostering Effective Energy Transition: 2020 edition. 2020. [WS11] D. P. Williamson and D. B. Shmoys. The Design of Approximation Algorithms. Cambridge, June 2011. 518 pp. isbn: 0521195276. [Xu+18] B. Xu, A. Oudalov, A. Ulbig, G. Andersson, and D. S. Kirschen. “Modeling of Lithium-Ion Battery Degradation for Cell Life Assessment.” In: IEEE Transactions on Smart Grid 9.2 (2018). doi: 10.1109/TSG.2016.2578950. [YH19] F. W. Yu and W. T. Ho. “Analysis of chiller system performance with different component combinations.” In: Applied Thermal Engineering 154 (2019). doi: 10.1016/j.applthermaleng.2019.03.113. [Yu+14] F. W. Yu, K. T. Chan, R. K. Y. Sit, and J. Yang. “Review of Standards for Energy Performance of Chiller Systems Serving Commercial Buildings.” In: Energy Procedia 61 (2014). International Conference on Applied Energy, ICAE2014. doi: 10.1016/j.egypro.2014.12.308. [Zap15] J. V. Zapata Riveros. “Facilitating the Integration of Renewable Energy through Combined-heat-and-power Flexibility.” PhD thesis. KU Leuven, 2015. [ZL11] J. Zhang and J. Lee. “A review on prognostics and health monitoring of Li-ion battery.” In: Journal of Power Sources 196.15 (2011). doi: 10.1016/ j.jpowsour.2011.03.101. 267","libVersion":"0.3.2","langs":""}