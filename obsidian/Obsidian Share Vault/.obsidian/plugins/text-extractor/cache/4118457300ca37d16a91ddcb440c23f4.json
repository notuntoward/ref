{"path":"lit/lit_notes_OLD_PARTIAL/Cramer22priceFrcstElecMktNormFLow.pdf","text":"Page 1 of 16 Multivariate Probabilistic Forecasting of Intraday Electricity Prices using Normalizing Flows Eike Cramer a,b , Dirk Witthautc,d , Alexander Mitsos e,a,f , Manuel Dahmen a,∗ a Forschungszentrum Jülich GmbH, Institute of Energy and Climate Research, Energy Systems Engineering (IEK-10), Jülich 52428, Germany b RWTH Aachen University Aachen 52062, Germany c Forschungszentrum Jülich GmbH, Institute of Energy and Climate Research, Systems Analysis and Technology Evaluation (IEK-STE), Jülich 52428, Germany d Institute for Theoretical Physics, University of Cologne, 50937 Köln, Germany e JARA-ENERGY, Jülich 52425, Germany f RWTH Aachen University, Process Systems Engineering (AVT.SVT), Aachen 52074, Germany Electricity is traded on various markets with diﬀerent time horizons and regulations. Short-term trading becomes increasingly important due to higher penetration of renewables. In Germany, the intraday electricity price typically ﬂuctuates around the day-ahead price of the EPEX spot markets in a distinct hourly pattern. This work proposes a probabilistic modeling approach that models the intraday price diﬀerence to the day-ahead contracts. The model captures the emerging hourly pattern by considering the four 15 min intervals in each day-ahead price interval as a four-dimensional joint distribution. The resulting nontrivial, multivariate price diﬀerence distribution is learned using a normalizing ﬂow, i.e., a deep generative model that combines conditional multivariate density estimation and probabilistic regression. The normalizing ﬂow is compared to a selection of historical data, a Gaussian copula, and a Gaussian regression model. Among the diﬀerent models, the normalizing ﬂow identiﬁes the trends most accurately and has the narrowest prediction intervals. Notably, the normalizing ﬂow is the only approach that identiﬁes rare price peaks. Finally, this work discusses the inﬂuence of diﬀerent external impact factors and ﬁnds that, individually, most of these factors have negligible impact. Only the immediate history of the price diﬀerence realization and the combination of all input factors lead to notable improvements in the forecasts. Keywords: Electricity price forecasting; probabilistic forecasting; deep learning; multivariate modeling 1 Introduction The liberalization of the European electricity mar- ket into the EPEX spot markets has introduced the auction-based day-ahead market and the continu- ously traded intraday market (Mayer and Trück, 2018). The hourly day-ahead auction market is cleared on the day before delivery. Afterward, the continuous 15 min interval intraday markets aim to reduce the balance requirements by enabling short- term changes to delivery and consumption commit- ments and react to ramping of supply and demand (Ocker and Ehrhart, 2017; Kiesel and Paraschiv, 2017; Koch and Hirth, 2019; European Power Ex- change, 2021; Bublitz et al., 2019). The increas- ing penetration of renewable electricity sources with low marginal cost (Sensfuß et al., 2008) causes in- traday prices to become more volatile (Viehmann, 2017). Thus, electricity price forecasting (EPF) (Weron, 2014) for the intraday market becomes in- creasingly diﬃcult (Lago et al., 2021; Jedrzejewski et al., 2022) as the forecasts have to account for the inherent uncertainty of intermittent renewable elec- tricity supply and human interaction on the contin- uous market (Mayer and Trück, 2018; Bublitz et al., 2019). A promising approach to address the uncertainty in EPF uses probabilistic forecasting models that predict a distribution of possible realizations in- stead of a single point forecast (Zhang et al., 2003; Nowotarski and Weron, 2018). The quantitative knowledge of the uncertainty allows the market participants to develop diﬀerent strategies consid- ering the range of possible outcomes and to de- rive more eﬀective bidding strategies (Nowotarski and Weron, 2018). Established approaches for probabilistic forecasting include prediction intervals (Zhang et al., 2003; Serinaldi, 2011; Jónsson et al., 2014; Uniejewski and Weron, 2021) and density forecasts (Huurman et al., 2012; Panagiotelis and Smith, 2008; Andrade et al., 2017; Narajewski and Ziel, 2020b). Other works use ensemble forecasts (Narajewski and Ziel, 2020b) or propose combina- ∗Manuel Dahmen, Forschungszentrum Jülich GmbH, Institute of Energy and Climate Research, Energy Systems Engineering (IEK-10), Jülich 52428, Germany E-mail: m.dahmen@fz-juelich.dearXiv:2205.13826v1 [cs.LG] 27 May 2022 Page 2 of 16 tions of deterministic and probabilistic approaches (Marcjasz et al., 2020). The majority of probabilistic EPF papers utilize univariate modeling approaches (Nowotarski and Weron, 2018), i.e., the models predict single time steps in a step-by-step fashion and consider the cor- relation between time steps via the autoregressive components. Alternatively, multivariate models predict sequences in multi-step forecasting (Pana- giotelis and Smith, 2008; Ziel and Weron, 2018). For instance, Panagiotelis and Smith (2008) use a multivariate student-t distribution model for intra- day prices in Australia. In a study on deterministic forecasting models, Ziel and Weron (2018) report on the advantages of using a multivariate approach for day-ahead EPF. Most of the previously mentioned literature on probabilistic EPF only considers the day-ahead markets (Lago et al., 2021). A notable exception is presented by Andrade et al. (2017) who perform probabilistic forecasting for both day-ahead and in- traday markets. The literature on intraday EPF generally ad- dresses the intraday prices as a stand-alone predic- tion problem without considering the relation to the day-ahead prices. However, separating the intraday EPF from the day-ahead prices ignores the connec- tion between the two markets, where the intraday market mainly serves to make adjustments to the ﬁxed day-ahead contracts (Kiesel and Paraschiv, 2017; Koch and Hirth, 2019). Consequently, the intraday price follows the day-ahead price trend. Furthermore, the adjustments react to the ramp- ing of supply and demand, which leads to steadily increasing or decreasing prices in the four intraday trading intervals of each day-ahead trading inter- val (Kiesel and Paraschiv, 2017). Thus, there is a distinct hourly ﬂuctuation of the intraday prices around the day-ahead prices that averages to the day-ahead price (Kiesel and Paraschiv, 2017; Han et al., 2022). This work proposes a modeling ap- proach for intraday electricity prices based on the special relationship between the two electricity mar- kets. Assuming that the intraday EPF is performed short-term, i.e., after the day-ahead price is set, the intraday price is modeled via the diﬀerence between the two market prices. Furthermore, the hourly in- creasing or decreasing pattern of the four 15 min intervals of each day-ahead price interval are cap- tured using a multivariate joint distribution. The proposed four-dimensional distribution of price diﬀerences is modeled using normalizing ﬂows (Dinh et al., 2017; Papamakarios et al., 2021), a non-parametric, i.e., fully data-driven, distribution model. Normalizing ﬂows learn complex distribu- tions without a priori assumptions about the data and can include external impact factors for prob- abilistic regression (Winkler et al., 2019; Cramer et al., 2022b). For scenario generation of other en- ergy time series, such as renewable electricity gen- eration and electricity demand, normalizing ﬂows have already shown promising results (Dumas et al., 2022; Cramer et al., 2022a,b; Arpogaus et al., 2021). The forecasting performance of the normalizing ﬂow is evaluated in comparison to an informed selection of historical data, a Gaussian copula, and a multi- variate Gaussian regression. The remainder of this work is organized as fol- lows: Section 2 introduces the four-dimensional price diﬀerence modeling approach and highlights the advantages of multivariate modeling over the traditional univariate approach. Section 3 intro- duces the diﬀerent multivariate probabilistic models and discusses relevant external input factors. Sec- tion 4 applies the diﬀerent distribution modeling ap- proaches to learn the four-dimensional conditional distribution and discusses the impact of each ex- ternal input factor via an empirical study. Finally, Section 5 concludes this work. 2 Electricity price analysis This Section ﬁrst describes the used data sets. Sec- ond, an approach for multivariate modeling of in- traday electricity prices is proposed. Finally, the Section compares a univariate and a multivariate sampling approach for the price diﬀerence vector using assessment scores for multivariate probabilis- tic forecasting. 2.1 Data description The majority of electricity is traded on the auction- based day-ahead market, while the intraday market is primarily used to make short-term adjustments to the previously submitted bids (Han et al., 2022). The intraday contracts are negotiated between the producers and the consumers on diﬀerent time hori- zons and for diﬀerent periods. Thus, diﬀerent prices occur for the same intraday trading interval (Mayer and Trück, 2018; Ocker and Ehrhart, 2017). As an indicator of the intraday electricity prices, the market operators release indices of volume-weighted averages (European Power Exchange, 2021). This work uses the ID3 index, i.e., the index reﬂect- ing the volume-weighted average price of the last 2 2.2 Hourly price diﬀerence vectors Page 3 of 16 three hours before delivery, as it is the most com- monly used indicator (European Power Exchange, 2021; Bublitz et al., 2019). The data set consid- ered in this work is the day-ahead and ID3 price time series recorded over the years of 2018 and 2019 provided by the Fraunhofer-Institut für Solare En- ergiesysteme ISE (2022). The renewable electricity production forecasts and actual production values for the same time frame are taken from ENTSO-E Transparency Platform (2022). All renewable elec- tricity time series are recorded in 15 min intervals. Note that the electricity price data from 2020 and 2021 shows atypical behavior due to the COVID-19 pandemic (Michał Narajewski, 2020; Badesa et al., 2021) and is, therefore, not included. 2.2 Hourly price diﬀerence vectors The volume of electricity traded on the day-ahead and the intraday markets exempliﬁes the relation- ship between the two markets. In 2019, the volume of day-ahead trades was 501.6 TWh, and the intra- day trades amounted to 83.2 TWh (European Power Exchange (EPEX SPOT), 2020). These numbers explicate how traders primarily use the day-ahead market and the intraday market only to make ad- justments to the previously submitted bids. Intra- day trades address ramping of supply and demand within the day-ahead trading intervals and com- pensate for forecast errors of demand and renew- able electricity supply (Kiesel and Paraschiv, 2017; Spodniak et al., 2021). In particular, the ramping of large suppliers and consumers leads to a distinct pattern of increasing or decreasing intraday prices within each day-ahead trading interval (Kiesel and Paraschiv, 2017). For instance, a scheduled ramp up of electricity supply results in an undersupply in the ﬁrst 15 minutes and an oversupply in the last 15 minutes of the respective hour, which leads to higher prices in the ﬁrst 15 minutes and lower prices in the last 15 minutes, respectively. Thus, the hour-wise constant day-ahead contracts lead to hourly patterns in the 15 min intraday prices (Kiesel and Paraschiv, 2017; Han et al., 2022). Figure 1 shows the trends of the day-ahead and the ID3 index price on September 10 th, 2019. As in- dicated by Kiesel and Paraschiv (2017), the average ID3 price within each hour is close to the respec- tive day-ahead price. Furthermore, the ID3 price is either increasing or decreasing within the respec- tive day-ahead trading intervals. Figure 2 shows the average daily day-ahead and intraday prices in 2018 and 2019, i.e., each step represents the aver- age price interval over the two years. The proﬁles 0 6 12 18 24 Time [h] 30 40 50 60 70 80Price [EUR/MWh] Intraday ID3 Day-Ahead Fig. 1. Example of daily proﬁles of day-ahead and ID3 price trends on September 10 th, 2019. EPEX spot price data from Fraunhofer-Institut für Solare Energiesysteme ISE (2022). 0 6 12 18 24 Time [h] 30 35 40 45 50 55 60Price [EUR/MWh] Average Intraday ID3 Average Day-Ahead Fig. 2. Average daily proﬁles of day-ahead and ID3 price trends of 2018 and 2019. EPEX spot price data from Fraunhofer-Institut für Solare En- ergiesysteme ISE (2022). 3 2.3 Price diﬀerence vector analysis Page 4 of 16 support the observations made in Figure 1 and by Kiesel and Paraschiv (2017): First, the ID3 index ﬂuctuates around the day-ahead auction price. Sec- ond, Figure 2 highlights that the distinct hourly patterns of either increasing or decreasing steps ap- pear systematically. Exceptions of this pattern only appear at local minima and maxima of the day- ahead price. In summary, the relationship between the day-ahead and the intraday markets as primary and adjustment markets leads to a distinct hourly pattern of intraday price ﬂuctuations around the day-ahead prices. The proposed modeling approach for the ID3 price index aims to capture this ﬂuctuational pat- tern. Since the intraday market is used for adjust- ments to the day-ahead market, the diﬀerence be- tween the two price time series represents the char- acteristics of the intraday market. Assuming that the prediction takes place after the day-ahead auc- tion has been settled and the day-ahead prices are known, the ID3 price index can be described via the sum of the day-ahead price and the diﬀerence be- tween the two price time series. Furthermore, the hourly pattern of ﬂuctuations is captured by mod- eling the four steps of price diﬀerences in each day- ahead trading interval as a four-dimensional vector. For a given hour t the price diﬀerence vector ∆ID3 then reads: ∆ID3(t) =     ID00 3 (t) − DA(t) ID15 3 (t) − DA(t) ID30 3 (t) − DA(t) ID45 3 (t) − DA(t)     (1) The four dimensions each describe the diﬀerence be- tween intraday and day-ahead price for a 15 min in- terval. The superscripts 00, 15, 30, 45 indicate the starting minutes of the four intraday trading inter- vals. 2.3 Price diﬀerence vector analysis To showcase the advantage of the multivariate mod- eling approach, this Section ﬁrst highlights the strong correlation between the four price diﬀerence time steps in each day-ahead trading interval by showing the Pearson correlation and then compares a univariate and a multivariate sampling approach to highlight how the multivariate approach better captures the correlations between the time steps. Table 1 shows the Pearson correlation of the four dimensions in the joint distribution of price diﬀer- ences. The correlations between neighboring time steps are high and, thus, highlight the strong corre- Tab. 1. Pearson correlation within the 4D-∆ID3 distribution (see Equation (2)). Price data from Fraunhofer-Institut für Solare Energiesysteme ISE (2022). ∆ID00 3 ∆ID15 3 ∆ID30 3 ∆ID45 3 ∆ID00 3 1.00 0.77 0.41 0.09 ∆ID15 3 0.77 1.00 0.74 0.46 ∆ID30 3 0.41 0.74 1.00 0.83 ∆ID45 3 0.09 0.46 0.83 1.00 lation between the time steps within each day-ahead trading interval. To conﬁrm that the multivariate approach cap- tures the correlation shown in Table 1 better than the classical univariate approach, two diﬀerent ap- proaches of univariate and multivariate selection of historical data are compared using scoring met- rics for multivariate probabilistic forecasts. Fig- ure 2 shows a strong dependency of the average realization on the hour of the day. The multivari- ate selection is based on this observation and ran- domly selects historical realizations of the hourly price diﬀerence intervals that occurred during the same hour of the day. Similarly, the univariate se- lection approach randomly selects values that oc- curred during the same 15 min interval and com- bines the selections into four-dimensional samples. Both approaches randomly select price diﬀerences from 2018 and 2019 with the exception of July 2019, which is set aside as a test set. Unlike point forecasts, probabilistic forecasts can- not be evaluated by residual metrics such as the mean-square-error or the mean-absolute-error. In- stead, probabilistic forecasts are typically evaluated in terms of reliability and sharpness (Nowotarski and Weron, 2018). Here, reliability describes whether the realization lies within certain predic- tion intervals. Sharpness analyses the tightness of the prediction intervals, i.e., how close the lower and upper boundaries of the prediction intervals are together (Nowotarski and Weron, 2018). A good probabilistic forecast should be both reliable and sharp to avoid missing the realization and avoid large prediction intervals that carry little informa- tion. To evaluate the diﬀerent sampling approaches, this work uses the energy score (Gneiting and Raftery, 2007; Pinson and Girard, 2012) and the variogram score (Scheuerer and Hamill, 2015). The energy score (Gneiting et al., 2008; Pinson and Gi- rard, 2012) is a widely applied metric for multistep 4 Page 5 of 16 Multivariate Univariate 0 10 20 30 40 50 60Energy Score Multivariate Univariate 0 20 40 60 80 100Variogram Score Fig. 3. Box plots (Waskom, 2021) of the en- ergy score (Gneiting and Raftery, 2007; Pinson and Girard, 2012) and variogram score (Scheuerer and Hamill, 2015) distributions of historical data selected using univariate and multivariate ap- proaches. Price data from 2018 and 2019 (Fraunhofer-Institut für Solare Energiesysteme ISE, 2022) and test set in July 2019. probabilistic forecasts that assesses how close the prediction samples are to the realizations and how diverse the samples are: ES = 1 N N∑ s=1 ||x − ˆxs||2 − 1 2N 2 N∑ s=1 N∑ s′=1 ||ˆxs − ˆxs′||2 Here, x is the realized ID3 price-vector, i.e., the actual realization from the test set, ˆxs are sample vectors drawn from the predicted distributions, N is the number of samples, and || · ||2 is the 2-norm. The variogram score (Scheuerer and Hamill, 2015) aims to assess whether a multivariate forecast cor- rectly describes the correlation between the individ- ual time steps: VS = 1 N ˆT∑ t=1 ˆT∑ t′ =1 ( |xt − xt′ | γ − 1 N N∑ s=1 |ˆxs t − ˆxs t ′ |γ)2 Here, xt are the realized ID3 price time steps, ˆxt are time steps of samples from the predicted ID3 distri- bution, ˆT = 4 is the quarter hour interval, N is the number of samples, γ is the variogram order (typi- cally γ = 0.5 (Scheuerer and Hamill, 2015)), and | · | denotes the absolute value. Both energy score and variogram score are negatively oriented metrics, i.e., lower values indicate better performance (Scheuerer and Hamill, 2015; Pinson and Girard, 2012). Figure 3 shows box plots (Waskom, 2021) of the energy score and the variogram score distributions of the univariate and the multivariate selection ap- proaches applied to each day-head trading interval of the test month, respectively. The multivariate approach yields lower values for energy scores and variogram scores and, thus, indicates better agree- ment with the realizations. In particular, the vari- ogram score highlights that the univariate selection fails to represent the correct correlation between the time steps whereas the multivariate approach cap- tures the hourly pattern. In conclusion, the results in Figure 3 conﬁrm that the multivariate approach is better suited to describe the price diﬀerence dis- tribution than a univariate approach. In the fol- lowing, the term historical selection refers to the multivariate selection of historical data. 3 Multivariate probabilistic forecasting of electricity price diﬀerences This Section introduces the diﬀerent modeling ap- proaches for the conditional probability distribution of the electricity price diﬀerence vector in Equa- tion (1). Furthermore, this Section discusses rele- vant external factors included in the probabilistic regression. 3.1 Multivariate probabilistic re- gression The realizations of the hourly price diﬀerence vec- tor in Equation (1) follow a four-dimensional joint distribution: ∆ID3 ∼ p∆ID3 (∆ID3) (2) Here, p∆ID3 (∆ID3) is the probability density func- tion (PDF) of the vector-valued random variable ∆ID3. As the realizations of the price diﬀerence distribution are assumed to be inﬂuenced by known external factors y, the proposed modeling approach includes these external factors to form a conditional distribution: ∆ID3 ∼ p∆ID3|Y (∆ID3|y) (3) To model the conditional probability distribution of price diﬀerences described by Equation (3), this work uses the following four approaches: (1) con- ditional normalizing ﬂows (Winkler et al., 2019), (2) the informed selection of historical data pre- sented in Section 2 to serve as a benchmark for the other models, (3) Gaussian copulas with quantile regression (Pinson et al., 2009), and (4) multivari- ate Gaussian regression (Dillon et al., 2017). 5 3.2 External factors Page 6 of 16 Gaussian: 𝒛𝒛~𝜙𝜙 𝒛𝒛 Price difference vector: 𝑝𝑝𝚫𝚫𝑰𝑰𝑫𝑫𝟑𝟑|𝑌𝑌 𝚫𝚫𝑰𝑰𝑫𝑫𝟑𝟑|𝐲𝐲 𝚫𝚫𝑰𝑰𝑫𝑫𝟑𝟑 = 𝑇𝑇 𝐲𝐲, 𝐳𝐳 𝑇𝑇−1 𝚫𝚫𝑰𝑰𝑫𝑫𝟑𝟑 𝒚𝒚 = 𝒛𝒛 𝐲𝐲 Fig. 4. Sketch of the normalizing ﬂow modeling approach. The horizontal arrows indicate the trans- formation of Gaussian samples z ∼ φ(z) to samples of the price diﬀerence vector ∆ID3 and vice versa. The external factors y, e.g., renewable electricity forecast errors, are considered as additional inputs to the transformation T . Normalizing ﬂows are non-parametric distribu- tion models that model high-dimensional complex distributions as an invertible neural network trans- formation T , with inverse T −1, of a multivariate standard Gaussian φ(z) (Dinh et al., 2017; Papa- makarios et al., 2021). Utilizing the change of vari- ables formula, normalizing ﬂows describe the con- ditional PDF pX|Y (x|y) of a multivariate random variable X with realizations x and inputs y ex- plicitly (Papamakarios et al., 2021; Winkler et al., 2019): pX|Y (x|y) = φ (T −1(x, y)) |det JT −1(x, y)| (4) Here, JT −1 is the Jacobian of the inverse transfor- mation. Normalizing ﬂows make no assumptions about the data structure and distribution. Thus, by using suﬃciently expressive transformations, nor- malizing ﬂows can model any distribution (Papa- makarios et al., 2021). To sample from a normal- izing ﬂow, ﬁrst, samples are drawn from the mul- tivariate Gaussian ˆzi ∼ φ(z). Second, the samples and the conditional inputs are transformed using the forward form of the invertible neural network: ˆxi = T (ˆzi, ˆy = const.) ∀i = 1, 2, . . . , N Here, ˆy = const. are the external inputs at the re- spective time. Figure 4 shows a sketch of the con- ditional normalizing ﬂow modeling scheme. For the implementation of the invertible neural network, this work uses the real non-volume preserving trans- formation (RealNVP) (Dinh et al., 2017). The Gaussian copula is a well-established method to describe multivariate distributions with nontriv- ial correlations between the individual dimensions. The basic approach relies on transforming samples from a uniform distribution via an estimated in- verse cumulative distribution function (CDF). In forecasting applications, the inverse CDF is esti- mated via interpolation of quantile forecasts from quantile regression. For a detailed introduction on the combination with quantile regression, we refer the interested reader to Pinson et al. (2009). The present work uses the quantile regression in Seabold and Perktold (2010). Finally, the multivariate Gaussian regression uses neural networks to predict the mean vector µX and the covariance matrix ΣX of the multivariate Gaus- sian as a function of the conditional inputs y (Dillon et al., 2017): pX|Y (x|y) = NX|Y (x; µX (y), ΣX (y)) (5) As the covariance matrix is symmetric, the neural network only needs to predict a lower-triangular version of ΣX (y) (Dillon et al., 2017). The pre- dicted mean and covariance can then be used to sample from the Gaussian distribution parameter- ized by the predicted values. In all models, the electricity price diﬀerence vec- tor ∆ID3 takes the role of the random variable X, and the external factors are the conditional inputs Y . For every realization of the external factors y, the models allow sampling from the electricity price diﬀerence vector distribution ˆ∆ID3 ∼ p∆ID3 as de- scribed for the normalizing ﬂow above. 3.2 External factors The realizations of both the day-ahead and the intraday prices are inﬂuenced by external factors. These external factors include any information that informs about the realizations of the electricity price diﬀerences. Examples of external factors for day-ahead and intraday prices include the electric- ity demand, supply from renewable electricity, and the time of the delivery (Wolﬀ and Feuerriegel, 2017; Naumzik and Feuerriegel, 2021). However, the proposed model considers the diﬀerence be- tween the two market prices, which alleviates the impact of some external factors and ampliﬁes the impact of others. In particular, the impact of the forecasted total electricity demand and the fore- casted total renewable electricity supply is already considered in the day-ahead market and has lit- tle inﬂuence on the price diﬀerences (Kiesel and Paraschiv, 2017; Spodniak et al., 2021; Han et al., 2022). The intraday markets are used to adjust the previously submitted bids on the day-ahead market, 6 3.2 External factors Page 7 of 16 which are based on forecasts. Thus, the diﬀerences are mostly impacted by the forecasting errors for de- mand and renewables (Kiesel and Paraschiv, 2017; Han et al., 2022). The renewable forecast errors are computed as the diﬀerence between the realization and the forecast: ∆P RE t = P RE t − ˆP RE t RE ∈ {Solar, Wind} Here, P RE t is the actual generation, ˆP RE t is the day- ahead generation forecast. Another important external factor for the ﬂuctu- ation of the intraday prices is the ramping of solar electricity generation in the morning and at night, which leads to large changes in solar power sup- ply within single day-ahead trading intervals (Koch and Hirth, 2019). Wolﬀ and Feuerriegel (2017) and Ocker and Ehrhart (2017) ﬁnd that the relation of conventional and renewable electricity impacts the realizations of both day-ahead and intraday prices. To investigate whether the relation also impacts the price diﬀerence, the quotient of conventional and re- newable power in the grid is included as an external factor: P rel t = P conventional t P renewable t Figure 2 suggests that the increments of the day- ahead price, i.e., the diﬀerence between one hour and the next, have a substantial impact on the di- rection (increasing or decreasing) and the intensity of the hourly ﬂuctuation. For increasing or decreas- ing day-ahead prices, the hourly ﬂuctuation shows increasing or decreasing patterns, respectively (Han et al., 2022). Furthermore, larger increments ap- pear to induce more signiﬁcant ﬂuctuations and vice versa. For local minimum and maximum peak hours in the day-ahead price, Figure 2 shows no distinct trend of the ﬂuctuation. Figure 2 also indicates that the realizations of the price diﬀerences depend on the time of the day. Thus, the proposed model includes this time depen- dency by including a trigonometric encoding of the hour of the day (Moon et al., 2019). Neither the day of the week nor the month of the year signiﬁcantly impacts the price diﬀerences. The supplementary material contains further details of the impact of the time of the day, day of the week, and month of the year. Narajewski and Ziel (2020a) and Han et al. (2022) state that the day-ahead markets in Germany are weak-form eﬃcient, i.e., the recent history of day- ahead prices does not inform on future realizations, whereas for intraday prices, there is an advantage 0 12 24 36 48 Lag [h] 0.0 0.2 0.4 0.6 0.8 1.0ACF [-] Day-ahead price ID3-Index price Price difference ID3 Fig. 5. Pearson autocorrelation (ACF) of day- ahead price (“Day-ahead price”), ID3 index (“ID3- Index price”), and diﬀerence between the two time series (“Price diﬀerence ∆ID3”) with time lag of 0 to 48 h. Price data in 2018 and 2019 (Fraunhofer- Institut für Solare Energiesysteme ISE, 2022). from including the most recent value in the predic- tion. To evaluate the impact of prior realizations on the price diﬀerence, Figure 5 shows the Pearson autocorrelation function (ACF) of the day-ahead price, the intraday price, and the diﬀerence between the two time series. The ACF of the price diﬀerence drops quickly and continues to ﬂuctuate around low values that are signiﬁcantly lower compared to the day-ahead ACF and the intraday ACF. However, the ﬁrst hour still shows high ACF values and is, thus, included in the external inputs. Table 2 lists the Pearson correlation of all consid- ered external factors with the 4 dimensions of the price diﬀerence vector in Equation (1). The Pear- son correlation indicates the highest dependency on the immediate history of the price diﬀerence vec- tor. Most other considered factors show moderate to low correlation factors. However, the low cor- relation does not indicate that there is no value in including those external factors in the probabilis- tic forecast as Pearson correlations describe only the linear correlations of the mean. In the numeri- cal experiments section of this work, we perform an empirical evaluation of the inﬂuence of the diﬀerent external factors. Note that some of the considered external factors are not known until the realization of the intraday price. For instance, the exact forecast errors are unknown at the forecasting time. Hence, this work considers these factors as a feasibility study for the multivariate modeling approach and postpones the discussion about the timing of the probabilistic fore- cast. 7 3.2 External factors Page 8 of 16 Tab. 2. Pearson correlation between the price diﬀerence dimensions ∆ID3 and conditional input factors. Q00, . . . , Q45 indicate the for 15 min intervals in each day-ahead trading interval. Price data from Fraunhofer-Institut für Solare Energiesysteme ISE (2022) and renewables data from ENTSO-E (ENTSO- E Transparency Platform, 2022). External factors ∆ID00 3 ∆ID15 3 ∆ID30 3 ∆ID45 3 Day Ahead Auction Price -0.03 -0.05 -0.05 -0.04 Day Ahead Increments -1 -0.44 -0.16 0.14 0.31 Day Ahead Increments +1 0.38 0.10 -0.22 -0.42 cos hour encoding 0.11 0.03 -0.04 -0.10 sin hour encoding 0.01 0.00 0.02 -0.01 ∆ID00 3 (t − 1h) 0.72 0.55 0.28 0.05 ∆ID15 3 (t − 1h) 0.70 0.69 0.51 0.31 ∆ID30 3 (t − 1h) 0.49 0.67 0.69 0.56 ∆ID45 3 (t − 1h) 0.24 0.53 0.70 0.67 Solar Forecast Error Q00 -0.20 -0.23 -0.21 -0.15 Solar Forecast Error Q15 -0.20 -0.24 -0.23 -0.17 Solar Forecast Error Q30 -0.20 -0.24 -0.24 -0.18 Solar Forecast Error Q45 -0.20 -0.24 -0.24 -0.19 Wind Forecast Error Q00 -0.28 -0.36 -0.38 -0.32 Wind Forecast Error Q15 -0.28 -0.36 -0.39 -0.33 Wind Forecast Error Q30 -0.28 -0.37 -0.39 -0.33 Wind Forecast Error Q45 -0.28 -0.36 -0.39 -0.34 Absolute solar Q00 -0.11 -0.06 -0.01 0.06 Absolute solar Q15 -0.09 -0.06 -0.02 0.04 Absolute solar Q30 -0.07 -0.05 -0.03 0.02 Absolute solar Q45 -0.05 -0.05 -0.04 0.00 Relative fossil Q00 0.05 0.04 0.04 0.04 Relative fossil Q15 0.04 0.03 0.05 0.05 Relative fossil Q30 0.03 0.03 0.05 0.06 Relative fossil Q45 0.03 0.03 0.05 0.06 8 Page 9 of 16 4 Numerical experiments This section investigates whether the diﬀerent mod- eling approaches can describe the four-dimensional price diﬀerence distribution. Each model is trained on the data set from 2018 and 2019 (Fraunhofer- Institut für Solare Energiesysteme ISE, 2022), where the month of July 2019 is again set aside as a test set. The 24 h × 31-day test set results in 744 test intervals. Note that July 1st, 2019, was a Monday. To preprocess the data and avoid com- plications from the heavy-tailed distributions (Han et al., 2022), the data is transformed using the prob- ability integral transform discussed in Uniejewski et al. (2017), which renders the data in a Gaus- sian form. The normalizing ﬂow and the Gaussian regression are trained via log-likelihood maximiza- tion over 500 epochs with a batch size of 128 using the python-based machine-learning library Tensor- Flow version 2.8.0 (Abadi and Agarwal, 2015). The Gaussian copula uses the quantile regression in the statsmodels python library (Seabold and Perktold, 2010). For details on the implementation of the models, see the supplementary material. One hun- dred samples are drawn for each hour in the test set and used to compute the diﬀerent metrics outlined in Section 2. 4.1 Prediction intervals This Section analyzes the forecasted distributions by investigating the 50% and 90% prediction in- tervals. The intervals are estimated by computing the respective quantiles for each time step and then adding the day-ahead price of the given hour to re- verse the diﬀerence in Equation (1). Figure 6 shows the predicted mean, the 50% and 90% prediction intervals, and the intraday price re- alization for the ﬁrst four days in the test month of July 2019. The Figure shows the results esti- mated from probabilistic forecasts from the nor- malizing ﬂow (top), the selection of historical data (second from top), the Gaussian copula (third from top), and the Gaussian regression (bottom). For the presented test days, the normalizing ﬂow en- closes the realization for most of the time steps, and the forecast mean appears to identify the re- alized trends well, with very few exceptions. The selection of historical data reﬂects the trends mod- erately well and portrays wider prediction intervals compared to the normalizing ﬂow. The Gaussian copula and Gaussian regression often fail to identify the correct trends and do not ﬁt the realizations as tightly as the normalizing ﬂow. In particular, Tab. 3. Percentage of realizations within 50% and 90% prediction intervals (PI). PI 50% PI 90% Normalizing Flow 59.4% 93.5% Historical 62.1% 95.5% Copula 61.6% 96.0% Gaussian 54.9% 90.2% the Gaussian copula results in extensive prediction intervals that show vast peaks for the 90% predic- tion interval. Compared to the other approaches, the normalizing ﬂow performs signiﬁcantly better in identifying the trends and keeping narrow predic- tion intervals. Overall, the normalizing ﬂow yields the sharpest prediction intervals while the Gaussian copula shows low sharpness. On the ﬁrst day in the days shown in Figure 6, there is a signiﬁcant peak in the ID3 price realiza- tion. This type of extreme event may occur due to unforeseen incidences in the markets, such as un- planned changes in the operation of large consumers or suppliers. Notably, the normalizing ﬂow is the only approach that captures this peak. The sup- plementary material shows the prediction intervals for other peak days in the test month that conﬁrm the normalizing ﬂows’ ability to capture the price peaks. Table 3 shows the percentage of time steps in the test set that lie within the 50% and 90% prediction interval, respectively. All approaches show conser- vative results for both prediction intervals, i.e., the actual percentage of realizations within the predic- tion intervals is higher than the selected probability. Thus, all approaches yield reliable prediction inter- vals. In summary, the normalizing ﬂow shows the best results with sharp prediction interval presented in Figure 6 and reliable results in Table 3. The se- lection of historical data shows surprisingly good results but shows poor sharpness in the prediction intervals due to the missing conditional input infor- mation. The Gaussian copula results in prediction intervals with poor sharpness and extreme peaks that are likely a result of a poor quantile regres- sion of the tails of the price diﬀerence distribution. By overestimating the tails in the inverse CDF, the Gaussian copula samples a higher share of outliers than the actual distribution. The high reliability in- dicated in Table 3 comes at the cost of poor sharp- ness. Finally, the Gaussian regression has to pre- dict a total of 14 values for the mean vector and 9 4.1 Prediction intervals Page 10 of 16 07-01 00 07-01 12 07-02 00 07-02 12 07-03 00 07-03 12 07-04 00 07-04 12 07-05 00 0 20 40 60 80 100 120Intraday ID3 [EUR/MWh] Normalizing Flow mean realization 90% 50% 07-01 00 07-01 12 07-02 00 07-02 12 07-03 00 07-03 12 07-04 00 07-04 12 07-05 00 0 20 40 60 80 100 120Intraday ID3 [EUR/MWh] Historical mean realization 90% 50% 07-01 00 07-01 12 07-02 00 07-02 12 07-03 00 07-03 12 07-04 00 07-04 12 07-05 00 0 20 40 60 80 100 120Intraday ID3 [EUR/MWh] Copula mean realization 90% 50% 07-01 00 07-01 12 07-02 00 07-02 12 07-03 00 07-03 12 07-04 00 07-04 12 07-05 00 0 20 40 60 80 100 120Intraday ID3 [EUR/MWh] Gaussian mean realization 90% 50% Fig. 6. Predicted mean, prediction intervals of 50% and 90%, and realization for the ﬁrst ﬁve days of July 2019 estimated from probabilistic forecasts form the normalizing ﬂow (top) the informed selection of historical data (second from top), the Gaussian copula (third from top), and the Gaussian regres- sion (bottom). Note the truncated y-axis for the Gaussian copula. Training data from 2018 and 2019 (Fraunhofer-Institut für Solare Energiesysteme ISE, 2022). Results generated with all conditional inputs shown in Table 2. 10 4.2 Energy and variogram score Page 11 of 16 a lower-triangular covariance matrix (Dillon et al., 2017). Likely, this number is too high to achieve good ﬁts in the regression model and, instead, the training regresses to constant outputs. 4.2 Energy and variogram score Figure 7 shows the energy score for each model and each hour of the test month (left), as well as box plots of the overall energy score distributions (right). The Gaussian regression performs only marginally better than the historical selection. As shown in Figure 6, the Gaussian regression strug- gles to identify the correct trends, and the histor- ical selection shows wider prediction intervals, i.e., both approaches show weaknesses that lead to an increase in the energy score in diﬀerent ways. The Gaussian copula shows signiﬁcantly worse results than the other forecasting models. As already ob- served in Figure 6, the Gaussian copula results in extensive prediction intervals and fails to identify the intraday price patterns. Thus, the large energy scores in Figure 7 conﬁrm the qualitative observa- tions from Figure 6. Finally, the normalizing ﬂow shows the lowest energy score, i.e., it provides the most reliable predictions while maintaining sharp prediction intervals. The excellent performance of the normalizing ﬂows stems from a correct identiﬁ- cation of the trends and maintaining narrow predic- tion intervals. Furthermore, the normalizing ﬂow generates a diverse set of samples. In general, the energy scores over time in the case of all methods show rare incidences of extreme price peaks, e.g., on the ﬁrst day and at the beginning of the last quarter of the month. Notably, however, the normalizing ﬂow shows the best approximation of these extreme events, e.g., for the price peak on the ﬁrst day of the test month shown in Figure 6 and the other peak days shown in the supplementary material. Next, the variogram score is used to compare whether the diﬀerent models can identify the cor- relation between the dimensions. Figure 8 shows the variogram score for each model and each hour of the test month (left), as well as box plots of the overall distributions (right). Note that the y-axis of the right of Figure 8 is truncated to allow for bet- ter visualization of the distributions. Similar to the energy score results, the normalizing ﬂow shows the best results while the Gaussian regression performs approximately equal to the historical selection. The Gaussian copula appears to miss large parts of the correlation and shows the worst variogram scores. The ﬂexibility of the normalizing ﬂow allowed the model to learn the correlation between the four time steps in the price diﬀerence vector better than any other considered approach. In conclusion, the ﬂexibility of the normalizing ﬂow can describe the non-trivial distribution of the considered price diﬀerences, as highlighted by both the energy scores and the variogram scores for the test month. Furthermore, the combination with ex- ternal impact factors leads to a signiﬁcant improve- ment over the historical selection. Meanwhile, both Gaussian copula and Gaussian regression result in erroneous trends and inﬂated prediction intervals. 4.3 Signiﬁcance of external factors The Pearson correlations in Table 2 indicate a mod- erate dependency of the price diﬀerences on many of the considered external factors but a strong cor- relation with the prior realization of the price dif- ference vector. Up to this point, however, it re- mains unclear whether these correlations translate into better forecasting performance. Figure 9 shows box plots of the energy score and variogram score distributions over the test month for samples gener- ated using the normalizing ﬂow with diﬀerent sets of external factors in comparison to the selection of historical data. Note the truncated y-axis to high- light the majority parts of the distributions. The energy score results highlight that most of the individual external factors do not improve the probabilistic forecasts compared to the selection of historical data. The encoding of time (“Time”), the renewables forecast errors (“Forecast Errors”), the absolute solar power generation (“Solar Rampling”), and the relation of fossil electricity to renewables (“Relative Fossil”) all show approximately the same energy score as the historical data. Meanwhile, the day-ahead price increments (“Increments”) show a moderate improvement, and the previous realiza- tion of the price diﬀerence vector (“Previous Inter- val”) results in lower energy scores. Notably, the combination of all external factors (“All”) achieves the lowest energy scores. The variogram score conﬁrms the observations from the energy score. Except for the increments (“Increments”) and the previous realizations (“Pre- vious Interval”), all inputs lead to approximately equal or slightly worse results compared to the in- formed historical selection. Again, the previous re- alizations show the strongest impact, and the com- bination of all external factors leads to the lowest variogram score overall. In conclusion, the previous realization of the price diﬀerence vector has by far the strongest impact on 11 4.3 Signiﬁcance of external factors Page 12 of 16 0 100ESNormalizing Flow 0 100ESHistorical 0 100ESCopula 2019-07-01 2019-07-04 2019-07-07 2019-07-10 2019-07-13 2019-07-16 2019-07-19 2019-07-22 2019-07-25 2019-07-28 2019-07-31 Days 0 100ESGaussian Normalizing Flow Historical Copula Gaussian 0 20 40 60 80 100Energy Score Fig. 7. Energy score (Gneiting et al., 2008; Pinson and Girard, 2012) of the normalizing ﬂow (“Nor- malizing Flow”), the selection of historical data (“Historical”), the Gaussian copula (“Copula”), and the Gaussian regression (“Gaussian”) for each hour in test month of July 2019 (left) and box plot (Waskom, 2021) of the overall distribution for each model (right). Training data from 2018 and 2019 (Fraunhofer- Institut für Solare Energiesysteme ISE, 2022). Conditional inputs as shown in Table 2. 0 200VSNormalizing Flow 0 200VSHistorical 0 200VSCopula 2019-07-01 2019-07-04 2019-07-07 2019-07-10 2019-07-13 2019-07-16 2019-07-19 2019-07-22 2019-07-25 2019-07-28 2019-07-31 Days 0 200VSGaussian Normalizing Flow Historical Copula Gaussian 0 20 40 60 80 100Variogram Score Fig. 8. Variogram score (Scheuerer and Hamill, 2015) of the normalizing ﬂow (“Normalizing Flow”), the selection of historical data (“Historical”), the Gaussian copula (“Copula”), and the Gaussian regression (“Gaussian”) for each hour in test month of July 2019 (left) and box plot (Waskom, 2021) of the overall distribution for each model (right). Training data from 2018 and 2019 (Fraunhofer-Institut für Solare Energiesysteme ISE, 2022). Conditional inputs as shown in Table 2. 12 Page 13 of 16HistoricalIncrementsTimeForecast ErrorsSolar RampingRelative FossilPrevious IntervalAll0 10 20 30 40 50Energy ScoreHistoricalIncrementsTimeForecast ErrorsSolar RampingRelative FossilPrevious IntervalAll0 10 20 30 40 50Variogram Score Fig. 9. Energy score (Gneiting et al., 2008; Pinson and Girard, 2012) and variogram score (Scheuerer and Hamill, 2015) of normalizing ﬂow predictions using diﬀerent sets of external factors. Note the truncated y-axis. Training data from 2018 and 2019 (Fraunhofer-Institut für Solare Energiesysteme ISE, 2022) and July 2019 as test set. the probabilistic forecasts, as already indicated by the high Pearson correlation in Table 2. However, the normalizing ﬂow can still extract additional in- formation from the remaining external factors while also learning to ignore irrelevant information. Narajewski and Ziel (2020a) and Han et al. (2022) argue that the intraday markets are not eﬃcient in the sense of the “eﬃcient-market hypothesis” as there are are strong relations between the current and previous realizations. The improved results of the normalizing ﬂow from using previous realiza- tions as input factors conﬁrm the observation of high dependency on previous realizations. The analysis in this section shows promising re- sults that indicate valuable density forecasts of the price diﬀerence vector by the normalizing ﬂow. Both the Gaussian copula and the Gaussian regres- sion show weaknesses and fail to improve on the re- sults of the informed historical selection suggesting they are not suitable prediction methods. Figure 9 shows that only the knowledge of the realizations in the previous hour poses an advantage over using the informed selection of historical data. Hence, lead times of multiple hours rescind the advantage of the normalizing ﬂow over the informed histori- cal selection. In conclusion, the normalizing ﬂow yields high-quality density forecasts for short lead times. If less information is available, the selection of historical price diﬀerences based on the hour of the day appears to be suﬃcient. 5 Conclusion This work proposes a modeling approach for proba- bilistic forecasting of intraday electricity prices in the German EPEX spot market. The novel ap- proach captures the strong relation between day- ahead and intraday prices by assuming ﬁxed day- ahead prices and predicting the diﬀerence between the two price time series. Furthermore, the model captures the hourly patterns of ﬂuctuation of the intraday prices around the day-ahead prices by con- sidering each day-ahead trading interval as a four- dimensional joint distribution. The non-parametric distribution model called normalizing ﬂow is used to learn the proposed four- dimensional distribution of price diﬀerences and in- cludes external input factors to form a conditional density forecast. The proposed model yields a com- plete end-to-end approach for multivariate density estimation and probabilistic regression that does not require any a priori assumptions about the data. Compared to a selection of historical data and other multivariate probabilistic models, namely the Gaussian copula and multivariate Gaussian regres- sion, the normalizing ﬂow returns both the most reliable and sharpest predictions. In summary, the normalizing ﬂow best identiﬁes the trends of the in- traday prices and shows the narrowest prediction intervals. The empirical comparison of diﬀerent impact fac- tors highlights that the combination of multiple input factors leads to the lowest energy scores. Among the diﬀerent impact factors, the prior re- alizations of the price diﬀerence vector result in the largest improvement, while other subsets of impact factors perform approximately equal to the histor- ical selection. The good performance of using the previous price diﬀerences conﬁrms the strong de- pendency found in the statistical analysis by Han et al. (2022). In conclusion, the analysis shows promising re- sults that indicate valuable price diﬀerence density forecasts. Future studies on forecasting the diﬀer- ence between intraday and day-ahead prices should focus on identifying signiﬁcant impact factors con- sidering their attainability at diﬀerent points in time. For instance, the short-term 2 1 4 h renewable forecasts could be valuable substitutes for the cur- rently used exact realizations to estimate the fore- cast errors. 13 BIBLIOGRAPHY Page 14 of 16 Acknowledgements We gratefully acknowledge Johannes Kruse (FZ- Jülich IEK-STE), Julius Trebbien (FZ-Jülich IEK- STE), and Leonard Rydin Gorjão (Department of Computer Science, OsloMet) for the discussion about the concepts and the importance of diﬀer- ent impact factors. This work was performed as part of the Helmholtz School for Data Science in Life, Earth and Energy (HDS-LEE) and received funding from the Helmholtz Association of German Research Centres. Nomenclature Symbol Description N Number of samples P conventional t Conventional electric- ity in the grid P renewable t Renewable electricity in the grid P rel t Relation of conven- tional and renewable electricity in the grid P RE t Renewable elec- tricity from RE ∈ {Solar, Wind} ˆP RE t Forecast of renewable electricity ∆P RE t Forecast error of re- newable electricity T Invertible neural net- work JT −1 Jacobian of T −1 ˆT Day-ahead trading in- terval ˆT = 4 xt Value at time step t ˆxt Sample at time step t x, y Data vector ˆz Gaussian sample ˆx, ˆy Sample of data vector y External input factors ID3 Intraday price ID00 3 , ID15 3 , ID30 3 , ID45 3 Quater hour steps of intraday prices DA Day-ahead price ∆ID3 4D vector of price dif- ference φ Multivariate standard Gaussian Symbol Description NX|Y (x; µX (y), ΣX (y)) Conditional Gaussian distribution pX|Y (x|y) Conditional PDF of X given Y p∆ID3|Y (∆ID3|y) Conditional PDF of ∆ID3 given Y NX|Y Gaussian distribu- tion with moments predicted via inputs Y µX (y) Neural network mean value predictor ΣX (y) Neural network covari- ance matrix value pre- dictor γ Variogram order (typi- cally γ = 0.5) Bibliography Abadi, M. and Agarwal, A. (2015). TensorFlow: Large-scale machine learning on heterogeneous systems. https://www.tensorflow.org/. Ac- cessed on 08-08-2021. Andrade, J. R., Filipe, J., Reis, M., and Bessa, R. J. (2017). Probabilistic price forecasting for day- ahead and intraday markets: Beyond the statis- tical model. Sustainability, 9(11):1990. Arpogaus, M., Voß, M., Sick, B., Nigge-Uricher, M., and Dürr, O. (2021). Probabilistic short-term low-voltage load forecasting using bernstein- polynomial normalizing ﬂows. In ICML 2021 Workshop on Tackling Climate Change with Ma- chine Learning, virtual. Badesa, L., Strbac, G., Magill, M., and Stojkovska, B. (2021). Ancillary services in Great Britain dur- ing the COVID-19 lockdown: A glimpse of the carbon-free future. Applied Energy, 285:116500. Bublitz, A., Keles, D., Zimmermann, F., Fraunholz, C., and Fichtner, W. (2019). A survey on electric- ity market design: Insights from theory and real- world implementations of capacity remuneration mechanisms. Energy Economics, 80:1059–1078. Cramer, E., Mitsos, A., Tempone, R., and Dah- men, M. (2022a). Principal component density estimation for scenario generation using normal- izing ﬂows. Data-Centric Engineering, 3:e7. Cramer, E., Paeleke, L., Mitsos, A., and Dahmen, M. (2022b). Normalizing ﬂow-based day-ahead 14 BIBLIOGRAPHY Page 15 of 16 wind power scenario generation for proﬁtable and reliable delivery commitments by wind farm op- erators. arXiv preprint arXiv:2204.02242. Dillon, J. V., Langmore, I., Tran, D., Brevdo, E., Vasudevan, S., Moore, D., Patton, B., Alemi, A., Hoﬀman, M., and Saurous, R. A. (2017). Tensorﬂow distributions. arXiv preprint arXiv:1711.10604. Dinh, L., Sohl-Dickstein, J., and Bengio, S. (2017). Density estimation using Real NVP. In 5th In- ternational Conference on Learning Representa- tions, ICLR 2017, Toulon, France, April 24- 26, 2017, Conference Track Proceedings. Open- Review.net. Dumas, J., Wehenkel, A., Lanaspeze, D., Cornélusse, B., and Sutera, A. (2022). A deep generative model for probabilistic energy fore- casting in power systems: Normalizing ﬂows. Ap- plied Energy, 305:117871. ENTSO-E Transparency Platform (2022). ENTSO-E Transparency Platform. https: //transparency.entsoe.eu/. Accessed: 2022- 03-01. European Power Exchange (2021). EPEX SPOT documentation. http://www.epexspot.com/en/ extras/download-center/documentation. Ac- cessed: 2021-05-30. European Power Exchange (EPEX SPOT) (2020). Annual report 2019. https://www.epexspot. com/sites/default/files/download_center_ files/Epex-spot-2019_200703_Planche.pdf. Accessed: 2021-05-30. Fraunhofer-Institut für Solare Energiesysteme ISE (2022). Energy Charts. https://www. energy-charts.info. Accessed: 2022-03-01. Gneiting, T. and Raftery, A. E. (2007). Strictly proper scoring rules, prediction, and estimation. Journal of the American Statistical Association, 102(477):359–378. Gneiting, T., Stanberry, L. I., Grimit, E. P., Held, L., and Johnson, N. A. (2008). Assessing proba- bilistic forecasts of multivariate quantities, with an application to ensemble predictions of surface winds. Test, 17(2):211–235. Han, C., Hilger, H., Mix, E., Böttcher, P. C., Rey- ers, M., Beck, C., Witthaut, D., and Gorjão, L. R. (2022). Complexity and persistence of price time series of the european electricity spot mar- ket. PRX Energy, 1(1):013002. Huurman, C., Ravazzolo, F., and Zhou, C. (2012). The power of weather. Computational Statistics & Data Analysis, 56(11):3793–3807. Jedrzejewski, A., Lago, J., Marcjasz, G., and Weron, R. (2022). Electricity price forecasting: The dawn of machine learning. IEEE Power and Energy Magazine, 20(3):24–31. Jónsson, T., Pinson, P., Madsen, H., and Nielsen, H. A. (2014). Predictive densities for day-ahead electricity prices using time-adaptive quantile re- gression. Energies, 7(9):5523–5547. Kiesel, R. and Paraschiv, F. (2017). Econometric analysis of 15-minute intraday electricity prices. Energy Economics, 64:77–90. Koch, C. and Hirth, L. (2019). Short-term electric- ity trading for system balancing: An empirical analysis of the role of intraday trading in balanc- ing germany’s electricity system. Renewable and Sustainable Energy Reviews, 113:109275. Lago, J., Marcjasz, G., De Schutter, B., and Weron, R. (2021). Forecasting day-ahead elec- tricity prices: A review of state-of-the-art algo- rithms, best practices and an open-access bench- mark. Applied Energy, 293:116983. Marcjasz, G., Uniejewski, B., and Weron, R. (2020). Probabilistic electricity price forecasting with narx networks: Combine point or probabilistic forecasts? International Journal of Forecasting, 36(2):466–479. Mayer, K. and Trück, S. (2018). Electricity mar- kets around the world. Journal of Commodity Markets, 9:77–100. Michał Narajewski, F. Z. (2020). Changes in elec- tricity demand pattern in europe due to COVID- 19 shutdowns. IAEE Energy Forum, pages 44–47. Moon, J., Park, S., Rho, S., and Hwang, E. (2019). A comparative analysis of arti- ﬁcial neural network architectures for build- ing energy consumption forecasting. Interna- tional Journal of Distributed Sensor Networks, 15(9):1550147719877616. Narajewski, M. and Ziel, F. (2020a). Economet- ric modelling and forecasting of intraday elec- tricity prices. Journal of Commodity Markets, 19:100107. 15 BIBLIOGRAPHY Page 16 of 16 Narajewski, M. and Ziel, F. (2020b). Ensemble fore- casting for intraday electricity prices: Simulating trajectories. Applied Energy, 279:115801. Naumzik, C. and Feuerriegel, S. (2021). Forecasting electricity prices with machine learning: Predic- tor sensitivity. International Journal of Energy Sector Management, 15(1):157–172. Nowotarski, J. and Weron, R. (2018). Recent ad- vances in electricity price forecasting: A review of probabilistic forecasting. Renewable and Sus- tainable Energy Reviews, 81:1548–1568. Ocker, F. and Ehrhart, K.-M. (2017). The “German Paradox” in the balancing power markets. Re- newable and Sustainable Energy Reviews, 67:892– 898. Panagiotelis, A. and Smith, M. (2008). Bayesian density forecasting of intraday electricity prices using multivariate skew t distributions. Interna- tional Journal of Forecasting, 24(4):710–727. Papamakarios, G., Nalisnick, E., Rezende, D. J., Mohamed, S., and Lakshminarayanan, B. (2021). Normalizing ﬂows for probabilistic modeling and inference. Journal of Machine Learning Research, 22(57):1–64. Pinson, P. and Girard, R. (2012). Evaluating the quality of scenarios of short-term wind power gen- eration. Applied Energy, 96:12–20. Pinson, P., Madsen, H., Nielsen, H. A., Pa- paefthymiou, G., and Klöckl, B. (2009). From probabilistic forecasts to statistical scenarios of short-term wind power production. Wind En- ergy: An International Journal for Progress and Applications in Wind Power Conversion Technol- ogy, 12(1):51–62. Scheuerer, M. and Hamill, T. M. (2015). Variogram- based proper scoring rules for probabilistic fore- casts of multivariate quantities. Monthly Weather Review, 143(4):1321–1334. Seabold, S. and Perktold, J. (2010). Statsmod- els: Econometric and statistical modeling with python. In Proceedings of the 9th Python in Sci- ence Conference, pages 92–96, Austin, TX. Sensfuß, F., Ragwitz, M., and Genoese, M. (2008). The merit-order eﬀect: A detailed analysis of the price eﬀect of renewable electricity generation on spot market prices in germany. Energy policy, 36(8):3086–3094. Serinaldi, F. (2011). Distributional modeling and short-term forecasting of electricity prices by gen- eralized additive models for location, scale and shape. Energy Economics, 33(6):1216–1226. Spodniak, P., Ollikka, K., and Honkapuro, S. (2021). The impact of wind power and electricity demand on the relevance of diﬀerent short-term electricity markets: The nordic case. Applied En- ergy, 283:116063. Uniejewski, B. and Weron, R. (2021). Regular- ized quantile regression averaging for probabilis- tic electricity price forecasting. Energy Eco- nomics, 95:105121. Uniejewski, B., Weron, R., and Ziel, F. (2017). Variance stabilizing transformations for electric- ity spot price forecasting. IEEE Transactions on Power Systems, 33(2):2219–2229. Viehmann, J. (2017). State of the German short-term power market. Zeitschrift für En- ergiewirtschaft, 41(2):87–103. Waskom, M. L. (2021). Seaborn: statistical data visualization. Journal of Open Source Software, 6(60):3021. Weron, R. (2014). Electricity price forecasting: A review of the state-of-the-art with a look into the future. International Journal of Forecasting, 30(4):1030–1081. Winkler, C., Worrall, D., Hoogeboom, E., and Welling, M. (2019). Learning likelihoods with conditional normalizing ﬂows. arXiv preprint arXiv:1912.00042. Wolﬀ, G. and Feuerriegel, S. (2017). Short-term dynamics of day-ahead and intraday electricity prices. International Journal of Energy Sector Management, 11:557–573. Zhang, L., Luh, P. B., and Kasiviswanathan, K. (2003). Energy clearing price prediction and con- ﬁdence interval estimation with cascaded neural networks. IEEE Transactions on Power Systems, 18(1):99–105. Ziel, F. and Weron, R. (2018). Day-ahead elec- tricity price forecasting with high-dimensional structures: Univariate vs. multivariate modeling frameworks. Energy Economics, 70:396–420. 16 Page 1 of 3 Multivariate Probabilistic Forecasting of Intraday Electricity Prices using Normalizing Flows Eike Cramer a,b , Dirk Witthautc,d , Alexander Mitsos e,a,f , Manuel Dahmen a,∗ a Forschungszentrum Jülich GmbH, Institute of Energy and Climate Research, Energy Systems Engineering (IEK-10), Jülich 52425, Germany b RWTH Aachen University Aachen 52062, Germany c Forschungszentrum Jülich GmbH, Institute of Energy and Climate Research, Systems Analysis and Technology Evaluation (IEK-STE), Jülich 52428, Germany d Institute for Theoretical Physics, University of Cologne, 50937 Köln, Germany e JARA-ENERGY, Jülich 52425, Germany f RWTH Aachen University, Process Systems Engineering (AVT.SVT), Aachen 52074, Germany 1 Time dependency Figures 1, 2, and 3 show the dependency of the price diﬀerence vector on the hour of the day, the day of the week, and the month of the year, respectively. Notably, only the hour of the day appears to have a signiﬁcant impact on the realizations. This also indicates a similar behavior of the price diﬀerences for weekdays and weekends. 20 0 20Q1 [EUR/MWh] 20 0 20Q2 [EUR/MWh] 20 0 20Q3 [EUR/MWh] 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 Time [h] 20 0 20Q4 [EUR/MWh] Fig. 1. Box plots of distribution of price diﬀerence as function of hour of the day. 2 Additional analysis of Win- kler score The Winkler score (?Gneiting and Raftery, 2007) is a well-established test to investigate reliability and sharpness: WS =    δt xt ∈ [ ˆL α t , ˆU α t ] δt + 2 1−α ( ˆU α t − xt) xt ≥ ˆU α t δt + 2 1−α (xt − ˆL α t ) xt ≤ ˆL α t 20 0 20Q1 [EUR/MWh] 20 0 20Q2 [EUR/MWh] 20 0 20Q3 [EUR/MWh] Monday Tuesday Wednesday Thursday Friday Saturday Sunday Time 20 0 20Q4 [EUR/MWh] Fig. 2. Box plots of distribution of price diﬀerence as function of day of the week. Here, xt is the time step, ˆL α t and ˆU α t are the lower and upper bound of the conﬁdence interval with probability α, respectively. The term δt indicates the width of the predicted conﬁdence interval: δt = ˆU α t − ˆL α t The Winkler score is a negatively oriented score, i.e., lower values indicate better performance. Figure 4 shows the distributions of Winkler scores over the full month of July 2019 for each of the probabilistic models and over α values between 0.0 and 0.9. Overall, the normalizing ﬂow shows the best results. 3 ANN structures The Gaussian regression uses a fully-connected neu- ral network with one hidden layer, 32 neurons, and ‘tanh’ activation. The output layer has 14 neu- rons to describe the four-dimensional mean and the lower triangular covariance matrix implemented in TensorFlow-probability (Dillon et al., 2017). The ∗Manuel Dahmen, Forschungszentrum Jülich GmbH, Institute of Energy and Climate Research, Energy Systems Engineering (IEK-10), Jülich 52425, Germany E-mail: m.dahmen@fz-juelich.dearXiv:2205.13826v1 [cs.LG] 27 May 2022 Page 2 of 3 20 0 20Q1 [EUR/MWh] 20 0 20Q2 [EUR/MWh] 20 0 20Q3 [EUR/MWh] Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec Time 20 0 20Q4 [EUR/MWh] Fig. 3. Box plots of distribution of price diﬀerence as function of month of the year. 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 alpha 0 20 40 60 80 100Winkler score Historical Normalizing Flow Copula Gaussian Fig. 4. Winkler score (?Gneiting and Raftery, 2007) over conﬁdenc interval width alpha for the diﬀerent models and the historical data. Full dis- tribution of scores over the month of July 2019. neuron that output the mean have no activation and the neurons that output the covariance matrix use ‘softmax’ activation to ensure strict positivity. The normalizing ﬂow uses the aﬃne coupling layer implementation in (Dinh et al., 2017). The full model uses four aﬃne coupling layers with fully con- nected conditioner models. The conditioner models have two hidden layers with ‘ReLU’ activation and four neurons per layer. 4 Prediction intervals on ex- treme peaks Figure 5 shows the predicted mean, the prediction intervals of 50% and 90%, and the realization be- tween July 21 st and July 26 th of 2019. Similar to the prediction intervals shown in the main part of the paper, the results conﬁrm that the normalizing ﬂow results in the narrowest prediction intervals and is the only approach that captures the extreme price peaks. Bibliography Dillon, J. V., Langmore, I., Tran, D., Brevdo, E., Vasudevan, S., Moore, D., Patton, B., Alemi, A., Hoﬀman, M., and Saurous, R. A. (2017). Tensorﬂow distributions. arXiv preprint arXiv:1711.10604. Dinh, L., Sohl-Dickstein, J., and Bengio, S. (2017). Density estimation using Real NVP. In 5th In- ternational Conference on Learning Representa- tions, ICLR 2017, Toulon, France, April 24- 26, 2017, Conference Track Proceedings. Open- Review.net. Fraunhofer-Institut für Solare Energiesysteme ISE (2022). Energy Charts. https://www. energy-charts.info. Accessed: 2022-03-01. Gneiting, T. and Raftery, A. E. (2007). Strictly proper scoring rules, prediction, and estimation. Journal of the American Statistical Association, 102(477):359–378. 2 BIBLIOGRAPHY Page 3 of 3 2019-07-21 2019-07-22 2019-07-23 2019-07-24 2019-07-25 2019-07-26 0 50 100 150Intraday ID3 [EUR/MWh] Normalizing Flow mean realization 90% 50% 2019-07-21 2019-07-22 2019-07-23 2019-07-24 2019-07-25 2019-07-26 0 50 100 150Intraday ID3 [EUR/MWh] Historical mean realization 90% 50% 2019-07-21 2019-07-22 2019-07-23 2019-07-24 2019-07-25 2019-07-26 0 50 100 150Intraday ID3 [EUR/MWh] Copula mean realization 90% 50% 2019-07-21 2019-07-22 2019-07-23 2019-07-24 2019-07-25 2019-07-26 0 50 100 150Intraday ID3 [EUR/MWh] Gaussian mean realization 90% 50% Fig. 5. Predicted mean, prediction intervals of 50% and 90%, and realization between July 21 st and July 26 th of 2019 estimated from the probabilistic forecasts form the normalizing ﬂow (top), the selection of historical data (second from top), the Gaussian copula (third from top), and the Gaussian regres- sion (bottom). Note the truncated y-axis for the Gaussian copula. Training data from 2018 and 2019 (Fraunhofer-Institut für Solare Energiesysteme ISE, 2022). Results generated with all conditional inputs. 3","libVersion":"0.3.2","langs":""}