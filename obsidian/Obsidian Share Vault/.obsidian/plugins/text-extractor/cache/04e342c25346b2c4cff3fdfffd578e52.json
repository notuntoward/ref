{"path":"lit/lit_sources.backup/Jiang21DatadrivenFaultDiagnosis2.pdf","text":"Data-driven fault diagnosis and thermal runaway warning for battery packs using real-world vehicle data Lulu Jiang a, 1, Zhongwei Deng a, 1, Xiaolin Tang a, **, Lin Hu b, Xianke Lin c, Xiaosong Hu a, * a College of Mechanical and Vehicle Engineering, Chongqing University, Chongqing, 400044, China b School of Automotive and Mechanical Engineering, Changsha University of Science and Technology, Changsha, 410114, China c Department of Automotive, Mechanical and Manufacturing Engineering, Ontario Tech University, Oshawa, ON, L1G 0C5, Canada article i nfo Article history: Received 19 May 2021 Received in revised form 13 June 2021 Accepted 15 June 2021 Available online 18 June 2021 Keywords: Electric vehicle Data-driven Fault diagnosis Thermal runaway Lithium-ion battery packs Real-world vehicle data abstract Battery fault diagnosis is essential to ensure the safe and reliable operation of electric vehicles. Early detection of battery faults can reduce battery incidents and property losses. However, early warning of battery thermal runaway is still a challenging task. This paper proposes a novel data-driven method for lithium-ion battery pack fault diagnosis and thermal runaway warning based on state representation methodology. The normalized battery voltages are used to achieve accurate identiﬁcation of battery early faults. The proposed method calculates the real-time state of each cell to characterize the internal characteristics of the battery cell, and the state changes are recorded to achieve battery fault diagnosis. The fault detection time is compared with the alarm time of real vehicles to verify the effectiveness of the proposed method. The real-world operation data of four electric vehicles with different speciﬁcations are used to verify the feasibility, robustness, and reliability of the proposed method. The results show that the method can achieve not only the accurate identiﬁcation of the faulty cells and accurate determination of the voltage fault type but also the early detection of faults and early warning of thermal runaway. © 2021 Elsevier Ltd. All rights reserved. 1. Introduction Limited fossil fuels and climate change provide a strong impetus for the development of energy storage technology, which plays an essential role in the context of energy-saving [1e3]. As one of the most widely used energy storage technologies, electrochemical (battery) energy storage has successfully applied in modern power facilities like smart grids and microgrids, and electric vehicles (EVs) [4e6]. Among various types of battery, lithium-ion batteries (LIBs) are the best choices for EVs owing to their high speciﬁc energy density, long cycle life, low self-discharge rate, and no memory effect [7,8]. However, ﬁre incidents involving EV LIBs pose a severe threat to people's lives and property [9,10]. Under the complex operating conditions of EVs, LIBs can generate excessive heat if they are under fault conditions, which could eventually lead to thermal runaway [11,12]. Battery faults may be caused by inherent defects of the battery, improper use, and harsh environment. It is difﬁcult to redesign the battery structure and materials in the short term to improve safety [13,14], so accurate and effective battery fault diagnosis and thermal runaway warning are essential to ensure the safe and reliable operation of EVs [15e17]. A lot of research work has been carried out in the fault diagnosis of battery systems. The fault diagnosis methods can be mainly divided into three categories: knowledge-based, model-based, and data-driven-based [18,19]. Knowledge-based methods utilize the knowledge and observation of battery systems to achieve fault diagnosis without developing models, while the knowledge acquisition and rules establishment are difﬁcult [20]. Model-based methods usually compare the actual measured information of the diagnosed object with the predicted information generated by an accurate model and then obtain residual signals. Subsequently, residual signals are analyzed to achieve fault diagnosis. For example, Chen et al. [21] proposed an external short-circuit fault diagnosis method based on the ﬁrst-order equivalent circuit model (ECM) for LIBs. Dey et al. [22] proposed a two-state model for thermal fault diagnosis, which can describe the dynamics of the surface and core temperature of LIBs. Feng et al. [23] developed a fault diagnosis algorithm for online internal short-circuit (ISC) * Corresponding author.; ** Corresponding author. E-mail addresses: tangxl0923@cqu.edu.cn (X. Tang), xiaosonghu@ieee.org (X. Hu). 1 Equally contributed to this work. Contents lists available at ScienceDirect Energy jo urn a l homepag e: www.elsevier.com/locate/en erg y https://doi.org/10.1016/j.energy.2021.121266 0360-5442/© 2021 Elsevier Ltd. All rights reserved. Energy 234 (2021) 121266 detection based on thermal model and ECM. Model-based methods can accurately describe the evolution of battery states under normal and faulty conditions. However, they usually have the following disadvantages: ﬁrst, diagnosis relies heavily on modeling techniques and requires high model accuracy; second, these models are only suitable for certain types of faults in many studies; third, it is difﬁcult to preset an appropriate threshold. Many studies have shown that data-driven techniques can be well applied in the ﬁeld of LIB fault diagnosis. Lskaaﬁ et al. [24] established a framework coupled with Least Squares Support Vector Machine (LS-SVM) and Memory Particle Filter to diagnose and predict the faults of LIBs. Yao et al. [16] proposed an intelligent fault diagnosis method for lithium battery systems based on grid search SVM, which can identify the potential fault state and classify the severity of the fault. Shang et al. [25] proposed a multi-fault diagnosis method for early battery failure prediction based on the modiﬁed sample entropy. Hu et al. [26] developed a battery health prognosis method for EVs using sample entropy and sparse Bayesian predictive modeling. The data-driven techniques directly analyze and process the running data to detect faults without relying on the accurate analytical model and expert knowledge. However, obtaining rich battery fault data is usually time- consuming and costly. Besides, the data are mainly from experi- ments in the lab and simulations, and the reliability of these methods for real-world EV data has seldom been veriﬁed. Without early warning and timely handling, LIB faults may eventually develop into thermal runaways. Therefore, developing efﬁcient approaches for battery thermal runaway prediction is critical [27]. Ren et al. [28] proposed an electrochemical-thermal coupled overcharge-to-thermal runaway model to predict the highly interactive and thermal behaviors of LIBs under overcharge conditions. Shah et al. [29] presented an experimentally validated theoretical model to predict the temperature distribution of a cell in response to the nonlinear heat generation rate that was known to occur during thermal runaway Nevertheless, the above methods still rely on data generated by laboratory methods and do not fully consider the complex conditions of real-world vehicle operation. The battery performance characteristics in real-world operating vehicles are much more complicated due to the complexity and unpredictability of road conditions, weather, and driving behavior [30]. Therefore, it is necessary to propose fault diagnosis and pre- diction methods of battery systems based on real-world EV oper- ation data. Li et al. [31] proposed a battery fault diagnosis method based on abnormal voltage, which combines the long short-term memory (LSTM) neural network model and ECM, while the hyper-parameter training of LSTM is difﬁcult. Wang et al. [32] proposed an in-situ voltage fault diagnosis method based on modiﬁed Shannon entropy and a safety management strategy based on the Z-score method, which can predict the voltage fault by monitoring cell voltages during vehicular operation. Zhao et al. [33] used a machine learning algorithm and 3s multiple screening strategies to detect the abnormal voltage cells in the battery pack based on the operation big data, and successfully veriﬁed it in real- world vehicles. However, these algorithms mainly identify anom- alies in real-time for the current operating conditions and cannot achieve fault diagnosis on long time scale. Moreover, only the in- formation of the worst battery cell can be obtained, and the health status of other cells cannot be monitored, which brings certain difﬁculties to the operation and maintenance of the battery. Conventional fault diagnosis methods lack veriﬁcation of actual vehicle operating data, and also fail to consider the safety of all the cells in the battery pack. In this study, a novel data-driven method for battery fault diagnosis is proposed to address these drawbacks. To the best of our knowledge, it is the ﬁrst time that the state representation methodology (SRM) has been applied to the ﬁeld of battery fault diagnosis. The SRM uses normalized cell voltages rather than original cell voltages as features to calculate the state of each cell in the battery pack, thus the subtle changes can be captured, and the battery fault can be identiﬁed more quickly. The states and state changes are recorded in each time window (TW) in real-time to achieve accurate identiﬁcation of the faulty cells and determination of the voltage fault type. Furthermore, the fault detection time obtained by the SRM is compared with the alarm time of the real vehicle battery management system (BMS) to verify the early detection of faults. Finally, the real-world operation data of four EVs with different speciﬁcations are used to verify the feasibility, robustness, and reliability of the proposed method. The remainder of this article is organized as follows: Section 2 details the battery fault diagnosis method. Section 3 gives a brief introduction of the big data platform, data acquisition, and faulty vehicle preliminary analysis. The fault diagnosis results of faulty vehicles are given in Section 4. The feasibility, robustness, and reliability of the proposed method are discussed in Section 5. Finally, Section 6 presents the conclusions. 2. Diagnostic method description To realize battery fault diagnosis, it is necessary to make full use of measurable parameters with low-cost sensors, which mainly include voltage, current, and temperature sensors [34]. The tran- sient current depends heavily on the driving behavior, so the cur- rent is difﬁcult to reﬂect the internal characteristics of the battery. The temperature also cannot fully reﬂect the thermal characteris- tics of the battery because the temperature sensor on the vehicle can only measure the surface temperature at certain ﬁxed positions and not every cell is equipped with a temperature sensor. There- fore, using the cell voltage to diagnose the battery faults for real- world vehicles is a better idea. Traditional fault diagnosis methods usually predict the normal voltage of cells based on various models such as ECMs and neural network models, and the prediction values are compared with the actual voltages of cells. However, these approaches are more suitable for laboratory con- ditions. In this article, MATLAB software is used to compute the SRM algorithm because of its powerful matrix calculation capa- bility. A detailed algorithm description and steps of the SRM are introduced below. 2.1. SRM algorithm SRM algorithm has been widely used in structural health diag- nosis of civil infrastructure such as bridges and road networks [35,36]. A large structure can be seen as a complex system. In the ﬁeld of health diagnosis, it is difﬁcult to connect many monitoring data generated by the system with the internal state of the system and extract the fault information. The SRM algorithm can reveal the relationship between the monitoring data and the system state, and realize the accurate determination of the health state of the complex system [37]. According to the modern control theory, the internal state of the system can be regarded as the response of the system to environmental excitation, that is, the characteristics of the system [38]. For the battery system in the actual vehicle, due to the limitation L. Jiang, Z. Deng, X. Tang et al. Energy 234 (2021) 121266 2 of the number and location of sensors, not all the characteristics of the battery system can be obtained. Therefore, the reasonable se- lection of features is of great signiﬁcance for effectively evaluating the state of the battery system. As discussed earlier, cell voltages are ideal parameters to diagnose battery faults. However, the cell voltages collected from real-world vehicles are usually disturbed by various factors, such as noise and driving behavior, which may cause signiﬁcant voltage ﬂuctuations [39]. Therefore, data cleaning and data preprocessing must be performed to reduce the interfer- ence of external factors on the cell voltages [40]. Furthermore, the normalization of the cell voltages is needed to realize accurate identiﬁcation of early battery faults. Finally, the normalized cell voltages are used as features to characterize the internal state of the cells. By taking all cell voltages of a battery pack at each sampling time as a sample, the normalized voltage of each cell under each sample is calculated, and the feature vector xt is constructed. Ut ¼ðvt1; …; vti; …; vtmÞ (1) uti ¼ vti jUtj (2) xt ¼ðut1; …; uti; …; utmÞ (3) where m is the number of cells in the battery pack, vti and uti represent the original voltage and normalized voltage of the cell i at the sampling time t, respectively. jUtj is the length of original voltages at the sampling time t. SRM principle [41]: From Eq. (4), if we know the system re- sponses x ¼ðx1; …; xi…; xmÞ and the state function f ð ,Þ, then we can get the system structure coefﬁcientsl ¼ðl1;…; li;…lmÞ and state variable z. Furthermore, when time passes, we can get new re- sponses denoted asxnew.If f ðl; xnewÞ¼ z still holds, it means that the system is not changed, otherwise, it is changed. Due to the complexity of the battery system, the cell state will inevitably ﬂuctuate, so small ﬂuctuations in the cell state are regarded as normal circumstances. The basic schematic of battery fault diag- nosis based on the SRM is shown in Fig. 1, J is threshold value. z ¼ f ðl; xÞ¼ C (4) where C is a constant and is set to 1 in this article. And the normalized cell voltages are system responsesx. 2.2. Battery fault diagnosis based on the SRM algorithm A ﬂow chart of the SRM algorithm is illustrated in Fig. 2. And the speciﬁc steps are as follows: Step 1: Determine the length of the TW, and construct the cell voltage state matrixG: Xj ¼ \u0001xj 1; …; xj t; …; xj n\u0003T ¼ 2 6 6 6 6 6 6 6 6 6 4 uj 11; …; uj 1i; …; uj 1m ……………………… uj t1; …; uj ti; …; uj tm ……………………… uj n1; …; uj ni; …; uj nm 3 7 7 7 7 7 7 7 7 7 5 (5) uj i ¼ \u0001uj 1i; ::::uj ti; …; uj ni\u0003T (6) Gj ¼ XjT \u0002 Xj ¼ 0 B B B B B B B B B @ < uj 1; uj 1 > ; …; < uj 1; uj i > ; ::::; < uj 1; uj m > ::::::::::::::::::::::::::::::::::::::::::::::::::::::::: < uj i; uj 1 > ; …; < uj i; uj i > ; ::::; < uj i; uj m > ::::::::::::::::::::::::::::::::::::::::::::::::::::::::: < uj m; uj 1 > ; …; < uj m; uj i > ; ::::; < uj m; uj m > 1 C C C C C C C C C A (7) Fig. 1. The basic schematic of battery fault diagnosis based on the SRM. Fig. 2. A ﬂow chart of the SRM algorithm. L. Jiang, Z. Deng, X. Tang et al. Energy 234 (2021) 121266 3 where n is the length of TW, all the parameters below are at the TW j, uj tiand xj t are the normalized voltage of the cell i and feature vector at the sampling time t, Xj is the feature matrix, uj i is the voltage vector of cell i, < uj i; uj 1 > is the product of the voltage vector of the cells 1 and i, Gj is the cell voltage state matrix. Step 2: Calculatel in z ¼ f ðl; xÞ at the basic TW. The ﬁrst TW is regarded as the basic TW. According to the least square error objective function l, corresponding to the cell voltage state matrix G1 at the basic TW is calculated: e ¼ð1; …; 1; :::1Þ1\u0002m (8) l ¼ðl1; …; li; …; lmÞT (9) G1 ¼ X1T \u0002 X1 ¼ 0 B B B B B B B B B @ < u1 1; u1 1 > ; …; < u1 1; u1 i > ; ::::; < u1 1; u1 m > ::::::::::::::::::::::::::::::::::::::::::::::::::::::::: < u1 i ; u1 1 > ; …; < u1 i ; u1 i > ; ::::; < u1 i ; u1 m > ::::::::::::::::::::::::::::::::::::::::::::::::::::::::: < u1 m; u1 1 > ; …; < u1 m; u1 i > ; ::::; < u1 m; u1 m > 1 C C C C C C C C C A (10) objective function : min \u0004 \u0004 \u0004 \u0004 \u0005I \u0003 1 meT e\u0006G1l \u0004 \u0004 \u0004 \u0004 2 (11) constraint condition : Xm 1 li ¼ 10 \u0004 li \u0004 1 (12) where li is the parameter weight corresponding to the cell i at the basic TW. Step 3: Calculate the basic state variable z1 corresponding to G1: z1 ¼ f ðl; xÞ ¼ Xm 1 li < u1 i ; X1 > ¼ G1 \u0002 l ¼ ðz11; …; z1i; …; z1mÞT (13) where f ðl; xÞ is a battery state function, z1i is the feature of cell i at the basic TW. Step 4: Calculate the state variable zj at TW j: zj ¼ f ðl; xÞ¼ Xm 1 li < uj i; Xj > ¼ Gj \u0002 l ¼ \u0007zj1; …; zji; …; zjm\bT (14) where zji is the feature of cell i at the TW j. Step 5: Calculate the difference betweenz1: diffj ¼ X\t \tzj \u0003 z1\t \t ¼ \t \tzj1 \u0003 z11\t \t þ … þ \t \tzji \u0003 z1i\t \t… þ \t \tzjm \u0003 z1m\t \t j ¼ 2; 3; … (15) If diffj exceeds the threshold value J, it indicates that the TW j is an abnormal TW, and some cells of the battery pack have faults. Otherwise, the algorithm continues to calculate the cell states at the next TW: f ¼ 0 if dif fj < J 1 if dif fj > J (16) where f ¼ 0 and f ¼ 1 represent there is no abnormity and there is abnormity at the TW j, respectively. Step 6: Compare the state of abnormal cell i with the median state of cells at the basic TW. Abnormal cells can be easily identiﬁed according to the state curves at each TW, because the state of the abnormal cell will signiﬁcantly deviate from states of other cells at the later TW. The state of abnormal cell i (zabi) and the median state of cells (zabmed) at the basic TW are compared. If zabi is higher thanzabmed, it in- dicates that the cell i has an over-voltage fault. While if zabi is lower thanzabmed, it indicates that the cell i has an under-voltage fault: s ¼ 0 if zabi > zabmed 1 if zabi < zabmed (17) where s ¼ 0 represents that the cell i appears over-voltage fault, s ¼ 1 represents that the cell i appears under-voltage fault. Step 7: Compare the fault detection time with BMS alarm time: v ¼ 0 if t1 \u0005 t2 1 if t1 < t2 (18) The time corresponding to the occurrence of ﬁve abnormal TWs in a row is regarded as the fault detection time. Where t1 and t2 represent fault detection time and BMS alarm time, respectively. v ¼ 0 indicates that early detection of faults cannot be achieved, while v ¼ 1 represents that early detection of faults can be achieved. 3. Data acquisition and preliminary analysis of real vehicles 3.1. Big data platform and data acquisition The vehicle data studied in this article are collected from the China Southwest Branch of the National Monitoring and Manage- ment Center for New Energy Vehicles (CSB-NMMC-NEV), which is a big data platform jointly established by the National Big Data Alliance for New Energy Vehicles (NBDA-NEV) and China Auto- motive Engineering Research Institute Co, Ltd. It is responsible for monitoring NEVs in southwest China, and on this platform, not only macro data such as the total number of connected vehicles and the number of online vehicles, but also the operation data of the ve- hicles can be monitored. For public vehicles, more detailed data can be monitored, including battery status information, temperature information, etc. Based on these data, this platform can realize real- time monitoring, statistical analysis and basic safety warning of NEVs. The schematic of the platform is illustrated in Fig. 3. In this article, four EVs from CSB-NMMC-NEV platform are Fig. 3. The schematic of the CSB-NMMC-NEV platform. L. Jiang, Z. Deng, X. Tang et al. Energy 234 (2021) 121266 4 studied. They are independent of each other, as can be seen from the size of their own battery packs, and they can be divided into three types (potential failures, thermal runaway, normal) according to maintenance records, as shown in Table 1. Vehicles No. 1 and No. 2 had potential failures, and there was at least one alarm that occurred during the operation of the vehicle. Vehicle No. 3 had a thermal runaway incident, and faulty cells that caused the thermal runaway have been identiﬁed according to the incident investiga- tion by professional personnel. Vehicle No. 4 was a normal one, and it did not have any fault alarms. The data collected from vehicles No. 1 and No. 2 are used to verify the effectiveness of the proposed method for battery fault diagnosis. The data collected from vehicle No. 3 are used to verify the effectiveness of the proposed method for the early warning of thermal runaway. The data collected from vehicle No. 4 are used to verify the reliability of the proposed method for fault diagnosis. All batteries in the studied EVs are ternary LIBs. Taking vehicle No. 3 as an example, the battery pack consists of 16 battery modules connected in series, and each module has a certain number of series-connected cells. The layout of the battery pack is shown in Fig. 4. The battery pack is double-layered. Only module 1 is installed in the front of the upper layer, and ﬁve modules from 9 to 5 are arranged in sequence on the back of the upper layer. For the lower layer of the battery pack, modules from 12 to 16 are located on the front, while modules 10, 11, 2, 3, and 4 are located on the back. Voltage sensors are installed for each cell. 3.2. Preliminary analysis of two types of faulty vehicles 3.2.1. Potentially faulty vehicles The original and normalized cell voltage curves of the vehicles with potential fault are shown in Fig. 5. The data sampling interval of vehicles No. 1 and No. 2 is 30 s. For vehicle No. 1, the data is collected from April 1, 2019, 16:50:43 to August 1, 2019, 09:15:27. The original voltage curves of vehicle No. 1 are presented in Fig. 5 (a). It can be seen that the small voltage drop cannot be identiﬁed clearly from all cell voltage curves, thus the potential failure risks are likely to be ignored. However, after voltage normalization, as shown in Fig. 5 (b), the voltage manifestation of cells 2 and 49 are different from other cells. And the time of abnormality occurrence is clear. On May 1, 2019, 19:49:55, the normalized voltage of cell 2 gradually drops to a certain level and keeps this level for a long time. While the normalized voltage of cell 49 suddenly drops at about June 8, 2019, 14:08:06, and continues to fall to July 14, 2019, 12:50:30 with violent ﬂuctuations. It can be inferred that cell 2 is abnormal ﬁrst, and then cell 49 may have an ISC fault during vehicle running. However, the voltages of cells 2 and 49 then recover rapidly due to self-recovery and internal circuit equaliza- tion [42]. Although all the voltages return to normal levels, the voltage ﬂuctuations are more pronounced than before, and the voltage inconsistencies increase. Similarly, the original and normalized cell voltage curves of vehicle No. 2 are shown in Fig. 5 (c) and Fig. 5 (d). The data is collected from April 15, 2019, 17:42:30 to August 5, 2019, 10:54:30. It can be found that Cell 83 always has the lowest voltage in Fig. 5 (d). While as can be seen from Fig. 5 (c), this phenomenon is not obvious in the early stage. At about May 22, 2019, 17:14:00, all cell voltages synchronously drop to a low status at the end of a discharge. It may indicate that the driver does not charge in time, resulting in a low battery SOC. Such behavior may damage the health of batteries and should be avoided. While in Fig. 5 (d), the running in low SOC segment can not be seen, because the normalized cell voltages describe the relative state of each cell at the same level. When the voltages of all cell change consistently, the change of one cell is less obvious. The voltage curves begin to show obvious clustering from July 12, 2019, 15:03:30, and the voltage differences between cell 83 and other cells become larger. It reveals the resistance of cell 83 further increases resulting in the consistency of the battery pack becomes worse. 3.2.2. Thermal runaway vehicle The cell voltage curves of vehicle No. 3 before and after normalization are shown in Fig. 6 below. The data is collected from August 7, 2020, 17:16:55 to August 12, 2020, 07:11:35 with a sam- pling interval of 10 s. Different from the vehicles with potential fault, the battery pack of vehicle No. 3 has good consistency before thermal runaway occurs. The voltage curves almost overlap without any obvious ﬂuctuations. And the original cell voltage Table 1 Parameters of studied EVs. Item No. 1 No. 2 No. 3 No. 4 Vehicle type Potential fault Potential fault Thermal runaway Normal Sample interval (s) 30 30 10 10 Cell number 156 89 92 96 Fig. 4. The layout of the battery pack of vehicle No. 3. L. Jiang, Z. Deng, X. Tang et al. Energy 234 (2021) 121266 5 curves and normalized cell voltage curves look the same in Fig. 6 (a) and Fig. 6 (b). We can observe that the voltages of cells 31 and 35 begin to drop suddenly, and the voltage of cell 31 drops by 3.011 V within 12 s, then the voltages of several other cells start to drop. The voltages of all cells remain constant due to voltage sensors data acquisition failure when thermal runaway occurs. Combined with Fig. 4, it can infer that the thermal runaway of vehicle No. 3 might happen in modules 6 and 7. 4. Results Battery fault diagnosis usually includes locating faulty cells, identifying fault type, detecting fault occurrence, and determining the cause of the fault. However, due to the coupling characteristics of battery system faults, that is, different fault causes may lead to very similar abnormality, and an abnormality may be the result of a combination of multiple faults [18], it is very difﬁcult to determine the exact cause of the fault only based on the high-level vehicle operation data. The accurate determination of the cause of a fault often requires technical assistance such as battery pack disas- sembly and ultrasound diagnosis. Some existing fault diagnosis methods are to diagnose a certain type of fault, like references [21,23]. In this article, only the cell voltage data is considered, so determining the cause of the fault is not the focus of this article, and only possible fault causes can be obtained. To verify the effective- ness of the proposed method for battery fault diagnosis and ther- mal runaway warning, the results are shown below in detail. Fig. 5. The cell voltage curves of the vehicles with potential fault. (a) The original cell voltage curves of vehicle No. 1. (b) The normalized cell voltage curves of vehicle No. 1. (c) The original cell voltage curves of vehicle No. 2. (d) The normalized cell voltage curves of vehicle No. 2. Fig. 6. The cell voltage curves of the thermal runaway vehicle. (a) The original cell voltage curves of vehicle No. 3. (b) The normalized cell voltage curves of vehicle No. 3. L. Jiang, Z. Deng, X. Tang et al. Energy 234 (2021) 121266 6 4.1. Battery fault diagnosis results Fig. 7 presents the cell states of two vehicles with potential fault. Each curve on the graph represents the state of all cells under each TW. The length of the TW is set as 1 in this article. When the battery pack is under normal circumstances, the state of each cell ﬂuctuates around a small range of its basic state value. And the state ﬂuctu- ations of cells under each TW indicate the degree of inconsistency of the battery pack. But once the battery pack performs abnormal, it can be observed that the state of the abnormal cell is far away from other cells under this TW. Thus, the abnormal cell in the battery pack is easily to locate. Besides, it is easy to judge whether the abnormal cell belongs to over-voltage fault type or under-voltage fault type by comparing its state with the median state value under basic TW. For vehicle No. 1, as shown in Fig. 7 (a), the states of cells 2 and 49 are lower than the median state value, and therefore both of them are abnormal cells and have an under-voltage fault. What's more, the abnormality degree of cell 49 is signiﬁcantly higher than that of cell 2. For vehicle No. 2, cell 83 is faulty and has an under-voltage fault, and apparent stratiﬁcation in the cell states can be observed in Fig. 7 (b), which means that the battery pack has terrible in consistency. The results verify that the proposed method can not only precisely locate faulty cells in battery packs, but also identify the fault types between over-voltage fault and under- voltage fault. The results of two potentially faulty vehicles for early detection of faults are shown in Fig. 8. The ﬁxed threshold value is obtained by training a large amount of historical data of the corresponding Fig. 7. The cell states of two vehicles with potential fault under each TW. (a) Vehicle No. 1. (b) Vehicle No. 2. Fig. 8. The results of two potentially faulty vehicles for early detection of faults. (a) The state difference curve of vehicle No. 1. (b) Early detection of faults results of vehicle No. 1. (c) The state difference curve of vehicle No. 2. (d) Early detection of faults results of vehicle No. 2. L. Jiang, Z. Deng, X. Tang et al. Energy 234 (2021) 121266 7 vehicle under normal conditions. And the threshold value of each faulty vehicle is different because of the different speciﬁcations of them. The time when the state difference exceeds the threshold value is regarded as the fault detection time. For vehicle No. 1, as shown in Fig. 8 (a) and Fig. 8 (b), the fault detection time is at 11,340 sampling point, while the time of the ﬁrst BMS alarm is at 13,460 sampling point. For vehicle No. 2, as shown in Fig. 8 (c) and Fig. 8 (d), the fault detection time is at 9100 sampling point, while the time of the BMS alarm is at 10,110 sampling point. Although the state difference also exceeds the threshold value and an alarm sign occurs at 4725 sampling point, we do not regard this time as fault detection time because the state difference will return to normal after a long period of time, and this phenomenon is caused by the battery being discharged too deeply as discussed in section 3.2. The results show the proposed method can achieve the early detection of faults before the BMS alarm time, therefore, it can warn relevant people to deal with it before causing serious hazards. 4.2. Thermal runaway early warning For vehicle No. 3, its battery pack has good voltage consistency, as discussed earlier, and only the data of 3000 sampling points in the later period are used to analyze results. As shown in Fig. 9 (a), several cells are abnormal. Among them, cells 31, 33, 35, and 42 appear under-voltage fault, while cells 32 and 43 appear over- voltage fault. The state difference between abnormal cells and abnormal cells is very large, which shows that the thermal runaway of vehicle No. 3 is severe. As shown in Fig. 9 (b), the state difference is almost equal to zero under normal conditions because of the good consistency of the battery pack. The state difference goes up sharply when the thermal runaway occurs. Fig. 9 (c) shows the result of the thermal runaway warning, and its zoomed-in view is shown in Fig. 9 (d). It can be seen that the algorithm detects the abnormality a few seconds after the voltage drop in Fig. 9 (d). The fault detection time is at 2986 sampling point (06:51:16), while the BMS alarm time is at 2989 sampling point (06:51:19), and thermal runaway occurs at 2995 sampling point (06:51:25). The results verify that the proposed method can effectively achieve the early warning of thermal runaway, therefore more time is available to take actions before thermal runaway occurs. 5. Discussion 5.1. Feasibility analysis Compared with the original voltage signal, the proposed feature is superior and more feasible for battery fault diagnosis. The com- parison of the original and normalized cell voltage curves of cells 1 and 2 in vehicle No. 1 is shown in Fig. 10. As shown in Fig. 10 (a), the consistency of the battery pack is not too bad in the early stage. The original voltages of cells 1 and 2 have little difference and the changing trend of the curve looks the same. However, after normalization, as shown in Fig. 10 (b), the voltage difference be- comes more obvious. Besides, the states of cells always ﬂuctuate in a small range regardless of whether the battery is in charging or discharging. As discussed earlier, cell 2 occurs in abnormalities in the later stage. Thus, the larger voltage difference can be observed in Fig. 10 (c). The normalized cell voltage curves amplify the subtle difference between normal and abnormal cells, as shown in Fig. 10 (d), which helps identify potentially risky cells in the battery pack. Fig. 9. The thermal runaway early warning veriﬁcation of vehicle No. 3. (a) The cell state curves under each TW. (b)The state difference curve. (c) Thermal runaway early warning result. (d) Zoomed-in view of (c). L. Jiang, Z. Deng, X. Tang et al. Energy 234 (2021) 121266 8 5.2. Robustness analysis To verify the robustness of the proposed SRM method on different lengths of TW, we set TW to 1, 5, 10, 15, 30, and 60, respectively. The fault detection time and BMS alarm time of ve- hicles No. 1 and No. 2 under these TWs are shown in Fig. 11. As the length of TW increases, the fault detection time is prolonged. For vehicle No. 1, except in the case where the TW length is equal to 60, the fault detection time is ahead of the BMS alarm time under other TWs. While for vehicle No. 2, the fault detection time is ahead of the corresponding BMS alarm time under all TWs. The difference in results may be due to the different voltage failure modes of the two vehicles. Therefore, it can be concluded that the proposed SRM method allows the TW length to be appropriately extended to improve the fault diagnosis efﬁciency. In order to obtain a longer warning time in advance and reduce the storage burden of the monitoring platform for EVs, the length of the TW is selected to be 1 in this article. 5.3. Reliability analysis The data for vehicle 4 from November 4, 2019, 19:15:16 to November 16, 2019, 11:53:25 is retrieved, and no alarm occurs in any cell during this period. As shown in Fig. 12 (a), the original voltage curves show slight ﬂuctuations in the voltage of some cells, but there is no obvious abnormality. The normalized voltage curves in Fig. 12 (b) show no cell with abnormal voltage except for the slight deviation of cell 82. Fig. 12 (c) presents the state of each cell under each TW, and the results show that cell 82 has an under- voltage tendency, while the state difference is always under the threshold value in Fig. 12 (d). Therefore, it is proved that the pro- posed method does not generate false alarms for the normal vehicle, and it has good reliability. Fig. 10. The comparison of the original and normalized cell voltage curves of cells 1 and 2 in vehicle No. 1. (a) The original cell voltage curve in the early stage. (b) The original cell voltage curve in the later stage. (c) The normalized cell voltage curve in the early stage. (d) The normalized cell voltage curve in the later stage. Fig. 11. Fault diagnosis results of vehicles No. 1 and No. 2 with different TW length. L. Jiang, Z. Deng, X. Tang et al. Energy 234 (2021) 121266 9 6. Conclusions This paper presents a data-driven fault diagnosis method for lithium-ion battery packs based on SRM. The SRM method uses the normalized battery voltages as features to calculate the real-time state of each cell in the battery pack. Compared with the original cell voltages, the normalized cell voltages can amplify the subtle changes in the cell state, so that early battery faults can be more easily identiﬁed. The changes of the cell state in each TW are recorded to realize the diagnosis of the faulty cells, including the accurate identiﬁcation of the faulty cells and determination of the voltage fault type. Besides, under appropriate TWs, the fault detection time obtained by this method is earlier than the BMS alarm time of the actual vehicle. Therefore, this method has ad- vantages in the actual applications. In addition, the proposed method can realize the early warning of thermal runaway. Finally, the feasibility, robustness, and reliability of the proposed method are veriﬁed. In future work, the inﬂuence of noise and different data pre- processing methods on battery fault diagnosis should be consid- ered. In addition, the adaptive threshold should replace the ﬁxed threshold to reduce the false alarm rate and the missed alarm rate of battery fault diagnosis. Credit Author Statement Lulu Jiang: Conceptualization, Investigation, Methodology, Software, Validation, Writing e original draft. Zhongwei Deng: Conceptualization, Investigation, Methodology, Validation, Writing e original draft. Xiaolin Tang: Conceptualization, Funding acquisi- tion, Methodology, Investigation, Validation, Writing e original draft. Lin Hu: Investigation, Validation, Writing e review & editing. Xianke Lin: Investigation, Validation, Writing e review & editing. Xiaosong Hu: Conceptualization, Funding acquisition, Investiga- tion, Methodology, Validation, Writing e original draft. Declaration of competing interest The authors declare that they have no known competing ﬁnancial interests or personal relationships that could have appeared to inﬂuence the work reported in this paper. Acknowledgments This work was in part supported by National Natural Science Foundation of China (Grant No. 51875054and No. U1864212); Graduate research and innovation foundation of Chongqing, China (Grant No. CYS20018); and the Chongqing Natural Science Foun- dation for Distinguished Young Scholars (Grant No. Cstc2019jcyjjq0010), Chongqing Science and Technology Bureau, China. In addition, thanks to China Automotive Engineering Research Institute Co., Ltd for supporting the research data in this article. References [1] Calise F, Cappiello FL, D'Accadia MD, et al. Energy and economic analysis of a small hybrid solar-geothermal trigeneration system: a dynamic approach. Energy 2020;208. https://doi.org/10.1016/j.energy.2020.118295. [2] Lai CS, Locatelli G. Economic and ﬁnancial appraisal of novel large-scale en- ergy storage technologies. Energy 2021;214. https://doi.org/10.1016/ j.energy.2020.118954. [3] Mbungu NT, Naidoo RM, Bansal RC, et al. An overview of renewable energy resources and grid integration for commercial building applications. J. Storage Mater. 2020;29:101385. https://doi.org/10.1016/j.est.2020.101385. [4] Torres-Moreno JL, Gimenez-Fernandez A, Perez-Garcia M, et al. Energy man- agement strategy for micro-grids with PV-battery systems and electric vehi- cles. Energies 2018;11:522. https://doi.org/10.3390/en11030522. [5] Gonz\u0002alez I, Calder\u0002on AJ, Portalo JM. Innovative multi-layered architecture for Fig. 12. The data and results of vehicle No. 4. (a) The original cell voltage curves. (b) The normalized cell voltage curves. (c) The state of each cell under each TW. (d) The state difference curve. L. Jiang, Z. Deng, X. Tang et al. Energy 234 (2021) 121266 10 heterogeneous automation and monitoring systems: application case of a photovoltaic smart microgrid. Sustainability 2021;13:2234. https://doi.org/ 10.3390/su13042234. [6] Su T, Lyu N, Zhao Z, et al. Safety warning of lithium-ion battery energy storage station via venting acoustic signal detection for grid application. J. Storage Mater 2021;38:102498. https://doi.org/10.1016/j.est.2021.102498. [7] Deng Z, Hu X, Lin X, et al. Data-driven state of charge estimation for lithium- ion battery packs based on Gaussian process regression. Energy 2020;205. https://doi.org/10.1016/j.energy.2020.118000. [8] Yiding L, Wenwei W, Cheng L, et al. A safety performance estimation model of lithium-ion batteries for electric vehicles under dynamic compression. Energy 2021;215:119050. https://doi.org/10.1016/j.energy.2020.119050. [9] Ren D, Feng X, Liu L, et al. Investigating the relationship between internal short circuit and thermal runaway of lithium-ion batteries under thermal abuse condition. Energy Storage Mater 2021;34:563e73. https://doi.org/ 10.1016/j.ensm.2020.10.020. [10] Jindal P, Bhattacharya J. Reviewdunderstanding the thermal runaway behavior of Li-ion batteries through experimental techniques. J Electrochem Soc 2019;166:A2165e93. https://doi.org/10.1149/2.1381910jes. [11] Li J, Sun D, Jin X, et al. Lithium-ion battery overcharging thermal character- istics analysis and an impedance-based electro-thermal coupled model simulation. Appl Energy 2019;254:113574. https://doi.org/10.1016/ j.apenergy.2019.113574. [12] Feng X, Lu L, Ouyang M, et al. A 3D thermal runaway propagation model for a large format lithium ion battery module. Energy 2016;115:194e208. https:// doi.org/10.1016/j.energy.2016.08.094. [13] Nitta N, Wu F, Lee JT, et al. Li-ion battery materials: present and future. Mater Today 2015;18:252e64. https://doi.org/10.1016/j.mattod.2014.10.040. [14] Mbungu NT, Bansal RC, Naidoo RM, et al. A dynamic energy management system using smart metering. Appl Energy 2020;280:115990. https://doi.org/ 10.1016/j.apenergy.2020.115990. [15] Feng X, Zheng S, Ren D, et al. Investigating the thermal runaway mechanisms of lithium-ion batteries based on thermal analysis database. Appl Energy 2019;246:53e64. https://doi.org/10.1016/j.apenergy.2019.04.009. [16] Yao L, Fang Z, Xiao Y, et al. An intelligent fault diagnosis method for lithium battery systems based on grid search Support vector machine. Energy 2021;214. https://doi.org/10.1016/j.energy.2020.118866. [17] Liao Z, Zhang S, Li K, et al. A survey of methods for monitoring and detecting thermal runaway of lithium-ion batteries. J Power Sources 2019;436:226879. https://doi.org/10.1016/j.jpowsour.2019.226879. [18] Hu X, Zhang K, Liu K, et al. Advanced fault diagnosis for lithium-ion battery systems: a review of fault mechanisms, fault features, and diagnosis proced- ures. IEEE Ind. Electron. Mag. 2020;14:65e91. https://doi.org/10.1109/ MIE.2020.2964814. [19] Xiong R, Sun W, Yu Q, et al. Research progress, challenges and prospects of fault diagnosis on battery system of electric vehicles. Appl Energy 2020;279: 115855. https://doi.org/10.1016/j.apenergy.2020.115855. [20] Held M, Br€onnimann R. Safe cell, safe battery? Battery ﬁre investigation using FMEA, FTA and practical experiments. Microelectron Reliab 2016;64:705e10. https://doi.org/10.1016/j.microrel.2016.07.051. [21] Chen Z, Xiong R, Tian J, et al. Model-based fault diagnosis approach on external short circuit of lithium-ion battery used in electric vehicles. Appl Energy 2016;184:365e74. https://doi.org/10.1016/j.apenergy.2016.10.026. [22] Dey S, Perez HE, Moura SJ. Model-based battery thermal fault diagnostics: algorithms, analysis, and experiments. IEEE Trans Contr Syst Technol 2019;27: 576e87. https://doi.org/10.1109/TCST.2017.2776218. [23] Feng X, Pan Y, He X, et al. Detecting the internal short circuit in large-format lithium-ion battery using model-based fault-diagnosis algorithm. J. Storage Mater. 2018;18:26e39. https://doi.org/10.1016/j.est.2018.04.020. [24] Lskaaﬁ MA. fault diagnosis and failure Prognostics of lithium-ion battery based on least squares Support vector machine and memory Particle Filter framework. University of Tennessee; 2015. https://trace.tennessee.edu/utk_ graddiss/3594. [25] Shang Y, Lu G, Kang Y, et al. A multi-fault diagnosis method based on modiﬁed Sample Entropy for lithium-ion battery strings. 227275 J Power Sources 2020;446:1e75. https://doi.org/10.1016/j.jpowsour.2019.227275. 12. [26] Hu X, Jiang J, Cao D, et al. Battery health prognosis for electric vehicles using sample entropy and sparse bayesian predictive modeling. IEEE Trans Ind Electron 2015;63:1. https://doi.org/10.1109/TIE.2015.2461523.1. [27] Lai X, Wang S, Wang H, et al. Investigation of thermal runaway propagation characteristics of lithium-ion battery modules under different trigger modes. Int J Heat Mass Tran 2021;171:121080. https://doi.org/10.1016/ j.ijheatmasstransfer.2021.121080. [28] Ren D, Feng X, Lu L, et al. An electrochemical-thermal coupled overcharge-to- thermal-runaway model for lithium ion battery. J Power Sources 2017;364: 328e40. https://doi.org/10.1016/j.jpowsour.2017.08.035. [29] Shah K, Jain A. Prediction of thermal runaway and thermal management re- quirements in cylindrical Li-ion cells in realistic scenarios. Int J Energy Res 2019;43. https://doi.org/10.1002/er.4411. [30] Hu X, Che Y, Lin X, et al. Health prognosis for electric vehicle battery packs: a data-driven approach. IEEE ASME Trans Mechatron 2020:1. https://doi.org/ 10.1109/TMECH.2020.2986364.1. [31] Li D, Zhang Z, Liu P, et al. fault diagnosis of battery systems for electric vehicles based on voltage abnormality combining the long short-term memory neural network and the equivalent circuit model. IEEE Trans Power Electron 2020:1. https://doi.org/10.1109/TPEL.2020.3008194.1. [32] Wang Z, Hong J, Liu P, et al. Voltage fault diagnosis and prognosis of battery systems based on entropy and Z-score for electric vehicles. Appl Energy 2017;196:289e302. https://doi.org/10.1016/j.apenergy.2016.12.143. [33] Zhao Y, Liu P, Wang Z, et al. Fault and defect diagnosis of battery for electric vehicles based on big data analysis methods. Appl Energy 2017;207:354e62. https://doi.org/10.1016/j.apenergy.2017.05.139. [34] Hu X, Feng F, Liu K, et al. State estimation for advanced battery management: key challenges and future trends. Renew Sustain Energy Rev 2019;114: 109334. https://doi.org/10.1016/j.rser.2019.109334. [35] Yabe A, Miyamoto A, Brühwiler E. Characteristics of a bridge condition assessment method based on state representation methodology (SRM) and damage detection sensitivity. J Civ Struct Heaith Monit 2019;9:233e51. https://doi.org/10.1007/s13349-019-00328-9. [36] Miyamoto A, Yabe A. State representation methodology (SRM) for bridge condition assessment in SHM. Journal of Civil Engineering and Architecture 2012;6. https://doi.org/10.17265/1934-7359/2012.04.004. [37] Yan Z, Miyamoto A, Jiang Z. Frequency slice algorithm for modal signal sep- aration and damping identiﬁcation. Comput Struct 2011;89:14e26. https:// doi.org/10.1016/j.compstruc.2010.07.011. [38] Yan Z, Miyamoto A, Jiang Z, et al. An overall theoretical description of fre- quency slice wavelet transform. Mech Syst Signal Process 2010;24:491e507. https://doi.org/10.1016/j.ymssp.2009.07.002. [39] Li X, Dai K, Wang Z, et al. Lithium-ion batteries fault diagnostic for electric vehicles using sample entropy analysis method. J. Storage Mater. 2020;27: 101121. https://doi.org/10.1016/j.est.2019.101121. [40] C X, Ilyas IF, Krishnan S, et al. Data cleaning: overview and emerging chal- lenges. In: Proceedings of the 2016 International Conference on management of data. San Francisco, California, USA: Association for Computing Machinery; 2016. p. 2201. https://doi.org/10.1145/2882903.2912574. 06. [41] Miyamoto A. Usage management of civil structures: Encyclopedia of struc- tural health monitoring. 2009. https://doi.org/10.1002/ 9780470061626.shm111. [42] Lai X, Yi W, Li H, et al. Online internal short circuit detection method considering equalization electric quantity for lithium-ion battery pack in electric vehicles. Int J Energy Res 2020;35:470e99. https://doi.org/10.1016/ j.ensm.2020.11.026. L. Jiang, Z. Deng, X. Tang et al. Energy 234 (2021) 121266 11","libVersion":"0.3.2","langs":""}