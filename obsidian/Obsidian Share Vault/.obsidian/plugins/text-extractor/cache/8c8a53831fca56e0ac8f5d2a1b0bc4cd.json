{"path":"lit/lit_sources.backup/Shenoy15StochOptPowMktRgrssn.pdf","text":"Stochastic Optimization of Power Market Forecast Using Non-Parametric Regression Models Saahil Shenoy1 and Dimitry Gorinevsky2 IEEE POWER & ENERGY SOCIETY GENERAL MEETING • JULY 2015, DENVER, CO Abstract— The paper considers stochastic optimization of the electricity procurement in the day-ahead power market. The novelty is in addressing the random errors of time series forecasting of electrical power loads and prices in the procurement. This problem is currently important because of the increased random variability in the power grid that is caused by growing integration of renewable generation. This paper presents a methodology for stochastic optimization using data-driven models. We consider non-parametric models of multivariate distributions based on multiple quantile re- gressions, built from historical data sets. The statistics, such as cost expectation, required for the stochastic optimization are computed numerically using these models. Applying the methodology to utility data shows that 2% improvement of the costs is feasible. I. INTRODUCTION The growing integration of renewable generation increases random variability of electrical power loads and prices in the power grid. The problem requires new analytical approaches. This paper discusses stochastic optimization in the electrical power market using time series forecasting models and stochastic models of the forecast errors. The non-parametric stochastic models are built from historical operation data. Stochastic optimization is used in power market appli- cations, such as wind power generation and storage in the market, see [1], [2]. It is also used for power procurement in the day ahead electricity markets, see [3], [4]. Stochastic optimization using Gaussian models of the prices has been considered in [5], [6], [7]. These papers do not address other distribution shapes. The demand and spot prices are non- Gaussian; their peaking is described by long tails. This paper presents data-driven stochastic models for the optimization. A ﬂexible non-parametric multivariate model is given by quantile regression, see [8]. Quantile regression is used in many applications and is included with major statistical packages as a software function. However, so far, it found limited use for building non-parametric multivariate distribu- tion models that can be used in stochastic calculus. This paper applies an optimization-based approach de- scribed in [9] to simultaneous estimation of multiple quan- tiles in the non-parametric model. The approach is scalable to extremely large training data sets because it uses the alternating direction method of multipliers (ADMM), see [10], [11]. For high (or low) quantiles, where the data is 1Saahil Shenoy is a PhD student in the Department of Physics, Stanford University, Stanford, CA 94305, USA, saahils@stanford.edu 2Dimitry Gorinevsky is with the Department of Electrical Engineering, Stanford University, Stanford, CA 94305, USA, gorin@stanford.edu and Mitek Analytics LLC, Palo Alto, CA 94306, dimitry@mitekan.com scarce, the approach uses a parametric model of the tail with ﬁxed quantile regression slope, similar to, e.g., [12]. The stochastic optimization based on a non-parametric multivariate quantile regression model of the entire distribu- tion appears to be new. Existing quantile regression uses are mostly for off-line analysis of the data such as risk estimation in ﬁnance [13]. The model for wind power generation in [14] could be used for forecasting; the additive quantile regression model separates each regressor variable and is not truly multi-variable. The contributions of this paper are as follows. First, it formulates a stochastic optimization approach to power pro- curement using non-parametric models of the distributions with long tails. Second, it presents a computational method for building the model from historical data by formulating and solving a convex optimization problem. Third, it demon- strates the approach for electrical utility data. As the example, we use time series of hourly electrical power loads and spot market electricity prices collected over several years. The non-parametric models of the proposed form are trained on older historical data, then backtested for stochastic optimization of power purchase decisions in the day-ahead power market. It is shown that using proposed stochastic optimization approach could lead to 2% savings. II. SINGLE QUANTILE REGRESSION We will consider a dataset D = {Zi, yi}N i=1, (1) where scalars yi are response variables and vectors Zi ∈ ℜ n are explanatory variables (regressors). Index i describes the sample and N is the number of samples available, which can be very large. In what follows, we assume that data (1) are i.i.d., and follow unknown (but ﬁxed) conditional multivariate distribution p(yi|Zi). In forecasting applications, i is the time sample and the i.i.d. assumption means time- invariance of the underlying process. A. Quantile Regression Problem We assume that the unknown generating distribution p(yi|Zi) for (1) can be characterized through the probabilities P (yi ≤ y(q)|Zi) = q, y(q) = Ziβ(q) + α(q), (2) where q ∈ (0, 1) is the quantile level, β ∈ ℜ n and α ∈ ℜ deﬁne a quantile regression hyperplane in the data space. For a given quantile level q, model (2) can be found by solving a linear programming (LP) problem, see [8]. We build a smoothed optimization formulation for joint 1 estimation of multiple quantile levels that deals with the quantile crossing problem. The formulation yields a QP problem and is described in [9]. The paper [9] discusses a scalable implementation of ADMM (see [10], [11]) to solve the QP problem for a large number of the training data points. Figure 1 illustrates the model training logic. The model is computed from Input, the dataset (1). Quantile Grid refers to set of quantile levels {qj} nq j=1, where the quantile regression is computed; nq is the number of the levels in the grid. The ADMM Solver takes input data (1) and the quantile grid and outputs Quantile Regression Model described by the parameter set {β(qj), α(qj)} nq j=1. Fig. 1. Quantile regression solution logic. B. Large Response Variable The described smoothed model interpolates the data, where it is available. The distribution tails, i.e., the large absolute values of response variables y have to be modeled separately. The stochastic models for very low or very high quantiles can be extrapolated beyond the data range if their parametric form is known. Extreme Value Theory (EVT), predicts that in many cases the distribution tails, which describe the extreme events, follow a Pareto (power law) distribution. The tails can be estimated using peaks over threshold (POT) method. The application examples of Sections III and V, use log coordinates. Thus, the Pareto distribution becomes an exponential distribution. Consider the ﬁrst qL = q1 and the last qR = qnq quantile levels on the quantile modeling grid as the tail thresholds. The POT method exceedances are eL,j = yj − Zjβ1 − α1, j ∈ JL, (3) eR,k = yk − Zkβnq − αnq , k ∈ JR, (4) where JL ≡ {j : yj < Zjβ1 + α1} and JR ≡ {k : yk > Zkβnq + αnq }. We model the probability distributions of eL,j and eR,k as −eL,j ∼ qL · Exp(θL), eR,k ∼ qR · Exp(θR). (5) The parameters θL and θR are estimated as a part of the smoothed optimization formulation for the quantile model; see [9] for more detail. III. POWER LOAD MODEL EXAMPLE The motivating example for development of the proposed non-parametric approach is modeling of electrical power demand for a utility. The hourly load and price data from an anonymous US utility are described in [15]. The modeling methodology was applied to the total system load. The range of the loads is 11.544 to 33.222 GW, with the average value being 18.0166 GW. The data covers a time range from January 2011 to June 2013 with sampling interval of one hour, N = 21, 696 samples at all. Let Pt be the load demand. The data is sampled every hour and t is the number of hours elapsed since the start of the data collection. We use logarithmic load, normalized by P0 = 1 GW, as response variable yP,t yP,t = log (Pt/P0) . (6) We used 45 non-linear regressors Zt that depend on time, previous load values, and previous prices. The regressors that depend on time indicate which day of the week, month, and hour of the day it is, and whether it is a holiday. We use the log load and log price values from 24 hours ago for the effect of day ahead forecasting. More detail of the time related regressors can be found in [16]. 1350 1360 1370 1380 1390 1400 1410 1420 1430 1440 1450 14 15 16 17 18 19 20 21 22 TIME (HOURS)POWER LOAD DEMAND (GW) LOAD DEMAND AND FORECAST q=0.1 LOAD DEMAND (GW) q=0.5 LOAD DEMAND (GW) q=0.9 LOAD DEMAND (GW) LOAD DEMAND (GW) Fig. 2. Plot of quantile regression load forecast. Median regression, described by (2) with q = 1/2, is used to illustrate our model for forecasting of the power load data in Figure 2, over a period of 101 hours. This model can be expressed as yP,t = Ztβ(1/2) + α(1/2). We also plot other quantile forecasts of the power load distribution for q = 0.1 and q = 0.9. One can see that the median regression forecast matches the data reasonably well. We choose a uniform quantile grid spacing of 0.01 from q1 = 0.01 to qnq = 0.99. Figure 3 shows the PP (probablity- probablity) plot illustrating the accuracy of the data ﬁt for the developed model. The abscissa is quantile level q in the ﬁtted model (2), P(yt < ZtβP (q) + αP (q)) = q. The ordinate is the empirical quantile level estimated as the fraction of the data points in the set where the inequality yt < ZtβP (q) + αP (q) holds. The full description of the load model parameters is described in [9]. IV. PRICE MODEL EXAMPLE Dataset [15] described in Section III includes the spot price of the electricity. Let πt be the price at time t. The price ranges from $12.52 to $363.80, with average value being $48.51. It is sampled at an hourly rate, the same as the load. We model the logarithmic price yπ,t = log πt. In what follows, we consider the following two conditional quan- tile models πt(q|Zt) and πt(q|yP,t, Zt). The ﬁrst model πt(q|, Zt) has the same form as the load forecasting model in Section III. Similar to Figure 2, Figure 4 shows the quantile regression forecast of the electricity power prices for q = 0.1, 0.5, 0.9 along with the actual prices for a 100 hour interval. One can see that the price forecast matches the data reasonably well. 20 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 THEORETICAL QUANTILE LEVELEMPIRICAL QUANTILE LEVEL LOAD PROBABILITY−PROBABILITY PLOT QUANTILE REGRESSION MODEL PERFECT MODEL Fig. 3. PP plot for non-parametric distribution model ﬁt for the load data. 1.725 1.726 1.727 1.728 1.729 1.73 1.731 1.732 1.733 1.734 x 10 4 25 30 35 40 45 50 55 60 65 70 TIME (HOURS)PRICE ($) PRICE AND FORECAST q=0.1 FORECASTED PRICES q=0.5 FORECASTED PRICES q=0.9 FORECASTED PRICES PRICES Fig. 4. Plot of quantile regression price forecast. The second price model πt(q|yP,t, Zt) has the same form as the ﬁrst price model πt(q|Zt) with one extra regres- sor, yt, added. This model assumes that the actual load is known at forecast time. We need this conditional dis- tribution for the stochastic optimization described in Sec- tion V. We will show the extra regressor explicitly, assuming the model of the form (2) with the quantile regression hyperplane given by Ztβπ + yP,tγπ + απ. The model is estimated similar to (2) by optimizing over decision variables{ απ(qi), [ βπ(qi) T γπ(qi) ]T }nq i=1. Figure 5 shows the actual prices πt and the two median quantile models. As expected the model with the extra regressor ﬁts the actual prices better. 1000 1050 1100 1150 1200 1250 1300 30 40 50 60 70 80 90 100 110 TIME (HOURS)PRICE ($) PRICE AND MEDIAN FORECAST MODELS t(q=0.5|Z t) t(q=0.5|y t,Z t) t Fig. 5. Spot prices πt vs forecasts πt(q|yP,t, Zt) and πt(q|Zt) for q = 1 2 . We used the same quantile level range and nq quantiles as the power load models in Section III. The PP plot in Figure 6 illustrates the accuracy of the price data ﬁt for the estimated non-parametric distribution model. The plot is similar to Figure 3. The full description of the price model parameters is described in [9]. 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 THEORETICAL QUANTILE LEVELEMPIRICAL QUANTILE LEVEL PRICE PROBABILITY−PROBABILITY PLOT QUANTILE REGRESSION MODEL PERFECT MODEL Fig. 6. PP plot for non-parametric distribution model ﬁt for the price data. V. STOCHASTIC OPTIMIZATION OF DAY-AHEAD COST The utilities order power in the electricity market a day in advance. If the actual power load is higher, the utility has to buy additional electricity at much higher spot price. The goal of the stochastic optimization approach in this section is to minimize the total expected cost. The stochastic optimization relies on the models described in Sections III and IV. We consider stochastic optimization at given time t, when regressor Zt is known. The future (day-ahead) log-load yP,t is deﬁned by the conditional quantile model of the form (2) discussed in Section III. The future (day-ahead) log-prices yπ,t are deﬁned by the conditional quantile model of the form (2) discussed in Section IV. The stochastic optimization requires to estimate the ad- vance cost and the expected spot cost components of the total expected cost. These costs depend on the advance order Pa(t) = P0eyP,t, (7) where yP,t is the logarithmic load that can be related to the quantile model of Section III. One can always ﬁnd a quantile s such that in (7) yP,t = yP (s) for Section III model yP (s) =    yP (qL) + θ−1 P,L log s qL , s < qL Ztβ(s) + α(s), qL ≤ s ≤ qR yP (qR) − θ−1 P,R log 1−s qR , s > qR (8) The extra log terms for s < qL and s > qR come from the analytical quantile function (inverse CDF) of the exponential distribution assumed in Section II-B. The advance cost is the deterministic value πadv,tPa(t), where πadv,t is the advance price at time t. At(s) = πadv,tP0eyP,t(s), (9) The spot cost is the random variable deﬁned by the future load and spot price, in a day from the order. To compute the expected spot cost, we need the joint probability distribution over the log spot prices yπ and log load yP conditional on the regressors Zt, which we denote as p(yπ, yP |Zt). According to the conditional probability rule, p(yπ, yP |Zt) = p(yπ|yP , Zt) · p(yP |Zt). (10) 3 Similar to quantile model (8) for yP = yP (q), we can write a quantile model for yπ. In Subsection IV, the log price yπ is modeled through the conditional distribution p(yπ|yP , Zt). The conditional quantile model for yπ is then yπ(r, q) =    Ztβπ(r) + γπ(r)yP (q) + απ(r), rL ≤ r ≤ rR yπ(rL, q) + log(r/rL)/θπL, r < rL yπ(rR, q) − log((1 − r)/rR)/θπR, r > rR (11) where θπL and θπR are the estimated left and right tail rates of the price distributions. The quantile level gridding for r is the same as for q in Section III. The spot cost C(s) depends on the advance order Pa(t) = P0eyP,t(s) because the utility has to pay the spot price only when this order is exceeded. The spot cost expectation is Eyπ,yP [C(s)] = ∫ ∞ −∞ ∫ ∞ −∞ eyπ(r,q)P0 · (eyP (q) − eyP (s)) + p(yπ(r, q), yP (q))dyπ(r, q)dyP (q), (12) where the integrand is the spot cost times the excess demand. The joint pdf in (12) can be expressed in terms of quantile levels q and r by using (10), where in accordance with (2) p(yP |Zt) = dq/dyP (q), (13) p(yπ|yP , Zt) = dr/dyπ(r, q). (14) Changing the integration variables in (12) to r, q and using (13), (14) yields Eyπ,yP [C(s)] = P0 ∫ 1 s ∫ 1 0 eyπ(r,q) (eyP (q) − eyP (s)) drdq. (15) To compute integral (15), we substitute the expression (8) for yP (q) and (11) for yπ(r, q). Each of the expressions (15), (8) breaks into three parts: the numerical model for the middle part of the distribution and two analytical models for the inverse CDFs of the tails. Their product in (15) yields the following 3 × 3 matrix of the partial integrals to be evaluated B(s) = P0   BL,L(s) BL,M (s) BL,R(s) BM,L(s) BM,M (s) BM,R(s) BR,L(s) BR,M (s) BR,R(s)   , (16) where the subscripts L, M , and R indicate the left tail, the middle part, and the right tail respectively. The subscript combination describes an integration rectangle in the area of the integration in (15). The expected spot cost Eyπ,yL [C(s)] (15) is the sum of the nine matrix entries in (16). The logic of evaluating (15) using (16) is outlined in Figure 7. The input is the desired quantile level s at which Fig. 7. Logic of evaluating expected spot cost (15) using (16). the expected spot cost is evaluated. The two models yP (q) (8), yπ(r, q) (11) are used to compute each matrix element of B(s). The expected spot cost follows after this computation. The partial integrals in (16) can be computed as follows BL,L(s) = CLGL(s, fL(s), γπ(rL)), (17) BL/R,M (s) = ∫ rR rL eZtβπ(r)+απ(r) × GL/R(s, fL/R(s), γπ(r))dr, (18) BL,R(s) = CRGL(s, fL(s), γπ(rR)), (19) BM,L/R(s, s ′) = CL/R ∫ qR fM (s) (e(1+γπ(rL/R))yP (q) −eyP (s)+γπ(rL/R)yP (q)) dq, (20) BM,M (s) = ∫ qR fM (s) ∫ rR rL eyπ(r|q) (eyP (q) − eyP (s)) drdq, (21) BR,L(s) = CLGR(s, fR(s), γπ(rL)), (22) BR,R(s) = CRGR(s, fR(s), γπ(rR)), (23) where the index L/R means that the expression is valid for either index L or R. The integrals in (20)–(21) are evaluated numerically for given s using the smoothed non-parametric models described above. The integrals involving the tails have been evaluated analytically. For the right tail integral to converge, the tail parameters must satisfy θπ,R > 1 and θP,R > maxr{γπ(r)}. For the example dataset, these tail parameters were θP,L = 39.2248, θP,R = 31.7821, θπ,L = 6.9101, and θπ,R = 7.2108. The left tail integrals exist for any s > 0. Formulas (17)–(23) include several interim expressions described below. The function GL/R(·, ·, ·) is computed as GL/R(s, s ′, γ) = FL/R(s ′, 1+γ)−e yL(s)FL/R(s ′, γ), (24) FL(s, γ) = ∫ qL s eγyL(q)dq = q−γ/θP,L L eγyP (qL)θP,L γ + θP,L [q(γ+θP,L)/θP,L L − s (γ+θP,L)/θP,L] , FR(s, γ) = ∫ 1 s eγyP (q)dq = qγ/θP,R R eγyP (qR) θP,R θP,R − γ (1 − s) (θP,R−γ)/θP,R . The constants CL and CR in (17)–(23) are CR = eZtβπ(rR)+απ(rR) θπ,Rr1/θπ,R R θπ,R − 1 (1 − rR) θπ,R −1 θπ,R , CL = eZtβπ(rL)+απ(rL)θπ,LrL/(θπ,L + 1). The saturation functions in (17)–(23) are fL(s) = min(s, qL), (25) fR(s) = max(s, qR), (26) fM (s) = min(max(s, qL)), qR). (27) 4 The total cost T (s) can be computed from (9) and (15) as T (s) = A(s) + E[C(s)] (28) Based on (9), advance cost A(s) is a non-decreasing function of s. Based on (15), the expected spot cost E[C(s)] is a non-increasing positive function of s. The optimal trade-off between the advance cost and the spot cost that minimizes the total cost for some s can be found numerically by computing T (s) (28) on a grid of s ∈ (0, 1). VI. COST OPTIMIZATION EXAMPLE The non-parametric models for the load and price were trained on the utility data set as described in Sections III and IV. The stochastic optimization algorithm was then backtested on the last 6 months of the data, which were excluded from the model training. The constant advance price πadv,t = $50/MWh was assumed. At each step, the optimal quantile level s∗ was found by computing total cost T (s) (28) on a grid of s using formulas (17)–(23). A time series segment for the computed optimal quantile level s∗(t) is shown in Figure 8, where the lowest value is s∗ = 0.001. 3720 3740 3760 3780 3800 3820 3840 3860 3880 3900 0 0.1 0.2 0.3 0.4 0.5 0.6 TIME (HOURS) OPTIMAL QUANTILE LEVEL OPTIMAL QUANTILE LEVEL MEDIAN QUANTILE LEVEL Fig. 8. Optimal quantile level sequence sample. Figure 9 shows the actual realization of the total cost in backtesting of the advance procurement strategy that uses the optimized s = s∗ in (7), (8). The results from May 25, 2013 to June 2, 2013 are shown. The described optimized procurement based on the smoothed quantile regression (QR) model was compared to the baseline strategy based on the ordinary least squares (OLS) regression. The baseline model used the same regressors. The OLS regression parameters were estimated from the same data as the QR model. The baseline procurement strategy used the linear regression forecast of the log-load in (7). Figure 9 also includes the median regression strategy that used s = 0.5 in (7), (8). In 3720 3740 3760 3780 3800 3820 3840 3860 3880 3900 600 800 1000 1200 1400 1600 1800 TIME (HOURS) TOTAL COST ($/1000) MODEL COMPARISON OLS MEDIAN SMOOTHED QR Fig. 9. The hourly total cost over a sample 200 hour period Figure 9, when the smoothed QR strategy has a lower total cost than the baseline, it is by a signiﬁcant amount; when cost is higher than OLS, it is by a much smaller amount. The total cost for the 6 month period for each strategy is summarized in Table I. The total savings of the optimized strategy based on the smoothed QR model are $85.666 mil- lion compared to the OLS baseline. The median regression strategy saves $11.203 million, it is much closer to the OLS. TABLE I COST RESULTS ($/BILLION) Strategy/Model Smoothed QR Median OLS Total 6-Month Cost 3.83 3.91 3.92 Percentage Savings 2.19% 0.29% 0% REFERENCES [1] C. Abbey and G. Jo´os, “A stochastic optimization approach to rat- ing of energy storage systems in wind-diesel isolated grids,” IEEE Transactions on Power Systems, vol. 24, no. 1, pp. 418–426, 2009. [2] J. Garcia-Gonzalez, R. R. de la Muela, L. M. Santos, and A. M. Gonz´alez, “Stochastic joint optimization of wind generation and pumped-storage units in an electricity market,” IEEE Transactions on Power Systems, vol. 23, no. 2, pp. 460–468, 2008. [3] S. Wong and J. D. Fuller, “Pricing energy and reserves using stochastic optimization in an alternative electricity market,” IEEE Transactions on Power Systems, vol. 22, no. 2, pp. 631–638, 2007. [4] S. Sen, L. Yu, and T. Genc, “A stochastic programming approach to power portfolio optimization,” Operations Research, vol. 54, no. 1, pp. 55–72, 2006. [5] R. Bjorgan, C.-C. Liu, and J. Lawarree, “Financial risk management in a competitive electricity market,” IEEE Transactions on Power Systems, vol. 14, no. 4, pp. 1285–1291, 1999. [6] A. J. Conejo, F. J. Nogales, J. M. Arroyo, and R. Garc´ıa-Bertrand, “Risk-constrained self-scheduling of a thermal power producer,” IEEE Transactions on Power Systems, vol. 19, no. 3, pp. 1569–1574, 2004. [7] E. Tanlapco, J. Lawarr´ee, and C.-C. Liu, “Hedging with futures contracts in a deregulated electricity industry,” IEEE Transactions on Power Systems, vol. 17, no. 3, pp. 577–582, 2002. [8] R. Koenker, Quantile regression. No. 38, Cambridge university press, 2005. [9] S. Shenoy, D. Gorinevsky, and S. Boyd, “Non-parametric regression modeling for stochastic optimization of power market forecast,” in American Control Conference, (Chicago, IL), July 2015. [10] S. Boyd, N. Parikh, E. Chu, B. Peleato, and J. Eckstein, “Distributed optimization and statistical learning via the alternating direction method of multipliers,” Foundations and Trends in Machine Learning, vol. 3, no. 1, pp. 1–122, 2011. [11] N. Parikh and S. Boyd, “Block splitting for distributed optimization,” Mathematical Programming Computation, vol. 6, no. 1, pp. 77–102, 2014. [12] H. J. Wang, D. Li, and X. He, “Estimation of high conditional quantiles for heavy-tailed distributions,” Journal of the American Statistical Association, vol. 107, no. 500, pp. 1453–1464, 2012. [13] L. Qian, L. Yongli, and W. Chong, “The risk linkage effects of stock indexes based on quantile regression and granger causality test,” in 25th Chinese Control and Decision Conference (CCDC), pp. 4252– 4257, May 2013. [14] H. A. Nielsen, H. Madsen, and T. S. Nielsen, “Using quantile regression to extend an existing wind power forecasting system with probabilistic forecasts,” Wind Energy, vol. 9, no. 1-2, pp. 95–108, 2006. [15] Crowdanalytix.com, “Global energy forecasting competition 2014 probabilistic electricity price forecasting.” Avail- able: https://crowdanalytix.com/contests/ global-energy-forecasting-competition-2014 -probabilistic-electricity-price-forecasting#. [16] S. Shenoy and D. Gorinevsky, “Risk adjusted forecasting of electric power load,” in American Control Conference (ACC), pp. 914–919, IEEE, 2014. 5","libVersion":"0.3.2","langs":""}