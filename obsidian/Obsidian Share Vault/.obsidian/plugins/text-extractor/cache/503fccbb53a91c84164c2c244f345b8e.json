{"path":"lit/lit_sources/Martin17intrdyMktThesis.pdf","text":"Master’s Thesis A Limit Order Book Model for the German Intraday Electricity Market Ein Limit Order Buch basiertes Modell für den deutschen Intradaymarkt für Strom written by Henry Martin henrymartin@gmx.de Matr. Nr. 03618753 submitted at Chair of Energy Economy and Application Technology Technical University Munich to Prof. Dr.-Ing. Ulrich Wagner in cooperation with Fraunhofer Institute for Wind Energy and Energy System Technology (IWES) Supervisor: Prof. Dr.-Ing. Ulrich Wagner Dr. Scott Otterson (IWES) Final Submission: 11.05.2017 Abstract The importance of the German intraday electricity market increased signiﬁcantly over the past years, however there is limited research about intraday market models in Germany. In this thesis we examine the possibility of applying limit order book market models designed for stock markets to the German intraday electricity market. We ﬁnd that the general approach may be suitable for modeling characteristics like liquidity, but that the speciﬁc models are a poor ﬁt. Therefore we propose new models that are tailored to our application. We proceed by preparing the EPEX SPOT M7 order ﬂow data, a data set containing all orders submitted to the German intraday electricity market. We present prepro- cessing steps and decision rules necessary to infer the identity of individual orders, information that is not directly available. Based on these rules, we implement a historical market simulator that reconstructs the complete state of the market for every point in time. The historic market simulator itself can be used as a simple, limit order book based market model. It allows modeling the inﬂuence of trade size and trading time on the available market price. Thus, this model can, when limited to small trade sizes, represent important dimensions of liquidity. We ﬁnd that the historical EPEX SPOT order ﬂow simulator can reproduce independent transaction records with a near-exact accuracy. The order ﬂow is then used to create a stochastic market model. First, we introduce a horizon dependent power law model for the order submission intensity, which provides a very good ﬁt to empirical data. We show that trading size is strongly clustered around integers, and propose a mixture model that can reproduce the preference of traders for rounded values. Order cancellation arrival intensity is indirectly modeled by a distribution of order lifetimes. We show that order lifetime does not follow the exponential distribution used for stock markets so we instead model it using a log-logistic model. Finally, we simulate the market model for the last two hours of trading for one month of unseen test data. For most of the variables, the simulated outcome matches the time independent distributions of the empirical data. The ﬁt is especially close for the order arrival rate, order prices, the mid-price, the price at the best ask and the price of the best bid.LehrstuhlfürEnergiewirtschaftundAnwendungstechnikFakultätfürElektrotechnikundlnformationstechnikTechnischeUniversitätMünchenAufgabenstellungMastersThesisvonHerrnMARTINHenryMatr.-Nr.03618753ALimitOrderBookModelfortheGermanlntradayElectricityMarketEinLimitOrderBuchbasiertesModellfürdendeutschenlntradaymarktfürStromBackground:Powergenerationfromrenewableenergysources(RES)issoldattheday-aheadmarketbasedonforecasts.Theseforecasts,generatedthedaybeforedelivery,incorporateaforecasterrorwhichdecreaseswithshorterforecasthorizons.Theincreasinglyaccurateshorttermforecastsareusedtotradeontheintradaymarket,correctingtheday-aheadseilingerrors,andthusavoidingtheuseofexpensiveandsecurityrelevantbalancingpower.Thecontinuousintradaymarketofferstradersmanydegreesoffreedomfortheirtradingdecisions—whentheytradehowmuchpower.Thesetofrulesbehindthetradingdecisionscanbereferredtoastradingstrategyortradingalgorithms.lntradaytradingaigorithmsarenotonlyusedforthecorrectionofdayaheadtradingerrorsbutalsotorthecontrolofflexiblegeneration,storageanddemandtooptimizeprofitviaarbitrageandpeak-shifting.Withhigherpercentagesofintermiftentenergysourcesintheenergysystem,morepowerhastobetradedontheintradaymarket,andintradaytradingstrategiesarebecomingmoreimportant.State-of-the-artintradaypowertradingstrategiesarebasedondeterministicforecastsandcancauseunnecessarycostsfromdoubletrading,orbecauseabettetpricewouldhavebeenavailablewithinthenexthours.TheseproblemsareapproachedbytheEWeLINEProject1,ajointprojectbetweenthreeGermanTSOs2,theDeutscherWetterdienstandtheFraunhoferIWES3.Inthisproject,FraunhoferIWEShaspresentednewtradingaIgorithms.Theperformanceoftradingalgorithmscanbeevaluatedbysimulatingtheirinteractionwithamarketmodel.WhiIethenewdevelopedtradingalgorithmsshowedpotentialtolowerintradaytradingcosts,areliablevalidationwasdifficuit,especiaIlybecausetheavailablemarketmodelslacktheabilitytorepresentliquidity,whichcanbedescribedastheabiiitytobuyorseilpowerwithoutinfluencingthemarketprice4.1http://www.projekt-eweiine.de/en/index.html2AmprionGmbH,TennelTSOGmbH,50HertzTransmissionGmbHInstituteforWindEnergyandEnergySystemTechnologyHagemann,Simon,andChristophWeber.“AnempiricalanalysisofiiquidityanditsdeterminantsintheGermanintradaymarketforeiectricity.“(2013).LehrstuhlfürEnergiewirtschaftundAnwendungstechnikFakultätfürElektrotechnikundInformationstechnikTechnischeUniversitätMünchenTasks:TV11ThismasterthesiswillbeembeddedintheEWeLINEprojectandwillworkonmorereliablepossibilitiestoevaluatetradingalgorithms.•Tovalidatethealgorithm,adatasetincludingallGermanEPEXSPOTtransactionswaspurchasedfromEPEXSPOT.Thisdatawillbereviewedwithafocusonhowilliquidityshowsinthedataandhowitcanbeincludedinthemarketmodel.Inordertofindamoreaccuratemarketmodel,state-of-the-artmarketmodelswillbereviewedandcomparedwithregatdtotheirabilitytorepresenttheGermanintradaymarket.Asuitablemodelwillthenbeimplementedandfinally,reliablewaystoevaluatethegoodnessofamarketmodelwillbereviewedandapplied.Betreuer:Prof.Dr.-Ing.UlrichWagnerTel.:089-28928301Ausgabedatum:29.08.20169JAufgabensteller:Prof.Dr.-Ing.Wagner Erklärung Hiermit erkläre ich, Name: Martin Vorname: Henry Matr. Nr.: 03618753 dass ich die beiliegende Master’s Thesis zum Thema: A Limit Order Book Model for the German Intraday Electricity Market selbständig verfasst, keine anderen als die angegebenen Quellen und Hilfsmittel benutzt habe, sowie alle wörtlichen und sinngemäß übernommenen Stellen in der Arbeit gekennzeichnet und die entsprechende Quelle angegeben habe. Vom Lehrstuhl und seinen Mitarbeitern zur Verfügung gestellte Hilfsmittel, wie Mod- elle oder Programme, sind ebenfalls angegeben. Diese Hilfsmittel sind Eigentum des Lehrstuhls bzw. des jeweiligen Mitarbeiters. Ich werde sie nicht über die vorliegende Arbeit hinaus weiter verwenden oder an Dritte weitergeben. Einer weiteren Nutzung dieser Arbeit und deren Ergebnisse (auch Programme und Methoden) zu Zwecken der Forschung und Lehre, stimme ich zu. Ich habe diese Arbeit noch nicht zum Erwerb eines anderen Leistungsnachweises eingereicht. München, 11.05.2017 ................................................... Bearbeiter: Henry Martin Für Europa Contents 1 Introduction 1 2 Background 8 2.1 Probability Theory . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8 2.2 Bayesian probabilities . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 2.3 Power Trading in Germany . . . . . . . . . . . . . . . . . . . . . . . . 14 2.4 The German Electricity Intraday market . . . . . . . . . . . . . . . . 19 2.5 Economic Theory . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24 3 Literature Review 29 3.1 Electricity Spot Market Modeling . . . . . . . . . . . . . . . . . . . . 29 3.2 Limit Order Book Modeling . . . . . . . . . . . . . . . . . . . . . . . 34 4 Data and Data Preparation 35 4.1 EPEX SPOT Intraday Transaction Data . . . . . . . . . . . . . . . . 35 4.2 EPEX SPOT Limit Order Book Data . . . . . . . . . . . . . . . . . . 37 5 Historic Intraday Market Simulator 39 5.1 Framework Conditions . . . . . . . . . . . . . . . . . . . . . . . . . . 39 5.2 Implementation and Simulation . . . . . . . . . . . . . . . . . . . . . 43 5.3 Validation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45 5.4 Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49 6 A Stochastic Model of the Intraday Market 50 6.1 The Market Model . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50 6.2 Modeling of Order Flow Intensities . . . . . . . . . . . . . . . . . . . 51 6.3 Cancellation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63 6.4 Market simulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69 6.5 Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73 7 Conclusion and Future Work 80 i A 82 A.1 M7 Order Book Data description . . . . . . . . . . . . . . . . . . . . 83 A.2 Order volume model . . . . . . . . . . . . . . . . . . . . . . . . . . . 84 A.3 Market State Variables . . . . . . . . . . . . . . . . . . . . . . . . . . 85 List of Figures 88 Bibliography 90 i Chapter 1 Introduction One of the key advantages of the usage of electricity is its simplicity. We are used to plugging in any electric device at any time or switch on a light whenever we want without wondering how it is possible that there is always the right amount of electricity available. The complexity that is necessary to oﬀer such freedom to individuals is well hidden beyond the power socket. Electricity system is an umbrella term for all entities and actions that are necessary to supply private and business consumers with the electricity they need. A special challenge of electricity systems is that, in order to ensure their stability, electricity generation and consumption must be equal at every moment in time. This challenge is particularly tricky because storing electricity electricity in amount comparable to total power system use is challenging and because most power plants can adapt their output only slowly, so that the total generation has to be carefully planned in advance. The German Electricity System The German electricity system is divided into three diﬀerent sectors: Generation, transmission and retail. In a simpliﬁed example, the three sectors are run by three independent companies. Private costumers and small businesses make a contract with the retail company, which purchases the required energy from the generation company; the transport company ensures the safe operation of the transmission grid. In reality, there are many companies active in the three sectors competing with one another. An exception is the transmission sector, where transmission system operators (TSOs) - governmental controlled geographic monopolies - are responsible for the stability of the grid, and must guarantee non-discriminatory access to the grid for utilities. Physical and Financial Flows In the electricity system, physical power ﬂows are generally independent of ﬁnancial cash ﬂows. The reason is that it is not possible to control individual power ﬂows in a well interconnected transmission grid; power ﬂows follow, much like water, along the path of the least resistance. It is therefore common to think of two diﬀerent 1 CHAPTER 1. INTRODUCTION paths connecting generation and consumption: A physical path and a ﬁnancial path. The physical path is relatively straight - the path of the least resistance - while the ﬁnancial path is independent of the physical grid. In most European countries, utilities are free to trade electricity without considering transmission restrictions as long as they trade within the same market area. Germany is wholly contained in one market area together with Austria and Luxembourg. This means that it is possible, that a retail company with most of its customers in the south of Germany and Austria purchases its power at the energy exchange from a generator in the north of Germany because it had the best oﬀer at the time. Yet physically, the power for the customers in the south of Germany is likely to be provided by a power plant in the south of Germany which may have sold its power to somebody else. Diﬀerent Energy Exchanges for Diﬀerent Horizons There are several diﬀerent possibilities for utilities to trade power on a whole-sale level in Germany. Utilities can trade directly with each other, which is called over the counter trading (OTC). They can also trade at one of the two power exchanges. The European Energy Exchange (EEX) organizes the derivatives market, where power can be traded up to six years in advance until several days before delivery and the European Power Exchange (EPEX SPOT) which organizes the spot market. There are several possibilities to trade power at the spot market. The day before delivery, power can be traded at the day-ahead auction and the intraday auction. At the day of delivery, power can be traded at the continuous intraday market up to 30 minutes before delivery. Balancing Power One of the most important tasks is maintaining the stability of the transmission system is for the TSOs to ensure that generation and consumption are in balance at all times. To enable the TSOs to do so, all utilities have to report their power schedules: When and how they plan to consume or generate a speciﬁc amount of power. Even though the schedule is monitored by the TSOs, the balance can be at risk if unexpected events occur. This can be a unplanned power plant outage or an error in the demand or generation forecast. To prevent the imminent danger of a blackout, the TSOs provision balancing power. Balancing power is the capacity to quickly increase or lower the reserve power generation which is on call in case of unexpected events. It is usually provided by ﬂexible generators like gas power plants, pumped-storage hydroelectricity, or by ﬂexible industrial process that can be stopped in order to reduce the demand for power. Parties responsible for the necessity of its usage will be charged for the amount their error. The price for balancing energy in Germany is called ReBap 1 and is designed to cover the costs for the provision of balancing power and as an incentive for utilities not to deviate from their original schedule. The ReBap is considered to be expensive, hard to predict and extremely 1Regelzonenübergreifender einheitlicher Ausgleichsenergiepreis 2 CHAPTER 1. INTRODUCTION volatile. This can be seen in Figure 1.1, were intraday market prices are compared to the ReBap. -6000 -4000 -2000 0 2000 4000 6000 Price (EUR/MWh) 100 105 1010Count Intraday Avg. Price Frequency: =32.2238, =18.5708 -6000 -4000 -2000 0 2000 4000 6000 Price (EUR/MWh) 100 105Count Balance Price Frequency: =24.8796, =147.293 Figure 1.1: Comparison of the distribution of balancing prices and individual intraday transaction prices. µ and σ are the average and standard deviation in EUR\\MWh The Impact of the Energy Transition on Generation Requirements At present, Germany is in the process of shifting its energy consumption from nuclear and fossil sources towards renewable energy. With rising share of volatile energy generation, the need for ﬂexible power generation and consumption rises. Figure 1.2 shows how a higher infeed of renewable energy sources like wind and solar requires other generation to ramp up and down faster and with higher amplitude than before. The other generation can merely be conventional power plants. While gas power plants are ﬂexible, they are also very expensive and other conventional power generation, like nuclear or coal generation, are typically too limited in their ability to change their power output quickly. In order to ﬁll the demand for ﬂexible energy generation and consumption, new technologies which can store electricity or generate power more ﬂexible when needed, are under research. The need for ﬂexibility in the energy system is also reﬂected by the electricity price. Following the law of supply and 3 CHAPTER 1. INTRODUCTION demand, electricity prices are low when the sun shines and the wind blows and they rise when little renewable generation is available. Figure 1.2: Power generation from diﬀerent sources for a week in a scenario with intermediate and with high shares of volatile power generation. Figure from www. energytransition.de The Impact of the Energy Transition on Power Trading The power exchanges oﬀer ﬂexible energy systems many degrees of freedom for power trading. Within their technical limits, generation owners can decide when exactly they want to buy or sell a speciﬁc amount of power. These decisions are mainly aﬀected by the current price and the expected future price. These decisions have a large inﬂuence whether the system will be proﬁtable in the end. The set of rules by which owners choose to make these decisions is called a \"trading strategy\" or, if it is done automatically, \"trading algorithm\". The power trading strategy of a utility company usually ranges from several years until only some minutes before the physical power delivery time. For ﬂexible energy systems it is mainly the short term trading, which starts which the day before delivery, that is interesting, because of the higher price volatility, see Figure 1.1. With the rising penetration of renewable energy sources in the energy system, power trading has changed. In the past, power trading strategies were very straightforward. In contrast to wind and solar based generation, conventional power plants are con- trollable by its owner. In the case of wind farms and solar parks, the owner has to 4 CHAPTER 1. INTRODUCTION forecast the generation he can sell on the market. Much like weather forecasts, re- newable energy generation forecasts get more precise with decreasing forecast horizon. Figure 1.3 shows the relation of forecast error over time. It declines constantly until about eight hours before delivery, when it starts to drop. The forecast error decreases by 50% in the last ﬁve hours before delivery. This relation creates a dilemma for power traders. They want to trade the power early on the day-ahead market to beneﬁt from its stable and predictable price, in contrast to that, it is also beneﬁcial to trade as late as possible to take advantage from the most recent power generation forecasts. The usual approach is to sell the expected power generation at the day ahead market and to correct the trading error on the intraday market using the updated forecasts. The possibility of correcting trading and forecasting errors until 30 minutes before market closure makes the intraday market very important for the successful inte- gration of renewable energy sources. Thus, with the ongoing installation of new renewable energy generation, the power volume traded on the intraday market rises as well. Figure 1.4 shows that the volume of the short-term markets for electricity, day-ahead and intraday rose over the last years. In between 2009 and 2015, the volume of the intraday market rose over 600% , continuing to rise from 2014 to 2015, when the day-ahead markets were stagnating (Bundesnetzagentur, 2016). Added Value and Thesis Organization With the increasing importance of the intraday market, well performing intraday trading algorithms become also more important. The performance of intraday trad- ing algorithms can be tested by simulating their interaction with a model of the intraday market. The reliability of the simulated results depends on the goodness of the market model, which is its ability to represent the real intraday market for power. Since the importance of the intraday market is rather recent, and because the intraday market mechanism is rather complex compared to the day-ahead market, there is a lack of reliable models of the German intraday electricity market. To ﬁll this gap, this thesis proposes two market models for the German electricity intraday market. The ﬁrst model uses the EPEX SPOT M7 order ﬂow data set, which contains all orders submitted at the continuous intraday market, to re-simulate the historic course of the intraday electricity market over time and is called \"historic simulator\". This is the ﬁrst time, that the historic state of the German intraday electricity market has been reconstructed in such detail, and this thesis provides detailed instructions on how to interpret the EPEX SPOT M7 order book data in order to do so. The result is a fully functional and validated model for the German intraday electricity market with the ability to model the trading time and volume dependency of electricity prices. The second market model applies state-of-the-art market stochastic models used for 5 CHAPTER 1. INTRODUCTION Figure 1.3: Wind power forecast error by forecast horizon for Germany. The Figure shows two error metrics, the root means squared error (RMSE) and the conditional ranked probability score (CRPS). CRPS is a scalar performance measure for probabilistic forecasts that like RMSE, is smaller for more accurate forecasts. The Figure was created by Fraunhofer IWES with data from 2013-2014 Figure 1.4: Development of yearly spotmarket volumes for the German/Austrian delivery zone from 2009 to 2015 from (Bundesnetzagentur, 2016). 6 CHAPTER 1. INTRODUCTION ﬁnancial markets to the German electricity intraday market to model the inﬂuence of trading decisions on the market and is called \"stochastic model\". Therefore, order submissions and cancellations are modeled using stochastic processes with conditional intensities and stationary probability distributions. State of the art market models turn out to be poor ﬁts to the German Spot market. Therefore, we develop new statistical approaches which are much more accurate. Strengths and weaknesses of the model are discussed and possible improvements are proposed. Chapter 2 of this thesis starts with an outline of the necessary background knowledge in probability theory, probabilistic modeling, economics and power markets. A focus of this chapter lies on the price building process at the short-term power markets and the limit order book, which organizes the price building process at the intraday market. Chapter 3 reviews in depth how market models were used in recent publications in the ﬁeld of energy systems. A focus lies on the usage of market models to benchmark the proﬁtability of energy systems with ﬂexible power generation or consumption. Commonly made assumptions are reviewed with regards to their validity on the German intraday electricity market. The end of this chapter brieﬂy reviews the state-of-the-art of modeling markets of limit order book markets in quantitative ﬁnance. Chapter 4 introduces the two data sets used in this thesis. It highlights the advantage of the EPEX SPOT transaction data set over freely available, summarized intraday market data but also comments on its limits and shortcomings. Afterwards the EPEX SPOT M7 order ﬂow data set and its additional value for market modeling are presented. Chapter 5 introduces the historic simulator which is used for the creation of the enriched order ﬂow used in the following chapter. The chapter describes the im- plementation of the historic simulator and its validation using the EPEX SPOT transaction data set. A focus lies on the correct interpretation of the order ﬂow. In Chapter 6 the results of the historic market simulation are used to implement a recently published stochastic model for stock markets. The diﬀerent modeling steps for the order submission and cancellation process are explained and the model is validated by simulating the market and comparing the results to the historic outcome. Finally Chapter 7 summarizes the work and gives an outlook on possible future steps for intraday market modeling. 7 Chapter 2 Background 2.1 Probability Theory 2.1.1 Fundamentals Probability Space The propability of events can be measured on a probability space. (Hajek, 2015) deﬁnes a probability space as the triplet (Ω, F, P) where Ω is the sample space, a non empty set. Each of its elements ω is called an outcome. F is a set of subsets of Ω called events. P is the assignment of probabilities to events. Let F be a σ-algebra, which means that F fulﬁlls the following requirements: A 1. F ∈ Ω A 2. If A ∈ F, then ¯A ∈ F A 3. If A, B ∈ F then A ∪ B ∈ F. Also, if A1, A2, . . . is a sequence of elements in F then ∪∞ i=1 Ai ∈ F The probability measure P has to fulﬁll the following requirements: (Hajek, 2015, P. 1) A 4. P(A) ≤ 1∀A ∈ F A 5. If A1, A2, . . . is a sequence of mutually exclusive events in F then P(∩ ∞ i=1Ai) =∑∞ i=1 P(Ai). A 6. P(Ω) = 1 Random Variables A random variable is deﬁned as a function X from Ω to R that is F measurable on the probability space (Ω, F, P) such that for any number c ∈ R and any events ω ∈ Ω (Hajek, 2015) {ω | X(ω) ≤ c ∈ F} 8 CHAPTER 2. BACKGROUND which will be shortened to {X(ω) ≤ c ∈ F} A random variable X is said to be a discrete random variable if there exist distinct real numbers xi, i ∈ 1, 2, ...I such that I∑ i=1 P(X = xi) = 1. (2.1) If X is a continuous, integrable random variable with density f , then F (x) = P(X ≤ x) = ∫ x −∞ f (t)dt. (2.2) (Gubner, 2006) Cumulative Distribution Function The cumulative distribution function (CDF) of a real random variable X is deﬁned as FX(x) = P(X ≤ x) (2.3) and describes the probability that X does not exceed x. The CDF fulﬁlls the following properties (Grimmett and Stirzaker, 2001): lim x→−∞ F (x) = 0, lim x→+∞ F (x) = 1, (2.4) if x < y then F (x) ≤ F (y), (2.5) F is right-continous, that is, F (x + h) → F (x) as h ↓ 0. (2.6) Probability Mass Function The probability mass function (pmf) of a discrete random variable X is denoted pX and is deﬁned by pX(x) = P {X = x} (2.7) the pmf and CDF of a discrete random variable are related by FX(x) = ∑ y:y≤x pX(y). (2.8) (Hajek, 2015) 9 CHAPTER 2. BACKGROUND Probability Density Function If X is a continuous random variable, then the CDF is the function of a function fX(x) such that: FX(x) = ∫ x −∞ fX(y)dy (2.9) The function fX(x) is called probability density function (pdf) (Hajek, 2015). If A is any Borel subset of R, then P(X ∈ A) = ∫ A fX(x)dx (2.10) Expectation The expectation or mean of a continuous random variable X on the probability space (Ω, F, P) is deﬁned by (Hajek, 2015) as E[X] = ∫ Ω X(ω)P(dω) (2.11) Let X be a discrete random variable, if {x1, . . . , xm} is a ﬁnite set and X(ω) ∈ {x1, . . . , xm} ∀ ω, then the expectation of X is deﬁned as E[X] = m∑ i=1 xiP{X = xi} (2.12) Variance The variance of a random variable X on the probability space (Ω, F, P) is deﬁned by (Hajek, 2015) as Var(X) = E[(X − E[X]) 2]. (2.13) (2.14) If E[X] is ﬁnite, the following is true: Var(X) = E[X2 − 2X E[X] + E[X]2] (2.15) = E[X2] − E[X] 2 (2.16) 10 CHAPTER 2. BACKGROUND 2.1.2 Important Probability Distributions Uniform distribution If X is uniformly distributed between a and b we write X ∼ U (a, b). pdf : f (x) = { 1 b−a a ≤ x ≤ b 0 else E[X] = a + b 2 , Var(X) = (b − a) 2 12 Normal distribution If X is normally distributed with mean µ and standard deviation σ, we write X ∼ N(µ, σ2). pdf(if σ2 > 0) : f (x) = 1 √ 2πσ2 exp ( −(x − µ) 2 2σ2 ) E[X] = µ, Var(X) = σ2 Log-normal distribution A positive random variable Y follows a log-normal distribution if ln(Y) ∼ N(µ, σ2) (Gubner, 2006, P. 191) pdf : f (x) = 1 x · √2πσ2 exp ( −(ln(x) − µ) 2 2σ2 ) , y > 0 E[X] = exp ( µ + σ2 2 ) , Var(X) = exp (2µ + σ2) (exp (σ2) − 1 ) Exponential distribution If X is exponentially distributed with the parameter λ, we write X ∼ exp(λ). pdf : f (x) = λe −λx E[X] = 1 λ, Var(X) = 1 λ2 11 CHAPTER 2. BACKGROUND Poisson distribution If a discrete random variable follows a Poisson distribution, then pmf: p(i) = λie−λ i! , i ≥ 0 (2.17) E[X] = λ, Var(X) = λ (2.18) 2.1.3 Poisson Point Process A random process is an indexed collection X = (Xt : t ∈ T) of random variables, all on the same probability space (Ω, F, P). Let T be an interval of R that describes a set of times, then X is called a continuous-time random process(Hajek, 2015). In section 2.1.1 a random variable was deﬁned as a function that relates any outcome ω of Ω to R. (Gubner, 2006, P. 383) deﬁnes two diﬀerent interpretations of the random process X = (Xt : t ∈ T): • For a ﬁxed t, Xt is a random variable • For a ﬁxed ω, Xt(ω) is a function of t and called a realization or sample path of X. (Hajek, 2015, P. 118) deﬁnes a counting function as a function f on R+ that fulﬁlls the following requirements: f (0) = 0 f is nondecreasing f is right continuous f is integer valued The value of a counting function f (t) is the number of increments in the interval (0, t]. (Hajek, 2015) deﬁnes a counting process as a random process where the probability that any sample path is a counting function is one. The Poisson process is a special counting process with Poisson distributed inter arrival times. (Hajek, 2015) deﬁnes a Poisson process as follows: A Poisson process with rate λ ≥ 0 is a random process X = (Xt : t ≥ 0) such that X is a counting process X has independent increments For t ≥ s, X(t) − X(s) is poisson distributed with λ(t − s) 12 CHAPTER 2. BACKGROUND 2.2 Bayesian probabilities Probabilities are usually viewed as frequencies of random events. The Bayesian interpretation of probabilities on the other hand, is the interpretation \"in which probabilities provide a quantiﬁcation of uncertainty (Bishop, 2007, Page 21). Some important deﬁnitions are needed for this view of probabilities. The conditional probability of an event A with knowledge about the realization of the event B is deﬁned as: P(A|B) = P(A ∩ B) P(B) (2.19) Given a random variable X(θ) following an assumed known distribution with unknown distribution parameters θ, then the probability distribution of X generated with the parameters θ is denoted as p(θ). Let x = x1, x2, ..., xn be a vector of observations of X, then the following probabilities can be deﬁned: • Without knowledge about any realization xi, p(θ) is called the prior proba- bility or prior. It describes the probability distribution given the parameters θ. • The uncertainty of the distribution parameters θ given the observation xi is described by the posterior probability p(θ|xi). • The uncertainty that the observation xi was generated by the distribution with the parameters θ is described by the likelihood P(xi|θ). In data science, it is a common problem that a vector of observations x = x1, x2, ..., xn was generated by an assumed known distribution with unknown parameters θ. We deﬁne for independent x: P(x|θ) = n∏ i=1 P(xi|θ) (2.20) as the likelihood of θ with respect to the vector of observations x (Duda et al., 2012, Chap. 3 Page 5). The likelihood p(x|θ) is a function of the distribution parameters θ. The distribution parameters ˆθ, that are most likely to have generated the observations x can be determined by maximizing the likelihood or the logarithm of the likelihood, called log-likelihood. 13 CHAPTER 2. BACKGROUND 2.3 Power Trading in Germany 2.3.1 Transmission Restrictions Geographically, power trading in Europe is organized in market areas or bidding zones. \"A bidding zone is the largest geographical area within which Market Participants are able to exchange energy without Capacity Allocation\"(ENTSOE, 2014, Page 5). This simply means, that even though maximum power ﬂows are limited by transmission capacities, power trading within the same market area is not limited by possible congestions. The stability of the grid within the same market area still has to be monitored by the TSOs. Today, Germany is wholly contained in a single market area together with Luxembourg and Austria. Sharing a market area is only possible, if the transmission system is developed well enough, so that transmission congestions are rare. Because of the quick expansion of renewable energy generation capacities in Germany, the market area will be split between Germany and Austria in the upcoming years (Schlandt, 2015). 2.3.2 Over the Counter Power Trading Power trading in Germany can be classiﬁed by its transaction medium into two diﬀerent groups. It can be traded via energy exchanges or over-the-counter (OTC). OTC trades are arrangements directly between two parties with or without a broker as an intermediary. The main feature of OTC trades is the great ﬂexibility they oﬀer for trade partners to customize their oﬀers (Baumhögger and Perret, 2017, Page 87). Even though energy exchanges have gained importance over the last years, Table 2.1 shows that most of the power is still traded OTC, brokered via broker platforms. The table shows how much power was traded for the German market area in 2015 by market place, OTC or exchange based and by fulﬁllment period. The numbers suggest, that contracts with a long term trading horizon (2 days to several years) are mainly traded OTC, while short term contracts are preferably traded at energy exchanges. 2.3.3 The Day after Trading A special case of OTC trading is the day-after trading which allows utilities under speciﬁc circumstances to avoid the payment of balancing energy even if they derived from their initial generation or consumption schedule. A day-after trade is possible until 16:00 of the day after delivery if utilities with a physically opposite schedule deviation are located within the same control area1. This covers cases where two utilities deviated from their generation schedule in the opposite way, so that the error was annulled(Andor et al., 2010). 1Control area in Germany is the area where a speciﬁc TSO is responsible for the stability of the power system. Germany has currently four control areas. 14 CHAPTER 2. BACKGROUND Table 2.1: Volume of electricity in TWh traded in 2015 via broker platforms and at exchanges split by fulﬁllment period from (Bundesnetzagentur, 2015, Page 173, 180) Fulﬁllment period Traded via broker platforms Exchange based power trading Intraday 0 38 Day-ahead 109 272 2015 incl. 2-6 days 1,363 223 2016 2,528 479 2017 620 147 2018 204 71 2019 and later 22 17 2.3.4 Exchange Based Power Trading Derivatives Market Power for the German/Austrian market area can be traded at three diﬀerent ex- changes, the European Energy Exchange (EEX) which organizes the derivatives or futures market and the European Power Exchange (EPEX SPOT) and the Energy Ex- change Austria (EXAA) which both organize a spot market for the German/Austrian market area. While the spot markets organize the power trading days or hours before physical delivery, the derivatives market allows trading several years in advance. The main product that is traded at the EEX derivatives market in the German market area is the Phelix Future. \"The Phelix Future is a ﬁnancial derivatives contract settling against the average power spot market prices of future delivery periods for the German/Austrian market area\" (EEX, 2015). Although Phelix Futures have an option for physical delivery they are usually only settled ﬁnancially (Baumhögger and Perret, 2017, Page 90). This means, that the contract parties pay the diﬀerence of the future contract price and the spot market settlement price without exchanging power. The reason therefore is that the main purpose of futures for utilities is the hedging of long term price risks and not the purchase of physical power. Trading at the EEX derivatives market is possible up to 6 year in advance for block sizes of one day, week-end, weeks, quarter and year and for the delivery periods base, peak and oﬀ-peak2(EEX, 2015). In 2010 the power volume traded on the derivatives market was already 224% of the total power consumption in Germany. This is because the main driver for the trading activities of many market participants is not the physical power delivery. 2Dleivery time base includes power for all 24 hours of the day, delivery for peak includes the hours from 9 to 20 and oﬀ-peak includes all non-peak hours(EEX, 2015). 15 CHAPTER 2. BACKGROUND This includes utilities that secure the generation of their power plants but also banks and investmentfonds that try to make proﬁt with rising or falling prices. (Graeber, 2013). Another possibility for hedging on the derivatives market are options. With an option, a market participant can purchase the right to buy or sell future contracts for a speciﬁc price. The exercise of this right is optional and will only be done if the party that purchased the option will beneﬁt from its execution. This allows market participants to limit their losses from falling or rising market prices (Baumhögger and Perret, 2017) Spot Market The main diﬀerence of spot markets compared to futures markets or derivatives markets is the mandatory physical delivery of the good and the shorter trading horizon of only one or two days. In the German market area, two diﬀerent spot markets are available, EPEX SPOT and the Energy Exchange Austria (EXAA). The EXAA oﬀers a day-ahead auction for trading power for the German/Austrian market area. In this thesis, only trading at EPEX SPOT is discussed. One reason is that the EPEX SPOT day-ahead market is of greater importance, Figure 1.4 shows that the volume of the EPEX SPOT day-ahead market is over 300% higher than the volume traded at the EXAA day-ahead market. The other reason is, that both markets behave very similar due to the well developed interconnection of the countries (Kloess and Zach, 2014). More information on trading at the EXAA can be found directly at the EXAA3 or in (Kloess and Zach, 2014) EPEX SPOT oﬀers several possibilities to trade power in the German market area: The day-ahead auction, the intraday auction and the continuous intraday trading. Day-ahead auction The day-ahead auction, often referred to as the day-ahead market or even as the spot market, is the most important (exchange based) market place for physical power delivery in Germany. At the day-ahead market, market participants submit oﬀers to buy or sell power at a speciﬁc price for individual hours or blocks of several hours 4of the next day. Who gets to generate and consume power at what price is determined via a \"uniform price auction\". This mechanism is shown in Figure 2.1. The blue curve, the Electricity supply curve or merit order, is created by sorting all oﬀers to generate power for a speciﬁc hour by price. The red curve, the Electricity demand curve is generated similarly by sorting all oﬀers to buy power by price. The price for an hour is determined by the intersection of the electricity supply curve and the electricity demand curve, this price is the market clearing price (MCP). Only oﬀers, demand as well as supply, with a price inferior or equal 3http://www.exaa.at/en 16 CHAPTER 2. BACKGROUND to the MCP are accepted and will all be priced with the MCP. The name uniform price auction stems from the fact that all market participants whose oﬀers were accepted in the auction, are rewarded with the same price. This pricing mechanism is an incentive for generators to oﬀer their electricity at the lowest price possible in order to have their oﬀers accepted. The lowest price a generating unit can oﬀer without being deﬁcient equals their marginal costs and is called the marginal price. Marginal costs vary greatly between diﬀerent types of power plants. The primary cost driver are fuel costs but they also vary in between power plants with the same fuel type depending on their eﬃciency. The blue curve in Figure 2.1 is a schematic representation of the merit order. It shows how the marginal costs of diﬀerent power plant types compare to each other. The day-ahead market for all 24 hours of the following day, closes at 12:00 the day before delivery. This results in a lead time of 12 hours for the ﬁrst hour of the next day and a maximum lead time of 36 hours for the last hour of the next day. The results of the auction are published as soon as they are available from 12:40 on. Figure 2.1: A schematic representation of the merit order and the day-ahead auc- tion from https://www.next-kraftwerke.be/en/knowledge-hub/merit-order- curve/ Intraday auction 4Consult (EPEXSPOT, 2014) for more information about available block sizes. 17 CHAPTER 2. BACKGROUND The intraday auction takes place three hours after the day-ahead auction at 15:00. Like the day-ahead auction, the intraday auction is also a uniform price auction but with the diﬀerence, that 15-minute products for each of the 96 15-minute intervals of the following day are traded. The intraday auction was introduced in December 2014 to oﬀer market participants the possibility to adjust their hourly day-ahead bids to intra-hour changes of power consumption or generation (E.g. when the sun rises, pv generation changes signiﬁcantly within an hour). Figure 2.2 shows the developement of the trading volume of 15-minute products at the intraday auction and the continuous intraday market. Since its introduction, the intraday auction quickly gained importance and after about half a year, over 50% of the volume traded in 15-minute contracts was traded via the intraday auction. The eﬀect of the introduction of the intraday auction was analyzed by (Neuhoﬀ et al., 2015) who attested a positive eﬀect on liquidity, market depth and price volatility. Figure 2.2: Developement of the trading volume of 15-minute products at the intraday auction, compared to the trading volume of 15 minute products at the continuous intraday market and the total volume of the continuous intraday market. Figure from (Neuhoﬀ et al., 2015). Continuous intraday market At the continuous intraday market, also called intraday market, power can be traded in single hour or 15-minute intervals. The continuous trading starts at 15:00 for hourly products and at 16:00 for 15-minute products, the market for 18 CHAPTER 2. BACKGROUND both closes 30 minutes before the start of delivery. The intraday market was introduced to enable market participants to balance unplanned discrepancies in between power they traded at the day-ahead market and power they actually consume or generate. The lead time of the day-ahead market is in between 12 and 36 hours long, the minimum lead time of only 30 minutes at the intraday market is signiﬁcantly shorter. The short lead time is especially important for renewable energy sources. Renewable energy generation is sold at the day-ahead market based on forecasts. As it is with weather forecasts, renewable energy generation forecasts are more accurate if the forecast horizon is short. Figure 1.3 shows the development of the of the forecast error for wind energy in Germany in the last 24 hours before delivery. The day-ahead forecast error (24 hours before delivery) is at about 5%. With decreasing forecast horizon, the forecast error also decreases slowly until about eight hours before delivery, when the forecast error starts dropping faster to about 1.5% at market close. The intraday market allows to correct decisions of the day-ahead market using more recent and more accurate forecasts. Figure 1.4 shows the development of the volume traded on the intraday market. It shows that in 2015 more than six-times as much power was traded on the intraday market than in 2009. This sharp rise is related to the new installation of wind power and photovoltaic generation capacity in these years. It shows that the possibility to trade until 30 minutes before delivery is very important for renewable energy sources and that the intraday market plays a major role for the successful integration of RES in the energy system. 2.4 The German Electricity Intraday market The EPEX SPOT continuous intraday market allows to trade 1-hour and 15-minute contracts. Figure 2.2 shows that hourly products make up the larger portion of the intraday trading volume. Since this work is embedded in the EWeLiNE project5, with amongst others, three German TSOs as project Partners, this thesis will Focus exclusively on 15-minute products. The German TSOs are required by law to \"trade a class of subsidized wind power controlled by the Renewable Energy Sources Act (EEG), on interday day-ahead, and intraday markets\"(Otterson et al., 2016), more precisely, they trade the expected generation at the day-ahead market and correct their trading decisions at the intraday market using 15-minute products. This use case was one of the main incentives for this thesis and it will therefore not consider hourly products. However, as the market mechanism is the same for hourly and 15-minute products, market models created for the trading of 15-minute products are likely to be adaptable for the trading of hourly products. 5http://www.projekt-eweline.de/en/project.html 19 CHAPTER 2. BACKGROUND 2.4.1 Price Building Prices for power at the continuous intraday market are determined using a limit order book, like it is described in 2.5.1. An example of the price building process using a limit order book is shown in Figure 2.3. Starting with a limit order book that is already ﬁlled with active limit orders, as presented in Figure 2.3a, a sell market order (ask) with volume of 5 MWh is submitted. It gets matched with the best active buy oﬀer at 30 EUR/MWh. This results in a transaction of 5 MWh for 30 EUR/MWh. Figure 2.3b shows the state of the limit order book after the transaction, the volume of the limit order at 30 EUR/MWh was reduced by the volume of the market order but the remaining volume stays active in the limit order book. In Figure 2.3c a 30 MWh buy market order is submitted. The buy market order gets matched with the best available sell oﬀers which results in a transaction of 5 MWh for 42 EUR/MWh and 25 MWh for 48 EUR/MWh. Figure 2.3d shows the state of the limit order book after the processing of the market order. The example illustrates the pay-as-bid principle of a limit order book market. In contrast to the uniform pricing of the day-ahead auction, we could observe three trades with three diﬀerent prices in this example. The limit order book allows a continuous price building process but can result in very volatile prices. Figure 2.4 shows a comparison of day ahead and intraday prices for one day in December 2015. The orange line shows the course of the day-ahead price that day which is rather typical. The price is lower at night and shows peaks in the morning and in the evening. The day-ahead price is hourly constant. The dark blue line shows the volume weighted average intraday price for each 15 minute period and the light blue-green area is mounted by the minimum and maximum price that occurred during the whole trading period for each 15 minute delivery window. The Figure indicates two characteristics of intraday prices compared to day-ahead market prices. Firstly, the intraday prices are more volatile and secondly, there are many realized prices for the same 15-minute period. Even if the volume-weighted average price is close to the day-ahead price, it is possible that prices for the same 15-minute period are at the same time substantially higher and lower than the intraday price. 2.4.2 Description of the Market Resolution Parameters and Fees It is common in limit order book markets to introduce discrete price and volume steps. The minimal increment for the volume of orders is called lot size and the minimal increment for prices is called tick size. Both parameters are commonly refered to as resolution parameters (Gould et al., 2013). The lot size at the continuous intraday market is 0.025 MWh and the tick size is 0.1 EUR\\MWh, prices may range from −9, 999 to 9, 999 EUR. Note that the minimum lot size for 15-minute products is deﬁned as 0.1 MW which is 0.025 MWh for a delivery period of 15 minutes. To be able to trade at the intraday market, market participants have to pay various 20 CHAPTER 2. BACKGROUND (a) Example of a 5 MWh market order to sell that matches the best bid at 30 EUR/MWh(red rectangle). The result is a transaction of 5MWh for 30 EUR/MWh (b) The limit order book after the transac- tion from 2.3a. The matched volume was deleted from the limit order book, the re- maining volume is still active (c) Example of a 30 MWh market order to buy that fully consumes the best bid at 42 EUR/MWh and then matches the next best bid at 48 EUR/MWh(red rectangle). The result is a transaction of 5 MWh for 42 EUR/MWh and a transaction for 25 MWh for 48 EUR/MWh (d) The limit order book after the transac- tion from 2.3c. The matched volume was deleted from the limit order book, the re- maining volume is still active Figure 2.3: Example of transactions in a limit order book market and their eﬀect on the limit order book 21 CHAPTER 2. BACKGROUND Figure 2.4: Comparison of day-ahead, volume-weighted average intraday price, minimum and maximum intraday price for a typical day in December 2014. Values of standard deviation, mean and median are given in Euro. ﬁxed one-time and recurring fees as well as oﬀer dependent trading fees. A summary of the existing fees can be found here (EPEXSPOT, 2017b). Trading fees are 0.10 EUR/MWh for market orders and 0.08 EUR/MWh for limit orders. Order Types and Market Actions Market participants that want to trade power in the continuous intraday market, can choose between diﬀerent order types. Here is a list of order types that are available during the continuous intraday trading (EPEXSPOT, 2014)(EPEXSPOT, 2017a) Limit order A limit order is the oﬀer to buy or sell a deﬁned power volume for a speciﬁc price or better (lower for buy, higher for sell orders). Once submitted, a limit order is written into the limit order book where it stays active and visible for all market participants until it is matched by an opposite order, canceled or if the market ends. Market order In contrast to a limit order, a market order is only deﬁned by its volume and has no price limit. A submitted market order, will, starting with the best price, fully or partially accept opposite oﬀers until its volume requirements are satisﬁed. 5Fees are from 2017, while the used data spans from 2013 until 2016, it is assumed that fees did not change signiﬁcantly. 22 CHAPTER 2. BACKGROUND Iceberg or hidden quantity order Iceberg orders are \"large volume orders, divided into several smaller orders which are entered in the order book sequentially\" (EPEXSPOT, 2014). This allows market participants who need to trade large amounts to conceal their total trading volume and thus limit the market impact of their actions (Gould et al., 2013). At the EPEX SPOT intraday market an iceberg order consists of several, equally sized limit orders, each with a minimal size of 25 MW peak. This equals a minimal volume of 6.25 MWh for 15-minute products. If submitted, only one of the limit orders is visible to the other market participants. If the visible order is consumed, one of the invisible orders becomes visible immediately. Additional to the diﬀerent order types, market participants can restrict the execution of their orders. Here is a list of the possible restrictions, market participants can choose from (EPEXSPOT, 2014): Immediate-or-cancel The order is either immediately executed or automatically canceled. Fill-or-kill The order is either immediately and entirely executed or canceled in its entirety. All-or-none The order is executed completely or not at all. After an order is submitted, market participants still have several actions available. Activation/Deactivation Market participants have the possibility to temporarily deactivate and later to reactivate their orders. This allows market participants to take time to reevaluate their oﬀer without the need to cancel their order. Modify Market participants can change the price and volume of their order to adjust it to a new market situation. Cancel If a market participant is no longer willing to trade power he has the possibility to cancel his oﬀer. 23 CHAPTER 2. BACKGROUND 2.5 Economic Theory 2.5.1 The Limit Order Book The limit order book is a widespread mechanism for price formation in continuous markets. In a limit order book market, market participants can submit orders. An order can be deﬁned as a commitment to buy or sell a ﬁxed quantity of the traded good for deﬁned price or better (lower for buy, higher for sell). Once an order is submitted, it enters the limit order book and is checked for opposing orders that fulﬁll its price restrictions. If no complimentary order is found, the order is called a limit order and stays active in the limit order book until it is matched by an opposing order that enters the limit order book; until it is canceled by the owner; or until the market closes. If an order is matched with an existing opposite order, it is called a market order. In this case, the order is matched with the best opposite oﬀers (highest priced buy oﬀer, lowest priced sell oﬀer) until either the quantity of the entering market order is satisﬁed or there are no more opposite orders that fulﬁll its price restrictions. If the limit order is not totally matched then the remaining volume of the order will be added to the limit order book. Each match of a market order with an existing limit order results in a transaction with a price equal to the price of the opposing limit order. Whenever a market order matches a limit order, the owner of the limit order receives the price she submitted even if the same market order matches better limit orders afterwards. This concept is called pay-as-bid principle and stands in a strong contrast to uniform pricing auctions, where all market participants receive the same price. Figure 2.5 shows a common representation of a limit order book of the German intraday electricity market. Active orders are represented as small blocks, colored depending on their side (buy or sell). Orders are positioned on the x-axis by price and the volume of an order determines its extent on the y-axis (the height of a block). Figure 2.5: Common representation of a limit order book using a coordinate system with price and volume axes. Individual orders are represented as blocks, colored by order book side (buy or sell). 24 CHAPTER 2. BACKGROUND Important Deﬁnitions of the Limit Order Book and their Mathematical Description Following some deﬁnitions of important characteristics of the limit order book together with a framework for their mathematical description as proposed by (Gould et al., 2013). Order An order x = (px, ωx, tx) submitted at time tx with price px and size ωx > 0 (respectively ωx < 0) is a commitment to sell (respectively buy) up to |ωx| units of the traded asset at a price no less than (respectively, no greater than) px. Bid-Side, Ask-Side A buy order is called a bid and the buy side of a limit order book is also called bid-side. A sell order is called an ask and the sell side of an order book is also called the ask-side. Limit Order Book A limit order book L(t) is the set of all active orders in a market at time t. The active orders in a LOB L(t) can be portioned into the set of active buy orders B(t), for which ωx < 0, and the set of active sell orders A(t), for which ωx > 0. Depth The depth of a limit order book is the volume that is available at a speciﬁc price. The bid-side depth available at price p and at time t is n b(p, t) := ∑ {x∈B|px=p} ωx (2.21) The ask-side depth available at price p and time t, denoted n a(p, t) and is deﬁned similarly using A(t). In words, the depth of an order book at price p is the volume that is oﬀered at this price. Bid price, ask price The bid price at time t is the highest stated price among active buy orders at time t, b(t) := max x∈B(t) px. (2.22) The ask price at time t is the lowest stated price among active sell orders at time t. a(t) := min x∈A(t) px (2.23) Bid-Ask Spread The bid-ask spread is the diﬀerence in between the highest oﬀered price to buy and the lowest sell price. The bid-ask spread at time t is s(t) := a(t) − b(t). Mid Price The mid-price is the price in the middle of the bid-ask spread. The mid price at time t is deﬁned as m(t) := a(t)+b(t) 2 . 25 CHAPTER 2. BACKGROUND 2.5.2 Liquidity The liquidity of a market is a measure that describes how fast the traded good can be transformed into cash (e.g. liquidation of assets) without loss in value. There is no unique deﬁnition of liquidity, (Hagemann and Weber, 2013) describes liquidity for stock markets from a traders perspective as \"the ability to exercise a buy or sell order of any size at any time without the price being inﬂuenced by this order \" and (Foucault et al., 2013) deﬁnes liquidity of a stock market as \"the degree to which an order can be executed within a short time frame at a price close to the security’s consensus value\". With regards to ﬁnancial markets, all deﬁnitions share the idea of transforming goods or stocks into money (or money into goods/stocks) without a ﬁnancial disadvantage. In a limit order book market, see section 2.5.1, prices are volume dependent. A large buy or sell market order will deplete several opposing oﬀers. The result is that oﬀers with less favorable prices have to be accepted. The change in price that a trader would have to accept to trade a large volume would be a measure for liquidity. The time that a trader would have to wait until new limit orders ﬁll the gap created by a large order, so that he can trade again for a price close to the consensus value of the traded good is also a measure for the liquidity of the market. It is consensus that liquidity \"is a multidimensional construct that is not directly observable\" (Hagemann and Weber, 2013). (Hagemann and Weber, 2013) reviewed the literature for diﬀerent dimensions of liquidity with respect to the power market and identiﬁed amongst others the following dimensions of liquidity: Tightness The most common measure for the tightness of a limit order book market is the bid-ask spread (BAS). The smaller the BAS, the higher is the consensus about the real value of the traded good among traders and the easier it is to resell a good after buying it. The BAS is very important for traders because illiquidity (a lack of liquidity) \"eats into the return\" (Foucault et al., 2013), which means that if a good is bought with the goal to resell it with proﬁt when its price rises, the BAS will reduce the proﬁt. Another way to measure the tightness of a LOB was proposed by (Irvine et al., 2000) with the cost of a round trip trade, which is the costs associated with buying and immediately selling a volume of a good corresponding to a speciﬁc amount of money. Price Impact If a large market order arrives, the best available opposite oﬀer may not be enough to satisfy the size of the oﬀer and prices beyond the best bid or ask have to be accepted. The price for power will move \"along a price-demand function which slope is determined by the volumes and prices of electricity in the limit order book \"(Hagemann and Weber, 2013). The price impact of an order, i.e. how much the price changes due to its execution, is directly related to the slope of this price-demand function. Resilience In general, the price impact of an arriving market order will dissapear because the depleted oﬀers will replenish by time (Foucault et al., 2013). The 26 CHAPTER 2. BACKGROUND speed of the replenishment is called resilience and is considered a dimension of liquidity. 2.5.3 Stylized Facts Stylized facts, also called \"empirical facts\" or \"characteristic features\", are statistical regularities that can be revealed by analysing empirical market data (Gould et al., 2013)(Cont, 2001). Stylized facts are often shared over a wide range of diﬀerent markets and time periods (Cont et al., 2010). From a modeling perspective, stylized facts are interesting, because the ability of a market model to represent important stylized facts can be used as a criterion as to whether or not the model ﬁts the market well. The analysis of stylized facts for power markets has been limited to auction based day-ahead markets like the EPEX SPOT day-ahead markets. In the following I will present a list of stylized facts that can commonly be observed in ﬁnancial and power markets, followed by some stylized facts that are speciﬁc to power markets: Volatility and volatility clustering Volatility itself is not a stylized fact as all time series are somewhat volatile by nature. The price on power spot markets however is especially volatile compared to other commodity markets(Simonsen et al., 2004). The reason for this high volatility is mainly due to the necessity of \"markets to be balanced in real time\"(Mugele et al., 2005) and the lack of electricity storage possibilities. A stylized fact related to volatility is the so-called volatility clustering. (Cont, 2001) described volatility clustering as \"diﬀerent measures of volatility display a positive autocorrelation over several days\", which means that events that cause a high volatility (price jumps) are more likely to happen if they were followed by an event that caused high volatility (Chakraborti et al., 2011). This stylized fact can be found on many diﬀerent ﬁnancial markets and also on the electricity market (Mugele et al., 2005)(Simonsen et al., 2004) Seasonality Electricity spot market prices have strong patterns of seasonality, which means that there are patterns of high and low prices that are repeated in ﬁxed time intervals. Those time intervals exist on many time scales. For example electricity prices usually peak twice a day, in the morning and in the evening when power consumption is the highest. There is also region speciﬁc seasonality, for example a lot of people in France have electric heating, so electricity prices in the winter are considerably higher than in the summer. A description for seasonality as a stylized fact in electricity spot markets can be found in (Mugele et al., 2005) or (Simonsen et al., 2004). A special case of seasonality exists on the intraday market. Here the price for 15-Minute products is considerably higher at the beginning of an hour in the morning, and at the end of an hour in the evening. This can be explained 27 CHAPTER 2. BACKGROUND because ramps, rising or falling power consumption, are approximated with hourly constant products at the day-ahead market. This means, that the demand was underestimated in the beginning of an hour and over estimated at the end of an hour, for rising ramps and the other way around for falling ramps (Kiesel and Paraschiv, 2015) Mean reversion Mean reversion is the characteristic of a price to revert to its original value after a price spike. While mean reversion can also be seen on most ﬁnancial markets, (Mugele et al., 2005) describes it as especially strong in electricity spot markets (faster reversion rate). Price spikes A characteristic feature that electricity markets are famous for is the relatively common occurrence of extreme price events. Electricity spot prices can be multiplied by 10 or more within only several hours and then quickly fall back to normal levesl(Simonsen et al., 2004)(Mugele et al., 2005). Considering price spikes is of great importance for utilities and power traders when they calculate the prices they oﬀer to customers. Clustering around integers Clustering around integers describes the eﬀect that integer valued prices and order sizes occur signiﬁcantly more often than the prices in between integers. The reason is the preference of human traders for integer values instead of the values in between integers, which might be closer to the optimal value. This eﬀect is known to occur in stock markets and was analysed for example by (Verousis and ap Gwilym, 2013) and by (Bhattacharya et al., 2012). At the German electricity intraday market order sizes and order prices showed a very strong clustering around integer values. An example for the clustering of order sizes is shown in Figure 6.4 28 Chapter 3 Literature Review 3.1 Electricity Spot Market Modeling 3.1.1 Overview Future energy systems with high percentages of intermittent renewable energy genera- tion will require ﬂexible energy applications to balance their volatile generation proﬁle (see paragraph The Impact of the Energy Transition on Generation Requirements in Chapter 1). A focus of today’s energy system related research is to ﬁnd and evaluate applications that can participate in providing the required ﬂexibility. Following is a list of example applications that can potentially provide ﬂexibility for the energy system and example studies that analyze this potential. • Optimal charging of a ﬂeet of electric vehicles (Rivera et al., 2016) • Demand side management (Siano and Sarno, 2016) (Mohsenian-Rad, 2015) (Mathieu et al., 2013)(Ehrlich et al., 2015)(Papaefthymiou et al., 2012) • Electric storage systems with (Zucker and Hinchliﬀe, 2014) and without at- tached generation (Kloess and Zach, 2014) (Eyer and Corey, 2010) (Hu et al., 2010) (Logenthiran and Srinivasan, 2011) (Bradbury et al., 2014) • Electricity price driven co-generation (Mitra et al., 2013) • Aggregations clustered in virtual power plants (Wille-Haussmann et al., 2010) (Schäfer and Moser, 2012) There are many applications that could provide ﬂexibility to the energy system but they often require additional investments to be enabled to do so. Therefore, many studies are split in two parts. A technical part where the possibility of providing ﬂexibility to the energy system is evaluated and an economic part, where the proﬁtability of the ﬂexible application is evaluated. 29 CHAPTER 3. LITERATURE REVIEW The owner of ﬂexible energy sources can proﬁt from volatile electricity prices: Flex- ible power generation can be moved to times of high electricity prices or ﬂexible power consumption can be moved to times of low electricity prices. The additional remuneration or saved costs from the interaction with the electricity market play an important role whether or not the investment in a more ﬂexible energy application is proﬁtable. In order to evaluate and to quantify the beneﬁt of an interaction with the electricity market, the interaction in between the electricity market and the ﬂexible energy application has to be simulated. This simulation requires a model of the electricity market. Market model is a very general term for the set of rules that determines how the artiﬁcial market behaves in the simulation. Market models can be can be arbitrarily complex, depending on the level of detail to be reproduced. A simple market model is the \"price-taker model\". A price-taker model oﬀers market participants information about the state of the market (e.g. the price) which they can choose to accept. An interaction (e.g. buying or selling power) between market participants and a price-taker model does not inﬂuence the market. An example of a price-taker model of the day-ahead market for an hourly simulation over the course of one year is a list with 8760 prices, one for every hour of the year. A market participant in a simulation could, for example, be an algorithm that controls the charging behavior of an electric storage system. The control algorithm would receive information about the available electricity prices from the market model (the list) and make a decision whether to buy or to sell. If the control algorithm decides to buy or sell power, it does not inﬂuence the market model. More detailed market models could also model the behavior of other market partici- pants, as well as the response of the market to the actions of the control algorithm. The response of the market would be, for example, that the price rises, if a large quantity is bought. To evaluate the proﬁtability of ﬂexible energy applications, studies are focused on exchange based spot markets. Since the liberalization of electricity markets, electricity exchanges have become increasingly important. They oﬀer an easy, anonymous access to the electricity wholesale market and take care of the ﬁnancial clearing of market transactions. The better availability of relevant market data makes exchanges more attractive then OTC trading for research purposes. Spot markets are preferred due to their shorter lead times and higher volatility than derivatives markets. The signiﬁcance of the simulation result, which means the probability that the simulated results are close to what would happen if the system would operate in the real electricity system, depends also on the assumptions that were made concerning the market model. In the following section, examples of how markets are modeled in recent publications are presented and the assumptions and simpliﬁcations are revised in a critical way. 30 CHAPTER 3. LITERATURE REVIEW 3.1.2 Common Assumptions A general ﬁnding of my review of recent energy related publications for their use of market models was that they often do not focus on market models but on the modeling of the energy application. While technical processes like the charging of batteries or the ramping behavior of power plants are modeled in high detail, and with great diligence, the market models used often rely on gross assumptions, the consequences of which are not discussed adequately. No generation and demand uncertainty Trades on the German day-ahead market are performed 12 to 36 hours before the physical delivery. For this horizon, generation from renewable energy sources as well as the electricity and the thermal demand, can not be predicted with a 100% accuracy. Nevertheless studies often assume perfect forecasts over the whole course of their simulations, which are often a whole year (Schäfer and Moser, 2012) (Wille-Haussmann et al., 2010) (Logenthiran and Srinivasan, 2011) (Bradbury et al., 2014). This assumption is very comfortable as this removes the uncertainty from the problem which would require a stochastic optimization approach. (Zucker and Hinchliﬀe, 2014) should be noted here, as they avoid a too unrealistic forecasting performance by forcing their system to the initial state after 1 day of usage which limits its maximum horizon for perfect forecasts to 24 hours. In the past it was general opinion that renewable energy generation is less predictable than changes in demand and that demand forecast uncertainty can therefore be neglected(Pandzžić et al., 2014). However it is important to keep in mind, that those assumptions are based on forecasts that combine a great number of consumers and might not be true for smaller groups of consumers. This can be seen in (Sevlian and Rajagopal, 2014) where the correlation of consumer group size and demand forecast error is shown. (Hernandez et al., 2014) predicts that due to the rise of disaggregated environments (e.g. microgrids, Smart Buildings, virtual power plants) demand forecast will be more complex in the future. On the one hand, this is because of the smaller group size for which the demand proﬁles won’t be as smooth as they were for large aggreagtions of consumers. On the other hand, this is because the load proﬁle itself will become more complex, for example, because it will be the result of a mix between power generation and consumption (also called prosumer). Load forecasts will at the same time gain importance, because disaggregated environments need to use their resources in an optimal way in order to be proﬁtable (Hernandez et al., 2014). Price uncertainty The investigated applications oﬀer ﬂexibility to the energy system and evaluate the ﬁnancial beneﬁt of this ﬂexibility by simulating the interaction with the electricity market. This usually means, that power is bought when the price is 31 CHAPTER 3. LITERATURE REVIEW low and sold when the price is high (arbitrage) or that demand is shifted from times with high prices to times with low prices (e.g. peak-shifting). Performing these actions requires knowledge of future electricity prices, which means that a price forecast is needed. Even though electricity spot market prices are volatile, it is very common to assume a perfect price forecast over the full duration of the simulation, which is often a full year (Schäfer and Moser, 2012) (Wille-Haussmann et al., 2010) (Logenthiran and Srinivasan, 2011) (Bradbury et al., 2014) (Zucker and Hinchliﬀe, 2014) (Hu et al., 2010) (Rivera et al., 2016) (Mitra et al., 2013) (Kloess and Zach, 2014). In (Mathieu et al., 2013) the eﬀect of price forecast errors on the revenue of ﬂexibility providers was brieﬂy reviewed and considered important. The error induced by neglecting uncertainty of future prices is likely to be higher for prices on the intraday market as it is for prices on the day-ahead market, due to the higher price- volatility at the intraday market. Figure 2.4 shows a comparison of intraday and day-ahead prices for one day in December. Impact on market price The vast majority of the reviewed publications used a price-taker model of the day-ahead market (Wille-Haussmann et al., 2010) (Hu et al., 2010) (Logenthiran and Srinivasan, 2011) (Schäfer and Moser, 2012) (Mitra et al., 2013) (Kloess and Zach, 2014) (Zucker and Hinchliﬀe, 2014) (Rivera et al., 2016) or the intraday market (Mathieu et al., 2013) (Bradbury et al., 2014) (Mohsenian-Rad, 2015). The price-taker model is a market model where market participants lack the market share to inﬂuence the market price with their actions 1. In practice, a price-taker market model could be a list with the actual and future, sometimes forecasted, electricity prices. The simulated applications buy or sell power to the oﬀered price without aﬀecting the market price. This assumption widely used and accepted for the German day-ahead market but it is problematic for the German intraday electricity market. Figure 4.1 shows the cumulative distribution function of the price spread of a 15-minute trading period for the same delivery period. 20 % of the prices of intraday transactions had a price spread of more than 5 EUR/MWh. Such price spreads occur because of the diﬀerence in between buy and sell oﬀers but also because the price is inﬂuenced by the trade size. For example because the trade depletes the best opposite oﬀer in the order book and needs to accept less favorable priced oﬀers from inside the book. Hourly time resolution Almost all reviewed publications perform simulations using an hourly time resolution. Reasons could be that the minimum duration for most day-ahead markets is one hour, that one hour is the traditional temporal resolution or that sub-hourly simulation would be computationally too expensive. However, 1http://www.investopedia.com/terms/p/pricetaker.asp 32 CHAPTER 3. LITERATURE REVIEW energy systems are changing; (Pandzžić et al., 2014) compared unit commitment simulations with hourly and 15-minute resolution and delivered evidence that an hourly resolution may not be accurate enough anymore for energy systems with high renewable penetration. Additional evidence of the relevance of sub-hourly modeling was presented by (Deane et al., 2014). In Germany, the minimum delivery period of the day-ahead market is one hour, hence market participants have to trade OTC, at the intraday auction or the continuous intraday market. Consideration of balancing energy prices If the actual power generation or consumption mismatches with the traded amount, balancing power will be used to ﬁll the gap and to ensure the stability of the power system. Balancing energy, which is the amount of balancing power used, has to be paid by the party that was responsible for the necessity of its usage. Balancing energy can be extremely expensive, so that market participants have an incentive to stick to their generation or respectively consumption schedule. In Germany, the price of balancing energy has a high standard deviation compared to intraday prices and is considered to be hard to predict. The use of balancing energy is therefore considered risky. Figure 1.1 shows a comparison in between intraday prices and balancing energy prices. Of the reviewed publications, only (Papaefthymiou et al., 2012) considered the payment of balancing energy in the case that their prediction mismatched the reality. It is diﬃcult to meet the actual demand only by trading hourly products on the day-ahead market with its lead time of in between 12 and 36 hours. Thus, either the intraday market should be used for corrections or the payment of balancing energy should be considered in the simulation. How likely it is to cause a mismatch in between forecasted and real generation on the day-ahead market can be seen in (Kiesel and Paraschiv, 2015), where the prices of the EPEX SPOT 15-minute intraday product were analyzed. One of the ﬁndings was, that prices spike for the ﬁrst 15 minutes of every hour when the sun is rising. This is because the estimated hourly mean generation of photovoltaic systems is sold on the day ahead market and as the actual photovoltaic generation is not constant but rises (or declines depending on the time of the day) over the course of an hour, the mismatch has to be corrected on the intraday market. All market participants have this problem which makes the volume high enough to inﬂuence the prices. 3.1.3 Conclusion In general it seems that the usage of the intraday market would be a better ﬁt for most ﬂexible applications. They would beneﬁt from more volatile electricity prices for arbitrage and the neglecting of demand and generation forecast errors would be a valid assumption. This is shown in (Taylor, 2012) where the load forecasting 33 CHAPTER 3. LITERATURE REVIEW performance of diﬀerent state-of-the-art methods are compared and the development of their forecast accuracy over the forecast horizon is shown. While publications that study ﬂexible applications operating on non-US markets often use models of the intraday market, there are no studies known to the author that use models of the German electricity intraday market for the economic evaluation of ﬂexible power systems2. Reason for this discrepancy could be the absence of easy to use intraday market models for the German intraday market, which has a more complicated price building mechanism then the auction based intraday markets in the US. 3.2 Limit Order Book Modeling The electricity spot market models reviewed in Section 3.1 modeled the market by modeling its outcome. The market outcome are the electricity prices, which are often modeled as trading volume independent. This approach is very common but faces several diﬃculties when applied to the limit order book based continuous intraday electricity trading. Prices here are very sensitive to the trade volume and prices are very volatile during the trading period for a single delivery time. Figure 2.4 shows that there are often price diﬀerences of 20 Euro and more at the intraday market for the same delivery time and Figure 4.1 shows that there are in between 8 and 200 diﬀerent transactions also for the same delivery time. Each of this transactions has potentially a diﬀerent price. This makes the modeling of intraday electricity prices more diﬃcult, for example it is hard to decide which price to take. A possibility to solve these problems is to model the underlying market mechanism, the limit order book. Limit order books are used in more than half of the worlds ﬁnancial markets as a price building mechanism (Gould et al., 2013). The modeling of the limit order book is a known problem in microeconomics and ﬁnance. There are a multitude of diﬀerent approaches to model limit order book markets(Gould et al., 2013) this thesis however, is focused on zero-intelligence modeling. In economics, markets are commonly modeled using \"rational utility maximizing agents\"(Farmer et al., 2005) however, these approaches \"rely on a series of auxiliary assumptions to quantiﬁy unobservable parameters.\". Opposed to that, \"zero-intelligence models assume that order arrivals and cancellations are directly governed by stochastic processes\"(Gould et al., 2013). Zero-intelligence modeling origins from econophysics, a rather new approach where economic systems are viewed and analyzed from a physics perspective(Chakrabarti et al., 2010). In recent years, zero-intelligence modeling was also applied to limit order books (Challet and Stinchcombe, 2001) and made since then signiﬁcant modeling progress (Gould et al., 2013)(Jiang et al., 2011)(Toke and Yoshida, 2016). 2An exception are studies that use a German or Europe scale unit commitment and dispatch model like it is done in (Papaefthymiou et al., 2012). 34 Chapter 4 Data and Data Preparation 4.1 EPEX SPOT Intraday Transaction Data The EPEX SPOT Intraday transaction data set is available for purchase directly from EPEX SPOT. It consists of a list of all transactions that occured during the continuous intraday trading. Summarizing information of intraday prices are available online for free and are commonly used in studies about the intraday market (Kiesel and Paraschiv, 2015). For every delivery time, minimum, maximum and the volume-weighted average price are available. Additionally, there is information about the last realized price and the total traded volume. This information can provide an estimate of the market state but they easily give the wrong idea of an uniform and homogeneous intraday market. Figure 4.1(a) shows the distribution of how many transactions occur for an individual 15-minute delivery time. The number of transaction varies greatly between single digit numbers and over 200 transactions per delivery time. Additionally to a large variance in trading activity between the delivery times, prices for an individual delivery time can be very volatile. Figure 4.1 (b) shows the distribution of price spreads within a 15-minute trading period for the same delivery time on the intraday market. The graph was created by binning the last eight hours of trading for each delivery time/delivery day combination in 15-minute increments (non-sliding). All trades for that delivery time were assigned to a bin depending on their trading time. Furthermore, the diﬀerence in between highest and lowest transaction price was calculated for each bin. The graph has a logarithmic x-axis and shows that around 20% of the 15-minute periods had a price span of over 5 Euro, and that 10% of the 15-minute bins had a price span of over 10 Euro. To gain insights about the intraday market dynamics within an individual delivery time, the summarized data is insuﬃcient and therefore the EPEX SPOT transaction data was purchased by Fraunhofer IWES. The EPEX SPOT transaction data comprises all intraday transactions. The available information is shown in Table 4.1. 35 CHAPTER 4. DATA AND DATA PREPARATION Number of transactions per delivery time 0 50 100 150 200 250 Number of transactions in for one delivery time 0 500 1000 1500 2000 2500Counts (a) 1 5 10 100 Price spread in EUR/MWh 0.6 0.7 0.8 0.9 1F(x) CDF of price spread of intraday prices occuring in a 15 minutes window (b) Figure 4.1: (a) shows the distribution of the number of intraday transactions per delivery time. (b) shows the empirical cumulative distribution function of the price spread of intraday transactions occurring in a 15-minute window for the same delivery time. Both graphs were created using EPEX SPOT transaction data of the last eight hours before market close from Jan. 2014 - Apr. 2015. Table 4.1: Table about the information available in the EPEX SPOT transaction data. First column shows the ﬁeld names as they occur in the spreadsheets delivered by EPEX SPOT, second column is a short description. Date The day of delivery in DD.MM.YYYY Market Area Buy Either Germany or Austria, depending to which area the power was delivered. Market Area Sell Either Germany or Austria, depending from which area the power was delivered. Hour From The end of delivery time in the format xxqhy, where xx is the delivery hour and y an integer from 1 - 4 that indicates during which quarter of the hour the power was delivered. Hour To The same value as \"Hour From\" Volume (MW) Size of the transaction in MW peak, will only be delivered during a quarter hour period. Price (EUR) The price in EUR/MWh Time Stamp The transaction time in DD.MM.YYYY hh:mm:ss Trade ID 7 digits incrementing identiﬁer. 36 CHAPTER 4. DATA AND DATA PREPARATION 4.2 EPEX SPOT Limit Order Book Data 4.2.1 Dataset Description To study and model the intraday market behavior more detailed, Fraunhofer IWES purchased the EPEX SPOT M7 order book dataset from 2013 until 2016 included. This dataset contains all orders that have been submitted to the intraday market, including orders that never resulted in a transaction or orders that were canceled. The additional information gained from this data can be seen in Figure 4.1 (a). The Figure shows the number of transaction in the last eight hours before delivery per individual delivery time. On average, there are 65 transactions per delivery time, which would result in one transaction every seven minutes. However, transactions often occur clustered and more transaction occur, close to the market closure (Otterson et al., 2016). So when binning all trades by delivery time/delivery day and sorting them in 15-minute wide trading windows (see Section 4.1 for a more detailed explanation), 87 % of these trading windows would be empty. This means that the transaction data set does not give any information about the state of the market for most of the time. The EPEX SPOT limit order book data gives information about the state of the market in between transactions and allows a much more thorough analysis of the intraday market. The data is delivered in Excel spreadsheets, the information available for each submitted order is shown in annex A.1. 4.2.2 Preparation Erroneous Order Information The M7 order book data set was recently made available for purchase from EPEX SPOT and was until this day not used in any published work known to the author 1. As the data set is very recent, there are still problems with data quality that require a higher amount of preparation. It is especially important to note that the content of some ﬁelds is erroneous and can not be used 2. The ﬁelds that can not be used are Execution Price and Execution Volume. The ﬁelds Initial ID and Parent ID were introduced in April 2015. Overlapping Content The M7 order book dataset is delivered by EPEX SPOT as one or more Excel spreadsheets per month. For further analysis and the model building, the individual spreadsheets were read into Matlab. Spreadsheets of adjacent months sometimes overlap for several days. To be able to process the order ﬂow later, redundant information has to be deleted. 1(Neuhoﬀ et al., 2016) analyzes the total available volume in the order book, it is not clear what data is used for this analysis. 2This was communicated by EPEX SPOT prior to purchase. 37 CHAPTER 4. DATA AND DATA PREPARATION Simulation of Austrian Orders Germany and Austria are in the same market area. This means, that power in between both countries can be traded without allocation of transmission capacity. In other words, it is possible to buy power at EPEX SPOT that will be delivered in Austria and to buy power at EXAA that will be delivered in Germany. Power traders can do so without considering transmission restrictions. The order ﬂow provided by EPEX SPOT only includes orders for power generated within, or to be delivered to, Germany. Orders from the Austrian delivery zone are not part of the M7 order book data set. With approximately 65 TWh (Austria, 2016) Austria has only about about 10% of Germany’s gross power generation. Moreover, Austria’s volatile renewable generation, which is especially present on the intraday market, has only a share of about 10% in the energy mix (Bundesministerium für Wissenschaft, 2015). These numbers are an indication that the role of the Austrian delivery zone at the intraday market is small. Nevertheless, it is possible to reconstruct all Austrian orders causing a transaction. This can be done using the EPEX SPOT intraday transaction data shown in Table 4.1. In this dataset, transactions have the information if the power is delivered to or from Austria. If power was delivered to (respectively from) the Austrian delivery zone, a buy (respectively sell) order with the same volume, price and delivery time as the transaction is created. It is not possible to determine the true submission time of the Austrian order and it is therefore assumed that the order was submitted at the time of the transaction. All other ﬁelds of the order book data are not required to include this order in the order ﬂow. 38 Chapter 5 Historic Intraday Market Simulator The stochastic market model based on (Toke and Yoshida, 2016) presented in Chapter 6 requires information about the state of the market at the moment of order submission in order to create market state dependent models for the arrival time, the volume, and the price of an order. Unfortunately, the EPEX SPOT order ﬂow data does not deliver any information about the market state, so that an enriched order ﬂow has to be created by simulating the historic market data. The enriched order ﬂow consists of the existing order information and of a set of variables that describe the market state at the moment of order submission. To get the information about the market state at the moment of order submission, the historic course of the market has to be simulated by successively processing the order ﬂow. The main purpose of the historic intraday market simulator is to enrich the order ﬂow with information about the market state. Additionally, it can also be used as a price-taker models of the intraday market that is able to model illiquidity. Price-taker market model oﬀers a price to a user without giving him the possibility to inﬂuence this price. Price-taker model are very common for the day-ahead market, see Section 3.1. The historic market simulator as a market model oﬀers the possibility to inﬂuence the price of the market but not the future order ﬂow. 5.1 Framework Conditions 5.1.1 Used Order Information The historical order ﬂow data described in Section 4.2 consists of ex-ante and ex-post information. \"Ex-ante\" refers to information which is known at the moment of order submission, for example the price or the volume of the order. \"Ex-post\" describes information which requires knowledge of the development of the market after the order was submitted, for example if, and at what time, the order was accepted by an opposing order. An overview of available ex-ante and ex-post order information is given in Table 5.1. 39 CHAPTER 5. HISTORIC INTRADAY MARKET SIMULATOR The historic market simulator will not use any of the ex-post information from the order book data set. On the one hand, available ex-post information is partially unreliable (see Section 4.2.2) and on the other hand, the historical market simulator should later be able to be used as a simple market model, which accepts user deﬁned orders as an input. Users of the market model will only have ex-ante information available. The dismissed ex-post information will be regenerated during the simulation using the limit order market mechanism. For example, the information at what time an order stops existing the ﬁeld End validity date, is available in the data set but will not be used. Instead, this information will be ﬁlled in during the simulation at the moment when the order is matched by an opposing order, when the order is canceled or when the market ends. An exception is the ex-post information Canceling date since there is no way to regenerate the information during the simulation. The simulation of the market without the usage of ex-post data has several advantages. Especially the possibility to use the simulator as a market model was important in this thesis. However, the exclusion of the ex-post information opens up the possibility of errors by misinterpreting the order ﬂow during the simulation. These errors are discussed in Section 5.1.2. Table 5.1: Order information available in the EPEX SPOT order book data separated in ex-ante and ex-post data. Ex-ante Ex-post Instrument type Is executed Delivery instrument End validity date Delivery date Canceling date Start validity date Execution price Status Executed volume Side Price Volume Initial ID Parent ID 5.1.2 Identify Orders in the Order Flow In the EPEX SPOT order ﬂow, not every item (a row with order information in the spreadsheet) corresponds to an individual, independent order. In the following, is an overview of the diﬀerent cases that occur as an item in the order ﬂow and the necessary actions to distinguish them from real orders. Orders 40 CHAPTER 5. HISTORIC INTRADAY MARKET SIMULATOR An item in the order ﬂow can correspond to an order. In Section 2.4.2 the diﬀerent order types, which are available at the intraday market, were presented. The order ﬂow provides no information that allows direct identiﬁcation of the order type. The order type is therefore identiﬁed during the simulation, or by preprocessing of the order ﬂow. Limit Orders and Market Orders The distinction between a limit order and a market order can be made easily during the simulation. First, all orders are treated as limit orders that are submitted to the limit order book. If an order matches an opposing order, the order is identiﬁed as market order. If not, the order is identiﬁed as limit order. Iceberg Orders As described in Section 2.4.2, it is possible to submit hidden quantity orders during the continuous intraday trading. In the order ﬂow, only the visible parts of iceberg orders are visible at the moment of submission. Once the visible order is consumed, it is followed by an order with the same ID and volume zero. This is then followed by a new order with the same ID. Since all individual orders of the iceberg order use the same ID, they can not be distinguished of reborn orders during the simulation. Therefore, the diﬀerent suborders of the iceberg orders are equipped with individual IDs in a preprocessing step. This is done by binning all orders by their ID, sorted by their submission time. Orders with the same ID are iterated and if an order with volume zero appears, all following orders are equipped with a new ID. The new ID is calculated using the following equation: New ID = Initial ID · 1000 + i, i ∈ 1, 2, 3... i increments for every appearance of a new suborder of the same iceberg order (same ID). Restricted Orders Orders can be submitted with diﬀerent execution restrictions. Section 2.4.2 describes the restrictions, which are available at the intraday market. Unfortunately, it is not possible to identify the diﬀerent restrictions given the information in the order ﬂow. This may result in the misinterpretation of some orders and in an erroneous reconstruction of the historic limit order book state. The error is quantiﬁed and discussed in Section 5.3. Rebirth of Partial Matched Orders In a limit order book it is a common event that active limit orders are only partially matched. This means for example that the same order stays in the book but its volume is reduced by the volume of the matching (opposite) market order. In the EPEX SPOT order ﬂow, a partially matched order 41 CHAPTER 5. HISTORIC INTRADAY MARKET SIMULATOR reappears as a new order with the same price and the residual volume. Later in this work, order arrivals will be counted in order to model the market state depending intensity of order arrivals. The creation of a new order for every partially matched order would inﬂate and distort this order count. In the market simulator, those reentered orders are not included in this count. During the simulation, the order book object keeps track of all active order IDs and ignores order ﬂow items with an ID that is already related to an active order. Market actions In Section 2.4.2 the diﬀerent actions that are available to a trader after having submitted an order were introduced. Each of these actions will appear as a new item in the order ﬂow and must not be confused with the submission of a new order. In the following, the description of how the diﬀerent market actions are treated. Order Modiﬁcations Once an order is submitted, the price as well as the volume can be modiﬁed by the owner of the order. In the order ﬂow, the modiﬁed order has a non- empty ﬁeld Canceling time ﬁlled with the time stamp of the modiﬁcation. It is followed by a new order with the same ID and a modiﬁed price or volume. During the simulation, a modiﬁcation can not be distinguished from a cancellation or the submission of a new order with the same ID. The frequency of appearance of limit orders, market orders and cancellations will be modeled in Chapter 6. The interpretation of order modiﬁcations as cancellations followed by an order submission would lead to inaccurate modeling results. To be able to identify modiﬁcations, a modiﬁcation ﬂag is introduced in a preprocessing step. Hereby, all orders are binned by their ID and sorted by submission date. Orders with the same ID are iterated and if an order has a nonempty ﬁeld Canceling time and is not the last existing order with the same ID, this order is marked as a modiﬁcation. During the simulation, a modiﬁcation is treated as a cancellation of the old order and the submission of a new one. The modiﬁcation ﬂag created in the preprocessing step will be used to exclude these submissions and cancellations from the modeling process. Activation and deactivation of orders Market participants have the possibility to deactivate an order temporarily and to reactivate it later. The deactivation of an order appears like the submission of a new order in the order ﬂow. The item in the order ﬂow has the same ID and the ﬁeld Status set to N, for not active. The ﬁeld Canceling time is ﬁlled with the reactivation time of the order. 42 CHAPTER 5. HISTORIC INTRADAY MARKET SIMULATOR The reactivation of the order corresponds to the submission of a new order with a possible modiﬁed volume or price and the ﬁeld Status set to Y again. Just as it is the case with modiﬁcations, the actions associated with the activation and the reactivation of an order must be excluded from the modeling. This is ensured using the same ﬂag which also identiﬁes modiﬁcations. During the simulation, a deactivation is treated as an immediate cancella- tion of the existing order with the same ID. The reactivation corresponds to the submission of a new order. The modiﬁcation ﬂag covering the deac- tivations and reactivations will also be used to exclude these submissions and cancellations from the modeling process. Cancellations Market participants have the possibility to cancel their active limit orders. A cancellation in the order ﬂow can be identiﬁed by the non-empty ﬁeld Canceling time and by excluding the cases modiﬁcation and deactivation. 5.1.3 Market State Variables One reason for the simulation of the historic order ﬂow in this thesis is to generate information about the market state at the moment of order submission. The state of the intraday market can be deﬁned via the LOB as the set of all active limit orders. This deﬁnition is not useful for making conditional distributions and we therefore introduce a set of variables which help to describe the market state. These variables are called \"market state variables\" There are many possibilities to describe the market state but in this thesis, only the variables used in (Toke and Yoshida, 2016) and the most common variables from (Gould et al., 2013) are tracked. An overview and a short description of all tracked market state variables is shown in Annex A.3. Note that even though only a few of these variables are actually used in the thesis, the others were tracked for later usage or for exploratory reasons. 5.2 Implementation and Simulation To reconstruct the historic state of the market over time, the order ﬂow has to be processed item by item. For the implementation in Matlab, these tasks were divided into two ﬁelds: The interpretation of the order ﬂow and the reproduction of the market mechanism. The core of the simulation is the reproduction of the limit order book market mechanism. Therefore, a limit order book object was created which processes incoming orders, modiﬁcations and cancellations as would a limit order book, while keeping track of the current market state. The market object is controlled by a script that processes the order ﬂow sequentially. This script has to test the diﬀerent cases described in Section 5.1.2 and to control the order book object accordingly. An overview of the work ﬂow of the market simulation is shown 43 CHAPTER 5. HISTORIC INTRADAY MARKET SIMULATOR in Figure 5.1. The step-by-step explanation of the market simulation, which follows in the next paragraph, requires some additional information about the composition of the order ﬂow. Theoretically, the order ﬂow is a long list of orders which entered the market sequentially. In the EPEX SPOT order ﬂow, not all entries in the list are orders. Entries are for example also modiﬁcations of already active orders. All entries are therefore referred to as items of the order ﬂow, until it is clear if they correspond to an order. Nevertheless, all items in the EPEX SPOT order ﬂow look like orders and have the same information as orders. More information about the diﬀerent items in the order ﬂow and how to distinguish between them can be found in Section 5.1.1. The simulation process starts with the incoming of an item from the order ﬂow. At ﬁrst, it is checked if the item corresponds to an order which was already completed. As described in Section 5.1.1, the EPEX SPOT order ﬂow does not provide the necessary information to identify items without uncertainty. It is therefore possible, that the simulation deviates from the real course of the market and that an item in the order ﬂow (e.g. a modiﬁcation) belongs to an order which was already matched and completed in the simulation. These entries have to be ignored. Next, it is checked if the item is marked as inactive, in which case the order to which the item belongs is canceled from the order book. This corresponding market action is a deactivation. It will not be counted as a cancellation in the later analysis. If the item has a cancellation time stamp, the cancellation time is inserted in a sorted list to keep track of the due time of open cancellations. In the next step, all open cancellations with a cancellation time earlier to the simulation time are executed consecutively. The simulation time is always the time stamp of the item of the order ﬂow being currently processed. The next step is to exclude reborn orders from the order ﬂow. Therefore, it is checked if the order ID corresponds to an order that is active in the LOB and if the item is a modiﬁcation. Modiﬁcations were determined in a preprocessing step described in Section 5.1.2. If the order ID is already in the book and the order is not a modiﬁcation, it is a reborn order and it is therefore not included in any order arrival counting. All remaining items are now treated as orders. Before the order enters the LOB, all market state variables from Table A.3 are updated. When the order enters the LOB, several cases are possible. It is checked, if the order matches an existing opposite order in the LOB. A match here means that an incoming buy order has a price higher than any active sell order or that an incoming sell order has a price lower than any active buy order. If the order matches an opposing order, it will be marked as a market order and it will generate a transaction for every limit order that is matched. The price of the transaction is determined by the matched limit order in the book. The volume of the transaction corresponds to the volume of the smaller order. The volume of both orders will be reduced by the volume of the transaction and each order with volume zero is deleted from the order book and marked as completed. The incoming order will continue to match with opposite orders until either its volume is reduced to zero or until it does not match opposing orders anymore. In this case, the 44 CHAPTER 5. HISTORIC INTRADAY MARKET SIMULATOR order will stay active in the book with its remaining volume at its maximum price. If the order does not match an active order in the order book, it is labeled as limit order and included as an active order in the LOB. Finally, all market and order information is stored and the next item of the order ﬂow is processed. 5.3 Validation The exclusion of available ex-post order information and the insuﬃcient description of market actions and order restrictions in the EPEX SPOT order ﬂow leads to an error in the reconstruction of the historic limit order book state. To quantify this error and validate the market state reconstruction, the transactions being generated during the simulation of the historic market data are compared to the EPEX SPOT transaction dataset described in Section 4.1. The EPEX SPOT transaction data contains all individual German intraday transactions with their volume and price information. The transaction data represents ground-truth information and the transactions generated by the simulation should match them as closely as possible. The simulated transactions and the original transactions are compared in three categories using data from April 2015 to December 2016. These categories are: • Number of trades • Traded volume • Volume weighted average price For the comparison, the error metrics described in Table 5.2 are used. The error is calculated for each delivery time for each day. This means they are calculated separately for each individual delivery time, e.g. delivery time: 25.05.2015 12:30 - 12:45. The errors are then aggregated using the diﬀerent metrics from Table 5.2. Figure 5.2a compares the total number of transactions per delivery time, Figure 5.2b compares the average price per delivery time and Figure 5.2c compares the total transaction volume per delivery time. The comparisons of Figure 5.2 show that there is a very high correlation in between the outcome of the historic market simulation and the transaction data baseline. The simulated data always reﬂects the shape of the transaction data and reproduces it almost perfectly in case of the price and the volume. Only the number of transactions is overestimated in the simulation. Table 5.2 shows the quantitative results of the comparison. The total volume of the simulated transactions was oﬀ by 12.73 % and the total number of trades by 9.36 %. Note that absolute values per delivery time were used for the comparison, hence there is no disguised symmetric error. For the sake of completeness, the total price error is given in the last column, even if the average, respectively the median error per delivery time is probably more meaningful. All three error categories have a skewed error distribution, meaning that the median does not equal the mean. This 45 CHAPTER 5. HISTORIC INTRADAY MARKET SIMULATOR Figure 5.1: Work ﬂow of the historic order ﬂow simulation. 46 CHAPTER 5. HISTORIC INTRADAY MARKET SIMULATOR is evidence of few delivery times which have a large error while most of the delivery times have a small error. This can be seen best at the price which has the highest mean error per delivery time but by far the lowest median error. The reason for the strong skewness of the price error could not be determined deﬁnitely but Figure 5.2 shows that the error for the traded volume is highest at the hourly peak of trading volume. A possible reason for this observation is the inability to identify order restrictions. Section 2.4.2 presents the diﬀerent possibilities that market participants have to restrict the execution of their orders. An example of an restriced order is a ﬁll-or-kill order. Fill-or-kill orders are only executed if they are matched immediatly and entirely. This allows their usage to test the market for hidden liquidity (iceberg- orders)(Cesari et al., 2012). In the trading process, large orders are often partially hidden to limit their impact on the market price. If a trader suspects the existence of a so-called iceberg order at a price that would be advantageous for him, he submits a ﬁll-or-kill order at this price. If there are iceberg orders available at this price, the ﬁll-or-kill order will reveal and match them. If this is not the case, the order is canceled without being executed. During the simulation order restrictions can not be identiﬁed and the order is submitted without restrictions. In the case of a ﬁll-or-kill order, this means that the order can match existing orders even if it is only ﬁlled partially. The missing restriction information explains the overestimation of the number of trades. However, it does ﬁnally clarify that the traded volume is underestimated at the same time. Table 5.2: The table shows diﬀerent error metrics for the validation of the simulation of historic market data. Therefore the simulated transactions are compared to the EPEX SPOT transaction dataset. xi is the total simulated value of the compared category (e.g. volume) per delivery time and ˜xi is the total value of this category based on the EPEX SPOT transaction data. n is the total number of delivery time/day combinations being compared (e.g. one week has 7 · 96 diﬀerent delivery time/day combinations). Name of error metric Equation Volume No. of trades Price Total error ∑n i |xi − ˜xi| 866000 MWh 476000 19300 EUR MWh Total error in % ∑n i |xi−˜xi| ∑n i |˜xi| 12.73 % 9.36 % 4.04 % Mean error per indi- vidual delivery time in % 1 n ∑n i | xi ˜xi | 11.58 % 8.86 % 13.52 % Median error per in- dividual delivery time in % median(| xi ˜xi |) 6.6 % 6.17 % 1.38 % 47 CHAPTER 5. HISTORIC INTRADAY MARKET SIMULATOR 0 10 20 30 40 50 60 70 80 90 100 Delivery time (as 15 minute increments) 2 3 4 5 6 7 8 9Number of trades 104 Number of transactions average per delivery time from Apr 15 to Dec 16 Intraday transaction data (baseline) Order book simulation (a) 0 10 20 30 40 50 60 70 80 90 100 Delivery time (as 15 minute increments) 15 20 25 30 35 40 45 50Price in EUR/MWh Volume weighted average transaction price average per delivery time from Apr 15 to Dec 16 Intraday transaction data (baseline) Order book simulation (b) 0 10 20 30 40 50 60 70 80 90 100 Delivery time (as 15 minute increments) 0 1 2 3 4 5 6 7Volume in MWh/quarter hour 105 Total transaction volume per delivery time from Apr 15 to Dec 16 Intraday transaction data (baseline) Order book simulation (c) Figure 5.2: Comparison of the transactions generated by the simulation of the order ﬂow and the EPEX SPOT transaction data. 48 CHAPTER 5. HISTORIC INTRADAY MARKET SIMULATOR 5.4 Conclusion In this section, the EPEX SPOT M7 order ﬂow data was successfully used to reconstruct the market state over the full trading period for every individual delivery time. The instructions for the reconstruction of the market state, especially the interpretation of the order ﬂow, are presented in detail to allow repetition of the process. The order ﬂow based market simulation is used in two ways. The ﬁrst objective is to determine the market state, described by diﬀerent variables, at the moment of order submission. The so created enriched order ﬂow is used in the next chapter to implement a stochastic market model. The second application is the usage as a market model. The presented simulation recreates the full state of the market for each delivery time for the whole trading period. To use the market simulation as a market model, the simulation is done as usual but it accepts orders from artiﬁcial market participants at any time. These market participants will then be priced with the pay-as-bid principle based on the available orders. This models market prices as volume and trading time dependent. In the end of this chapter, the market model was validated by comparing the outcome of the simulation, the transaction, to the EPEX SPOT transaction data set. The validation showed that the outcome of the market simulation is close to the real transaction. The presence of an error must not be misinterpreted as a drawback compared to the transaction data, as the simulation of the order ﬂow gives information of the full market state at every time during the trading period and not only about the transaction at the moment of a transaction. 49 Chapter 6 A Stochastic Model of the Intraday Market In Chapter 5 the possibility to use the historic market simulator as a market model was discussed. This market model has some signiﬁcant advantages over state of the art market models of the German intraday electricity market, in particular its ability to model the volume sensitivity of prices and the pay-as-bid principle. However, it still has shortcomings compared to state-of-the-art models for stock markets. Firstly, it requires the full set of historic order book data for the period that should be simulated. This data set is only commercially available and its size makes it unhandy to use. Secondly, the model is not able to model the response of the market participants to new, simulated trades. No matter what actions a market participant takes, only historical orders will be included in the order book. As an attempt to solve these weaknesses, a new model is proposed in this section. For the new model, events are purely simulated based on probabilistic arrival intensities. These, and any other simulated trader aﬀect the market state. These interactions will be modeled by conditional and stationary probability distributions. In the following, the new market model is deﬁned by identifying all market actions that aﬀect the market state. Afterwards, a model for each individual component of each modeled market action is proposed, and ﬁtted using the enriched order ﬂow data that was generated in Chapter 5. Finally, all parts are assembled, the market is simulated and the results of the simulation are compared to historic market data. 6.1 The Market Model Limit order book modeling is a common topic in economics and ﬁnance (Gould et al., 2013)(Jiang et al., 2011) but has not been applied yet to the German intraday market for power. In this Section, a zero-intelligence model based on the work of (Toke and Yoshida, 2016) will be applied to the German electricity intraday market. A great advantage of the zero-intelligence approach is that it oﬀers the possibility of a modular approach. The order book model can be implemented using simple 50 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET stationary distributions which can later be replaced step-by-step by more complex, and more suitable distributions and random processes. To identify the diﬀerent processes and market dynamics that have to be modeled, the state of the limit order book was observed. The diﬀerent actions that market participants can choose from were described in Section 2.4.2. Market participants can either submit a limit order, a market order or an iceberg order. Additionally, market participants can modify, temporarily deactivate or cancel their existing limit orders. To minimize the complexity of the developed market model, this thesis focuses on the modeling of the submission of limit and market orders to buy and sell power as well as order cancellations. This means iceberg orders, order deactivations and modiﬁcations are omitted in the stochastic model. Due to the modularity of the zero-intelligence approach, the omitted market dynamics could be modeled and added in the future. Figure 6.1 shows the modeled market dynamics. Market participants either want to buy power or they want to sell power. Each of those can be achieved by submitting a limit order to buy or sell power or by submitting a market order to buy or sell power. Additionally market participants can cancel active limit orders. The modeled market actions have diﬀerent impacts on liquidity: Limit orders provide liquidity by adding volume to the limit order book, while market orders and cancellations retrieve volume, and therefore liquidity from the book (see Section 2.4.2. To be fully deﬁned, a limit order needs a price, a volume and a submission time; A market order only needs the time of submission and a volume. In the following, the modeling process of those three order properties is described, followed by the modeling of cancellations. All ﬁgures and models are created based on EPEX SPOT limit order book data from April 2015 to November 2016. Data from December 2016 is spared for validation. Table 6.5 compares the models used by (Toke and Yoshida, 2016) with the models used in this thesis. At the same time it can be used as an overview of the ﬁnal model used in this thesis. 6.2 Modeling of Order Flow Intensities 6.2.1 Arrival Time A Market State dependent Model of Order Arrivals (Toke and Yoshida, 2016) models the arrival time of orders as point process with a market state dependent intensity. The order arrival intensity is deﬁned as the number of orders that are expected to arrive within a ﬁxed time interval. Equation 6.1 shows the proposed relationship in between the market state and the arrival rate 51 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET Market state Sell market order Sell limit order Buy limit order Buy market order Cancellation Figure 6.1: Illustration of the components of the stochastic limit order book model of market orders. λM (t; S(t), q1(t)) = exp[β0 + β1 ln(S(t)) + β11[ln(S(t))] 2 + β2 ln(1 + q1(t)) (6.1) + β22[ln(1 + q1(t))] 2 + β12 ln(S(t)) ln(1 + q1(t))] λM is the arrival rate for market orders, S is the bid-ask-spread, q1 is the volume at the best opposite oﬀer (price). The model for the arrival time of limit orders is similar to equation 6.1 but it uses the volume available at the 10 best quotes q10 instead of q1. The modeling choice in (Toke and Yoshida, 2016) was driven by two factors: The ability to reproduce empirically observed market dynamics and by robustness. λ M is related to its inputs via an exponential function, which ensures the non-negativity of λM . At the same time, the logarithm is taken of all variables so that their inﬂuence in the end is linear or quadratic. The choice of a quadratic term is important, so that non-linear relationships can be modeled. (Toke and Yoshida, 2016) chooses the bid-ask-spread and the volume available at the best opposite price (or the best 10 opposite prices for limit orders) as the market state used to control the order submission intensity. The motivation is the following: If the bid-ask-spread is high, traders have a high motivation to submit a limit order instead of a market order. In this case, a trader can submit his limit order in front of the stack (highest price for buy oﬀers, lowest price for sell oﬀers), which means that the order is likely to get matched, and still get a much more favorable price than if he had submitted a market order. If the bid-ask-spread is low, the price diﬀerence between a market order and a limit order that is at the front of the stack 52 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET is small. This motivates a trader to submit a market order rather than a limit order. A similar line of thinking applies to the volume. If there is a lot of volume available close to the bid-ask spread, a trader will rather submit a limit order than a market order. If there is only little volume available close to the bid-ask spread, there will be a rush for the last well priced Units of power and a trader will more likely submit a market order. Measuring the Order Arrival Intensity The order arrival intensity λ is deﬁned as the number of orders N that arrive in a ﬁxed period of time τ : λ = N τ (6.2) ˆλ, the empirical order arrival intensity, is determined separately for buy market or- ders, ˆλ BM , buy limit orders ˆλBL, sell market orders, ˆλSM , and sell limit orders, ˆλSL. For an empirical measurement of λ the data was binned by order type and by individual order book (for every delivery time on every day, an individual order book is opened). For each order book, the last two hours before delivery are analyzed. To calculate ˆλ a time window with length τ is placed at the beginning of the two hours order stream. All orders that arrive in that window are counted and the window slides forward by one minute. Each time the window slides, it generates one new value for λ. The value of λ is stored together with the order and market information related to that time window. As the market will change during the length of the window, the information is aggregated using the mean of all available information. For example, if in one window three orders occur, there are up to three diﬀerent values for the bid-ask-spread. The information that will be stored together with λ is the mean of all three bid-ask-spreads. Model Modiﬁcations The model proposed in (Toke and Yoshida, 2016) was created based on the properties of diﬀerent stock markets. These markets and the German electricity intraday market are all based on the limit order book. Nontheless, this does not mean that they are perfectly alike. The most important diﬀerence is the expiration date at the electricity market. The stock markets under reserach by (Toke and Yoshida, 2016) close everyday at 17:30. After market closure the stocks can continue to be traded the next day starting at 09:00. At the power market, all open positions have to be settled by market closure; otherwise, the market participants must pay for the required balancing power. This results in an exponential rise in trading activity. Figure 6.2 shows the distribution of order arrivals by trading horizon. The trading horizon is the time that is left until physical delivery at the moment of order submission. 53 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET The intraday market closes 30 minutes before physical delivery. Hence unlike at the stock market, the trading horizon plays a major role for the intensity of order submission at the German intraday electricity market. Therefore, for this thesis, the model of (Toke and Yoshida, 2016) is adapted so that the horizon inﬂuences the order submission intensity. Distribution of order submission by trading horizon 0 1 2 3 4 5 6 7 8 Time until market close in hours 0 2 4 6 8 10 12 14Counts 105 Figure 6.2: Distribution of order arrivals in the last eight hours before market closure. Equation 6.3 shows the modiﬁed version of the model. Compared to equation 6.1, the horizon H(t) enters the equation both linearly and quadratically in the same way as the other variables. Additionally, interaction terms between the horizon and the other variables are added. λ M (t; S(t), q1(t), H(t)) = exp[β0 + β1 ln((S(t)) + β11[ln(S(t))] 2 (6.3) + β2 ln(1 + q1(t)) + β22[ln(1 + q1(t))]2 + β3 ln(H(t)) + β33[ln(H)] 2 + β12 ln(S(t)) ln(1 + q1(t))] + β13 ln(S(t)) ln(H(t))] + β23 ln(H(t)) ln(1 + q1(t))]] Model Fitting The model is ﬁtted with general linear model (glm) regression (Dobson and Barnett, 2008) using the matlab built-in function glmﬁt with a poisson link function. The input data was normalized by dividing it by its standard deviation. The results of the ﬁtting are shown in Table 6.1. The ﬁtted parameters reveal that there are signiﬁcant diﬀerences between the diﬀerent models. It was expected that models for market and limit orders are diﬀerent but it was unanticipated that the diﬀerence between buy and sell orders of the same type are this strong. The ﬁrst ﬁtting result 54 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET Table 6.1: Parameters of the modiﬁed Toke model for the order arrival intensity shown in Equation 6.3 Order type Parameters β0 β1 β11 β2 β22 BL -0,3581 0,0369 -0,0997 0,8927 -0,3442 SL -0,7466 -0,0065 -0,1023 1,3353 -0,5248 BM 0,2206 -0,1168 -0,0711 1,7604 -0,6872 SM 0,3594 -0,1487 -0,0676 1,7957 -0,7096 Order type Parameters β3 β33 β12 β13 β23 BL -0,2988 -0,4696 -0,1782 -0,0517 -0,0653 SL 0,2161 -0,7039 -0,1686 -0,0360 -0,1594 BM - 0,9709 -0,2157 -0,0709 -0,1105 -0,5295 SM -1,2794 -0,0558 -0,0665 -0,0682 -0,5113 is that β1 is an important parameter for all order types; it has a negative inﬂuence on limit orders and a positive inﬂuence on market orders. This is in line with the claim of (Toke and Yoshida, 2016) that a small spread is an incentive for market orders. 6.2.2 A Power Law Model for Arrival Intensity Instead of the arrival time model in (Toke and Yoshida, 2016) this thesis proposes a market state independent model based on a power law. The power law shown in 6.4 is ﬁtted to the average arrival intensity by horizon. Therefore, the order arrival intensity calculated in Section 6.2.1 is binned by trading horizon. For each bin, the average arrival intensity is calculated. The power law is ﬁtted in a least-squares sense, using the logﬁt toolbox1. Figure 6.3 shows the average arrival rate per horizon as small crosses and the power law ﬁt as dotted line. Figure 6.3a shows the results for buy limit orders and Figure 6.3b for buy market orders, sell order results are equivalent. The ﬁt represents the empirical data very well, only limit orders are overestimated at short horizons. To prevent this, arrival rate values will be limited to the empirical maximum value during the simulation. Table 6.2 shows the parameters of the power law arrival rate 1https://de.mathworks.com/matlabcentral/fileexchange/29545-power-law-- exponential-and-logarithmic-fit 55 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 50 60 70 80 90 100 110 120 130 140 150 Trading horizon in minutes 5 10 15 20 25 30Arrival intensity in orders/15 Minutes Average arrival rate by horizon fitted with power law for buy limit orders Mean arrival rate Power law fit (a) Buy limit orders 50 60 70 80 90 100 110 120 130 140 150 Trading horizon in minutes 0.5 1 1.5 2 2.5 3 3.5 4 4.5Arrival intensity in orders/15 Minutes Average arrival rate by horizon fitted with power law for buy market orders Mean arrival rate Power law fit (b) Buy market orders Figure 6.3: Power law ﬁt of average arrival intensity per trading horizon. model. λ = 10 b · H m (6.4) Table 6.2: Parameters for power law arrival intensity model. Order type m b λmax BL -1.5125 -0.6957 25.9662 SL -1.6467 -0.9140 23.3045 BM -1.7406 -1.8702 4.3012 SM -1.7057 -1.8335 4.2643 6.2.3 Volume model The order size or the order volume is modeled using a mixture model of diﬀerent distributions. The choice of (Toke and Yoshida, 2016) to model the order volume using an exponential distribution with parameter 1 σ , where σ is the median of the order volume was a poor ﬁt to the German intraday electricity market, especially because of its inability to model the clustered distribution of order volumes. Figure 6.4 shows the empirical distribution of buy limit orders that were submitted two hours before market closure with a volume below MW. The maximum volume restriction excludes only about 2% of the orders. The histogram was created with a small bin size of 0.25 MW to illustrate the strong inﬂuence of integer valued volumes. 56 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET All of the bigger spikes are situated at multiples of 5 MW except the ﬁrst large spike which is at 1.25 MW. The empirical distribution suggests the possibility of an underlying exponential law that was fragmented by the discrete spikes and an additional normal distribution which is centered between 20 and 25 MW. This motivates the modeling choice of a mixture model consisting of an exponential distribution, a Gaussian distribution and thin uniform distributions for each integer value in between 0 and 50, 0.1 and 1.25. The width of each uniform distribution is 0.2 MW, which is one tick size around its position. Intraday order volume distribution for buy limit orders 0 5 10 15 20 25 30 35 40 45 50 Volume in MW, delivered for 15 minutes 0 1 2 3 4 5 6Counts 105 Figure 6.4: Distribution of intraday order volume for buy limit orders. Unit is MW, as it is used at EPEX SPOT for 15 minute products. The mixture model is ﬁtted to the empirical distribution using the expectation maximization algorithm described in (Bishop, 2007). Figure 6.5 shows a comparison of the empirical CDF and the CDF of the ﬁtted mixture model of order volumes for buy limit orders. The order volume follows globally an exponential distribution with a higher probability for integer values, which results in the stair-like behavior that can be observed in the graph. The mixture model is able to reproduce the behavior of the empirical distribution almost perfectly. The quality of the ﬁt can also be seen in Figure 6.6 which shows plots the quantiles of the empirical against the quantiles of the modeled distribution. Such a \"Quantile- Quantile\" or \"QQ plot\" shows the similarity of two distributions. A perfect ﬁt would lie exactly on a line deﬁned by x = y. The gaps in the QQ plot are caused by the integer values. The fact that the point after a gap lies close to x = y, drawn as blue 57 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET line, indicates that the integer values are well represented by the uniform distribution. Table 6.3 shows the parameters of the mixture model for the diﬀerent order types. The ﬁrst part shows the mixture weights, the importance of a mixture component. In the Table, the mixture weight of the uniform distribution is the sum of the weights of all uniform distributions corresponding to integer prices. The second part of the Table shows the parameters of the diﬀerent distributions. The parameters of the uniform distribution are not individually shown, to keep the Table small. The mixture models for the diﬀerent order types are similar but there are small diﬀerences between market and limit orders. Limit orders tend to have a higher percentage of integer values. Table 6.3: Parameters for order volume mixture model. Mixture weights are rounded and may not add up to 1. Exp. = exponential distribution, Gauss. = Gaussian distribution, Unif. = uniform distribution, µE = the expectation of the exponential distribution, µG and σG are expectation and standard deviation of the Gaussian distribution. Order type Mixture weights Parameters Exp. Gauss. Unif. µE µG σG BL 0.30 0.05 0.65 5.51 20.97 3.06 SL 0.29 0.05 0.67 4.95 21.14 3.04 BM 0.35 0.08 0.57 3.31 19.25 9.18 SM 0.36 0.08 0.56 3.17 19.24 9.30 58 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 0 5 10 15 20 25 30 35 40 45 50 Volume in MW 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution function of order volume for buy limit orders Empirical data Mixture model Figure 6.5: Comparison of the cumulative distribution functions of the empirical order volume distribution and the ﬁtted exponential-Gaussian-uniform mixture model. 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Modeled distribution 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1Empirical distribution Quantile-Quantile plot of empiric and fitted order volume distribution for buy limit orders Figure 6.6: Quantile-Quantile plot of the empirical order volume distribution and the distribution of the ﬁtted mixture model. 59 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 6.2.4 Price (Toke and Yoshida, 2016) model the price using the relative price. The relative price is the price-distance of an order to the best order of the same side. For the markets that are analyzed by (Toke and Yoshida, 2016), the empirical distribution of the relative order price is a smooth, two-humped distribution that is ﬁt using a mixture model with two Gaussian mixture components. The distribution of relative prices for the German intraday electricity market on the other hand are asymmetric and hard to deﬁne (see Figure 6.7). Another possibility for modeling the placement of limit orders is via the distance to the best opposite order. The distance to the best opposite order describes the diﬀerence in price between the price of an incoming limit order and the best opposite oﬀer. The distance to the best opposite order is deﬁned in equation 6.5 d B new = min x∈A(t) (px) − pnew (6.5) d A new = pnew − max x∈B(t) (px) dB new (or d A new) is the distance to the best opposite oﬀer of a new bid (or ask) with price pnew that enters the order book. A(t) (or B(t)) is the set of all active asks (or bids) that are in the limit order book at time t. px in this equation are all prices of one side (bid or ask) that are active in the order book at time t. The distance to the best opposite order is deﬁned such that it is positive for bids as well as asks. By deﬁnition of a limit order, dB new and dA new are positive for limit orders. Figure 6.8 shows the empirical distribution of the distance to the best opposite oﬀer of incoming buy limit orders. The empirical distribution shown in the Figure excludes values larger than 100 Euro, which counts for about 3% of the data and orders submitted earlier than two hours before market closure which excludes about 27% of the data. The histogram was generated using a small bin width of 0.25 Euro to show that only a slight clustering of the values around integers exists. The empirical distribution of the distance to the best opposite oﬀer is modeled using a log-normal distribution. It was ﬁt using the Matlab built-in ﬁtdist function, which uses a maximum likelihood estimation. The result is also shown in Figure 6.8 as an orange line. The ﬁtted log-normal distribution represents the general characteristics of the distribution well, even though the peak of the log-normal distribution is overestimating the empirical data and the continuous log-normal distribution is unable to represent the small spikes at integer values. For a better view of the ﬁt of the price model, Figure 6.9 compares the cumulative distribution functions (CDF) of the data and the ﬁtted distribution and Figure 6.10 shows the empirical CDF and the CDF of the model plotted against each other as Quantile-Quantile plot. Especially the Quantile-Quantile plot shows that the model is overall a good ﬁt but that it overestimates the empirical distribution between the 60 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 20th quantile (0.2) and the median (0.5). It also shows, that the log-normal model slightly underestimates values between the 80 th and 90 th quantile. Distribution of the relative price of buy limit orders -10 -5 0 5 10 15 20 Distance to best offer of the same side in Euro/MW 0 5 10 15Counts 105 Figure 6.7: Empirical distribution of the relative order price. Histogram of distance to best opposite offer for buy limit orders 0 10 20 30 40 50 60 70 80 90 100 Distance to best opposite offer in EUR/MW 0 0.02 0.04 0.06 0.08 0.1 0.12Probability Density Empirical distribution Log-normal fit Figure 6.8: Distribution of the distance to the best existing opposite order and the maximum likelihood ﬁt of a log-normal distribution. 61 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 0 10 20 30 40 50 60 70 80 90 100 Distance to best opposite offer in EUR/MW 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution function of the distance to best opposite offer for buy limit orders Empirical CDF Modeled CDF Figure 6.9: Comparison of the empirical CDF of the distance to the best quote of buy market orders and the theoretical CDF of the proposed log-normal model. 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Modeled distribution 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1Empirical distribution Quantile-Quantile plot of empiric and fitted distance to best opposite offer for buy limit orders Figure 6.10: Quantile-Quantile plot of empirical and modeled distance to the best opposite oﬀer. 62 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 6.3 Cancellation When trading at the German electricity intraday market, market participants have the possibility to cancel their active orders. Cancellations draw liquidity from the market, just as with market orders. They are therefore an important counterpart to the limit order submission process, and are essential for the equilibrium of the model. Unlike market and limit orders, cancellations are not an independent process where volume or price can be modeled using stationary, ﬁxed distributions; cancellations must refer to active oﬀers. (Toke and Yoshida, 2016) propose a new model for placement and timing of cancellations. Although, their approach to model the placement of limit orders could be directly adapted to the German intraday market for power, their model for cancellation timing must be modiﬁed. 6.3.1 Cancellation Timing (Toke and Yoshida, 2016) chose to model the order submission process via a constant expected lifetime instead of a market state dependent submission intensity. The reason was on the one hand to ensure the robustness of their model and on the other hand that the data that is used by (Toke and Yoshida, 2016) also did not allow tracking of individual orders. To determine the order lifetime distribution, it is assumed that the lifetime of orders is exponentially distributed. The parameter of the exponential distribution is deter- mined by minimizing the diﬀerence between the total volume and the expected total volume in the order book. The EPEX SPOT order ﬂow data allows the tracking of individual orders and we can therefore determine the empirical lifetime distribution of canceled orders. The empirical distribution of the canceled order lifetime can be seen in Figure 6.11. The lifetime has a variance of 41 minutes, the mean lifetime is approximately 102 seconds, while the median is only 6 seconds. About 90% of the orders have a lifetime of under 20 minutes and slightly above 80% percent of the orders have a lifetime of less than a minute. An exception to the rather smoothly distributed data are small peaks at 5 and at 15 minutes. A possible explanation for them could be, that traders can set a maximum lifetime at order submission and arbitrarily choose exact 5 or 15 minutes. By inspection, an exponential distribution for the order lifetime can be rejected, particularly because of the long tail and the high peak at low values. The x-axis of the histogram in Figure 6.11 is limited to 20 minutes but the tail of the distri- bution actually continues until 120 minutes (the maximum). This was because we considered only orders that were submitted in the last two hours before the market closed. The y-axis is limited to a count of 10 × 10 4 orders per bin but the maximum is at 1.2 × 10 6 orders at the lowest bin. These properties are characteristic for power law distributions but none of the common power law distributions could model the 63 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET empirical data well. Of the Pareto, exponential, Weibull and log-logistic distributions, the log-logistic distribution provided the best overall ﬁt and was therefore chosen for the modeling of order lifetimes. Figure 6.12 schows the QQ plot of the empirical distribution and the ﬁtted log- logistic distribution as well as the QQ plot of the empirical distribution and the ﬁtted exponential distribution. The Figure shows that the log-logistic distribution can not fully represent the empirical data but provides a signiﬁcantly better ﬁt than Toke’s exponential lifetime model. Until about the 70th quantile, the log-logistic model can follow the trend of the empirical distribution, at which point, it starts overestimating. A more detailed inspection of the data gave hints that the beginning of the distribution is exponentially distributed before its long-tailed behavior appears. Future modeling approaches could investigate a mixture model of an exponential and a heavy tailed distribution, in an attempt to divide the empirical distribution into head and tail components as in (Adler et al., 1998). Alternatively, non-parametric ﬁtting methods could be used.. Histogram of buy limit order lifetime 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 Lifetime in Minutes 0 1 2 3 4 5 6 7 8 9 10Count 104 Figure 6.11: Empirical distribution of the lifetime of canceled orders submitted two hours before market close. 6.3.2 Cancellation Placement A complete model of the cancellation process requires the following information: The cancellation time and which order is to be canceled. The place of a limit order in the order book is deﬁned by its price. But a price based model, as used for the placement of limit orders, is unsuitable for two reasons. Firstly, not all prices are 64 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 0 0.2 0.4 0.6 0.8 1 1.2 Modeled quantiles 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1Empirical quantiles Quantile-Quantile plot for buy limit order lifetime Exponential model Log-logistic model x = y Figure 6.12: Quantile-Quantile plot for diﬀerent models for canceled order live time. present in the order book at all times, so a price dependent cancellation placement would have to deal with the problem approximating an existing price, based on a price generated by the model. Secondly, the actual prices of existing orders are highly dependent on the current state of the order book. Cancellations occur mostly close to the bid-ask-spread; a cancellation placement model based solely on absolute prices would ignore this fact. (Toke and Yoshida, 2016) proposes a new variable, the priority index ξ, that indicates how the order is placed compared to all other orders of the same side. The priority index of an order is the \"priority volume\" divided by the total volume available at the same side of the order book and therefore ξ ∈ [0 1]. The \"priority volume\" of an order is the cumulated volume of all orders from the same side that have a higher execution priority against market orders. This means all orders with a lower price for the ask side and all orders with a higher price for the bid side of the book. If several orders have the same price, the order that was submitted ﬁrst has priority. The priority index was calculated for each cancelled order at the moment of its cancellation during the simulation of the historic market data described in Chapter 5. For simplicity, we stick to the approach of (Toke and Yoshida, 2016) and assume that the canceled order is always in the middle of a stack of active orders with the same price. This means that the priority volume is the sum of all orders with a higher price, plus half of the orders with the same price. The empirical distribution of the priority index of orders in the moment of cancellation can be seen in Figure 6.13. The distribution shows that the priority index is very 65 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET likely to be low. 88% of the canceled orders have a priority index below 0.1 and 36% of the canceled orders have a priority index of 0. The priority index is in between 0 and 1 but 99% of the values lie in between 0 and 0.5, for a better visibility of the empirical distribution, the histogram plot in Figure 6.13 is limited to this area. The empirical distribution has a small spike around 1. 0.13% of the priority index is in between and including 0.99 and 1, compared to only 0.003% that are situated in between and including 0.97 and 0.98. Empirical distribution of the priority index of cancelled buy limit orders 0 0.05 0.1 0.15 0.2 0.25 0.3 0.35 0.4 0.45 0.5 Priority index 0 2 4 6 8 10 12Counts 105 Figure 6.13: Empirical distribution of the priority index for canceled buy limit orders. In (Toke and Yoshida, 2016) the priority index follows a very smooth power law distribution for the stocks investigated. Such a smooth distribution is not present in the priority index of the German intraday electricity market. The empirical distribution shown in Figure 6.13 consists of a large spike at 0 and a distribution with a long thin tail that could not be determined. For this thesis, the distribution is therefore approximated by a mixture model of three Gaussians and two thin uniform distributions with a width of 0.002 which model the peaks at 0 and 1. The mixture model is ﬁtted using the EM algorithm described in (Bishop, 2007). The results of the ﬁt are presented in Table 6.4. The ﬁrst ﬁnding of the ﬁt is that the distribution of the priority index is very similar for buy and sell limit orders. The small values of the distribution are approximated with one very thin and one thin (= small standard deviation) Gaussian distribution which are equally important. The third Gaussian distribution approximates the tail for medium values of the distribution. For both order types, the uniform distribution at ξ = 0 has the highest weight, while the uniform distribution at ξ = 1 is rejected. Figure 6.14 shows the cumulative distribution function for both the empirical data and the ﬁtted mixture model for buy limit orders. The CDF plot shows that the 66 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET Table 6.4: Parameters of the ﬁt for the priority index mixture model. BL = Buy limit order, SL = Sell limit order, Gauss. = Gaussian distribution, Unif. = Uniform distribution, µ and σ are the expectation and the standard deviation of the Gaussian distributions. Order type Mixture weights Gauss. 1 Gauss. 2 Gauss. 3 Unif. 0 Unif. 1 BL 0.27 0.26 0.07 0.39 0.00 SL 0.22 0.23 0.08 0.47 0.00 Order type Parameters µG1 σG1 µG2 σG2 µG3 σG3 BL 0.01 0.01 0.07 0.04 0.30 0.20 SL 0.01 0.01 0.08 0.05 0.34 0.21 mixture model follows the empirical distribution closely but a look at the Quantile- Quantile plot of both distributions in Figure 6.15 shows that the mixture model is slightly oscillating around the empirical distribution alternating between over- and underestimation. This is a hint that the Gaussian distributions can not reproduce the underlying distribution which has to be compensated for by a higher number of Gaussian distributions. Future alternatives to this mixture model could include a mixture model with other component, for example power law distributions or a non-parametric approach. 67 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 0 0.2 0.4 0.6 0.8 1 1.2 Priority index 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution function of the priority index for buy limit orders Empirical data Mixture model Figure 6.14: Comparison of the empirical CDF of the priority index for buy market orders with the CDF of the proposed log-normal model. 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Modeled distribution 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1Empirical distribution Quantile-Quantile plot of empirical and fitted priority volume distribution for buy limit orders Figure 6.15: Quantile-Quantile plot of empirical and modeled priority index distribu- tion. Plot starts at approximately 0.4 because about 40% of all priority index values are 0. 68 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 6.4 Market simulation To evaluate the performance of the stochastic market model, intraday trading is simulated for every delivery time from the 1 st until the 30 th of December 2016 2. For the market simulation, it is assumed that the market state can only be changed by one of the actions presented in Figure 6.1. These actions are the following: • Buy limit order • Buy market order • Sell limit order • Sell market order • Cancellation Each of these actions is performed by one agent who acts as representative for all market participants that perform this action. Each agent is fully controlled by the stochastic models presented in the previous sections. All models are ﬁtted using data from December 2015 until November 20163. This means, that the models are evaluated on unknown data. For the simulation, the market state is reconstructed using the historic market simulator from Chapter 5. 120 minutes before market closure, the state of the market is copied. From then on, three diﬀerent versions of the market state exist. The ﬁrst one will continue with the historic simulation based on the EPEX Spot order ﬂow data and will serve as baseline for the performance of the stochastic models. The last 120 minutes of trading of the second version will be simulated using the market state dependent exponential model based on the work of (Toke and Yoshida, 2016). The third version will be simulated like the second version but with the power law model from Section 6.2.2 for the arrival intensity. The simulation is performed for every delivery time on every day in the simulation period independently. For the market state dependent exponential model, the arrival intensities for the diﬀerent order types are calculated using equation 6.3. For the power law model, the arrival intensity is calculated using 6.4 with only the current horizon as input. It is assumed, that λ is approximately constant in between two arrival times. This allows calculating the arrival time of the next order of type x using Equation 6.6 from (Gubner, 2006, Page 447). t x next = w · −log(U ) λx + tnow, x ∈ {BL, BM, SL, SM } (6.6) 2Last day of December was omitted because it was not complete after time stamps were shifted to UTC0 3The parameter and graphs presented in Section 6.2 are also based on this period. 69 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET U ∈ [0, 1] is a uniform random number, w is the length of the window that was used to calculate λ from the empiric data in Section 6.2.1. After generating one arrival time per order type, the most recent order arrival is processed. Depending on the order type, all necessary order information are sampled in the following way: Volume The volume of an order is sampled using the mixture model presented in Section 6.2.3. At ﬁrst, one of the mixture components is drawn randomly with a probability that correspondents to the mixture weight. Then a random number is sampled from the chosen distribution and deﬁned as volume for this order. All market orders are complete after this step. Price Limit orders are deﬁned by a volume and a price. The price is determined via the distance to the best opposite order using the log-normal model presented in Section 6.2.4. The price for limit orders is determined by rearranging Equation 6.5 to: pB = min x∈A(t) (px) − dB (6.7) pA = d A − max x∈B(t)(px) B indicates the bid-side, A indicates the ask-side of the limit order book. d is the sampled distance to the best opposite oﬀer, it is used to calculate the price p of the next order. Cancellation time Cancellations are modeled via the lifetime of limit orders in the book. For each incoming limit order, the lifetime of this order is sampled from the log- logistic lifetime distribution presented in Section 6.3.1. During the simulation, individual orders are not tracked. The cancellation time is therefore treated independently from the incoming order and stored in a list with all open cancellations until it is due. After all necessary order information are generated, the order enters the limit order book. After the order was processed, a new arrival time for an order of the same type is sampled using the updated market state variables. Like this, there is always one open order for each order type. If a new order is processed, it is checked if there are outstanding cancellations. If so, they are processed with priority. A cancellation is processed by sampling a priority index using the model presented in Section 6.3.2. It is possible, that there is no order in the limit order book that matches the drawn 70 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET priority index exactly. In this case, the order with the priority index closest to the drawn priority index is canceled. If the simulation time reaches the time of market closure, the simulation stops and the tracked information are stored. 71Table6.5:OverviewofToke’smodelandthemodeldevelopedandusedinthisthesisModelModeledcharacteristicOrderarrivalintensityOrderpriceOrdervolumeCancellationtimeCancellationplacementTokeAmultivariate,marketstatedependentexponentialmodelproposedby(TokeandYoshida,2016):λ(t;S(t),q1(t))=e[···](∗)Basedonrelativeprice∗∗∗,modeledusinganunconditionalGaussianmixturemodelwith3components:f(x)=3∑k=11√2πσ2k·e(−(x−µk)22σ2k)Exponentiallydistributedordersize:λeλxWith1λdeﬁnedasthemedianofallordervolumes.Modeledviaorderlifetime.Assumesexponentialorderlifetimedistribution:f(x)=λeλxForexponentialdistributedlifetimes,thecancellationintensityforallorders,λtotal,canbecalculatedas:λtotal=n·λWithn=thetotalnumberofordersintheLOB.Introducesthepriorityindexξforthepositionofacanceledorderinthelimitorderbook.Thedensityofξismodeledusinganunconditional,scaledtruncatedpowerlaw:f(ξ)=σ(α+1)(1+σ)α+1−1(1+σξ)ααandσarethedistributionparameters.FinalmodelHorizondependentmodiﬁcationoftheToke’smodel:λ(t;S(t),q1(t),H(t))=e[···](∗∗)Andanunivariatepowerlawmodelasalternative:λ(t;H(t))=10b·HmExemplarytheparametersforbuylimitordersubmission:bBL=−0.69mBL=−1.51Basedondistancetothebestoppositeorder,modeledusingalog-normaldistribution:f(x)=1x·√2πσ2exp(−(ln(x)−µ)22σ2)Mixturemodelwithoneexponential,oneGaussianand52uniformcomponents:f(x)=1√2πσ2·e(−(x−µ)22σ2)+λe−λx+52∑i=1U(ki)U(k)={12dk−d≤x≤k+d0otherwiseWithd<<range(x)andki∈{1,2,...,50}⋂{0.1,1.25}.Modeledviaorderlifetime.Lifetimeisbestdescribedvialog-logisticmodel:f(x)=βα(xα)β−1(1+(xa)β)2Forlog-logisticdistributions,thearrivalrateλisnotconstant.Therefore:λtotal̸=n·λCancellationtimesaresampledforeachincominglimitorder.Theconceptofthepriorityindexξforthepositionofacanceledorderisadapted.ThedistributionofξismodeledusingamixturemodelofthreeGaussiandistributionsandtwouniformdistributions:f(x)=3∑k=11√2πσ2k·e(−(x−µk)22σ2k)+2∑i=1U(ki)U(k)={12dk−d≤x≤k+d0otherwiseWithd<<range(x)andki∈{0,1}.Mainaccom-plishmentsImplementationandtestofToke’smodel;identiﬁcationandimplementationofanewmodelthatﬁtspowermarketorderarrivalbehavior.AnalysisandrejectionofToke’smodel,identiﬁcationandimplementationofanalternative.AnalysisandrejectionofToke’smodel,identiﬁcationandimplementationofanalternative.ImplementationandrejectionofToke’smodel,identiﬁcationandimplementationofanalternativethatﬁtsintradaybehavior.AdaptionofToke’sconceptwithanalternatemodelsuitableforpowermarketcharacteristics.∗λM(t;S(t),q1(t))=exp[β0+β1ln((S(t))+β11[ln(S(t))]2+β2ln(1+q1(t))+β22[ln(1+q1(t))]2+β12ln(S(t))ln(1+q1(t))]]∗∗λM(t;S(t),q1(t),H(t))=exp[β0+β1ln((S(t))+β11[ln(S(t))]2+β2ln(1+q1(t))+β22[ln(1+q1(t))]2+β3ln(H(t))+β33[ln(H)]2+β12ln(S(t))ln(1+q1(t))]+β13ln(S(t))ln(H(t))]+β23ln(H(t))ln(1+q1(t))]]∗∗∗distancetobestorderofthesameside CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 6.5 Results During the simulation, order information and information about the state of the market at the time of order submission are tracked. This information is now used to compare the outcome of the simulation of the market state dependent exponential model and the power law model with the historic course of the market. This is done by comparing the marginal distributions of the simulated and the empirical data in three categories: Order Submission, Cancellations and Market state. The ﬁrst two categories are directly linked to the used models, while the third category is a result of submitting or canceling the right order at the right time. The comparison of the marginal distributions shows if a model is able to represent the overall behavior of the modeled process but it gives no information if the simulation the market model is actually close to the real market behavior in an individual situation. Table 6.5 gives an overview of the diﬀerent models used for each order characteristic and compares them to the models used by (Toke and Yoshida, 2016) 6.5.1 Order Submission The order submission process is deﬁned by three properties: The arrival time of the order, the price of the order and the volume of the order. In the following, the simulated results of all three properties are compared to the empirical data from the simulation of the historical data. Figure 6.16 shows the distribution of the number of submitted orders (of all types) by horizon. It is striking, that the Toke’s market state dependent exponential model is underestimating the empirical distribution by about a power of ten. The power law model, that is solely dependent on the horizon, is able to represent the general trend of order submission well. This shows that the most important incentive for traders at the German intraday electricity market to submit orders is the trading horizon. This is an important diﬀerence from stock markets, where market state variables like the spread or the available volume have a strong inﬂuence. Toke’s model is therefore not appropriate, and won’t be included in the following comparisons. The power law distribution is slightly overestimating the empirical data and it is unable to follow the deviations from the power law behavior. These deviations could be the dependency of the order submission intensity to other market state variables. The distribution of submitted order prices in Figure 6.17 shows that the price model is able to represent the general trend of the empirical order price distribution. This is especially remarkable because the price model based on the distance to the best opposite oﬀer, was proposed in this work as a simpliﬁcation to the more commonly used models based on the relative price. Regardless of the good performance - complexity ratio, the price model has a tendency to extreme values. Figure 6.17 73 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET Number of order arrivals by horizon 40 60 80 100 120 140 Horizon in minutes 0 2000 4000 6000 8000 10000 12000 14000 16000 18000Count Proposed power law model Empirical data Toke's model (modified) Figure 6.16: Comparison of simulated and empirical number of submitted orders. -50 0 50 100 150 Order price in EUR/MWh 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution functions of order prices Empirical market data Simulated market data Figure 6.17: Comparison of the simulated and the empirical distribution of order prices. 74 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET Figure 6.18 compares the cumulative distribution functions of the empirical and the simulated order volume distribution. The proposed volume model can represent the clustering around integers of the order volume. However, it signiﬁcantly overestimates the order volume. The reason for the overestimation could be that order sizes at the intraday market changed substantially over the curse of the last year. The order volume model is ﬁtted to data from April 2015 to November 2016. It is possible that events or developments like the introduction of the intraday auction (Neuhoﬀ et al., 2016) or the general rise in trading volume (see Figure 1.4 impacted the distribution of order sizes. 0 5 10 15 20 25 30 35 40 45 50 Order volume in MW 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution functions of order volumes Empirical market data Simulated market data Figure 6.18: Comparison of the simulated and the empirical distribution of order volumes. 6.5.2 Cancellations The cancellation model requires two pieces of information: The time of the can- cellation and the position of the canceled order. Figure 6.19 shows the empirical distribution of cancellations over the simulation period. For a better visibility, the histogram of the simulated cancellation times is shown as a line with crosses at the mean value of the corresponding bin. The empirical distribution seems to oscillate around a mean value with sometimes large spikes in either direction. The distribution of simulated cancellations is relatively constant and slightly underestimates the mean value of the empirical data. The number of cancellations over time is constant because the number of cancellations is solely depending on limit order submissions. The latter in turn is only dependent on the horizon, which behaves equally for all delivery times. The overall behavior of the cancellation model is satisfactory because 75 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET it can approximately represent the average number of cancellations over time. Distribution of absolute cancellation times 03.12 08.12 13.12 18.12 23.12 28.12 Cancellation time, bin width = ~12 hours 0 2000 4000 6000 8000 10000 12000 14000 Empirical market data Simulated market data Figure 6.19: Comparison of the simulated and the empirical distribution of can- cellation times. Both, the bars and the crosses are histogram data but they were presented diﬀerently for a better visibility. If an open cancellation is due in the simulation, the canceled order is determined via its execution priority in the book (see Section 6.3.2. This position is described via the priority index. Figure 6.20 compares the distribution of the empirical and the simulated priority index of canceled orders. The model for the priority index has the same shape as the empirical data but it is overestimating it. Similar to the results of the order volume, it could be that the cancellation behavior changed over the time span of the training data. Unless there are reasons to adopt one of the hypotheses above, though, it seems more likely that the model used to ﬁt the priority index is only moderately suitable, or that the concept of placing cancellations using the priority index is incompatible with the German intraday electricity market. An alternative model which would require detailed tracking of individual orders during the trading time would be the introduction of conditional lifetimes for individual orders. This is left for future work. 76 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 0 0.05 0.1 0.15 0.2 0.25 0.3 0.35 0.4 0.45 0.5 Priority index 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution functions of the priority index of canceled orders Empirical market data Simulated market data Figure 6.20: Comparison of the simulated and the empirical distribution of the priority index of canceled orders 6.5.3 Market State The third category to evaluate the simulation results is the market state. In this category, the marginal distributions of individual market state variables are com- pared. This category is particularly interesting as it allows estimating how close the simulated market state is on average to the real state of the market. Figure 6.21 shows the distributions of the empirical and the simulated best bid and best ask price. The ﬁgures are similar; the simulation results are very close to the empirical distributions with a slight tendency towards underestimating low values and overestimating high values. The similarity of the distribution of a simulated market state variable and the empiri- cal distribution of this variable, does not necessarily mean that the market dynamics are the same. The comparison of the distributions only allows statements about the overall behavior. It is not evident if the state variables were similar at the same time. This is for example illustrated in Figure 6.22. Figure 6.22a shows the empirical and simulated distribution of the mid-price. Here, the simulated results match the empirical data closely. However, Figure 6.22b shows that the simulated bid-ask spread is systematically underestimated. This is possible, because the mid-price is only in average right similar but not always right at the right time. Additionally, the spread can be underestimated symmetrically. 77 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET -50 0 50 100 150 Euro/MWh 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution functions of the best ask price Empirical market data Simulated market data -50 0 50 100 150 Euro/MWh 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution functions of the best bid price Empirical market data Simulated market dataFigure 6.21: Comparison of the simulated and the empirical distribution of the best ask price(a) and the best bid price (b). -50 0 50 100 150 Euro/MWh 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution functions of the mid-price Empirical market data Simulated market data (a) 0 5 10 15 20 25 30 35 40 Euro/MWh 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution functions of the bid-ask spread Empirical market data Simulated market data (b) Figure 6.22: Comparison of the simulated and the empirical distribution of the mid-price (a) and the bid-ask spread (b). 78 CHAPTER 6. A STOCHASTIC MODEL OF THE INTRADAY MARKET 0 200 400 600 800 1000 1200 1400 1600 Volume in MW 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution of the total available ask-side volume Empirical market data Simulated market data 0 200 400 600 800 1000 1200 1400 1600 1800 2000 Volume in MW 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution functions of the total available bid-side volume Empirical market data Simulated market data Figure 6.23: Comparison of the simulated and the empirical distribution of the total volume available per order book side. Figure 6.23 shows the comparison of the total volume that is available at each side (bid and ask) of the order book. The bid-side volume as well as the ask-side volume is overestimated most of the time. An exception are high values of the volume. This is probably the result of the overestimation of order sizes that was shown in Figure 6.18. An argument for this conclusion is that the empirical distribution is not overestimated for high volumes. In times where there is a lot of volume in the market, it is likely that orders are larger in size. In this case, the order volume model would match the empirical order volume and the market state would match the historical state in terms of available volume. 79 Chapter 7 Conclusion and Future Work Main Findings One of the tasks for this thesis was to review possibilities to observe illiquidity in the German intraday electricity market and to ﬁnd ways to include it in a market model. The answer to both questions is the limit order book. Illiquidity is a multidimensional construct and all important measures require speciﬁc knowledge about the state of the limit order book. Market models that are based on the limit order book do consequently have the ability to represent illiquidity. The initially planned usage of the EPEX SPOT transaction data was omitted in favor of working with the EPEX SPOT order ﬂow. In quantitative ﬁnance, market models that are able to represent illiquidity via the state of the limit order book, have been under research for several years. To beneﬁt from this work, a current state-of-the-art stochastic market model was implemented and applied to the German intraday electricity market. Market simulations with this model revealed fundamental diﬀerences between limit order book based stock markets and the German intraday market for power. Notable, in the Germany intraday electricity market there is a strong dependency between trading activity and trading horizon, as well as a strong clustering around integer values for order prices and order volumes. These discrepancies and others, meant that much of current stock market theory was not appropriate for power markets. Therefore, this thesis borrows market model ideas where possible, and otherwise, develops new models which are better ﬁts to the German intraday power market. Contributions The building of the stochastic market model required detailed information about the state of the limit order book at the moment of order submission. This information was generated in a simulation of the historic order ﬂow data. For this simulation the order ﬂow had to be interpreted correctly. Therefore, diﬀerent errors, order types and market actions had to be identiﬁed. This thesis oﬀers a detailed description of how to correctly read the EPEX SPOT order ﬂow in order to reconstruct historic 80 CHAPTER 7. CONCLUSION AND FUTURE WORK market states. The simulation of the historic course of the market was done with a market simulator that was developed for this purpose. The market simulator recreates the state of the market for the whole trading period based on the order ﬂow. This can be used as a simple limit order book based market model. This historic model is capable of approximating illiquidity when simulating new trades for relatively small amounts of power. But the accuracy of this approximation will decrease as the amount of simulated trades increases; since the model is based solely on historic orders, it cannot model the addition of new orders in response to large changes in the order book state. To address these shortcomings, a stochastic market model of the intraday market was developed. It is based on an existing state-of-the-art model created for stock markets. It required extensive modiﬁcations in order to be suitable for the German intraday electricity market. This model can well describe the overall behavior of order submissions and prices well, while it has diﬃculties representing volume. Future Research The historic market simulator developed in this thesis represents a fully functional market market model. Because it is based on the limit order book, it has the potential to outperform market models which are currently used for the German electricity intraday market. A next step is to test and analyze this market model and its potential as a benchmarking system of intraday trading algorithms. The stochastic market model that was proposed in this thesis is, to some extent, able to represent the overall behavior of the market. However, it can not yet be used to simulate the short time development of the market. It lacks the ability to reliably submit the right order at the right time because the model is still based on based on unconditional distributions. The next step would to make the distributions conditional upon market state, which we anticipate, will greatly enhance the possible applications of the model. 81 Appendix A 82 APPENDIX A. A.1 M7 Order Book Data description Anonymized historical data of M7 intraday continuous market orders Field values/format explanation Instrument Type AN/ hour or Quart Hour Delivery Instrument 99.99 or 00.99 hours are identified as 02.00 for hour 2 (1.00 to 2.00) and quarters as 1.15 for the first quarter of hour 2 Delivery Date dd/mm/yyyy Start Validity Date dd/mm/yy hh:mm:ss.msmsms End Validity Date dd/mm/yy hh:mm:ss.msmsms dd/mm/yy hh:mm:ss.msmsms if an order is de-activated and re-activated. The \"Cancelling Date\" field corresponds to the reactivation time. dd/mm/yy hh:mm:ss.msmsms if an order is modified (limit price or volume). The \"Cancelling Date\" field corresponds to the modification time. dd/mm/yy hh:mm:ss.msmsms if an order is directly cancelled by a an action of cancelling. The \"Cancelling Date\" field corresponds to the cancelling action time. empty if an order is executed empty if a good til date order expires empty if the trading session expires Is Executed Num/ 0, 1 or 2 0 : not executed, 1: fully executed; 2: partially executed Status AN/ Y or N Y: active or N: not active Side AN/ B or S B: Buy, S:Sell Price AN/ 13,2 order price Execution Price AN/ 13,2 price at which the order is executed Volume Num 16,1 order volume Execution Volume Num 16,1 volume executed initial ID Num 13 The initial ID always equals the order number that was assigned to an order when it was entered for the very first time. parent ID Num 13 order Number of the previously modified order AN: Alphanumeric NS: numeric signed Num: numeric date: dd/mm/yyyy Time: hh.mm.ss.msmsms Cancelling Date 83 APPENDIX A. A.2 Order volume model 0 5 10 15 20 25 30 35 40 45 50 Volume in MW 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution function of order volume for buy limit orders Empirical data Mixture model 0 5 10 15 20 25 30 35 40 45 50 Volume in MW 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution function of order volume for buy market orders Empirical data Mixture model 0 5 10 15 20 25 30 35 40 45 50 Volume in MW 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution function of order volume for sell limit orders Empirical data Mixture model 0 5 10 15 20 25 30 35 40 45 50 Volume in MW 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1F(x) Cumulative distribution function of order volume for sell market orders Empirical data Mixture model 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Modeled distribution 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1Empirical distribution Quantile-Quantile plot of empiric and fitted order volume distribution for buy limit orders 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Modeled distribution 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1Empirical distribution Quantile-Quantile plot of empiric and fitted order volume distribution for buy market orders 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Modeled distribution 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1Empirical distribution Quantile-Quantile plot of empiric and fitted order volume distribution for sell limit orders 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Modeled distribution 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1Empirical distribution Quantile-Quantile plot of empiric and fitted order volume distribution for sell market orders Figure A.1: Comparison empirical and ﬁtted order volume distribution 84 APPENDIX A. A.3 Market State Variables Variable name Description Initial order information All original order information is trans- ferred to the enriched order ﬂow. For a more detailed description of the original order information see A.1. Added order information Order information that was made avail- able during the simulation of the market. Canceled A ﬂag to indicate if the order was ac- tually canceled during the simulation. The market simulation may diﬀer from the real course of the market because order restrictions (see section 5.1.2) can not be recognized. Distance to best order Price distance to the most favorable op- posite order. Lifespan Total duration that the order was active in the limit order book. Based on the data given by EPEX SPOT, not on the simulation. Market order Set to 1 if the order is a market order. An order is deﬁned as a market order if it matches at least one opposite order in the moment of submission. Priority volume Total volume that has a higher execution priority than an order in the moment of its cancellation. See 6.3.2 for a detailed description. Priority index Is deﬁned as priority volume divided by the total volume available. See 6.3.2 for a detailed description. Modiﬁcation cancellation Flag that indicates if an order that has a time stamp for a cancellation is in reality a modiﬁcation. Is used to distin- guish modiﬁcations from cancellations, see 5.1.2 for a detailed description. 85 APPENDIX A. Modiﬁcation submission Flag that indicates if an item in the or- der ﬂow is a modiﬁcation of an existing order. Is used to distinguish modiﬁca- tions from reborn orders, see 5.1.2 for a detailed description. Market information Volume best order at ask side Cumulated volume of all orders at the best available price at the ask (sell) side of the LOB. Volume best 10 orders at ask side Cumulated volume of all orders at the best 10 available prices at the ask (sell) side of the LOB. Volume all orders at ask side Cumulated volume of all orders at the ask (sell) side of the LOB. Volume best order at bid side Cumulated volume of all orders at the best available price at the bid (buy) side of the LOB. Volume best 10 orders at bid side Cumulated volume of all orders at the best 10 available prices at the bid (buy) side of the LOB. Volume all orders at bid side Cumulated volume of all orders at the bid (buy) side of the LOB. Best oﬀer volume Cumulated volume of all orders at the best opposite price relative to the sub- mitted order. Best bid price The highest buy price that is oﬀered in the LOB. Best ask price The lowest sell price that is oﬀered in the LOB. Bid-ask spread Diﬀerence of the highest buy price and the lowest sell price. Mid price Price that is in the middle of the bid- ask-spread. For example, best bid price + half the bid-ask-spread. 86 APPENDIX A. Relative price Price distance in between the price of the order and the best available price of the same side. Is negative if the order is placed in the bid-ask spread or if it is a market order. Distance to best opposite order Price distance to the best opposite oﬀer. Spread The bid-ask spread Horizon Time until power delivery Minutes since market opening Time since the market opened in min- utes Minutes till market close Time until the market closes in minutes 87 List of Figures 1.1 Comparison of distribution of intraday and balancing power prices . . 3 1.2 Ramping behavior in an energy system with moderate and with high share of intermittent renewable generation . . . . . . . . . . . . . . . 4 1.3 Wind forecast error by forecast horizon . . . . . . . . . . . . . . . . . 6 1.4 Development of yearly spotmarket volumes . . . . . . . . . . . . . . . 6 2.1 Schematic representation day-ahead auction . . . . . . . . . . . . . . 17 2.2 Comparison of trading volume of the intraday auction and the contin- uous intraday market . . . . . . . . . . . . . . . . . . . . . . . . . . . 18 2.3 Example and illustration of transactions and their eﬀect on the limit order book . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21 2.4 Comparison of day-ahead and intraday prices for one day in December 22 2.5 Illustration of a limit order book . . . . . . . . . . . . . . . . . . . . . 24 4.1 Number of intraday transactions per delivery time and price spread per 15 minute window . . . . . . . . . . . . . . . . . . . . . . . . . . 36 5.1 Work ﬂow of the simulation of the historic order ﬂow. . . . . . . . . . 46 5.2 Comparison of the transactions generated by the simulation of the order ﬂow and the EPEX SPOT transaction data. . . . . . . . . . . . 48 6.1 Illustration of the components of the stochastic limit order book model 52 6.2 Distribution of order arrivals by trading horizon . . . . . . . . . . . . 54 6.3 Power law ﬁt for arrival rate . . . . . . . . . . . . . . . . . . . . . . . 56 6.4 Histogram of intraday order volume . . . . . . . . . . . . . . . . . . . 57 6.5 Cumulative distribution function of empirical and modeled order volume 59 6.6 Quantile-Quantile plot of empirical and modeled order volume . . . . 59 6.7 Empirical distribution of the relative order price . . . . . . . . . . . . 61 6.8 Histogram and log-normal ﬁt for price model . . . . . . . . . . . . . . 61 6.9 Cumulative distribution function of empirical and modeled distance to the best opposite oﬀer . . . . . . . . . . . . . . . . . . . . . . . . . 62 6.10 Quantile-Quantile plot of empirical and modeled distance to the best opposite oﬀer . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 62 6.11 Empirical distribution of order lifetime . . . . . . . . . . . . . . . . . 64 88 LIST OF FIGURES 6.12 Quantile-Quantile plot of canceled order lifetime models. . . . . . . . 65 6.13 Empirical distribution of the priority index for canceled orders . . . . 66 6.14 Comparison of the empirical CDF of the priority index for buy market orders with the CDF of the proposed log-normal model . . . . . . . . 68 6.15 Quantile-Quantile plot of empirical and modeled priority index distri- bution . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 68 6.16 Comparison of simulated and empirical number of submitted orders . 74 6.17 Comparison of the simulated and the empirical distribution of order prices. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 74 6.18 Comparison of the simulated and the empirical distribution of order volumes. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75 6.19 Comparison of the simulated and the empirical distribution of cancel- lation times. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76 6.20 Comparison of the simulated and the empirical distribution of the priority index of canceled orders . . . . . . . . . . . . . . . . . . . . . 77 6.21 Comparison of the simulated and the empirical distribution of the best ask price and the best bid price . . . . . . . . . . . . . . . . . . 78 6.22 Comparison of the simulated and the empirical distribution of the mid-price and the bid-ask spread . . . . . . . . . . . . . . . . . . . . 78 6.23 Comparison of the simulated and the empirical distribution of the total volume available per order book side . . . . . . . . . . . . . . . 79 A.1 Comparison empirical and ﬁtted order volume distribution . . . . . . 84 89 Bibliography Adler, R., Feldman, R., and Taqqu, M. (1998). A practical guide to heavy tails: statistical techniques and applications. Springer Science & Business Media. Andor, D.-V. M., Flinkerbusch, D.-V. K., Janssen, D.-V. M., and Liebau, D.- V. B. (2010). Handeln am day-after strommarkt. ET. Energiewirtschaftliche Tagesfragen, 60(5):46–50. Austria, E.-C. (2016). Marktbericht Österreich 2016. Technical report, Energie- Control Austria. Baumhögger, J. and Perret, C. (2017). Großhandelsmärkte für strom und gas. In Industrielle Energiestrategie, pages 75–98. Springer. Bhattacharya, U., Holden, C. W., and Jacobsen, S. (2012). Penny wise, dollar foolish: Buy–sell imbalances on and around round numbers. Management Science, 58(2):413–431. Bishop, C. (2007). Pattern recognition and machine learning (information science and statistics), 1st edn. 2006. corr. 2nd printing edn. Springer, New York. Bradbury, K., Pratson, L., and Patiño-Echeverri, D. (2014). Economic viability of energy storage systems based on price arbitrage potential in real-time us electricity markets. Applied Energy, 114:512–519. Bundesministerium für Wissenschaft, F. u. W. (2015). Energiestatus Österreich 2015. Technical report, Bundesministerium für Wissenschaft, Forschung und Wirtschaft. Bundesnetzagentur, M. (2015). Monitoring report 2015. German Federal Network Agency. Bundesnetzagentur, M. (2016). Monitoring report 2016. German Federal Network Agency. Cesari, R., Marzo, M., and Zagaglia, P. (2012). Eﬀective trade execution. Chakrabarti, B., Chatterjee, A., Chakraborti, A., and Sinha, S. (2010). Econophysics: An introduction. Willey-VCH Verlag GmbH, Germany. 90 BIBLIOGRAPHY Chakraborti, A., Toke, I. M., Patriarca, M., and Abergel, F. (2011). Econophysics review: I. empirical facts. Quantitative Finance, 11(7):991–1012. Challet, D. and Stinchcombe, R. (2001). Analyzing and modeling 1+ 1d markets. Physica A: Statistical Mechanics and its Applications, 300(1):285–299. Cont, R. (2001). Empirical properties of asset returns: stylized facts and statistical issues. Unknown. Cont, R., Stoikov, S., and Talreja, R. (2010). A stochastic model for order book dynamics. Operations research, 58(3):549–563. Deane, J., Drayton, G., and Gallachóir, B. Ó. (2014). The impact of sub-hourly modelling in power systems with signiﬁcant levels of renewable generation. Applied Energy, 113:152–158. Dobson, A. J. and Barnett, A. (2008). An introduction to generalized linear models. CRC press. Duda, R. O., Hart, P. E., and Stork, D. G. (2012). Pattern classiﬁcation. John Wiley & Sons. EEX (2015). Phelix power futures. Technical report, EEX, http://www.eex.com/blob/9160/363d1af22e2c87d23c58dec4e4e89db6/phelix- futures-presentation-data.pdf. Ehrlich, L., Klamka, J., and Wolf, A. (2015). The potential of decentralized power- to-heat as a ﬂexibility option for the german electricity grid: a microeconomic perspective. Technical report, FoKoS Working Paper 2015/3. Available online at, checked on 6/16. ENTSOE (2014). Bidding zones review process. Technical report, ENTSOE. EPEXSPOT (2014). Epex spot trading brochure 2014. Technical report, EPEX SPOT, https://www.epexspot.com/document/26145/EPEX EPEXSPOT (2017a). Epex spot operational rules. EPEX SPOT. EPEXSPOT (2017b). Price list. Technical report, https://www.epexspot.com/document/37342/Price Eyer, J. and Corey, G. (2010). Energy storage for the electricity grid: Beneﬁts and market potential assessment guide. Sandia National Laboratories, 20(10):5. Farmer, J. D., Patelli, P., and Zovko, I. I. (2005). The predictive power of zero intelligence in ﬁnancial markets. Proceedings of the national academy of sciences of the united states of america, 102(6):2254–2259. 91 BIBLIOGRAPHY Foucault, T., Pagano, M., Roell, A., and Röell, A. (2013). Market liquidity: theory, evidence, and policy. Oxford University Press. Gould, M. D., Porter, M. A., Williams, S., McDonald, M., Fenn, D. J., and Howison, S. D. (2013). Limit order books. Quantitative Finance, 13(11):1709–1742. Graeber, D. R. (2013). Handel mit Strom aus erneuerbaren Energien: Kombination von Prognosen. Springer-Verlag. Grimmett, G. and Stirzaker, D. (2001). Probability and random processes. Oxford university press. Gubner, J. A. (2006). Probability and random processes for electrical and computer engineers. Cambridge University Press. Hagemann, S. and Weber, C. (2013). An empirical analysis of liquidity and its determinants in the german intraday market for electricity. Hajek, B. (2015). Random processes for engineers. Cambridge University Press. Hernandez, L., Baladron, C., Aguiar, J. M., Carro, B., Sanchez-Esguevillas, A. J., Lloret, J., and Massana, J. (2014). A survey on electric power demand fore- casting: future trends in smart grids, microgrids and smart buildings. IEEE Communications Surveys & Tutorials, 16(3):1460–1495. Hu, W., Chen, Z., and Bak-Jensen, B. (2010). Optimal operation strategy of battery energy storage system to real-time electricity price in denmark. In IEEE PES General Meeting, pages 1–7. IEEE. Irvine, P. J., Benston, G. J., and Kandel, E. (2000). Liquidity beyond the inside spread: Measuring and using information in the limit order book. Jiang, G., Wang, S., and Dong, H. (2011). A survey of limit order book modeling in continuous auction market. In 2011 3rd International Workshop on Intelligent Systems and Applications. Kiesel, R. and Paraschiv, F. (2015). Econometric analysis of 15-minute intraday electricity prices. Available at SSRN. Kloess, M. and Zach, K. (2014). Bulk electricity storage technologies for load-leveling operation–an economic assessment for the austrian and german power market. International Journal of Electrical Power & Energy Systems, 59:111–122. Logenthiran, T. and Srinivasan, D. (2011). Intelligent management of distributed storage elements in a smart grid. In Power Electronics and Drive Systems (PEDS), 2011 IEEE Ninth International Conference on, pages 855–860. IEEE. 92 BIBLIOGRAPHY Mathieu, J. L., Kamgarpour, M., Lygeros, J., and Callaway, D. S. (2013). Energy arbitrage with thermostatically controlled loads. In Control Conference (ECC), 2013 European, pages 2519–2526. IEEE. Mitra, S., Sun, L., and Grossmann, I. E. (2013). Optimal scheduling of industrial combined heat and power plants under time-sensitive electricity prices. Energy, 54:194–211. Mohsenian-Rad, H. (2015). Optimal demand bidding for time-shiftable loads. IEEE Transactions on Power Systems, 30(2):939–951. Mugele, C., Rachev, S., and Trück, S. (2005). Stable modeling of diﬀerent european power markets. Investment Management & Financial Innovations, 2(3). Neuhoﬀ, K., Ritter, N., Salah-Abou-El-Enien, A., and Vassilopoulos, P. (2016). In- traday markets for power: Discretizing the continuous trading? DIW discussion Paper. Neuhoﬀ, K., Ritter, N., and Schwenen, S. (2015). Bidding structures and trading arrangements for ﬂexibility across eu power markets. Technical report, ZBW- German National Library of Economics. Otterson, S., Jost, D., et al. (2016). Stochastic trading across time under german tso constraints. In Wind Integration Workshop, At Vienna, Austria. Pandzžić, H., Dvorkin, Y., Wang, Y., Qiu, T., and Kirschen, D. S. (2014). Eﬀect of time resolution on unit commitment decisions in systems with high wind penetration. In 2014 IEEE PES General Meeting| Conference & Exposition, pages 1–5. IEEE. Papaefthymiou, G., Hasche, B., and Nabe, C. (2012). Potential of heat pumps for demand side management and wind power integration in the german electricity market. IEEE Transactions on Sustainable Energy, 3(4):636–642. Rivera, J., Goebel, C., and Jacobsen, H.-A. (2016). Distributed convex optimization for electric vehicle aggregators. Schäfer, A. and Moser, A. (2012). Dispatch optimization and economic evaluation of distributed generation in a virtual power plant. In Energytech, 2012 IEEE, pages 1–6. IEEE. Schlandt, J. (2015). Europe’s largest electricity market set to split. Clean Energy Wire. Sevlian, R. and Rajagopal, R. (2014). A model for the eﬀect of aggregation on short term load forecasting. In IEEE Power and Energy Society General Meeting. 93 BIBLIOGRAPHY Siano, P. and Sarno, D. (2016). Assessing the beneﬁts of residential demand response in a real time distribution energy market. Applied Energy, 161:533–551. Simonsen, I., Weron, R., and Mo, B. (2004). Structure and stylized facts of a deregulated power market. Taylor, J. W. (2012). Short-term load forecasting with exponentially weighted methods. IEEE Transactions on Power Systems, 27(1):458–464. Toke, I. M. and Yoshida, N. (2016). Modelling intensities of order ﬂows in a limit order book. arXiv preprint arXiv:1602.03944. Verousis, T. and ap Gwilym, O. (2013). Trade size clustering and the cost of trading at the london stock exchange. International Review of Financial Analysis, 27:91–102. Wille-Haussmann, B., Erge, T., and Wittwer, C. (2010). Decentralised optimisation of cogeneration in virtual power plants. Solar Energy, 84(4):604–611. Zucker, A. and Hinchliﬀe, T. (2014). Optimum sizing of pv-attached electricity storage according to power market signals–a case study for germany and italy. Applied Energy, 127:141–155. 94","libVersion":"0.3.2","langs":""}