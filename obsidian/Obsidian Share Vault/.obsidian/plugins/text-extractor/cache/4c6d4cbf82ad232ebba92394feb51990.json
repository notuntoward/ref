{"path":"lit/sources/Wei23PredictionStateHealth.pdf","text":"Citation: Wei, Y. Prediction of State of Health of Lithium-Ion Battery Using Health Index Informed Attention Model. Sensors 2023, 23, 2587. https://doi.org/10.3390/s23052587 Academic Editor: Chun Sing Lai Received: 31 January 2023 Revised: 23 February 2023 Accepted: 24 February 2023 Published: 26 February 2023 Copyright: © 2023 by the author. Licensee MDPI, Basel, Switzerland. This article is an open access article distributed under the terms and conditions of the Creative Commons Attribution (CC BY) license (https:// creativecommons.org/licenses/by/ 4.0/). sensors Article Prediction of State of Health of Lithium-Ion Battery Using Health Index Informed Attention Model Yupeng Wei Department of Industrial and Systems Engineering, San Jose State University, San Jose, CA 95192, USA; yupeng.wei@sjsu.edu Abstract: State-of-health (SOH) is a measure of a battery’s capacity in comparison to its rated capacity. Despite numerous data-driven algorithms being developed to estimate battery SOH, they are often ineffective in handling time series data, as they are unable to utilize the most signiﬁcant portion of a time series while predicting SOH. Furthermore, current data-driven algorithms are often unable to learn a health index, which is a measurement of the battery’s health condition, to capture capacity degradation and regeneration. To address these issues, we ﬁrst present an optimization model to obtain a health index of a battery, which accurately captures the battery’s degradation trajectory and improves SOH prediction accuracy. Additionally, we introduce an attention-based deep learning algorithm, where an attention matrix, referring to the signiﬁcance level of a time series, is developed to enable the predictive model to use the most signiﬁcant portion of a time series for SOH prediction. Our numerical results demonstrate that the presented algorithm provides an effective health index and can precisely predict the SOH of a battery. Keywords: battery; prognostics; health index; attention model 1. Introduction Lithium-ion batteries are extensively adopted as a power resource for unmanned aerial vehicles, electric mobility, and electric vehicles as a result of their low maintenance frequency, long life cycle, and high energy efﬁciency [1,2]. Research efforts in the ﬁeld of lithium-ion batteries have focused on various aspects, including improving charge speed and energy density, reducing production costs, and extending battery life cycles [3,4]. In addition, there have been studies on the evolution of li-rich layered cathode materials [5], with a particular focus on controlling the anionic redox of li-rich layered oxides to maximize energy density [6]. Nevertheless, the safety and efﬁciency of batteries can reduce with the increment of time and charge-discharge cycles, which is also known as battery aging [7,8]. For example, the traveling mileage of unmanned aerial vehicles and electric vehicles can be dramatically reduced due to the battery aging issue. The battery aging issue in electric mobility may result in severe ﬁres and outbursts. As a result, it is necessary to monitor the health condition of batteries so that a proper maintenance schedule can be made to reduce the negative impact of battery aging. State of health (SOH) represents the primary measurement that provides reliable infor- mation to monitor and predict the health conditions of batteries [9]. SOH is deﬁned as the rate between the peak battery capacity and its rated capacity [10]. In the literature, numer- ous algorithms have been developed to make SOH predictions, and these algorithms can be categorized as model-based and data-driven algorithms. The model-based algorithms are built upon electronic, chemical, and mathematical models [11]. The primary drawback of the model-based algorithms is that the prediction performance can not be guaranteed as these methods can not capture the complex relationships among the enormous electrical and chemical components of batteries. To address the limitation of the model-based algo- rithms, data-driven algorithms are increasingly used in SOH predictions and this work will Sensors 2023, 23, 2587. https://doi.org/10.3390/s23052587 https://www.mdpi.com/journal/sensors Sensors 2023, 23, 2587 2 of 14 aim attention at data-driven algorithms. Data-driven algorithms are built upon statistical or machine-learning algorithms, such as Kalman ﬁlter [12], Gaussian Process [13], and deep learning methods [14]. While promising, most of the existing data-driven algorithms are not effective in dealing with time series as they are not able to utilize the most signiﬁcant part of a time series while predicting the SOH of a battery. To address this issue, an attention-based deep learning predictive algorithm is developed in this work, where an attention matrix referring to the signiﬁcance level of a time series at distinctive time is generated so that the deep learning predictive model can utilize the most relevant portion of a time series for SOH predictions. Moreover, it has been demonstrated that constructing an effective health index can increase the performance of a predictive model [15,16]. However, to our best knowledge, very few studies have been conducted to deﬁne or construct a health index of a battery. Although a few studies have been reported on the development of a health index for complex systems and machinery equipment [17], such as aircraft engines and bearings, these methods can only construct a monotonically decreasing health index which is not capable of capturing capacity fade and capacity regeneration behaviors of a battery. To ﬁll this gap, we propose four properties to capture capacity degradation and regeneration behaviors. We also develop a convex optimization model to obtain a health index of a battery. The major contributions of this work can be described as below: • A convex optimization model is introduced to obtain a health index of a battery, such an index can accurately capture the degradation trajectory of a battery as well as improves the SOH prediction performance. • An attention-based deep learning predictive algorithm is presented, where an attention matrix referring to the signiﬁcance level of a time series is adopted in SOH predictions so that the predictive algorithm can utilize the most signiﬁcant portion of a time series for SOH predictions. The remaining sections of this work is arranged as follows. Section 2 reviews the data- driven algorithms in SOH predictions. Section 3 presents the proposed convex optimization model for learning a health index and an attention-based deep learning predictive algorithm for SOH predictions of batteries. Section 4 demonstrates the efﬁciency of the proposed algorithm. Section 5 draws a conclusion and provides a discussion of future work. 2. Data-Driven Algorithms for SOH Predictions The data-driven algorithms used for predicting state of health (SOH) of batteries include ﬁlter-related models and machine-learning models. The ﬁlter-related models incorporate techniques such as the Kalman ﬁlter [18,19], particle ﬁlter [20,21], and others. For instance, Chen et al. [22] developed an unscented Kalman ﬁlter to evaluate the SOH of a battery. Their presented Kalman ﬁlter incorporated the internal resistance rate to trace the subsequent SOH trajectory while making predictions. The results showed that the presented Kalman ﬁlter could estimate the SOH with a low prediction error rate. Dong et al. [23] utilized the particle ﬁlter for estimating the SOH of a battery. Their proposed ﬁlter was integrated with a stochastic model to track abrupt changes in the process of battery capacity fade. The results demonstrated that the particle ﬁlter was able to predict the SOH of multiple battery cells with relatively high accuracy. The primary advantage of the ﬁlter- based methods is their self-correlation capability. However, these methods have difﬁculty in considering multiple battery cells while making SOH predictions [24]. To better utilize all historical information from all battery cells, machine learning algorithms, especially deep learning algorithms are increasingly adopted. These algorithms incorporate random forests [25], long short-term memory (LSTM) [26], temporal convo- lutional network (TCN) [27], graph convolutional network (GCN) [28,29], and so on. For example, Mawonou et al. [30] presented a novel random forests SOH estimation algorithm to consider both the usage pattern of drivers and the environmental conditions of electric vehicles. In order to boost the estimation performance, two aging indicators were also incor- porated into SOH estimation. The numerical results have manifested that the present novel random forests algorithm can reach a prediction error of 1.27%. Zhao et al. [31] combined Sensors 2023, 23, 2587 3 of 14 the LSTM algorithm with the Gaussian process to evaluate the SOH of a battery, where several health factors extracted from sensor data obtained from charge cycles were utilized. The LSTM model was adopted to track the trajectory change of extracted health factors and the trajectory change was fed into the Gaussian process model for SOH predictions. A publicly available battery dataset was utilized to evaluate the efﬁcacy of the presented algorithm. Zhou et al. [32] used the TCN for battery SOH predictions, where the dilated convolutional operation and causal operation were primarily used in the TCN model. In addition to TCN, the empirical mode decomposition was adopted to reduce the nuisance factors so that the SOH prediction performance can be more robust. Wei and Wu [33] pre- sented a GCN algorithm to predict the SOH and the remaining useful charge and discharge cycles of batteries, where a two-phase optimization model was presented to develop a graph with optimized graph entropy and density. Numerical results have illustrated that the presented GCN algorithm could predict the SOH accurately even without using sensor data during the charging process. In summary, numerous data-driven algorithms have been developed for predicting the SOH of a battery. However, most of these algorithms cannot effectively learn a health index that captures the degradation trajectory of a battery. Additionally, current data-driven algorithms are not able to handle time series data as they do not use the most signiﬁcant portion of the time series when predicting the SOH of a battery. To address these issues, we ﬁrst developed a convex optimization model to obtain a health index of a battery. This health index accurately captures the degradation trajectory of a battery and improves the prediction performance of SOH. We also introduce an attention-based deep learning predictive model, where an attention matrix is generated to show the signiﬁcance level of each time step in the time series. This allows the deep learning predictive model to utilize the most relevant portion of the time series data when predicting SOH. 3. Health Index Informed Attention Model The proposed algorithm comprises of three primary steps. Firstly, temporal features are extracted from the sensor data collected during the charging and discharging cycles of lithium-ion batteries. Secondly, a convex optimization model is constructed, and the extracted temporal features are given to the presented optimization model to learn health indices of batteries. Lastly, the extracted features and the learned health index are used to train an attention-based deep learning model for predicting SOH. The following sections provide detailed descriptions of these three steps. 3.1. Temporal Features Extraction The most common battery health monitoring data includes current, voltage, and temperature. Figure 1 shows the current and voltage measurements during a single charge and discharge cycle. In a charge cycle, the battery is subjected to a consistent current (CC) until the measured voltage reaches a speciﬁc value, and then under a consistent voltage (CV) until the current drops to a speciﬁc value. In the discharge cycle, the battery is loaded under a consistent current condition until the battery voltage drops to a certain range. The recurrent charging and discharging process leads to a reduced capacity of lithium-ion batteries, which can be observed through changes in sensor measurements. For instance, as batteries age, they require more time to reach a speciﬁc voltage during the charge cycle, compared to new batteries. In this work, temporal features are derived from current, voltage, and temperature measurements to capture the depreciation behaviors in charge and discharge cycles. In the charge cycle, one temporal feature extracted from voltage measurement is written as Equation (1), min t(s) s.t. Vt(s) − Vmax ≥ 0 (1) where t(s) refers to the time in the s-th sampling period; Vt(s) refers to the voltage mea- surement at time t(s); and Vmax is the maximum voltage of a battery. This extracted feature Sensors 2023, 23, 2587 4 of 14 refers to the time to the maximum voltage of batteries. The second feature extracted from voltage measurement is written as Equation (2), max t(s) − t(s′) s.t. Vt(s) − Vmax ≥ 0, Vt(s′) − Vmax ≥ 0 (2) where t(s) and t(s′) represent the time in the s-th and s′-th sampling period; and Vt(s) and Vt(s′) are the measured voltage at t(s) and t(s′). This feature refers to the time that a battery stays in CV mode. The ﬁrst feature extracted from the current measurement can be written as Equation (3), max t(s) − t(s′) s.t. At(s) = At(s′) = Aconstant (3) where At(s) and At(s′) are the current measurement at t(s) and t(s′), and Aconstant represents the current that the battery is under the CC condition. This extracted feature refers to the time that a battery is carried out under the CC condition. The second feature extracted from the current measurement is written as Equation (4), min t(s) − max t(s′) s.t. At(s) ≤ Aconstant, At(s′) ≤ Amin (4) where Amin is the minimum current of the battery. This feature represents the time to the minimum current of batteries. The feature extracted from temperature measurement can be written as Equation (5), min t(s) s.t. Tt(s) = max{Tt(s), ∀s} (5) where Tt(s) is the temperature at time t(s). This feature represents the time to the maximum temperature in the charge cycle. Figure 1. The current and voltage measurements in a single charge and discharge cycle. In the discharge cycle, the feature extracted from voltage measurement can be repre- sented in Equation (6), min t(s) s.t. Vt(s) ≤ Vmin (6) where Vmin represents the minimum voltage of a battery in the discharge cycle. This ex- tracted feature refers to the time to the minimum voltage. The feature extracted current measurement in the discharge cycle is written as Equation (7), min t(s) s.t. At(s) ≥ Aload (7) where Aload is the battery load while discharging. This feature represents the discharging time. The last feature extracted from temperature measurement in the discharge cycle can be written as Equation (8), and this feature refers to the time to the maximum temperature in the discharge cycle. min t(s) s.t. Tt(s) = max{Tt(s), ∀s} (8) These extracted features are fed into the proposed convex optimization model to obtain the health index of a battery. Sensors 2023, 23, 2587 5 of 14 3.2. Health Index Generation of a Battery In the literature, few studies have been conducted on learning monotonically decreas- ing health indices for complex engineering systems, such as those described in the Ref. [34]. While these health indices have proven effective in solving prognostic problems, they are unsuitable for modeling the degradation behavior of lithium-ion batteries. For instance, the capacity of a battery does not decrease monotonically due to phenomena such as capacity regeneration. To better characterize the degradation behavior of lithium-ion batteries, we introduce four attributes for learning health indices. The ﬁrst two attributes are based on the physical properties of aging batteries, while the remaining attributes are commonly used to capture the general degradation behaviors of complex systems [35]. • Attribute 1: The health indices of aging batteries should be piece-wise monotonically decreasing with the increasing number of charge and discharge cycles. • Attribute 2: The health indices of aging batteries should increase after a complete charge-discharge cycle and a long period of storage. • Attribute 3: The variance of the failure threshold for the health indices of aging batteries should be minimal. • Attribute 4: The health indices should be consistent with the true capacity degradation trajectory of batteries. The continuously repeated charge and discharge cycles lead to the reduced health conditions of lithium-ion batteries; therefore, Attribute 1 aims at learning piece-wise mono- tonically decreasing health indices in the piece-wise continued charging and discharging process. A battery may regain some capacity because of the capacity regeneration phe- nomenon; therefore, Attribute 2 aims at learning increasing health indices after a complete charge-discharge cycle and a long period of storage. Moreover, Attribute 3 and Attribute 4 are introduced to learn consistent and reliable health indices with less variance. Based on these four attributes, an optimization model is introduced as Equation (9), min θ1 m ∑ i=1 ni ∑ j=1 l ∑ k=1 wk( fi,j,k − fi,j−1,k)pi,j + θ2 m ∑ i=1 ni ∑ j=1 l ∑ k=1 wk( fi,j−1,k − fi,j,k)ri,j+ θ3wTQTMQw + θ4( m ∑ i=1 ni ∑ j=1 l ∑ k=1(wk fi,j,k − yi,j)2)1/2 s.t. ∑ a θa = 1; i = 1, ..., m, j = 1, ..., ni, k = 1, ..., l (9) where m refers to the total number of battery units; ni refers to the total number of cycles for the battery cell i; l is the total number of temporal features are extracted; wk is the weighted coefﬁcient for feature k to combine extracted features to learn health indices of batteries; fi,j,k represents the kth feature derived from the battery cell i in cycle j; fi,j−1,k represents the kth feature derived from the battery cell i in cycle j − 1; pi,j and ri,j are binary variables represent the information of storage periods; pi,j = 1 and ri,j = 0, if the cycle j is not after a storage period; pi,j = 0 and ri,j = 1, if the cycle j is after a storage period; yi,j is the battery capacity for the battery cell i in cycle j; w ∈ Rl×1 is the vector stores the weighted coefﬁcients wk; Q ∈ Rm×l is the matrix recording the temporal features extracted from failure observations with rows referring to each battery cell and the columns referring to every extracted features k; θa, ∀a are hyperparameters that decide the importance of four proposed attributes; M = (I − O/j)/(j − 1), O ∈ Rm×m is a matrix with all elements are one, and I ∈ Rm×m is an identity matrix; the matrix M is introduced to estimate the unbiased variance of the failure threshold of health indices, which is proved as Equation (10). Similar proofs can be found in the Ref. [36,37]. ((Qw)TQw − m((1TQw)/m)2) = wTQT((I − 11T/m)/(m − 1))Qw/(m − 1) = wTQTMQw (10) Sensors 2023, 23, 2587 6 of 14 To simplify the proposed optimization model, this model can be rewritten as Equation (11), min θ1pTDw − θ2rTDw + θ3wTQTMQw + θ4∥Fw − y∥2 2 s.t. ∑ a θa = 1 (11) where p ∈ R1×∑i ni−1 is a vector stores pi,j for all i, j and p = [p1,1, ..., p1,n1, p2,1, ..., p2,n2, ..., pm,nm ]T; r ∈ R1×∑i ni−1 is a vector stores ri,j for all i, j and r = [r1,1, ..., r1,n1, r2,1, ..., r2,n2, ..., rm,nm ]T; D ∈ R∑i ni−1×m is a matrix of collecting the differences of adjacent sampling time, and D = [D1, ..., Di, ..., Dm]T; F ∈ R∑i ni×m is a matrix recording the extracted features for all battery units and cycles, and F = [F1, ..., Fi, ..., Fm]T. The matrix Di and the matrix Fi can be written as Equation (12); Di =      fi,2,1 − fi,1,1 · · · fi,2,l − fi,1,l fi,3,1 − fi,2,1 · · · fi,3,l − fi,2,l ... . . . ... fi,ni,1 − fi,ni−1,1 · · · fi,ni,l − fi,ni−1,l  | | |  Fi =      fi,1,1 fi,1,2 · · · fi,1,l fi,2,1 fi,2,2 · · · fi,2,l ... ... . . . ... fi,ni,1 fi,ni,2 · · · fi,ni,l  | | |  (12) Moreover, y ∈ R∑i ni×1 is a vector recording the battery capacity for all battery units and cycles, where y = [y1, y2, ..., ym]T and yi = [yi,1, yi,2, ..., yi,l]T. Next, the gradient descent method could be adopted to resolve the optimization model, the optimized weighted coef- ﬁcients wk, ∀k are used to combine the extracted features to obtain the health indices. The health indices for unit i in the cycle j can be mathematically represented as hij = ∑k wk fijk. Figure 2 exhibits the framework of the presented optimization model for generating the health index of a lithium-ion battery. During the training process, four attributes are ﬁrst introduced to capture the capacity degradation and regeneration phenomenon of a battery, and a convex optimization model is constructed based on these attributes. To train the optimization model, the importance hyperparameters θa, ∀a, the storage period inputs ri,j, pi,j, ∀i, j, temporal features fi,j,k, ∀i, j, k, and the battery capacity yi,j, ∀i, j are given to the presented convex optimization model. The gradient descent method is adopted to learn the weighted coefﬁcients ωi,j, ∀i, j in the optimization model. During the process of learning the health index, the learned weighted coefﬁcients are used to combine the extracted temporal features to learn the health index hi,j, ∀i, j. Next, both the learn health index and the temporal features are fed into the proposed attention-based deep learning model for SOH predictions of batteries. Temporal features f i,j,k Piece-wise decreasing Increasing after storage Minimal variance T rajectory consistency W eighted coef ficients w i,j Convex optimization Health Index Modeling Gradient descent Attributes Storage period r i,j and p i,j Battery capacity y i,j Sensor measurements Health Index Modeling T raining Temporal features f i,j,k W eighted coef ficients w i,j Health index h i,j Health Index Modeling T esting Optimized coef ficients W eighted sum Importance parameters Figure 2. The framework of the proposed optimization model for generating the health index of a lithium-ion battery. 3.3. Attention-Based Deep Learning Model While attention-based models have been used to deal with time series, most of these studies focus on neural machine translation and text generation [38,39]. The general concept of the attention model is to simulate the attention mechanism of humans used for tasks such as reading and visualization. The attention model can be represented as the value retrieval procedure of a data administration system. In such a system, each value vi has a Sensors 2023, 23, 2587 7 of 14 key ki associated with it. For a query q, the attention value αi on item i can be written as αi = exp(sci)/ ∑i sci, where sci refers to the alignment score between the query q and the key ki for item i. The most often used alignment score function include dot-product [40], scaled dot-product [41], and additive [38]. In this work, the attention model is integrated with a sequence-to-one LSTM neural network to predict the SOH. Figure 3 shows the attention-based sequence-to-one LSTM predictive model for SOH predictions. This predictive model consists of three primary com- ponents, including an encoder network, an attention layer, and a decoder network. In the encoder network, time series inputs xi,j are given to the LSTM to derive the corresponding key ki,j and value vi,j. More speciﬁcally, xi,j is the vector that stores the extracted features and the learned health indices for battery unit i in cycle j; vi,0 is the randomized initial input of the encoder network; vi,j is the value generated from the LSTM network for cell i in cycle j; ki,j refers to the key generated from the LSTM network for unit i in cycle j; both the vi,j and ki,j are the hidden state of the LSTM in cycle j, and we set vi,j = ki,j to represent that the value is identical with the key; qi,t refers to the query and qi,t = ki,t = vi,t. In the attention layer, we use the local attention model with the monotonic alignment. The attention value αi,j for cycle j can be calculated by Equation (13), where scii,a refers to the alignment score between the query qi,t and the key ki,t Moreover, d represents the window length of the local attention model. αi,j = exp(sci,j)/ j+d ∑ a=j−d sci,a (13) ... x i ,1 x i ,j - 1 x i ,j x i ,j + 1 x i ,t k i,1LSTM v i,1 k i,j-1 v i,j-1 k i,j v i,j k i,j+1 v i,j+1 k i,t v i,t q i ,t a i ,1 a i ,j - 1 a i ,j a i ,j + 1 a i ,t c i Dense Layer y i ,tLSTMLSTMLSTMLSTM ... Encoder Network Decoder Network Attention Layer v i ,0 Figure 3. The attention-based sequence-to-one LSTM predictive model. xi,j refers to the vector of inputs for battery cell i in cycle j;vi,j is the key and ki,j is the value generated from the LSTM network for cell i in cycle j; αi,j refers to the attention value for cell i in cycle j; and ci represents the context vector. The general alignment function is utilized in this work, and the corresponding score sci,j can be calculated by using Equation (14). Wa ∈ Rz×z is the trainable weighted matrix to calculate the alignment score, where z is the total number of nodes in LSTM. sci,j = qT i,jWaki,j (14) In the decoder network, the context vector ci is calculated by using Equation (15). Then, the context vector and the output of the LSTM network are given to a fully connected layer to predict the SOH of the battery cell i in cycle t, that is, yi,t Sensors 2023, 23, 2587 8 of 14 ci = t ∑ j=1 αi,jvi,j (15) In comparison with the traditional LSTM predictive model, the attention-based predic- tive model has access to the entire time series while predicting by introducing the context vector ci. Because the context vector represents the weighted sum of the hidden outputs generated by the time series, respectively. 4. Case Study 4.1. Dataset Description In this work, we used four battery cells (Battery No. 5, No. 6, No. 7, and No. 18) to evaluate the efﬁciency of the proposed algorithm. The condition monitoring data of these four battery cells were collected by the NASA Ames Prognostics Center of Excellence (PCoE) [42], where the current, voltage, and temperature data were collected during the charging and discharging process. In the charging process, the CC mode with a current of 1.5 A was discontinued when the voltage measurement was above 4.2 V and proceeded under a CV condition unless the measured current was below 20 mA. In the discharging process, the CC mode was adopted with a current of 2A unless the measured voltage was below 2.7 V, 2.5 V, 2.2 V, and 2.5 V for Battery No. 5, Battery No. 6, Battery No. 7, and Battery No. 18, respectively. The run-to-failure experiment was conducted on these four battery cells, and the test was stopped when the capacity dropped to 70%. For all four battery cells, the maximum capacity was 2 Ah, and the test was stopped when the capacity dropped to 1.4 Ah. Figure 4 shows the measured voltage, current, and temperature over time during different charge and discharge cycles of battery cell No. 5. Based on this ﬁgure, we can observe that the trajectories of the measured voltage, current, and temperature change with the number of charge and discharge cycles. For example, Figure 5a shows that the time to reach the maximum voltage in 40 cycles is longer than the time to reach the maximum voltage in 120 cycles. 0 5000 10000 Time(secs) 3.2 3.4 3.6 3.8 4 4.2 4.4Voltage(V) (a) Voltage measurement in charging 40 cycles 60 cycles 80 cycles 100 cycles 120 cycles 0 5000 10000 Time(secs) -4 -3 -2 -1 0 1 2Current(A) (b) Current measurement in charging 40 cycels 60 cycles 80 cycles 100 cycles 120 cycles 0 5000 10000 Time(secs) 22 24 26 28 30 32Temperature(Celsius) (c) Temperature measurement in charging 40 cycles 60 cycles 80 cycles 100 cycles 120 cycles 0 1000 2000 3000 4000 Time(secs) 2.5 3 3.5 4 4.5Voltage(V) (d) Voltage measurement in discharging 40 cycles 60 cycles 80 cycles 100 cycles 120 cycles 0 1000 2000 3000 4000 Time(secs) -2.5 -2 -1.5 -1 -0.5 0 0.5Current(A) (e) Current measurement in discharging 40 cycles 60 cycles 80 cycles 100cycles 120 cycles 0 1000 2000 3000 4000 Time(secs) 20 25 30 35 40 45Temperature(Celsius) (f) Temperature measurement in discharging 40 cycles 60 cycles 80 cycles 100 cycles 120 cycles Figure 4. The voltage, current, and temperature measurements change over time in different charge and discharge cycles with respect to battery No. 5. Sensors 2023, 23, 2587 9 of 14 0 50 100 150 Cycles 0.5 0.6 0.7 0.8 0.9 1 1.1SOH (a) SOH for batteries Battery No.5 Battery No.6 Battery No.7 Battery No.18 0 50 100 150 Cycles -0.1 0 0.1 0.2 0.3 0.4 0.5Capacity Fade Percentage (b) Capacity Fade for batteries Battery No.5 Battery No.6 Battery No.7 Battery No.18 0 50 100 150 Cycles 0 0.5 1 1.5 2 2.5 3Health Index (c) Health index for batteries Battery No.5 Battery No.6 Battery No.7 Battery No.18 Figure 5. The SOH, the capacity fade, and the learned health index for batteries No. 5, No. 6, No. 7, and No. 18. 4.2. Health Index To capture changes in battery trajectory over time, temporal features were extracted to learn the health indices of the batteries. As mentioned earlier, this paper extracted ﬁve temporal features during charge cycles and three features during discharge cycles, as they have been shown to be efﬁcient for predicting the SOH of a battery [43]. During the charge cycles, we extracted the time to maximum voltage and temperature, time to minimum current, and time charged under CC and CV modes. During discharge cycles, we extracted the time to minimum voltage and maximum temperature, as well as time discharged under a CC mode. The extracted temporal features were then input into the optimization model presented to learn the health indices. To learn the health index of a battery, the values of hyperparameters θa for all a must be determined to evaluate the importance of the four proposed attributes. In this study, we considered each proposed attribute equally important by setting θa = 0.25 for all a. Furthermore, all extracted temporal features were standardized to reduce the loss of generality. Figure 5 presents the SOH, the capacity fade, and the learned health index for batteries No. 5, No. 6, No. 7, and No. 18. Based on Figure 5, we can conclude that the learned health index shows an obvious depreciation trend, which is consistent with the degradation trajectory of the SOH. Moreover, the learned health indices can also reﬂect the capacity regeneration phenomenon after a long storage period. For example, the SOH of battery No. 5 increases after 150 cycles due to its storage period between the 149th and 150th charge and discharge cycles. Therefore, we can conclude that the learned health indices are consistent with the degradation trajectory of the SOH and could potentially be used for predicting the SOH. 4.3. SOH Estimation The proposed attention-based deep learning algorithm was then used to predict the SOH using the temporal features and learned health index. To simplify the algorithm and reduce prediction errors, the network architecture and hyperparameters used in this case study have been tabulated in Table 1. The batch size is 30, the number of hidden nodes in the LSTM layer is 50, the window size of the local attention mechanism is 5, and the learning rate is set to 1 × 10−5. Moreover, the predictive alignment is used in this case study. Figure 6 shows the ground truth of SOH and the predicted values for all four batteries, with the predicted starting point at 20 charge and discharge cycles. From Figure 6, we can see that the proposed algorithm can predict the SOH of lithium-ion batteries with satisfactory precision, as the predicted values are close to the ground truth for all four batteries. Moreover, we can also observe that the predicted SOH can capture the capacity regeneration phenomenon after a storage period. To fully evaluate the efﬁcacy of the proposed algorithm, it was compared with other algorithms listed in Table 2. In this table, HI-ALSTM refers to the proposed algorithm, which is the health index-informed attention-based LSTM model. HI-LSTM refers to the proposed algorithm without the attention mechanism, ALSTM is the attention-based LSTM predictive algorithm without using the health index, and LSTM refers to the classical long Sensors 2023, 23, 2587 10 of 14 short-term memory without using the proposed health index or the attention mechanism. To ensure a fair comparison, the hyperparameters used in HI-LSTM, ALSTM, and LSTM are the same as those in the proposed algorithm, except that HI-LSTM does not use the attention mechanism, ALSMT does not use the learned health index, and LSTM does not use either the attention mechanism or the learned health index. 20 70 120 170 Number of cycles 0.6 0.7 0.8 0.9 1SOH (a) Battery No.5 Ground truth of SOH Predicted SOH 20 70 120 170 Number of cycles 0.5 0.6 0.7 0.8 0.9 1SOH (b) Battery No.6 Ground truth of SOH Predicted SOH 20 70 120 170 Number of cycles 0.65 0.7 0.75 0.8 0.85 0.9 0.95SOH (c) Battery No.7 Ground truth of SOH Predicted SOH 20 40 60 80 100 120 Number of cycles 0.65 0.7 0.75 0.8 0.85 0.9SOH (d) Battery No.18 Ground truth of SOH Predicted SOH Figure 6. The ground truth of SOH and the predicted value for all four batteries with the prediction starting point is 20 cycles. Table 1. Hyperparameters and network architecture utilized in this case study for SOH predictions. Sequence of Layers Description Output Dimensionality 1 Input layer 30 × 165 × 9 2 LSTM layer 30 × 165 × 50 3 Attention layer 30 × 5 × 50 4 Flatten layer 30 × 250 5 Output layer 30 × 1 Tables 3 and 4 show the mean absolute error (MAE) and mean absolute percentage error (MAPE) of the proposed algorithm and algorithms listed in Table 2 for all four batteries, respectively. Based on these two tables, it is evident that the learned health index and the attention mechanism can improve the accuracy of SOH prediction. For example, the average MAE of the proposed algorithm is 0.0103. However, the MAE of HI-LSTM and ALSTM is 0.0405 and 0.0121, respectively, indicating that the presented algorithm outperforms these models in terms of prediction accuracy. Table 2. Symbols and descriptions of the presented algorithm and comparable algorithms. Method Symbol Method Description HI-ALSTM Health index informed attention-based LSTM model (Proposed methodology) HI-LSTM Health index-informed LSTM model without using the attention mechanism ALSTM Attention-based LSTM predictive model without using the health index LSTM traditional LSTM predictive model Sensors 2023, 23, 2587 11 of 14 Table 3. The MAE of the proposed algorithm and algorithms listed in Table 2 for all battery units. Battery No. 5 Battery No. 6 Battery No. 7 Battery No. 18 Average HI-ALSTM 0.0149 0.0110 0.0068 0.0083 0.0103 HI-LSTM 0.0380 0.0551 0.0466 0.0222 0.0405 ALSTM 0.0066 0.0170 0.0133 0.0114 0.0121 LSTM 0.0362 0.0213 0.0372 0.0264 0.0303 Table 4. The MAPE of the proposed algorithm and algorithms listed in Table 2 for all battery units. Battery No. 5 Battery No. 6 Battery No. 7 Battery No. 18 Average HI-ALSTM 196.30% 151.03% 84.17% 108.29% 134.95% HI-LSTM 512.55% 793.49% 611.81% 292.07% 552.48% ALSTM 85.89% 247.20% 165.64% 150.38% 162.28% LSTM 487.97% 290.07% 485.74% 352.43% 404.05% Table 5 shows the root mean squared error (RMSE) of the proposed algorithm, algo- rithms tabulated in Table 2, and other algorithms reported in the literature [44,45] for all four batteries, to thoroughly evaluate the efﬁcacy of the presented algorithm. The meth- ods described in the literature incorporate logistic regression (LR) and gradient boosting decision tree (GBDT). Based on Table 5, it is evident that the learned health index and the attention mechanism can increase the SOH prediction accuracy. For example, for Battery No. 6, the prediction RMSE of the presented algorithm is 0.0153, whereas the methods without using the learned health index or the attention mechanism range from 0.220 to 0.612. With respect to Battery No. 7, the prediction RMSE of the presented algorithm is 0.0089, whereas the prediction RMSE of HI-LSTM and ALSTM is 0.0542 and 0.0145, respectively. Moreover, the presented algorithm also outperforms other methods used in the literature. For instance, the average prediction RMSE of the presented algorithm is 0.0136, whereas the average prediction RMSE of the other algorithms tabulated in Table 5 ranges from 0.0150 to 0.0457. Table 5. The RMSE of the proposed algorithm, algorithms listed in Table 2, and other algorithms reported in the literature for all battery units. Battery No. 5 Battery No. 6 Battery No. 7 Battery No. 18 Average HI-ALSTM 0.0165 0.0153 0.0089 0.0139 0.0136 HI-LSTM 0.0399 0.0612 0.0542 0.0274 0.0457 ALSTM 0.0085 0.0220 0.0145 0.0151 0.0150 LSTM 0.0375 0.0249 0.0427 0.0288 0.0335 LR-GPR [44] 0.0168 0.0292 - 0.0169 0.0210 GBDT [45] 0.0192 0.0281 0.0157 - 0.0210 5. Conclusions and Future Work In this work, a convex optimization model was presented to learn a health index of a battery. Such a health index can accurately capture the degradation trajectory of a battery as well as help improve SOH prediction accuracy. Moreover, we developed an attention-based LSTM algorithm for predicting the SOH of a battery, where an attention matrix, referring to the signiﬁcance level of a time series, was adopted so that the predictive model can utilize the most signiﬁcant portion of a time series while predicting. A battery dataset, including current, voltage, and temperature, collected from four batteries was utilized to evaluate the performance of the presented algorithm. The numerical results have illustrated that the learned health indices can precisely capture the capacity fade and regeneration phenomenons of the four batteries. The results have also shown that utilizing the learned Sensors 2023, 23, 2587 12 of 14 health index can improve the SOH prediction performance as the average RMSE with utilizing the health index is 0.0157 in comparison with the average RMSE without utilizing the health index is 0.0164 when over 20 cycles have been observed. We can also conclude that using the attention mechanism can also achieve a better SOH estimation performance. For example, with respect to No. 7, the RMSE of the presented algorithm is 0.0140, however, the RMSE of HI-LSTM is 0.0447. In addition, the presented algorithm outperforms other algorithms used in the literature. The ﬁeld of battery research is constantly evolving, and future efforts are expected to focus on predicting the SOH of batteries across a wide range of different battery types. Currently, much of the research in this area has been focused on lithium-ion batteries, which are widely used in a variety of applications, including electric vehicles, smart- phones, and laptops. However, there are many other types of batteries, including lead-acid, nickel-cadmium, and zinc-carbon batteries, which also require accurate and reliable SOH prediction methods. Research in this area is likely to involve developing new algorithms and machine learning models that can accurately predict the remaining capacity and useful lifetime of these batteries, as well as identifying the factors that contribute to degradation and failure. In addition to improving SOH prediction in different battery types, future research is also expected to facilitate the detection of small devices. As technology becomes increasingly miniaturized, there is a growing need for small, reliable batteries that can power these devices for extended periods of time. Research in this area is likely to focus on developing new battery chemistries that can deliver high energy densities in small form factors, as well as improving the accuracy and sensitivity of diagnostic tools for detecting small battery defects and failures. Overall, the future of battery research is likely to be focused on developing more accurate and reliable methods for predicting SOH across a wide range of battery types, as well as improving the performance and reliability of small batteries for use in miniature devices. Funding: This research received no external funding. Institutional Review Board Statement: Not applicable. Informed Consent Statement: Not applicable. Data Availability Statement: The dataset used in this study are available at https://www.nasa.gov/ content/prognostics-center-of-excellence-data-set-repository, accessed on 01 December 2022. Conﬂicts of Interest: The authors declare no conﬂict of interest. Abbreviations The following abbreviations are used in this manuscript: HI Health Index SOH State of Health CC Constant Current CV Constant Voltage PCoE Prognostics Center of Excellence RSME Root Mean Squared Error LSTM Long Short-term Memory FC Fully Connected References 1. Liu, X.; Wu, J.; Zhang, C.; Chen, Z. A method for state of energy estimation of lithium-ion batteries at dynamic currents and temperatures. J. Power Sources 2014, 270, 151–157. [CrossRef] 2. Xi, Z.; Wang, R.; Fu, Y.; Mi, C. Accurate and reliable state of charge estimation of lithium ion batteries using time-delayed recurrent neural networks through the identiﬁcation of overexcited neurons. Appl. Energy 2022, 305, 117962. [CrossRef] 3. Wang, Y.; Cao, G. Developments in nanostructured cathode materials for high-performance lithium-ion batteries. Adv. Mater. 2008, 20, 2251–2269. [CrossRef] Sensors 2023, 23, 2587 13 of 14 4. Guo, P.; Song, H.; Chen, X. Electrochemical performance of graphene nanosheets as anode material for lithium-ion batteries. Electrochem. Commun. 2009, 11, 1320–1324. [CrossRef] 5. Fang, L.; Chen, M.; Nam, K.W.; Kang, Y.M. Redox Evolution of Li-Rich Layered Cathode Materials. Batteries 2022, 8, 132. [CrossRef] 6. Fang, L.; Zhou, L.; Park, M.; Han, D.; Lee, G.H.; Kang, S.; Lee, S.; Chen, M.; Hu, Z.; Zhang, K.; et al. Hysteresis Induced by Incomplete Cationic Redox in Li-Rich 3d-Transition-Metal Layered Oxides Cathodes. Adv. Sci. 2022, 9, 2201896. [CrossRef] 7. He, W.; Williard, N.; Chen, C.; Pecht, M. State of charge estimation for Li-ion batteries using neural network modeling and unscented Kalman ﬁlter-based error cancellation. Int. J. Electr. Power Energy Syst. 2014, 62, 783–791. [CrossRef] 8. Xing, Y.; Ma, E.W.; Tsui, K.L.; Pecht, M. An ensemble model for predicting the remaining useful performance of lithium-ion batteries. Microelectron. Reliab. 2013, 53, 811–820. [CrossRef] 9. Fu, P.; Chu, L.; Li, J.; Guo, Z.; Hu, J.; Hou, Z. State of Health Prediction of Lithium-Ion Battery Based on Deep Dilated Convolution. Sensors 2022, 22, 9435. [CrossRef] 10. Yao, L.; Wen, J.; Xu, S.; Zheng, J.; Hou, J.; Fang, Z.; Xiao, Y. State of Health Estimation Based on the Long Short-Term Memory Network Using Incremental Capacity and Transfer Learning. Sensors 2022, 22, 7835. [CrossRef] 11. Wei, Y.; Liu, H. Convolutional Long-Short Term Memory Network with Multi-Head Attention Mechanism for Trafﬁc Flow Prediction. Sensors 2022, 22, 7994. [CrossRef] 12. Meng, J.; Yue, M.; Diallo, D. A degradation empirical-model-free battery end-of-life prediction framework based on gaussian process regression and Kalman ﬁlter. IEEE Trans. Transp. Electrif. 2022, 1. [CrossRef] 13. Jia, J.; Liang, J.; Shi, Y.; Wen, J.; Pang, X.; Zeng, J. SOH and RUL prediction of lithium-ion batteries based on Gaussian process regression with indirect health indicators. Energies 2020, 13, 375. [CrossRef] 14. Xu, N.; Xie, Y.; Liu, Q.; Yue, F.; Zhao, D. A Data-Driven Approach to State of Health Estimation and Prediction for a Lithium-Ion Battery Pack of Electric Buses Based on Real-World Data. Sensors 2022, 22, 5762. [CrossRef] 15. Wei, Y.; Wu, D.; Terpenny, J. Learning the health index of complex systems using dynamic conditional variational autoencoders. Reliab. Eng. Syst. Saf. 2021, 216, 108004. [CrossRef] 16. Kumar, A.; Parkash, C.; Vashishtha, G.; Tang, H.; Kundu, P.; Xiang, J. State-space modeling and novel entropy-based health indicator for dynamic degradation monitoring of rolling element bearing. Reliab. Eng. Syst. Saf. 2022, 221, 108356. [CrossRef] 17. Wei, Y.; Wu, D.; Terpenny, J. Constructing Robust and Reliable Health Indices and Improving the Accuracy of Remaining Useful Life Prediction. J. Nondestruct. Eval. Diagn. Progn. Eng. Syst. 2022, 5, 021009. [CrossRef] 18. Andre, D.; Appel, C.; Soczka-Guth, T.; Sauer, D.U. Advanced mathematical methods of SOC and SOH estimation for lithium-ion batteries. J. Power Sources 2013, 224, 20–27. [CrossRef] 19. Xu, W.; Wang, S.; Jiang, C.; Fernandez, C.; Yu, C.; Fan, Y.; Cao, W. A novel adaptive dual extended Kalman ﬁltering algorithm for the Li-ion battery state of charge and state of health co-estimation. Int. J. Energy Res. 2021, 45, 14592–14602. [CrossRef] 20. Liu, D.; Yin, X.; Song, Y.; Liu, W.; Peng, Y. An on-line state of health estimation of lithium-ion battery using unscented particle ﬁlter. IEEE Access 2018, 6, 40990–41001. [CrossRef] 21. Schwunk, S.; Armbruster, N.; Straub, S.; Kehl, J.; Vetter, M. Particle ﬁlter for state of charge and state of health estimation for lithium–iron phosphate batteries. J. Power Sources 2013, 239, 705–710. [CrossRef] 22. Chen, N.; Hu, X.; Gui, W.; Zou, J. Estimation of li-ion battery state of charging and state of healthy based on unsented Kalman ﬁltering. In Proceedings of the The 26th Chinese Control and Decision Conference (2014 CCDC), Changsha, China, 31 May–2 June 2014; pp. 4725–4729. 23. Dong, G.; Chen, Z.; Wei, J.; Ling, Q. Battery health prognosis using Brownian motion modeling and particle ﬁltering. IEEE Trans. Ind. Electron. 2018, 65, 8646–8655. [CrossRef] 24. Thelen, A.; Li, M.; Hu, C.; Bekyarova, E.; Kalinin, S.; Sanghadasa, M. Augmented model-based framework for battery remaining useful life prediction. Appl. Energy 2022, 324, 119624. [CrossRef] 25. Li, Y.; Zou, C.; Berecibar, M.; Nanini-Maury, E.; Chan, J.C.W.; Van den Bossche, P.; Van Mierlo, J.; Omar, N. Random forest regression for online capacity estimation of lithium-ion batteries. Appl. Energy 2018, 232, 197–210. [CrossRef] 26. Yayan, U.; Arslan, A.T.; Yucel, H. A novel method for SoH prediction of batteries based on stacked LSTM with quick charge data. Appl. Artif. Intell. 2021, 35, 421–439. [CrossRef] 27. Zhou, D.; Wang, B. Battery health prognosis using improved temporal convolutional network modeling. J. Energy Storage 2022, 51, 104480. [CrossRef] 28. Yao, X.Y.; Chen, G.; Pecht, M.; Chen, B. A novel graph-based framework for state of health prediction of lithium-ion battery. J. Energy Storage 2023, 58, 106437. [CrossRef] 29. Wei, Y.; Wu, D.; Terpenny, J. Bearing remaining useful life prediction using self-adaptive graph convolutional networks with self-attention mechanism. Mech. Syst. Signal Process. 2023, 188, 110010. [CrossRef] 30. Mawonou, K.S.; Eddahech, A.; Dumur, D.; Beauvois, D.; Godoy, E. State-of-health estimators coupled to a random forest approach for lithium-ion battery aging factor ranking. J. Power Sources 2021, 484, 229154. [CrossRef] 31. Zhao, J.; Zhu, Y.; Zhang, B.; Liu, M.; Wang, J.; Liu, C.; Zhang, Y. Method of Predicting SOH and RUL of Lithium-Ion Battery Based on the Combination of LSTM and GPR. Sustainability 2022, 14, 11865. [CrossRef] 32. Zhou, D.; Li, Z.; Zhu, J.; Zhang, H.; Hou, L. State of health monitoring and remaining useful life prediction of lithium-ion batteries based on temporal convolutional network. IEEE Access 2020, 8, 53307–53320. [CrossRef] Sensors 2023, 23, 2587 14 of 14 33. Wei, Y.; Wu, D. Prediction of state of health and remaining useful life of lithium-ion battery using graph convolutional network with dual attention mechanisms. Reliab. Eng. Syst. Saf. 2023, 230, 108947. [CrossRef] 34. Liu, K.; Chehade, A.; Song, C. Optimize the signal quality of the composite health index via data fusion for degradation modeling and prognostic analysis. IEEE Trans. Autom. Sci. Eng. 2015, 14, 1504–1514. [CrossRef] 35. Wei, Y.; Wu, D.; Terpenny, J. Decision-Level Data Fusion in Quality Control and Predictive Maintenance. IEEE Trans. Autom. Sci. Eng. 2020, 18, 184–194. [CrossRef] 36. Liu, K.; Gebraeel, N.Z.; Shi, J. A data-level fusion model for developing composite health indices for degradation modeling and prognostic analysis. IEEE Trans. Autom. Sci. Eng. 2013, 10, 652–664. [CrossRef] 37. Wei, Y.; Wu, D.; Terpenny, J. Robust incipient fault detection of complex systems using data fusion. IEEE Trans. Instrum. Meas. 2020, 69, 9526–9534. [CrossRef] 38. Bahdanau, D.; Cho, K.; Bengio, Y. Neural machine translation by jointly learning to align and translate. arXiv 2014, arXiv:1409.0473. 39. Xu, K.; Ba, J.; Kiros, R.; Cho, K.; Courville, A.; Salakhudinov, R.; Zemel, R.; Bengio, Y. Show, attend and tell: Neural image caption generation with visual attention. In Proceedings of the International Conference on Machine Learning, PMLR, Miami, FL, USA, 9–11 December 2015; pp. 2048–2057. 40. Luong, M.T.; Pham, H.; Manning, C.D. Effective approaches to attention-based neural machine translation. arXiv 2015, arXiv:1508.04025. 41. Vaswani, A.; Shazeer, N.; Parmar, N.; Uszkoreit, J.; Jones, L.; Gomez, A.N.; Kaiser, Ł.; Polosukhin, I. Attention is all you need. In Proceedings of the Advances in Neural Information Processing Systems, Long Beach, CA, USA, 4–9 December 2017; pp. 5998–6008. 42. Saha, B.; Goebel, K. Battery data set. NASA AMES Progn. Data Repos. 2007. 43. Audin, P.; Jorge, I.; Mesbahi, T.; Samet, A.; De Beuvron, F.D.B.; Boné, R. Auto-encoder LSTM for Li-ion SOH prediction: A comparative study on various benchmark datasets. In Proceedings of the 2021 20th IEEE International Conference on Machine Learning and Applications (ICMLA), online, 13–15 December 2021; pp. 1529–1536. 44. Yu, J. State of health prediction of lithium-ion batteries: Multiscale logic regression and Gaussian process regression ensemble. Reliab. Eng. Syst. Saf. 2018, 174, 82–95. [CrossRef] 45. Qin, P.; Zhao, L.; Liu, Z. State of health prediction for lithium-ion battery using a gradient boosting-based data-driven method. J. Energy Storage 2022, 47, 103644. [CrossRef] Disclaimer/Publisher’s Note: The statements, opinions and data contained in all publications are solely those of the individual author(s) and contributor(s) and not of MDPI and/or the editor(s). MDPI and/or the editor(s) disclaim responsibility for any injury to people or property resulting from any ideas, methods, instructions or products referred to in the content.","libVersion":"0.3.1","langs":""}