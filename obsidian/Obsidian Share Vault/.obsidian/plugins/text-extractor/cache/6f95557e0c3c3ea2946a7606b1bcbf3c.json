{"path":"lit/lit_sources.backup/Zhao24uncertInformBilevRESsched.pdf","text":"1 Uncertainty-Informed Renewable Energy Scheduling: A Scalable Bilevel Framework Dongwei Zhao, Vladimir Dvorkin, Stefanos Delikaraoglou, Alberto J. Lamadrid L., and Audun Botterud Abstract—This work proposes an uncertainty-informed bid adjustment framework for integrating variable renewable energy sources (VRES) into electricity markets. This framework adopts a bilevel model to compute the optimal VRES day-ahead bids. It aims to minimize the expected system cost across day- ahead and real-time stages and approximate the cost efficiency of the stochastic market design. However, solving the bilevel optimization problem is computationally challenging for large- scale systems. To overcome this challenge, we introduce a novel technique based on strong duality and McCormick envelopes, which relaxes the problem to a linear program, enabling large- scale applications. The proposed bilevel framework is applied to the 1576-bus NYISO system and benchmarked against a myopic strategy, where the VRES bid is the mean value of the probabilistic power forecast. Results demonstrate that, under high VRES penetration levels (e.g., 40%), our framework can significantly reduce system costs and market-price volatility, by optimizing VRES quantities efficiently in the day-ahead market. Furthermore, we find that when transmission capacity increases, the proposed bilevel model will still reduce the system cost, whereas the myopic strategy may incur a much higher cost due to over-scheduling of VRES in the day-ahead market and the lack of flexible conventional generators in real time. Index Terms—Renewable energy, electricity markets, uncer- tainty management, bilevel optimization, unit commitment, scal- ability, McCormick envelope NOMENCLATURE A. Sets and Indexes Λ Set of transmission lines, indexed by (n, m), where n/m is sending/receiving end of a transmission line Ω Set of VRES generation scenarios, indexed by ω I Set of conventional units, indexed by i or j I FS Subset of I with fast-startup generation units I SL Subset of I with slow-startup generation units K Set of VRES generation units, indexed by k N Set of grid buses, indexed by n T Set of market operation time slots, indexed by t (·)n mapping of (·) into the set of buses B. Parameters Ci Variable generation cost of conventional units The information, data, or work presented herein was funded by the Advanced Research Projects Agency-Energy (ARPA-E), U.S. Department of Energy, under Award Number DE-AR0001277. The views and opinions of authors expressed herein do not necessarily state or reflect those of the United States Government or any agency thereof. Parts of the results have appeared in a conference paper [1]. Dongwei Zhao and Vladimir Dvorkin are with the Energy Initiative and Laboratory for Information and Decision Systems, Massachusetts Institute of Technology, Cambridge, MA, USA (e-mail: {zhaodw, dvorkin}@mit.edu). Stefanos Delikaraoglou and Audun Botterud are with the Laboratory for In- formation and Decision Systems, Massachusetts Institute of Technology, Cam- bridge, MA, USA (e-mail: sdelikaraoglou@gmail.com, audunb@mit.edu). Alberto J. Lamadrid L. is with the Department of Economics and Depart- ment of Industrial and Systems Engineering, Lehigh University, Bethlehem, PA, USA (e-mail: ajlamadrid@lehigh.edu). C 0 i No-load cost of conventional units C SU i Start-up cost of conventional units C sh Cost of load shedding (value of lost load) C U/D i Real-time up-/downward re-dispatch costs F n,m Transmission line capacities Ln,t Day-ahead load forecast Ln,t,ω Real-time demand realization P i Maximum generation capacity of conventional units P i Minimum generation capacity of conventional units RU/D i Upward/downward ramping capacity of conven- tional units ̃Wk,t,ω Real-time VRES power realization W k VRES power capacity xn,m Transmission line reactance C. Decision Variables δDA n,t Day-ahead voltage angle cDA i,t Day-ahead start-up cost of conventional units pC i,t Day-ahead generation of conventional units pW k,t Day-ahead generation of VRES units u DA i,t Day-ahead commitment status of conventional units Wk,t Day-ahead bidding quantity of VRES units δRT n,t,ω Real-time voltage angle c RT i,t,ω Real-time start-up cost of conventional units lsh n,t,ω Real-time shedding of electrical loads p W,cr k,t,ω Real-time VRES power curtailment rU/D i,t,ω Real-time up-/downward re-dispatch of conventional units u RT i,t,ω Real-time commitment status of conventional units I. INTRODUCTION The appeal for a transition to zero-carbon power systems has motivated the large-scale deployment of variable renewable energy sources (VRES). From 2010 to 2020, the globally installed solar PV capacity increased from about 40 GW to 760 GW, while the wind energy capacity grew from about 200 GW to 740 GW [2]. In many regions, this transition takes place in restructured electricity markets. For instance, in the USA, New York Independent System Operator (NYISO) is mandated to reach 70% renewable electricity by 2030 [3] and California Independent System Operator (CAISO) is taking actions to align with the state’s policy to supply 100% zero- emission electricity by 2045 [4]. The existing electricity market design is tailored to the technical and economic characteristics of dispatchable fossil- fueled generators. However, the increasing levels of VRES pose challenges to achieving market efficiency and reliability due to inherent variability and uncertainty. As a result, there are ongoing discussions around revisiting the electricity market design to address these challenges [5].arXiv:2312.03868v1 [eess.SY] 6 Dec 2023 2 Current short-term electricity markets are typically arranged in two stages [6]: a day-ahead market (DAM) cleared before actual operations to establish initial generation schedules and prices, and a real-time market (RTM) that runs close to actual delivery to compensate for any imbalances from the day-ahead schedule. However, in the DAM, the uncertainty information about VRES generations is usually summarized in a single- valued point forecast, typically the conditional expectation of the predicted probability distribution [7]. This myopic approach does not account for the re-dispatch cost under generation uncertainty, thus leading to inefficient coordination between the day-ahead and real-time operations. To improve the coordination between day-ahead and real- time stages, there is extensive literature adopting stochas- tic optimization, chance-constraint optimization, and robust optimization in the electricity market design to account for uncertainty from VRES sources. The works in [8]–[11] cleared the market by means of scenario-based stochastic optimization, which usually guarantees the least system cost in the expected fashion. However, this approach relies on accurate probability distributions of random variables. Also, it is demonstrated that scenario-based stochastic optimization has difficulty in achiev- ing revenue adequacy and cost recovery for each scenario individually [12]. Some papers [13], [14] proposed market mechanisms based on the chance-constraint optimization. The chance-constraint optimization can internalize the stochasticity of VRES using statistical moments (e.g., mean and standard deviation). Although the chance constraints can easily control risk tolerance in the market, the underlying assumptions to reformulate chance constraints are restrictive (i.e., they require a linear dependency of optimization variables on random forecast errors) and may lead to sub-optimal, conservative solutions, as shown in [15]. The works in [16], [17] adopted robust optimization to clear the market. Robust optimization seeks a solution that minimizes the worst-case cost, without explicitly modeling probability distributions of VRES. How- ever, it only optimizes the worst case and may not achieve good performance for other cases. Besides, it is generally challenging to solve robust optimization problems due to its non-convex nature, which makes it difficult to support market operations. However, the literature above all cleared the DAM and RTM in a joint manner to determine the DAM schedule, which is not directly compatible with the deterministic two-settlement market structure. To address this issue, Morales et al. [18] proposed an adjustment of day-ahead wind-energy quantities using bilevel optimization, which approximates the stochastic market solution within the sequential deterministic energy- only market design. Follow-up work in [19]–[21] extended this bilevel approach to reserve and energy co-optimization. For practical large-scale power systems, however, solving bilevel problems efficiently is generally difficult due to their non-convex nature. In this work, our bilevel model is bilevel linear programming that has linear objectives and constraints at both lower and upper levels. The works [18]–[21] solved bilevel linear programming for market clearing by formulating mixed-integer linear programming (MILP) problems based on Karush–Kuhn–Tucker (KKT) conditions. However, these methods were only tested on small-scale systems, such as a 24-bus system [18]. For large-scale systems, MILP problems can still be challenging to solve, making it difficult to support practical market operations. For instance, on the NYISO system with over one thousand buses, the reformulated MILP problem cannot compute results within two hours for eco- nomic dispatch problems [1]. Therefore, alternative methods are necessary to address the computational complexity of bilevel programming for larger-scale systems. While bilevel linear programming has been extensively studied, there is no guarantee of efficient approaches for large-scale problems [22]. Among proposed techniques, enu- merative methods search for extreme points with iterative linear programming (LP) problems [23]–[25]. Other heuristic algorithms lack theoretical guarantees and require solving many intermediate optimization problems [26], [27]. In the domain of energy and power systems, the most common approach involves replacing the lower-level problem with KKT conditions [19]–[22], [28]. This reformulated problem can be solved using commercial MILP solvers [29], branch-and- bound algorithms [30], Benders decomposition [28], or penalty function methods [31]. However, at scale, these methods either introduce a large number of binary variables or require many iterations of large-scale optimization problems, making them computationally expensive. One alternative method for bilevel problems is to replace complementarity conditions in KKT conditions with equiv- alent strong-duality conditions [32]. However, the strong- duality constraint will introduce non-convex bilinear items. In power and energy research, Zhou et al. [33] and Yang et al. [34] discretized variables to transform bilinear items of strong-duality conditions in bilevel pricing problems, which creates a large number of binary variables. Cerisola et al. utilized McCormick envelopes [35] to relax bilinear functions in hydrothermal models [36]. In this work, we combine the strong-duality condition and McCormick envelope together on the bilevel LP problem, which relaxes it into an LP problem. We demonstrate that this approach is scalable for large-scale systems, while it can achieve significant economic benefits. We present the technical contributions of this work as follows: 1) Bilevel optimization of VRES bids for unit-commitment problems: We present a bilevel-dispatch framework (BiD) to adjust VRES bidding quantities in the day-ahead unit commitment (UC) problem, which can guarantee the minimum expected system cost in the context of a deterministic two- settlement market structure. Relative to [18]–[21], which pri- marily focuses on the European market settlements, we include the UC constraints and fit the framework into the scope of US electricity markets. We compare BiD with two benchmarks: (i) a myopic-dispatch strategy (MyD) where VRES producers bid the forecast (expected) value in the DAM. (ii) a stochastic- dispatch framework (StD) that jointly optimizes DAM and RTM, and attains the least expected cost. 2) Efficient algorithm for practical large-scale systems: Solving large-scale bilevel optimization problems is computa- tionally expensive. The conventional method of reformulating a MILP problem based on KKT conditions cannot solve the 3 large-scale NYISO system within two hours for economic dispatch problems [1]. To address this scalability issue, we propose a new approach based on the strong-duality condi- tion and McCormick-envelope relaxation. We design proper relaxation bounds for McCormick envelopes. This method is computationally efficient for the NYISO system as it only requires solving a linear program. Meanwhile, it can achieve significant economic benefits compared with MyD. 3) Large-scale application: We conduct numerical studies on a 1576-bus NYISO system. Under a high VRES penetration level (e.g., 40%) and current generator settings (73% fast- startup generation capacity) in NYISO, the results demon- strate significant economic benefits of BiD compared to MyD. By efficiently optimizing VRES bidding quantities in DAM, BiD can (i) substantially reduce the expected system cost (by over 20%), (ii) decrease the volatility of market prices and VRES producers’ revenues, and (iii) effectively prevent negative market revenues for VRES producers. Furthermore, increasing transmission capacities may incur a much higher system cost under MyD than BiD. The reason is that excessive renewable energy is scheduled in DAM without adequate flexible generators in RTM to address uncertainty. Notably, these benefits depend upon the penetration levels of VRES and generator flexibility. For instance, if all generators can start up fast in RTM, MyD can achieve similar economic benefits to BiD and StD. Notably, this work focuses on the system perspective, which establishes benchmark bidding quantities in a centralized way by minimizing the expected system cost. We expect that the benchmark bidding quantities can also serve as a tool to guide, monitor, or regulate the bidding strategies of private suppliers. For example, by comparing the benchmark results with the forecast values, a risk score can be developed to adjust and guide how much suppliers should bid in the market. We next discuss two important future extensions for this work. First, one future direction is to compare this centralized manner with the case that suppliers make bidding strategies by themselves. We briefly discussed two possible cases: price- taking and price-making bidding strategies. If the private suppliers just make decisions as price-takers based on the DAM and RTM price estimation, one of our previous papers [37] shows that under certain assumptions, the profit-seeking suppliers should either bid zero or maximum wind quantity in the DAM. This result may not be efficient from the system perspective. To reach the system optimum in a decentralized way, the impact of bids on prices needs to be considered in the suppliers’ decisions. It is necessary to adopt a dynamic and smart framework to coordinate and guide private suppliers to make decisions. One possible direction is to design a decentralized algorithm or incentive for suppliers based on the centralized bilevel model. Second, although we use stochastic optimization to for- mulate the bilevel framework in a risk-neutral way, we can also extend this work by adopting different risk-aversion ap- proaches to deal with uncertainty. For example, we can modify the objective in the upper level based on the conditional value of risk (CVaR). In addition, we can impose chance constraints into upper and lower levels to formulate a chance-constraint optimization problem. We can set up an uncertainty set and optimize the worst scenario in the upper-level objective using robust optimization. In these cases, the risk-aversion factor can be reflected while the deterministic two-settlement market structure can still be maintained. We leave these risk-aversion extensions as future work. The rest of the paper is organized as follows. We first introduce the standard deterministic market-clearing model in Section II. Then, we formulate a bilevel framework for VRES quantity adjustments in Section III and present the solution method in Section IV. Finally, we present the results of different case studies and conclude in Sections V and VI. II. TWO-SETTLEMENT MARKET CLEARING This section provides optimization models for the day-ahead and real-time unit commitment market dispatch. In terms of modeling assumptions, the network topology is included considering linear DC power flows.1 We assume a linear operation cost for conventional generation units and zero operation cost for VRES. 2 The system demand is inelastic with a large value of lost load (VoLL).3 To maintain convexity in the market-clearing models, we relax binary commitment decisions and build a relaxed version of the UC problem [41] [42]. 4 We differentiate the fast and slow start-up generators, and omit minimum on- and off-times for simplicity. For system uncertainty, we use the scenario set Ω to model the discrete probability distribution of real-time VRES generations and system demands. A. Day-Ahead Market The day-ahead market-clearing problem takes the form: min ΦDA f DA(Φ DA) := ∑ i∈I ∑ t∈T Ci · p C i,t + u DA i,t · C 0 i + c DA i,t (1a) s.t. ∑ i∈In p C i,t + ∑ k∈Kn p W k,t − Ln,t − ∑ m:(n,m)∈Λ δDA n,t − δDA m,t xn,m = 0 : λb n,t, (1b) − F n,m ⩽ δDA n,t − δDA m,t xn,m ⩽ F n,m : λn,m,t, λn,m,t, (1c) 1The Independent System Operators (ISOs) in the US leverage the DC Optimal Power Flow (DCOPF) formulation to settle and clear the DAM and RTM [38]. More detailed feasibility checks (e.g. with AC models) can still be performed outside the market clearing formulation, similar to the practice in current electricity markets. 2We use the synthetic data of NYISO systems developed by [39], which model linear operation costs of thermal units. Our model can easily be generalized to step-wise cost curves of thermal units since the DAM and RTM clearing models still exhibit linear structures. Such a format of step-wise cost curves is adopted in the NYISO [40]. 3 We leave demand response modeling and market participation to future work. In fact, we can easily generalize our model to incorporate step-wise demand curves to provide a more detailed representation of load reductions, where the DAM and RTM clearing models still exhibit linear structures. Demand curves can indicate the elasticity of demand, e.g., a low cost of load reductions shows high elasticity while a high cost shows low elasticity. 4In Appendix B, we show that this relaxation well approximates the binary setting, where the non-discrete UC solutions in the range (0, 1) make up less than 1% of the total number of UC solutions. 4 ∀n ∈ N , ∀(n, m) ∈ Λ, ∀t ∈ T , 0 ⩽ pW k,t ⩽ Wk,t : λW k,t, λW k,t, (1d) ∀k ∈ K, ∀t ∈ T , uDA i,t · P i ⩽ pC i,t ⩽ u DA i,t · P i : λC i,t, λC i,t, (1e) 0 ⩽ u DA i,t ⩽ 1 : λU i,t, λU i,t, (1f) C SU i · (u DA i,t − u DA i,t−1) ⩽ cDA i,t : λS1 i,t, (1g) 0 ⩽ c DA i,t : λS2 i,t, (1h) pC i,t − p C i,t−1 ⩾ −u DA i,t−1 · RD i : λR i,t, (1i) pC i,t − p C i,t−1 ⩽ u DA i,t · RU i : λ R i,t, (1j) ∀i ∈ I, ∀t ∈ T , where the total dispatch cost f DA includes the variable, no- load, and startup costs of conventional generation units. The decision variable set ΦDA comprises the day-ahead decisions for each conventional unit, i.e., pC i,t, u DA i,t , c DA i,t , and each VRES unit, i.e., p W k,t, as well as the voltage angles δDA n,t for each bus. Constraint (1b) guarantees the day-ahead power balance at each bus. Power flow constraints (1c) are enforced to satisfy transmission limits. The generation limits of renewable and conventional power producers are enforced using constraints (1d) and (1e), respectively, where the latter accounts for the UC decisions. A final set of constraints (1f)–(1j) model the relaxed UC decisions, UC costs, and ramping limits. Note that the subscript t = 0 denotes the initial states of variables before the operation horizon T . For VRES in constraint (1d), we define the VRES quantity offer W = (Wk,t, ∀k ∈ K, ∀t ∈ T ). We denote by X DA(W ) the constraint set constructed by (1b)-(1j) parameterized by VRES offer W . We list the dual variables after the column signs in (1b)-(1j), and gather them in vector λ. Finally, we will denote the optimal day-ahead solution by ΦDA⋆. In the baseline dispatch, W is set to the mean value of the VRES forecast. Later in Section III, we will introduce the bilevel model which optimizes W to achieve better coordina- tion between the day-ahead and real-time markets. B. Real-Time Market Closer to real-time operations, any deviation from the day- ahead schedule ΦDA⋆ is compensated for by balancing actions. For a specific realization ω ∈ Ω of renewable generation ̃Wk,ω,t and demand Lk,ω,t, the system operator decides the optimal re-dispatch by minimizing the re-dispatch cost f RT ω , which includes the upward/downward adjustment cost of con- ventional generators, startup cost and fixed operational cost of new online generators, and the cost of lost load: min ΦRT ω f RT ω (Φ RT ω , ΦDA⋆ ω ) := ∑ i∈I ∑ t∈T (C U i rU i,t,ω − C D i rD i,t,ω + C 0 i · (u RT i,t,ω − u DA⋆ i,t )+cRT i,t,ω) + ∑ n∈N ∑ t∈T C shlsh n,t,ω (2a) s.t. ∑ i∈In (p C⋆ i,t + rU i,t,ω − rD i,t,ω)+ ∑ k∈Kn (̃Wk,t,ω − pW,cr k,t,ω) − ∑ m:(n,m)∈Λ δRT n,t,ω − δRT m,t,ω xn,m = Ln,t,ω − lsh n,t,ω, (2b) 0 ⩽ lsh n,t,ω ⩽ Ln,t,ω, (2c) ∀n ∈ N , ∀t ∈ T , − F n,m ⩽ δRT n,t,ω − δRT m,t,ω xn,m ⩽ F n,m, (2d) ∀(n, m) ∈ Λ, ∀t ∈ T , u DA⋆ i,t ⩽ u RT i,t,ω ⩽ 1, u DA⋆ j,t = u RT j,t,ω, (2e) ∀i ∈ I FS, ∀j ∈ I SL, ∀t ∈ T , u RT i,t,ω · P i ⩽ p C⋆ i,t + rU i,t,ω − rD i,t,ω ⩽ uRT i,t,ω · P i, (2f) c RT i,t,ω + cDA⋆ i,t ⩾ C SU i · (u RT i,t,ω − u RT i,t−1,ω), (2g) − u RT i,t−1,ω · RD i ⩽ pC⋆ i,t + rU i,t,ω − rD i,t,ω − (p C⋆ i,t−1 + rU i,t−1,ω −rD i,t−1,ω) ⩽ u RT i,t,ω ·RU i , (2h) c RT i,t,ω ⩾ 0, rU i,t,ω ⩾ 0, rD i,t,ω ⩾ 0, (2i) ∀i ∈ I, ∀t ∈ T , 0 ⩽ pW,cr k,t,ω ⩽ ̃Wk,t,ω, (2j) ∀k ∈ K, ∀t ∈ T . Here the decision variable set ΦRT ω includes the re-dispatch variables of each conventional unit, i.e., (rU i,t,ω, rD i,t,ω, uRT i,t,ω, c RT i,t,ω), curtailment of each VRES producer p W,cr k,t,ω, and lost load lsh n,t,ω, as well as the voltage angles δRT n,t,ω at each bus. Constraint (2b) ensures the power balance. Constraints (2c) and (2d) give shedding load feasibility and transmission limits, respectively. The first entry in constraint (2e) allows the fast startup generators that are not committed in the DAM to be dispatched in the RTM. On the other hand, the commitment status of slow-startup generators in the RTM remains the same as in the DAM as per the second entry in (2e). Constraint (2f) is the capacity limit on the re-dispatch of conventional generators. Constraint (2g) yields the startup cost. Constraints (2h), (2i) and (2j) ensure the ramping-rate limits, the feasibility of upward/downward adjustment of conventional generators, and real-time VRES curtailment, respectively. We denote by X RT ω (ΦDA) the constraint set constructed by (2b)-(2j), which is coupled with day-ahead schedule ΦDA. Note that both optimization problems for the day-ahead and real- time dispatch are LP problems. III. UNCERTAINTY-INFORMED QUANTITY ADJUSTMENTS Building on the sequential DAM and RTM problems (1)– (2), we develop a bilevel-dispatch framework (BiD) to factor in the uncertainty of renewable generation and reveal the op- timal quantity offers of VRES producers, which improves the coordination between the two markets in terms of the dispatch cost. We also introduce two benchmark dispatch frameworks to assess the performance of the proposed framework. A. Bilevel Optimization framework The framework BiD is based on bilevel optimization prob- lems. In the upper level, the system operator decides the day- ahead VRES bidding quantities W . In the lower level, the day-ahead schedule ΦDA is optimized for a fixed value W provided from the upper problem. Sourcing the optimal day- ahead dispatch ΦDA from the lower-level problem, the system 5 operator in the upper level also optimizes the real-time re- dispatch ΦRT ω for different uncertainty realizations. The overall goal is to minimize the total system cost, i.e. the sum of DAM and expected RTM costs. The bilevel problem takes the following form: Problem BiD: Bilevel optimization problem for day- ahead VRES quantity offer SBiD := min ΦRT ⋃ W f DA(ΦDA⋆) + Eω∈Ω [ f RT ω (Φ RT ω , ΦDA⋆ ω ) ] s.t. ΦRT ω ∈ X RT ω (ΦDA⋆), ∀ω ∈ Ω, ΦDA⋆ ∈ arg {min ΦDA f DA(Φ DA) s.t. ΦDA ∈ X DA(W ) } . Once the optimal bid W ⋆ is obtained from Problem BiD, the system operator first clears the DAM (1) using W ⋆, and then, closer to real time, clears the RTM (2) for a particular realization of renewable generation. The expected system cost is denoted by SBiD. B. Dispatch Benchmarks We consider two dispatch benchmarks for BiD: 1) Myopic dispatch (MyD): Each VRES producer k offers the bidding quantity at the expected value of the forecast, i.e., Wk,t = Eω∈Ω[̃Wk,t,ω] in (1d). Then, the DAM is cleared, followed by the RTM clearing. The system cost SMyD is calculated by f DA +Eω∈Ω [ f RT ω ] following the market clearing problems (1) and (2). 2) Stochastic dispatch (StD): The system operator co- optimizes the day-ahead schedule and real-time re-dispatch by minimizing the total expected costs across the two markets. Note that instead of clearing DAM and RTM separately, the model of StD jointly optimized DAM and RTM, which is not directly compatible with the two-settlement market structure. Problem StD: Stochastic dispatch SStD := min f DA(ΦDA) + Eω∈Ω [ f RT ω (Φ RT ω , ΦDA ω )] (4a) s.t. ΦRT ω ∈ X RT ω (ΦDA), ∀ω ∈ Ω, (4b) ΦDA ∈ X DA(W ), (4c) var: ΦDA, ΦRT. System cost comparison: In terms of the system costs under StD, BiD and MyD, we have the following comparison. Proposition 1. The system costs satisfy SMyD ≥ SBiD ≥ SStD. The reason is that the solution of MyD is one feasible solution to Problem BiD while the optimal solution to Problem BiD is also one feasible solution to Problem StD. The two benchmarks serve as the upper bound and lower bound for the proposed bilevel framework. The inequality SMyD ≥ SBiD is straightforward. We elabo- rate more on SBiD ≥ SStD. Notably, Problem BiD and Problem StD have the same objective but different constraint sets. In Problem BiD, the day-ahead dispatch ΦDA is the optimal solution to the deterministic DAM market clearing problem. However, in Problem StD, we do not require that ΦDA is the optimal solution to the DAM clearing problem. If ΦDA is feasible in Problem BiD, it means that ΦDA satisfies ΦDA ∈ X DA(W ). Then, ΦDA will also satisfy ΦDA ∈ X DA(W ) in Problem StD. In other words, the solution space of Problem BiD is a subset of Problem StD. Therefore, Problem StD always induces a lower system cost than Problem BiD. IV. SOLUTION METHOD The bilevel Problem BiD is non-convex and challenging to solve. The conventional method is to replace the lower-level problem using KKT conditions and transform the problem into a MILP problem [18]. While this method works well on a small-scale system (e.g., IEEE 118-bus system), it does not solve a large-scale system (e.g., NYISO) in a reasonable time [1]. As a solution, we propose a method based on the strong duality of LP and a McCormick-envelope relaxation. A. Strong Duality Transformation Based on the strong-duality property of LP, we derive a single-level optimization, which is equivalent to Problem BiD. First, the lower-level LP problem, can equivalently be represented through the set of its KKT conditions, including primary feasibility, dual feasibility, stationary conditions, and complementarity slackness constraints. For LP, the strong- duality condition is equivalent to complementarity slackness constraints [32]. The KKT conditions then take the form: (i) Primary feasibility: (1b)-(1j); (ii) Dual feasibility: ˜λ ⩾ 0, (5) where ˜λ includes the set of dual variables λ except those associated with the power balance constraint (1b); (iii) Stationary conditions, i.e., the first-order conditions with respect to variables p C i,t, c DA i,t , u DA i,t , p W k,t, and δDA n,t: ∂L ∂p C i,t = Ci,t − λb n − λC i,t + λ C i,t − λ R i,t+1 + λR i,t+1 + λR i,t − λ R i,t = 0, (6a) ∀n ∈ N , ∀i ∈ In, ∀t ∈ T , ∂L ∂cDA i,t = 1 − λS1 i,t − λ S2 i,t = 0, (6b) ∀i ∈ I, ∀t ∈ T ; ∂L ∂uDA i,t = C 0 i + λU i,t − λU i,t − P C i · λC i,t + P C i · λC i,t − RU i · λ R i,t − RD i · λR i,t+1 + C SU i · λS1 i,t − C SU i · λ S1 i,t+1 = 0, (6c) ∀i ∈ I, ∀t ∈ T , ∂L ∂p W k,t = −λb n,t − λ W k,t + λW k,t = 0, (6d) ∀n ∈ N , ∀k ∈ Kn, ∀t ∈ T , ∂L ∂δDA n,t = ∑ m:(n,m)∈Λ −λb n,t −λn,m,t +λn,m,t xn,m 6 − ∑ m:(m,n)∈Λ −λb m,t −λmn,t +λmn,t xmn = 0, (6e) ∀n ∈ N , ∀t ∈ T ; (iv) Strong-duality condition: f DA(ΦDA) = gDA(λ), (7) where the dual objective function is defined by gDA(λ) := ∑ n∈N ∑ t∈T λb n,t · Ln,t − ∑ n,m∈N (λn,m,t + λn,m,t) · F n,m − ∑ i∈I ∑ t∈T λ U i,t − ∑ k∈K ∑ t∈T λ W k,t · Wk,t. (8) Then, equivalent to Problem BiD, the single-level optimiza- tion Problem BiD-S takes the following form: Problem BiD-S: Equivalence with strong duality min f DA(Φ DA) + Eω∈Ω [ f RT ω (ΦRT ω , ΦDA ω ) ] s.t. ΦRT ω ∈ X RT ω (Φ DA), ∀ω ∈ Ω, ΦDA ∈ X DA(W ), Equations (5), (6), (7), var : Φ RT, ΦDA, W , λ. However, Problem BiD-S has the only bilinear term λW k,t · Wk,t in the strong-duality constraint (7). Next, we adopt the McCormick envelope to relax this bilinear item. B. McCormick-Envelope Relaxation We will first formulate the McCormick-envelope relaxation, and then explain how we choose the bounds for the envelope. 1) Convex relaxation: We let zk,t = λW k,t · Wk,t in (8) and change gDA(λ) into gDA(λ, z), which transforms (7) into f DA(Φ DA) = gDA(λ, z). (10) Given some variable bounds αλ k,t ⩽ λW k,t ⩽ βλ k,t and αW k,t ⩽ Wk,t ⩽ βW k,t, the McCormick envelope gives the following convex relaxation for zk,t [35]. zk,t ⩾ αλ k,t · Wk,t + αW k,t · λ W k,t − αλ k,tαW k,t, (11a) zk,t ⩾ βλ k,t · Wk,t + βW k,t · λ W k,t − βλ k,tβW k,t, (11b) zk,t ⩽ βλ k,t · Wk,t + αW k,t · λ W k,t − βλ k,tαW k,t, (11c) zk,t ⩽ αλ k,t · Wk,t + βW k,t · λ W k,t − αλ k,tβW k,t, (11d) ∀k ∈ K, ∀t ∈ T , This leads to the following relaxed LP counterpart Problem BiD-McCormick of Problem BiD-S: Problem BiD-McCormick: Relaxed problem min f DA(ΦDA) + Eω∈Ω [ f RT ω (Φ RT ω , ΦDA ω )] s.t. ΦRT ω ∈ X RT ω (ΦDA), ∀ω ∈ Ω, ΦDA ∈ X DA(W ), Equations (5), (6), (10), (11) var : Φ DA, ΦRT, W , λ, z. 2) Bounds choice: It is important to choose proper lower and upper bounds for Wk,t and λ W k,t. In numerical studies, for Wk,t, we choose the bounds αW k,t = 0 as 0 ⩽ Wk,t. We set βW k,t = γ · Eω[̃Wk,t,ω], ∀k ∈ K, ∀t ∈ T , (13) where we adjust the parameter γ for the upper bounds around the mean value of VRES forecast to test the performance. For λ W k,t, we let αλ k,t = 0 as 0 ⩽ λ W k,t. We set βλ k,t = λW k,t(0), where λW k,t(0) denotes the dual solution of λW k,t in the DAM schedule when all VRES producers bid zero quantity. Based on (6d), when λ W k,t > 0, we have λW k,t = λ b n,t, ∀k ∈ Kn. Since VRES have zero marginal cost in the DAM, more renewable energy at one bus indicates lower locational marginal prices. Thus, the dual value λW k,t(0) can roughly indicate the upper bound for λW k,t, which is always feasible in simulations. 3) System cost SBiD calculation: After obtaining the quan- tity solution W ⋆ from Problem BiD-McCormick, the system operator will first clear the DAM (1) and obtain the DAM cost f DA given W ⋆, and then sequentially clear the RTM (2) and obtain the RTM cost f RT ω , based on which we calculate the system cost SBiD by f DA + Eω∈Ω [ f RT ω ] .5 We use the same scenario set to calculate SBiD as in Problem BiD-McCormick. Note that we are not using the optimal objective value in Problem BiD-McCormick as the system cost for SBiD. 4) Approximation error of McCormick envelope: Note that for Problem BiD, the KKT-condition-based reformulation is equivalent to the original problem. However, we may not be able to numerically solve the problem for a large-scale system. e.g., the NYISO system that we use in Section V. Therefore, we cannot use this result as a benchmark for our McCormick- envelope relaxation.6 Besides, we cannot theoretically charac- terize a bound for the relaxation error, which is a topic for future research. However, we have shown that StD provides a natural lower bound for BiD in terms of the expected system cost. Hence the approximation error (in system cost) of the McCormick- envelope relaxation for the bilevel model is upper-bounded by the difference between Problem BiD-McCormick and Problem StD. We use such an upper bound of the error to evaluate 5Although we solve the whole problem by linear relaxation, what we aim to obtain is the optimal bidding quantity of VRES. Given the optimal bidding quantity, we re-run the DAM (lower-level problem) and RTM models to clear the market. Therefore, the market-clearing solutions in the lower level and upper level, as resulting from these market simulations, are always feasible. 6For a small-scale system like IEEE 118-bus system, as shown in the previous conference paper [1], the gap is no greater than 2% between the McCormick-envelope-based method and accurate KKT-condition-based method. 7 the performance of Problem BiD-McCormick, which is usually less than 6% in the simulations in Section V. 5) Application to other problems: The proposed McCormick-envelope relaxation method can be applied to other bilevel optimization problems. First, as long as the lower- level problem is a linear program, we can use the strong- duality condition to obtain the equivalent transformations. Second, the strong-duality condition brings bilinear terms. It is important to choose proper upper bounds and lower bounds for the McCormick envelope. We select upper and lower bounds based on our insights into the VRES scheduling problem. When we apply this method to other applications, proper upper and lower bounds need to be selected considering their specific physical meanings. Lastly, this method can work well on a specific problem if it has good accuracy performance, which is the case for our application as shown later in Section V. However, if the accuracy performance is poor for a specific problem, we can try multi-segment McCormick envelopes, which introduce piece-wise linear constraints instead of linear constraints. In this case, the tradeoff between accuracy and complexity needs to be evaluated. In the next section, we will show that even if the selected lower and upper bounds for Wk,t and λW k,t are in wide ranges, they can still achieve system costs that are much lower than MyD and close to StD as shown in Section V-B. Besides, the relaxed Problem BiD-McCormick is an LP problem that can be efficiently solved even on large-scale systems. V. NUMERICAL STUDIES We test our BiD framework on the NYISO system [39]. We will first show a good performance of the proposed algorithm based on strong-duality conditions and McCormick envelopes. Then, we demonstrate the economic benefits of BiD compared with the baseline MyD, e.g., reducing system costs, improving robustness under out-of-sample tests for uncertainty scenarios, reducing volatility of market prices and revenues, and preventing revenue loss for VRES producers. A. Modeling Setup NYISO system: The tested NYISO system has 1576 buses, 2359 transmission lines, 1564 loads, 345 conventional gener- ation units, and 27 wind farms [39]. We use the wind and load data on August 2, 2019. For illustration, we adopt the operation window from 7:00 am to 10:00 am. We generate 20 joint scenarios for the probability distribution of wind and load forecast using PGscen [43]. The simulations on 24-hour operations and a large number of scenarios are computation- ally challenging. We give one example of 24-hour schedule results based on 4-hour rolling horizons in Appendix A. We present out-of-sample tests for 20 scenarios in Section V-D. Wind-energy generators: We have 27 wind farms in NYISO with 20 scenarios representing uncertainty in their generations. Since the original capacity of wind farms is small, i.e., it only meets 4.4% of the total demand, we will gradually increase the capacity of wind farms to achieve penetration levels of 10%, 40%, and 70%, relative to system demand on average. To accommodate more renewable energy, we also increase transmission-line capacities by factors × 2 and × 4. Flexibility of conventional generators: We classify conven- tional generators into fast-startup and slow-startup technolo- gies: those using steam turbines and combined-cycle systems are regarded as slow-startup generators and the rest, including gas turbines, internal combustion, and hydro, are fast-startup generators. In the NYISO system, there are 582 conventional units, among which there are 126 slow-startup units whose capacity makes up 26% of the total generation capacity. In the interest of experiments, we also consider varying flexibility for the conventional generation units. Additional Notation: We use notation xR and yL to indicate the x% percentage increase of VRES power capacity and multiplicative factor y for the scaled transmission line capacity, respectively. For example, 70R-2L denotes 70% wind power penetration with line capacities scaled by a factor of 2. In terms of varying generation flexibility, we use mFlx to denote the current state of medium generator flexibility, lFlx to denote the low flexibility case with all the generators as slow start-up units, and hFlx to denote the high flexibility case where all the generators are fast-startup units. We simulate on a MacBook Pro (2020) with a 2.3 GHz Quad-Core Intel Core i7 processor. We use the solver Gurobi to solve the LPs in Julia/JuMP. B. Performance of BiD-McCormick We show that the proposed relaxation technique for BiD can achieve good performance in accuracy and scalability. We simulate a case of high levels of VRES at 40R-1L- mFlx. Figures 1a and 1b show the expected system costs and day-ahead scheduled VRES amounts, respectively, where we adjust the upper bound parameter γ in (13). Different curves represent StD, BiD, and MyD, respectively. Table I shows the computation time for different scenarios and operation times. Accuracy: As we increase γ in a wide range from 0.2 to 1.4, in Figure 1a, the expected system cost under BiD (blue curve) is very close to StD (green curve) within a gap of 6%, but lower than MyD (red curve) by over 20%. This shows that BiD can achieve a performance close to the least-cost benchmark StD, which is also robust under the bound choice of γ. As shown in Figure 1b, the day-ahead scheduled VRES quantities under StD and BiD are more conservative than MyD to reduce the re-dispatch cost in the RTM. We also discuss the impact of the upper bound of dual variables in the McCormick envelope in Appendix D. Scalability: Our preliminary results [1] have shown that the conventional method of reformulating a MILP problem based on KKT conditions cannot solve the large-scale NYISO system within two hours, even for an economic dispatch problems with only 5 wind scenarios. In our extended UC problem, Table I shows that BiD can still compute the result within 20 minutes for 20 scenarios and 4 operation hours.7 However, we acknowledge that as the number of scenarios and operation hours increases, both BiD and StD may face computational challenges. 7Different values of γ ∈ [0, 1.6] do not change running time significantly. 8 0.0 0.5 1.0 1.5 Bound adjustment 300 320 340 360 380 400 420System cost (k$) StD BiD-McCormick MyD (a) 0.0 0.5 1.0 1.5 Bound adjustment 0 2 4 6DA wind schedule (GW) StD BiD-McCormick MyD (b) Fig. 1: (a) Expected system cost; (b) Day-ahead scheduled total VRES quantity. Both are functions of bound adjustment γ. TABLE I: NYISO: Computation time (minutes) for a varying number of uncertainty scenarios and operation hours. # Scenarios # Hours 5S2H 10S2H 20S2H 20S4H 20S6H MyD 0.35 0.35 0.35 0.53 1.0 BiD 2.0 3.1 7.4 19.4 48.9 StD 0.76 1.2 3.0 7.3 16.3 TABLE II: BiD vs MyD: System cost reduction. Under mFlx System cost reduction 10R-1L 0.3% 40R-1L 25% 70R-1L 23% 70R-2L 84% Under 70R-1L System cost reduction lFlx 93% mFlx 23% hFlx -0.4% To further facilitate the computation of large-scale stochas- tic linear programs, some decomposition techniques can be potentially applied to decompose across scenarios and hours so that the problem can be solved more efficiently in a dis- tributed manner. These methods include progressive hedging algorithms to decompose scenarios [44], [45], the lagrangian relaxation method for temporal decomposition [46], and the alternating direction method of multipliers (ADMM) to de- compose network and temporal constraints [47]. In addition to conventional optimization techniques, machine learning methods are now also gaining popularity in efficiently solving large-scale optimization problems, e.g., using neural networks to solve DC power flow problems [48] or directly solve bilevel programs [49]. These machine learning techniques can be explored in the future to solve the bilevel and linear programs more efficiently in power systems. C. BiD Performance: System Cost Reduction We show that the BiD framework can substantially reduce the expected system cost compared with MyD. However, this benefit is affected by the factors of VRES amounts and generator flexibility levels. Overall, a higher VRES penetration level and a lower flexibility level of generators will increase the performance gap between BiD and MyD. Furthermore, increasing transmission-line capacities may result in a much higher system cost under MyD (while a lower cost under BiD) because of the lack of flexible generators in real-time to deal with uncertainty. In Figure 2, we demonstrate the expected system costs under different parameter settings. The error bars show the standard deviation (std) of the results. In Figure 2a, we fix the flexibility level of generators at mFlx. We show the expected system costs under StD, BiD, and MyD, respectively, considering different VRES amounts and transmission-line capacities. In Figure 2b, we fix the VRES amounts and transmission-line capacity at 70R-1L and vary different flexibility levels of generators. In Table II, we show the values of system cost reduction when comparing BiD with MyD. In Figure 3, under different parameters, we show the load- serving power amounts (average over hours and scenarios) from different sources. Figure 3a shows DAM scheduled quantities of conventional generators and wind energy. Figure 3b shows actual power amounts from conventional generators, wind energy, and load shedding, to serve real-time load. We have the following observations. System cost reduction: BiD can substantially reduce the expected system cost and its volatility compared with MyD, particularly under high VRES generation amounts and limited flexibility of conventional generators. MyD cannot account for real-time re-dispatch costs, which prevents it from achieving market efficiency under high VRER amounts and lower flex- ibility levels of generators. In particular, under 70R-2L-mFlx (Figure 2a) or 70R-1L-lFlx (Figure 2b), the system cost can be very high under MyD due to the lost load in real-time as shown in Figure 3b. Impact of VRES penetration levels: A higher VRES penetra- tion level will reduce the system cost under BiD and StD, but can increase the system cost under MyD if the system lacks flexible generators. As shown in Figure 2a, the system cost under BiD and StD always decreases as the VRES amount or the transmission-line capacity increases. However, the system cost under MyD does not. For instance, when we increase the transmission line capacity from 1L to 2L in Figure 2a, the system cost rises significantly under MyD. The reason is that the increased line capacity allows more VRES to be dispatched in the DAM and keeps more slow-startup generators offline in the DAM. Then, it leads to load shedding (Figure 3b: 70R- 2L-mFlx) in real time due to the lack of flexible resources. Furthermore, note that although the wind-energy generation amount makes up 70% of the total demand, the transmission limit will lead to the curtailment of renewable energy in RTM. For example, under the case of 70R-2L-hFlx, the maximum amount serving the demand is about 50% in DAM (Figure 3a) and 30% in RTM (Figure 3b). Impact of generator flexibility: Increasing the flexibility level of generators (assuming unchanged generation costs) will reduce the expected system cost for each dispatch framework. MyD can achieve market efficiency close to BiD and StD if there is high flexibility. As shown in Figure 2b, for each dispatch framework, the increasing flexibility levels reduce the system cost. In fact, under hFlx, MyD, BiD, and StD will induce the same system cost (Figure 2b: hFlx) and similar real-time energy-source supply mix (Figure 3b: 70R-2L-hFlx), despite the different DAM schedule results (Figure 3a:70R- 2L-hFlx). Under the current flexibility level mFlx, i.e., 126 slow-startup units among 582 conventional generators, MyD 9 10R-1L-mFlx 40R-1L-mFlx 70R-1L-mFlx 70R-2L-mFlx 2000 1000 0 1000 2000 3000 4000 5000System cost (k$) 334 297 286 217 339 303 297 239340 407 382 1473 StD BiD MyD (a) 70R-1L-lFlx 70R-1L-mFlx 70R-1L-hFlx 5000 2500 0 2500 5000 7500 10000 12500 15000System cost (k$) 294 286 272370 297 272 5454 382 272 StD BiD MyD (b) Fig. 2: (a) Under mFlx: expected system cost under different wind-energy amounts (-R) and transmission line capacities (-L); (b) Under 70R-1L: expected system cost under different generator flexibility levels (-Flx). StD BiD MyD 70R-1L-lFlx 0 5 10 15 20DA power serving demand (GW) Conv Wind StD BiD MyD 70R-1L-mFlx StD BiD MyD 70R-2L-mFlx StD BiD MyD 70R-2L-hFlx StD BiD MyD 70R-4L-hFlx (a) StD BiD MyD 70R-1L-lFlx 0 5 10 15 20RT power serving demand (GW) Conv Wind Lost load StD BiD MyD 70R-1L-mFlx StD BiD MyD 70R-2L-mFlx StD BiD MyD 70R-2L-hFlx StD BiD MyD 70R-4L-hFlx (b) Fig. 3: (a) DAM schedule to serve demand from different sources. (b) Actual power to serve demand in real time from different sources. 0 200 400 600 800 1000 1200 1400 1600 Nodes 100 50 0 50 100 150 200Price ($/MWh) A C E F G K BiD (DAM) BiD (RTM) MyD (DAM) MyD (RTM) (a) 2 4 6 8 10 12 14 16 18 20 Scenarios 50 100 150 200 250 300Price ($/MWh) BiD (DAM) BiD (RTM) MyD (DAM) MyD (RTM) (b) 10R-1L-mFlx 40R-1L-mFlx 70R-1L-mFlx 70R-1L-hFlx 70R-4L-hFlx 800 600 400 200 0 200Revenues of wind producers (k$)25 37 -6 13 40 16 -288 -327 -48 27 BiD MyD (c) Fig. 4: BiD vs MyD: (a) Hourly DAM and RTM prices (average in scenarios) under different nodes, where A-K show different regions of NYISO (with parameter setting 40R-1L-mFlx); (b) Hourly DAM and RTM prices (average in nodes) under different scenarios (with parameter setting 40R-1L-mFlx). (c) Wind producers’ revenues (total in DAM and RTM) under different parameter settings. 0 10 20 30 40 50 Sample tests 300 350 400 450 500System cost (k$) StD BiD MyD Fig. 5: Expected system costs under different samples where dash lines are for the initial scenario set. does not work well under high penetration levels of VRES. D. Out-of-Sample Test Our work optimizes the DAM bidding strategies of VRES based on the given probability distributions of VRES gener- ators. Different probability distributions will lead to different solutions. The uncertainty of VRES is initially modeled by continuous probability distributions. 8 The reason to do the out-of-sample test is that we are using discrete scenarios to approximate the initial continuous probability distributions. The newly generated scenarios for out-of-sample testing are sampled from the same continuous probability distribution as the original scenarios based on the Monte Carlo method. We show that BiD achieves more robust results than MyD in out-of-sample tests. Recall that Figure 2 shows results based on the initial 20 scenarios of wind power and load forecast. 8The continuous probability distributions are modeled in PGscen [50]. 10 Now, we will test the day-ahead schedule obtained under the initial scenario set on other scenario sets. In the out-of-sample test, we still use PGscen to generate different scenario sets of wind energy and load. Note that PGscen uses the Monte Carlo method to generate scenarios. For each test, we randomly generate 20 scenarios. Given the day-ahead schedule under the initial scenario set in Section V, we compute the re-dispatch result under the newly generated scenario set and calculate the total system cost. We run 50 tests in total and focus on the setting of 40R-1L-mFlx. In Figure 5, we show the system costs under different test samples for MyD (red solid curve), BiD (blue solid curve), and StD (green solid curve), respectively. The dashed flat curves show the system cost under the original scenario set in Section V. The std values (k$) of system costs under MyD, BiD, and StD are 39.3, 7.9, and 8.6, respectively. Figure 5 shows that BiD and StD can achieve more robust results in terms of system costs under different scenario samples, compared with MyD. MyD schedules more VRES in DAM and brings more uncertainty. In addition, we discuss the impact of the number of scenarios on the out-of-sample test in Appendix E. E. BiD Performance: Prices and Revenues We demonstrate that BiD is effective in reducing the volatil- ity of various market factors when compared to MyD. By bringing more conventional generators online in the DAM, BiD can decrease the volatility of market prices and wind producers’ revenues across scenarios.9 Additionally, BiD can help to prevent negative revenues for VRES. In Figures 4a and b, we set the parameters at 40R-1L-mFlx. We show the market prices at different nodes (average in sce- narios) and different scenarios (average in nodes), respectively. The solid and dotted curves show the DAM and RTM prices, respectively. The blue curves show the BiD result and the orange ones are for MyD. In Figures 4c, we show the revenues for wind producers under different parameter settings. Volatility reduction: BiD can reduce the volatility of market prices and VRES producers’ revenues. As shown in Figures 4a and 4b, the market prices under BiD exhibit less volatility across nodes and scenarios. Moreover, under BiD, the RTM prices fluctuate around the DAM prices, whereas MyD gener- ates higher RTM prices than DAM in almost all scenarios and nodes. In Figure 4c, under high VRES amounts and limited generator flexibility (i.e., 40R-1L-mFlx and 70R-1L-mFlx), the std values of revenues are much smaller under BiD than MyD. However, with lower VRES amounts and higher generator flexibility, the std values under BiD and MyD are similar. Revenue uplift for VRES: BiD can effectively prevent rev- enue loss for VRES producers compared with MyD. Figure 4c shows that under conditions of high VRES amounts and limited generator flexibility (e.g., 40R-1L-mFlx and 70R-1L- mFlx), wind producers experience negative profits under MyD. This is due to high RTM prices and low DAM prices (in Figures 4a-b), despite more scheduled VRES in the DAM. 9We also show the results for conventional generators’ revenues and RTM re-dispatch amounts in Appendix C. VI. CONCLUSION In this paper, we propose a computationally efficient mech- anism for adjusting the quantity of VRES in the DAM, which takes into account uncertain real-time imbalance costs while remaining compatible with the existing sequential market- clearing structure. To efficiently solve the bilevel optimization problems involved, we propose a linear relaxation technique based on strong duality and McCormick envelopes. This method can be applied to the relaxed unit-commitment prob- lem for large-scale systems, where the conventional approach for bi-level optimization based on MILP fails. We evaluate our bilevel framework on the 1576-bus NYISO system and compare it with the myopic strategy where VRES producers bid the expected forecast value in the DAM. Numerical studies demonstrate that, in the future market with high penetration levels of VRES, our bilevel framework can achieve significant economic benefits by efficiently adjusting VRES dispatch in the DAM. For example, it can significantly reduce the expected system cost, and volatility of market prices and revenues. The proposed bilevel framework can provide a market- efficiency benchmark for VRES bidding quantities in the DAM. It can also potentially assist in market monitoring of VRES bidding strategies. In future work, we plan to explore decomposition methods to further improve computational ef- ficiency and investigate how to effectively incorporate this framework into current electricity market designs. REFERENCES [1] D. Zhao, V. Dvorkin, S. Delikaraoglou, A. J. Lamadrid L., and A. Bot- terud, “A scalable bilevel framework for renewable energy scheduling,” ACM e-Energy, 2023. [2] REN21, “Renewables 2021 global status report,” 2021. [3] NYISO, “2021-2040 system & resource outlook (the outlook),” 2022. [4] CAISO, “Caiso 20-year transmission outlook,” 2022. [5] Z. Zhou, A. Botterud, and T. Levin, “Price formation in zero-carbon elec- tricity markets: The role of hydropower,” Argonne National Lab.(ANL), Argonne, IL (United States), Tech. Rep., 2022. [6] D. S. Kirschen and G. Strbac, Fundamentals of power system economics. John Wiley & Sons, 2018. [7] “Wind and solar resource bidding, scheduling, dispatch, and settlement,” NYISO: Technical Bulletin 154, 2021. [8] S. Wong and J. D. Fuller, “Pricing energy and reserves using stochastic optimization in an alternative electricity market,” IEEE Transactions on Power Systems, vol. 22, no. 2, pp. 631–638, 2007. [9] V. M. Zavala, K. Kim, M. Anitescu, and J. Birge, “A stochastic elec- tricity market clearing formulation with consistent pricing properties,” Operations Research, vol. 65, no. 3, pp. 557–576, 2017. [10] L. Exizidis, J. Kazempour, A. Papakonstantinou, P. Pinson, Z. De Gr`eve, and F. Vall´ee, “Incentive-compatibility in a two-stage stochastic electricity market with high wind power penetration,” IEEE Transactions on Power Systems, vol. 34, no. 4, pp. 2846–2858, July 2019. [11] J. Kazempour, P. Pinson, and B. F. Hobbs, “A stochastic market design with revenue adequacy and cost recovery by scenario: Benefits and costs,” IEEE Transactions on Power Systems, vol. 33, no. 4, pp. 3531– 3545, 2018. [12] J. M. Morales, A. J. Conejo, K. Liu, and J. Zhong, “Pricing electricity in pools with wind producers,” IEEE Transactions on Power Systems, vol. 27, no. 3, pp. 1366–1376, 2012. [13] R. Mieth, M. Roveto, and Y. Dvorkin, “Risk trading in a chance- constrained stochastic electricity market,” IEEE Control Systems Letters, vol. 5, no. 1, pp. 199–204, 2020. [14] Y. Dvorkin, “A chance-constrained stochastic electricity market,” IEEE Transactions on Power Systems, vol. 35, no. 4, pp. 2993–3003, 2019. [15] V. Dvorkin, D. Mallapragada, and A. Botterud, “Multi-stage decision rules for power generation & storage investments with performance guarantees,” IEEE Transactions on Power Systems, pp. 1–14, 2023. 11 [16] A. Velloso, A. Street, D. Pozo, J. M. Arroyo, and N. G. Cobos, “Two- stage robust unit commitment for co-optimized electricity markets: An adaptive data-driven approach for scenario-based uncertainty sets,” IEEE Transactions on Sustainable Energy, vol. 11, no. 2, pp. 958–969, 2019. [17] N. G. Cobos, J. M. Arroyo, N. Alguacil, and A. Street, “Network- constrained unit commitment under significant wind penetration: A multistage robust approach with non-fixed recourse,” Applied energy, vol. 232, pp. 489–503, 2018. [18] J. M. Morales, M. Zugno, S. Pineda, and P. Pinson, “Electricity market clearing with improved scheduling of stochastic production,” European Journal of Operational Research, vol. 235, no. 3, pp. 765–774, 2014. [19] N. Viafora, S. Delikaraoglou, P. Pinson, G. Hug, and J. Holbll, “Dynamic reserve and transmission capacity allocation in wind-dominated power systems,” IEEE Transactions on Power Systems, 2020. [20] S. Delikaraoglou and P. Pinson, “Optimal allocation of HVDC intercon- nections for exchange of energy and reserve capacity services,” Energy Systems, vol. 10, no. 3, pp. 635–675, 2019. [21] V. Dvorkin, S. Delikaraoglou, and J. M. Morales, “Setting reserve requirements to approximate the efficiency of the stochastic dispatch,” IEEE Trans. on Power Systems, vol. 34, no. 2, pp. 1524–1536, 2018. [22] S. Dempe and A. Zemkoho, “Bilevel optimization,” Springer optimiza- tion and its applications, vol. 161, 2020. [23] W. Bialas and M. Karwan, “On two-level optimization,” IEEE transac- tions on automatic control, vol. 27, no. 1, pp. 211–214, 1982. [24] S. Dempe, “A simple algorithm for the-linear bilevel programming problem,” Optimization, vol. 18, no. 3, pp. 373–385, 1987. [25] D. Zhao, H. Wang, J. Huang, and X. Lin, “Virtual energy storage sharing and capacity allocation,” IEEE transactions on smart grid, vol. 11, no. 2, pp. 1112–1123, 2019. [26] M. M. Stojiljkovi´c, “Bi-level multi-objective fuzzy design optimization of energy supply systems aided by problem-specific heuristics,” Energy, vol. 137, pp. 1231–1251, 2017. [27] R. Kuo and C. Huang, “Application of particle swarm optimization algorithm for solving bi-level linear programming problem,” Computers & Mathematics with Applications, vol. 58, no. 4, pp. 678–685, 2009. [28] J. Salmeron, K. Wood, and R. Baldick, “Worst-case interdiction anal- ysis of large-scale electric power grids,” IEEE Transactions on Power Systems, vol. 24, no. 1, pp. 96–104, 2009. [29] T. Kleinert, M. Labb´e, I. Ljubi´c, and M. Schmidt, “A survey on mixed- integer programming techniques in bilevel optimization,” EURO Journal on Computational Optimization, vol. 9, p. 100007, 2021. [30] J. F. Bard and J. T. Moore, “A branch and bound algorithm for the bilevel programming problem,” SIAM Journal on Scientific and Statistical Computing, vol. 11, no. 2, pp. 281–292, 1990. [31] D. J. White and G. Anandalingam, “A penalty function approach for solving bi-level linear programs,” Journal of Global Optimization, vol. 3, pp. 397–419, 1993. [32] S. Boyd, S. P. Boyd, and L. Vandenberghe, Convex optimization. Cambridge university press, 2004. [33] B. Zhou, J. Fang, X. Ai, S. Cui, W. Yao, Z. Chen, and J. Wen, “Storage right-based hybrid discrete-time and continuous-time flexibility trading between energy storage station and renewable power plants,” IEEE Transactions on Sustainable Energy, vol. 14, no. 1, pp. 465–481, 2022. [34] Y. Yang, Y. Chen, G. Hu, and C. J. Spanos, “Optimal network charge for peer-to-peer energy trading: A grid perspective,” IEEE Transactions on Power Systems, 2022. [35] G. P. McCormick, “Computability of global solutions to factorable nonconvex programs: Part I—convex underestimating problems,” Math- ematical programming, vol. 10, no. 1, pp. 147–175, 1976. [36] S. Cerisola, J. M. Latorre, and A. Ramos, “Stochastic dual dynamic programming applied to nonconvex hydrothermal models,” European Journal of Operational Research, vol. 218, no. 3, pp. 687–697, 2012. [37] M. Ili´c and D. Zhao, “Dynamic reserves for managing wind power,” in 2023 IEEE Power & Energy Society General Meeting (PESGM), 2023, pp. 1–5. [38] U. Cali, M. Kuzlu, M. Pipattanasomporn, J. Kempf, L. Bai, U. Cali, M. Kuzlu, M. Pipattanasomporn, J. Kempf, and L. Bai, “Optimization and digitalization of power markets,” Digitalization of Power Markets and Systems Using Energy Informatics, pp. 217–232, 2021. [39] S. Greene, “NYISO network 2019,” University of Wisconsin-Madison, Tech. Rep., 2022. [40] “Market participants: User’s guide,” NYISO, 2021. [41] J. Kazempour and B. F. Hobbs, “Value of flexible resources, virtual bidding, and self-scheduling in two-settlement electricity markets with wind generation—part i: principles and competitive model,” IEEE Trans- actions on Power Systems, vol. 33, no. 1, pp. 749–759, 2017. [42] S. Kasina, S. Wogrin, and B. Hobbs, “A comparison of unit commitment approximations for generation production costing,” IEEE Transactions on Power Systems, 2014. [43] R. Carmona and X. Yang, “Joint stochastic model for electric load, solar and wind power at asset level and monte carlo scenario generationren\\’e carmona\\& xinshuo yang,” arXiv preprint arXiv:2209.13497, 2022. [44] C. Ordoudis, P. Pinson, M. Zugno, and J. M. Morales, “Stochastic unit commitment via progressive hedging—extensive analysis of solution methods,” in 2015 IEEE Eindhoven PowerTech. IEEE, 2015, pp. 1–6. [45] Y. Gu and L. Xie, “Stochastic look-ahead economic dispatch with variable generation resources,” IEEE Transactions on Power Systems, vol. 32, no. 1, pp. 17–29, 2016. [46] K. Kim, A. Botterud, and F. Qiu, “Temporal decomposition for improved unit commitment in power system production cost modeling,” IEEE Transactions on Power Systems, vol. 33, no. 5, pp. 5276–5287, 2018. [47] M. J. Feizollahi, M. Costley, S. Ahmed, and S. Grijalva, “Large-scale decentralized unit commitment,” International Journal of Electrical Power & Energy Systems, vol. 73, pp. 97–106, 2015. [48] X. Pan, “Deepopf: deep neural networks for optimal power flow,” in Proceedings of the 8th ACM International Conference on Systems for Energy-Efficient Buildings, Cities, and Transportation, 2021, pp. 250– 251. [49] I. Molan and M. Schmidt, “Using neural networks to solve linear bilevel problems with unknown lower level,” Optimization Letters, pp. 1–21, 2023. [50] “Arpa-e’s perform program data plan.” [On- line]. Available: https://arpa-e.energy.gov/news-and-media/blog-posts/ arpa-es-perform-program-data-plan APPENDIX A. 24-hour Scheduling Horizon We present the result of the 24-hour schedule of market- clearing models. Due to computation complexity, we solve the models of MyD, BiD, and StD, respectively, for every 4- hour horizon, and roll into 24 hours eventually. We use the parameter setting 40R-1L-mFlx as one example. In Figure 6a, we show the scenarios of system wind energy (in blue) and load (in red) over 24 hours (on day August 2, 2019), where the highlighted curves show the average profiles. In Figure 6b, we present the 24-hour expected system costs for MyD (in red), BiD (in blue), and StD (in green), respectively. Figure 6c simulates the DAM (solid curves) and RTM prices (dashed curves) for MyD (in red) and BiD (in blue). As shown in Figure 6, when the system load is high, e.g., around 15:00, the system cost under MyD is much higher than that under BiD. When the load is low, e.g., around 24:00, the system costs under MyD and BiD are very close because we can have adequate flexible generators to deal with real-time uncertainty. In contrast, the system cost under BiD is always close to StD. Furthermore, in terms of market prices, RTM prices under MyD can be very high in the mid-day while under BiD, RTM and DAM prices are close. B. Performance of Relaxed Unit Commitment Problems In Section II of the main text, we relaxed binary variables of unit commitment into continuous variables [0, 1] to maintain the convexity of the lower-level problem. In this appendix, we show that this relaxation can well approximate the binary variable modeling. We focus on the setting of 40R-1L-mFlx . First, we show that under the relaxation model, most of the unit-commitment solutions are either 0 or 1. In Figure 7a, we show the frequency of relaxed DAM unit commitment solutions u DA⋆ i,t (all hours and conventional generators) under 12 (a) (b) (c) Fig. 6: 24-hour results: (a) Wind-energy generations and load; (b) Expected system costs; (c) Market prices. (a) (b) Fig. 7: BiD: (a) Frequency of UC solutions in DAM; (b) Frequency of UC solutions in RTM. BiD. In Figure 7b, we show the frequency of relaxed RTM unit commitment solutions u RT⋆ i,t,ω (all hours, scenarios, and conventional generators) under BiD. As shown in Figures 7a and 7b, the solutions of 1 and 0 absolutely dominate all the solution outcomes. For DAM, the UC solutions lying in (0, 1) only make up 0.77% of the total number of variables. For RTM, the UC solutions lying in (0, 1) only make up 0.89%. Second, we show that given the obtained bidding quantities of VRES, the relaxed model and the accurate binary model induce similar system costs. Although the bilevel model is based on relaxed unit-commitment decisions, the main purpose is to obtain the optimal bidding quantities of VRES. Hence, the system operator can continue to clear the DAM and RTM market using an accurate unit-commitment model with binary variables. To investigate this issue in more detail, we test the accurate unit-commitment model based on the optimal bidding quantities of VRES, which shows a system cost very similar to the relaxed unit-commitment model. Specifically, based on the relaxed unit-commitment model, we have the system costs (per hour) for NYISO: The DAM cost= 303 K$; the expected RTM cost= -3K$; the total system cost= 300K$. For the system costs based on the accurate unit-commitment model with binary variables, we have the DAM cost= 305K$; the expected RTM cost= -5K$; the total system cost= 300K$. C. Volatility Reduction We show the volatility reduction for conventional genera- tors’ revenues and RTM re-dispatch amounts. In Figure 8, under different system parameter settings, we show (a) revenues of all conventional generators, and (b) upward adjustments in RTM. The blue and orange bars show the results under BiD and MyD, respectively. We demonstrate 10R-1L-mFlx 40R-1L-mFlx 70R-1L-mFlx 70R-1L-hFlx 70R-4L-hFlx 0 200 400 600 800 1000 1200Revenues of conventional generators (k$) 625 541 509 428 226 591 719 676 391 235 BiD MyD (a) 10R-1L-mFlx 40R-1L-mFlx 70R-1L-mFlx 70R-1L-hFlx 70R-4L-hFlx 0 2 4 6 8RT upward adjustment (GW) 0.5 0.6 0.7 1.7 4.0 0.9 2.3 2.2 2.5 5.0 BiD MyD (b) Fig. 8: BiD vs MyD: (a) All conventional generators’ profits; (b) RTM upward adjustments. Both are average in hours. the average values in terms of scenarios and hours, where the error bars show the std in scenarios. Revenue volatility reduction: BiD can reduce the volatility of conventional generators’ revenues and RTM upward adjust- ments. In Figures 8a-b, under high VRES amounts and limited generator flexibility (i.e., 40R-1L-mFlx and 70R-1L-mFlx), the std values of conventional units’ revenues and RTM upward adjustments are much smaller under BiD than under MyD. However, with lower VRES amounts and higher generator flexibility, the std values under BiD and MyD are similar. Upward-adjustment reduction: Compared with MyD, BiD can significantly reduce the upward adjustment in the RTM. As shown in Figure 8b, MyD requires higher upward adjustment in RTM, compared with BiD, particularly under 40R-1L-mFlx and 70R-1L-mFlx. The reason is that with limited flexibility, BiD tends to be more conservative in dispatching wind energy in DAM. Thus, BiD brings more conventional generators online, which mitigates the impact of VRES uncertainty in real time and reduces the requirement for upward adjustment. 13 0.8 1.0 1.2 1.4 1.6 1.8 2.0 Dual bound adjustment 325 350 375 400 425 450System cost (k$) StD BiD-McCormick MyD (a) 0.8 1.0 1.2 1.4 1.6 1.8 2.0 Dual bound adjustment 0 1 2 3 4 5 6DA wind schedule (GW) StD BiD-McCormick MyD (b) Fig. 9: (a) Expected system cost; (b) Day-ahead scheduled total VRES quantity. Both are functions of dual bound adjustment ξ. D. Upper Bound choices of Dual Variables in the McCormick Envelope In Figure 1, we show how the upper bounds of bidding quantities in the McCormick envelope impact the result. We now further demonstrate simulation results by varying the upper bound of the dual variables in the McCormick envelope. The results show that a lower upper bound can lead to infeasi- ble solutions. However, when there are feasible solutions, the solutions are robust when we increase the upper bound of the dual variables. For demonstration, we use 5 scenarios to save computation time. Recall that we have the bilinear item zk,t = λ W k,t · Wk,t. In Figure 1, we have discussed the impact of the upper bound of Wk,t. For the lower bounds and upper bounds of λk,t, i.e., 0 ⩽ λW k,t ⩽ βλ k,t, we set the upper bound βλ k,t = ξ · λW k,t(0), where λ W k,t(0) denotes the dual solution of λW k,t in the DAM schedule when all VRES producers bid zero quantity. In the simulation results of Section V, we let ξ = 1. In this simulation, we vary ξ between [0, 2]. We find that when 0 ≤ ξ ≤ 0.6, there is no feasible solution. However, when 0.8 ≤ ξ ≤ 2, the solutions, e.g., system cost (Figure 9a) and DAM wind schedule amount (Figure 9b) will remain robust. This shows that the upper bound of the dual variables may have a limited impact on the solution accuracy while the upper bound of wind bidding quantities has a larger impact as shown in Figure 1. E. Impact of Number of Scenarios on Out-of-sample Test We demonstrate how the number of scenarios impacts the out-of-sample performance of the model. We test the cases of 10, 20, and 30 scenarios, respectively. We first obtain the optimal bidding quantities of VRES based on the 10, 20, and 30 scenarios, respectively. Then, in the out-of-sample test, for each case, we randomly generate 30 scenarios for VRES actual generations and examine the ex- pected system cost under the newly generated 30 scenarios. We randomly generate 30 scenarios by 50 times to evaluate varieties. We show the mean value and the standard deviation (std) values among 50 tests for each case in Table III. A larger number of scenarios perform better in the out-of-sample test with lower expected system costs and lower std values. TABLE III: NYISO: mean and std over 50 tests. # Scenarios mean (k$) std (k$) 10 310.00 6.73 20 303.89 6.70 30 302.71 5.95","libVersion":"0.3.2","langs":""}