/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var k=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var I=(t,e)=>{for(var s in e)k(t,s,{get:e[s],enumerable:!0})},D=(t,e,s,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of A(e))!O.call(t,i)&&i!==s&&k(t,i,{get:()=>e[i],enumerable:!(n=N(e,i))||n.enumerable});return t};var V=t=>D(k({},"__esModule",{value:!0}),t);var H={};I(H,{default:()=>w});module.exports=V(H);var r=require("obsidian"),b=require("@codemirror/view");var g={CHECKBOX:/- \[.]/.source,BULLET:/-|\*|\+/.source,NUMBER:/[0-9]+[.)]/.source,HEADING:/#{1,6}/.source,QUOTE:/>/.source,CODEBLOCK:/```/.source},$=new RegExp(`(?:${g.CHECKBOX}|${g.BULLET}|${g.NUMBER}|${g.HEADING}|${g.QUOTE})`),y=new RegExp(`(?<prefix0>^\\s*${$.source} )|(?:(?<prefix1>^${g.CODEBLOCK}).+)`),U=new RegExp(`${g.CHECKBOX}|${g.BULLET}|${g.NUMBER}`),q=new RegExp(`${g.BULLET}|${g.NUMBER}`),R=new RegExp(`^(?<whitespace>\\s*)(?<existing>${U.source}) (?<new>${q.source})`);function L(t){let e=t.getCursor().line,s=t.getCursor().ch,i=t.getLine(e).match(R);if((i==null?void 0:i[0].length)!==s)return;let o=i.groups;if(o.new===o.existing)return;let l={line:e,ch:o.whitespace.length},c={line:e,ch:i[0].length};t.replaceRange(o.new,l,c)}function x(t,e){var o;if(T((o=document.getSelection())==null?void 0:o.anchorNode,"table")||!t){console.log("blockier: falling back to selecting closest live preview element"),v();return}let n=t.listSelections(),i;if(e.selectFullCodeBlock&&n.length===1){let l=K(t);i=l!==void 0?[l]:void 0}if(i===void 0&&(i=n.map(l=>M(t,l,e.selectBlockAvoidsPrefixes))),e.selectAllIfUnchanged&&W(n,i)){v();return}t.setSelections(i)}function v(){let t=document.getSelection(),e=T(t==null?void 0:t.anchorNode,".cm-content");if(!t||!e)return;let s=document.createRange();s.selectNodeContents(e),t.removeAllRanges(),t.addRange(s)}function K(t){var h;let e=t.listSelections().first();if(!e||t.getSelection().contains("```")||t.getLine(e.anchor.line).contains("```")||t.getLine(e.anchor.line).contains("```"))return;let s=t.getRange({line:0,ch:0},e.anchor),n=!1;if((h=s.match(/```.*/g))==null||h.forEach(d=>{d.trim().length>3?n=!0:n=!n}),!n)return;let i=t.lastLine(),o=e.anchor.line,l=t.getLine(o);for(;!l.contains("```");){if(o<=0)return;o-=1,l=t.getLine(o)}let c=e.head.line,u=t.getLine(c);for(;!u.endsWith("```");){if(c>=i)return;c+=1,u=t.getLine(c)}return{anchor:{line:o+1,ch:0},head:{line:c-1,ch:t.getLine(c-1).length}}}function M(t,e,s){var o,l,c,u,h;let[n,i]=_(e.anchor,e.head);if(n.line!==i.line||!s)return{anchor:{ch:0,line:n.line},head:{ch:t.getLine(i.line).length,line:i.line}};{let d=n.line,B=t.getLine(d),a=(o=B.match(y))==null?void 0:o.groups;return{anchor:{ch:(h=(u=(l=a==null?void 0:a.prefix0)==null?void 0:l.length)!=null?u:(c=a==null?void 0:a.prefix1)==null?void 0:c.length)!=null?h:0,line:d},head:{ch:B.length,line:d}}}}function _(t,e){return t.line<e.line?[t,e]:t.line>e.line?[e,t]:t.ch<e.ch?[t,e]:[e,t]}function T(t,e){var s,n;return t?t.nodeType===Node.ELEMENT_NODE?t.closest(e):(n=(s=t.parentElement)==null?void 0:s.closest(e))!=null?n:null:null}function W(t,e){for(let s=0;s<t.length;s++)if(!F(t[s],e[s]))return!1;return!0}function F(t,e){return P(t.anchor,e.anchor)&&P(t.head,e.head)}function P(t,e){return t.ch===e.ch&&t.line==e.line}var m=require("obsidian"),f=class extends m.EditorSuggest{constructor(s,n,i){super(s);this.app=s;this.plugin=n;this.opts=i}onTrigger(s,n){let o=n.getLine(s.line).slice(0,s.ch).match(this.opts.triggerRegex);if(o){let l=o[1];return{start:p(s,-l.length),end:s,query:l}}return null}getSuggestions(s){let n=this.opts.suggestions;if(s.query==="")return n;let i=n.findIndex(l=>l.startsWith(s.query));if(i===-1)return n;let o=[n[i]];return o.push(...n.slice(0,i)),o.push(...n.slice(i+1)),o}renderSuggestion(s,n){let i=n.createDiv();i.classList.add("markdown-rendered","markdown-preview-view",this.opts.suggestionClass),m.MarkdownRenderer.render(this.app,this.opts.renderMarkdown(s),i,"",this.plugin)}selectSuggestion(s){if(!this.context)return;let n=this.context,i=n.editor.getCursor();n.editor.replaceRange(s+"] ",n.start,n.end);let o=n.editor.getLine(i.line).indexOf("]")+2-i.ch,l=p(i,o);n.editor.setCursor(l);let c=n.editor.getRange(l,p(l,2));c==="] "?n.editor.replaceRange("",l,p(l,2)):c[0]==="]"&&n.editor.replaceRange("",l,p(l,1))}},E=class extends f{constructor(e,s,n){super(e,s,{suggestions:n.split(""),triggerRegex:/^\s*- \[(.?)$/,suggestionClass:"blockier-checkbox-suggestion",renderMarkdown:i=>`- [${i}] \`${i}\``})}},S=class extends f{constructor(e,s,n){super(e,s,{suggestions:n.split(",").map(i=>i.trim()),triggerRegex:/^\s*> ?\[!(\w*)$/,suggestionClass:"blockier-callout-suggestion",renderMarkdown:i=>`> [!${i}]`})}};function p(t,e){return{...t,ch:t.ch+e}}var G={replaceBlocks:!0,selectBlockAvoidsPrefixes:!0,selectAllIfUnchanged:!1,selectFullCodeBlock:!1,showCheckboxSuggestions:!1,checkboxVariants:' x><!-/?*nliISpcb"0123456789',showCalloutSuggestions:!0,calloutSuggestions:"note, summary, info, todo, tip, check, help, warning, fail, error, bug, example, quote",enableSelectBlockEE:!0},w=class extends r.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new C(this.app,this)),this.addCommand({id:"select-block",name:"Select block",editorCallback:e=>{x(e,this.settings)}}),this.registerEditorExtension(b.keymap.of([{key:"Space",run:()=>{let e=this.app.workspace.getActiveViewOfType(r.MarkdownView);return this.settings.replaceBlocks&&e&&L(e.editor),!1}}])),this.settings.enableSelectBlockEE&&this.registerEditorExtension(b.keymap.of([{key:"c-a",mac:"m-a",run:()=>{var s;let e=(s=this.app.workspace.activeEditor)==null?void 0:s.editor;return x(e,this.settings),!0}}])),this.settings.showCheckboxSuggestions&&this.registerEditorSuggest(new E(this.app,this,this.settings.checkboxVariants)),this.settings.showCalloutSuggestions&&this.registerEditorSuggest(new S(this.app,this,this.settings.calloutSuggestions))}async loadSettings(){this.settings=Object.assign({},G,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},C=class extends r.PluginSettingTab{constructor(e,s){super(e,s),this.plugin=s}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Select block"}),new r.Setting(e).setName("Use ctrl/cmd-A for Select block").setDesc("Whether to override ctrl/cmd-A for the Select block command. Disable this and set a hotkey in hotkey settings if you prefer a different hotkey. Reload required.").addToggle(s=>s.setValue(this.plugin.settings.enableSelectBlockEE).onChange(async n=>{this.plugin.settings.enableSelectBlockEE=n,await this.plugin.saveSettings(),new r.Notice("Reload required!")})),new r.Setting(e).setName("Only select paragraphs").setDesc("Whether the Select block command will avoid selecting block prefixes.").addToggle(s=>s.setValue(this.plugin.settings.selectBlockAvoidsPrefixes).onChange(async n=>{this.plugin.settings.selectBlockAvoidsPrefixes=n,await this.plugin.saveSettings()})),new r.Setting(e).setName("Select all on double activation").setDesc("Whether the Select block command will select everything if the new selection would be unchanged.").addToggle(s=>s.setValue(this.plugin.settings.selectAllIfUnchanged).onChange(async n=>{this.plugin.settings.selectAllIfUnchanged=n,await this.plugin.saveSettings()})),new r.Setting(e).setName("Select full code block").setDesc("Whether the Select block command will select the entire code block when the cursor is inside one.").addToggle(s=>s.setValue(this.plugin.settings.selectFullCodeBlock).onChange(async n=>{this.plugin.settings.selectFullCodeBlock=n,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Block edit"}),new r.Setting(e).setName("Replace blocks").setDesc("Replaces the block type if you enter the prefix at the start of the paragraph.").addToggle(s=>s.setValue(this.plugin.settings.replaceBlocks).onChange(async n=>{this.plugin.settings.replaceBlocks=n,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Suggestions"}),new r.Setting(e).setName("Show checkbox suggestions").setDesc("Whether to show suggestions of checkbox variants supported by your theme. Reload required.").addToggle(s=>s.setValue(this.plugin.settings.showCheckboxSuggestions).onChange(async n=>{this.plugin.settings.showCheckboxSuggestions=n,await this.plugin.saveSettings(),new r.Notice("Reload required!")})),new r.Setting(e).setName("Checkbox suggestion variants").setDesc("Which checkboxes to be shown in the suggestion. These should be supported by your theme. Each character will be one suggestion.").addText(s=>s.setValue(this.plugin.settings.checkboxVariants).onChange(async n=>{this.plugin.settings.checkboxVariants=n,await this.plugin.saveSettings()})),new r.Setting(e).setName("Show callout suggestions").setDesc("Whether to show suggestions of callout variants supported by your theme. Reload required.").addToggle(s=>s.setValue(this.plugin.settings.showCalloutSuggestions).onChange(async n=>{this.plugin.settings.showCalloutSuggestions=n,await this.plugin.saveSettings(),new r.Notice("Reload required!")})),new r.Setting(e).setName("Callout suggestion variants").setDesc("Which callouts to be shown in the suggestion. Separate by commas.").addTextArea(s=>s.setValue(this.plugin.settings.calloutSuggestions).onChange(async n=>{this.plugin.settings.calloutSuggestions=n,await this.plugin.saveSettings()}))}};
